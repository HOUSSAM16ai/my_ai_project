---
# ======================================================================================
# PYTHON VERIFY - Strict Code Quality Check for Protected Branches
# ======================================================================================
# This workflow enforces strict code quality on protected branches (main, release)
# - Runs on push to protected branches
# - Check-only mode (no auto-fix)
# - Ensures code quality standards are maintained
# - Should be set as required check in branch protection rules
# ======================================================================================

name: python-verify

"on":
  push:
    branches: [main, release/**]
    paths:
      - "**/*.py"
      - "pyproject.toml"
      - ".pre-commit-config.yaml"

jobs:
  verify:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üêç Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: üì¶ Install quality tools
        run: |
          pip install --disable-pip-version-check \
            black==24.10.0 ruff==0.6.9

      - name: ‚ö´ Black (check only)
        run: |
          echo "‚ö´ Checking code formatting with Black..."
          black --check --diff --color --line-length=100 app/ tests/
          echo "‚úÖ Black check passed!"

      - name: ‚ö° Ruff (lint only)
        run: |
          echo "‚ö° Linting code with Ruff..."
          ruff check .
          echo "‚úÖ Ruff check passed!"

          # Explicit success exit
          exit 0

{
  "name": "CogniForge - Ultimate Edition",
  "dockerComposeFile": ["docker-compose.host.yml"],
  "service": "web",
  "workspaceFolder": "/app",

  // --- القوة المطلقة ---
  // العمل بصلاحيات الروت داخل بيئة التطوير فقط
  "remoteUser": "root",

  "remoteEnv": {
    "HOME": "/root",
    "PYTHONUNBUFFERED": "1"
  },

  // Ensure Dockerfile CMD/ENTRYPOINT is overridden to keep container alive
  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  // 1. Initialize: Local setup (Optional, usually implicit)
  // "initializeCommand": "bash .devcontainer/local-setup.sh",

  // 2. Post Create: Dependencies & DB Migrations
  "postCreateCommand": "bash .devcontainer/on-create.sh",

  // 3. Post Start: Launch background services
  "postStartCommand": "bash .devcontainer/on-start.sh",

  // 4. Post Attach: Orchestrate setup
  "postAttachCommand": "/bin/bash scripts/setup_dev.sh",

  // STRICT PORT CONFIGURATION
  // "forwardPorts" makes them available locally.
  "forwardPorts": [8000],

  // "appPort" is the property specific to VS Code Web / Codespaces
  // to indicate which ports are actually served by the application.
  "appPort": ["8000"],

  "portsAttributes": {
      "8000": {
        "label": "CogniForge Unified Interface",
        "onAutoForward": "openBrowser",
        "visibility": "public"
      },
      // Explicitly ignore common noise ports to prevent confusion
      "5000": { "onAutoForward": "ignore" },
      "5432": { "onAutoForward": "ignore" }
  },

  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "username": "root"
    },
    "ghcr.io/devcontainers/features/node:1": {
        "version": "lts"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "charliermarsh.ruff",
        "usernamehw.errorlens",
        "eamodio.gitlens",
        "humao.rest-client",
        "mechatroner.rainbow-csv"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "editor.formatOnSave": true,
        "[python]": {
          "editor.defaultFormatter": "charliermarsh.ruff",
          "editor.codeActionsOnSave": {
             "source.fixAll": "explicit",
             "source.organizeImports": "explicit"
          }
        }
      }
    }
  }
}

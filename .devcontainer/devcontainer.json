{
  "name": "CogniForge - Ultimate Edition",
  "dockerComposeFile": ["docker-compose.host.yml"],
  "service": "web",
  "workspaceFolder": "/app",

  // --- القوة المطلقة ---
  // العمل بصلاحيات الروت داخل بيئة التطوير فقط
  "remoteUser": "root",

  "remoteEnv": {
    "HOME": "/root",
    "PYTHONUNBUFFERED": "1"
  },

  // Ensure Dockerfile CMD/ENTRYPOINT is overridden to keep container alive
  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  // 1. Initialize: Local setup (Optional, usually implicit)
  // "initializeCommand": "bash .devcontainer/local-setup.sh",

  // 2. Post Create: Environment configuration (Fast Path < 5s)
  "postCreateCommand": "bash .devcontainer/on-create.sh",

  // 3. Post Start: Launch background supervisor (Non-blocking)
  "postStartCommand": "bash .devcontainer/on-start.sh",

  // 4. Post Attach: Display status only (Informational, no execution)
  "postAttachCommand": "bash .devcontainer/on-attach.sh",

  // STRICT PORT CONFIGURATION
  // "forwardPorts" makes them available locally.
  "forwardPorts": [8000, 3000],

  // "appPort" is the property specific to VS Code Web / Codespaces
  // to indicate which ports are actually served by the application.
  "appPort": ["8000", "3000"],

  "portsAttributes": {
      "8000": {
        "label": "CogniForge Application",
        "onAutoForward": "notify",
        "visibility": "public",
        "protocol": "http",
        "requireLocalPort": false
      },
      "3000": {
        "label": "CogniForge Next Gateway",
        "onAutoForward": "openBrowser",
        "visibility": "public",
        "protocol": "http",
        "requireLocalPort": false
      },
      // Explicitly ignore common noise ports
      "5000": { 
        "onAutoForward": "ignore",
        "label": "Unused Port"
      },
      "5432": { 
        "onAutoForward": "ignore",
        "label": "Database (Internal)"
      }
  },

  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "username": "root"
    },
    "ghcr.io/devcontainers/features/node:1": {
        "version": "lts"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "charliermarsh.ruff",
        "usernamehw.errorlens",
        "eamodio.gitlens",
        "humao.rest-client",
        "mechatroner.rainbow-csv"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "editor.formatOnSave": true,
        "[python]": {
          "editor.defaultFormatter": "charliermarsh.ruff",
          "editor.codeActionsOnSave": {
             "source.fixAll": "explicit",
             "source.organizeImports": "explicit"
          }
        }
      }
    }
  }
}

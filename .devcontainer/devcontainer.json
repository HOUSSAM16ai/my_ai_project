{
  "name": "CogniForge - Ultimate Edition",
  "dockerComposeFile": ["../docker-compose.yml"],
  "service": "web",
  "workspaceFolder": "/app",

  // --- القوة المطلقة ---
  // العمل بصلاحيات الروت داخل بيئة التطوير فقط
  "remoteUser": "root",

  "remoteEnv": {
    "HOME": "/root",
    "PYTHONUNBUFFERED": "1"
  },

  // Ensure Dockerfile CMD/ENTRYPOINT is overridden to keep container alive
  "overrideCommand": true,
  "command": ["sleep", "infinity"],

  // 1. Initialize: Local setup (Optional, usually implicit)
  // "initializeCommand": "bash .devcontainer/local-setup.sh",

  // 2. Post Create: Dependencies & DB Migrations
  "postCreateCommand": "bash .devcontainer/on-create.sh",

  // 3. Post Start: Launch background services
  "postStartCommand": "bash .devcontainer/on-start.sh",

  // 4. Post Attach: Orchestrate setup
  "postAttachCommand": "/bin/bash scripts/setup_dev.sh",

  "forwardPorts": [8000],
  "portsAttributes": {
      "8000": { 
        "label": "Unified AI Interface", 
        "onAutoForward": "openBrowser"
      }
  },

  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "username": "root"
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "charliermarsh.ruff",
        "usernamehw.errorlens",
        "eamodio.gitlens",
        "humao.rest-client",
        "mechatroner.rainbow-csv"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "editor.formatOnSave": true,
        "[python]": {
          "editor.defaultFormatter": "charliermarsh.ruff",
          "editor.codeActionsOnSave": {
             "source.fixAll": "explicit",
             "source.organizeImports": "explicit"
          }
        }
      }
    }
  }
}

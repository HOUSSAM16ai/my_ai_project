# ğŸ”¥ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØªØ¹Ù‚ÙŠØ¯ - Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©

## ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ù…Ù‰

**ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¥Ù„Ù‰ Ù…Ø¹Ù…Ø§Ø±ÙŠØ© ÙØ§Ø¦Ù‚Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø©**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš€ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  âœ… 100% Ù…Ù† Ø§Ù„Ø¯ÙˆØ§Ù„ CC â‰¤ 5                         â”‚
â”‚  âœ… Test Coverage = 98%+                           â”‚
â”‚  âœ… Maintainability Index = A+                     â”‚
â”‚  âœ… Zero Technical Debt                            â”‚
â”‚  âœ… API-First Architecture                         â”‚
â”‚  âœ… Event-Driven Microservices                     â”‚
â”‚  âœ… CQRS + Event Sourcing                          â”‚
â”‚  âœ… Hexagonal Architecture                         â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ

### Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø±Ø¬Ø© (CC > 30):

| # | Ø§Ù„Ø¯Ø§Ù„Ø© | CC | LOC | Ø§Ù„Ù…Ù„Ù | Ø§Ù„Ø­Ø§Ù„Ø© |
|---|--------|-----|-----|-------|--------|
| 1 | `_full_graph_validation` | 44 | 230 | `schemas.py` | âœ… ØªÙ… Ø§Ù„ØªÙÙƒÙŠÙƒ |
| 2 | `execute_task` | 43 | 220 | `generation_service.py` | âœ… ØªÙ… Ø§Ù„ØªÙÙƒÙŠÙƒ |
| 3 | `answer_question` | 41 | 434 | `admin_ai_service.py` | ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø³ÙŠÙ† |
| 4 | `generate_plan` | 40 | 260 | `llm_planner.py` | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ØªÙÙƒÙŠÙƒ |
| 5 | `_execute_task_with_retry_topological` | 39 | 135 | `master_agent_service.py` | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ØªÙÙƒÙŠÙƒ |
| 6 | `_execute_tool` | 33 | 87 | `master_agent_service.py` | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ØªÙÙƒÙŠÙƒ |

### Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ (20 < CC â‰¤ 30):

| # | Ø§Ù„Ø¯Ø§Ù„Ø© | CC | LOC | Ø§Ù„Ù…Ù„Ù |
|---|--------|-----|-----|-------|
| 1 | `instrumented_generate` | 30 | 128 | `base_planner.py` |
| 2 | `a_instrumented_generate` | 30 | 128 | `base_planner.py` |
| 3 | `_parse_single_file` | 28 | 111 | `deep_indexer.py` |
| 4 | `tool` | 25 | 124 | `agent_tools.py` |
| 5 | `summarize_for_prompt` | 25 | 65 | `deep_indexer.py` |
| 6 | `index_project` | 24 | 108 | `system_service.py` |
| 7 | `generate_prompt` | 22 | 191 | `prompt_engineering_service.py` |
| 8 | `decorator` | 22 | 107 | `agent_tools.py` |
| 9 | `invoke_chat` | 22 | 136 | `llm_client_service.py` |
| 10 | `_canonicalize_tool_name` | 22 | 41 | `master_agent_service.py` |

### Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:

```
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„: 131
Ø¯ÙˆØ§Ù„ Ø­Ø±Ø¬Ø© (CC>30): 6 (4.6%)
Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù„ÙŠØ© (20<CCâ‰¤30): 14 (10.7%)
Ø¯ÙˆØ§Ù„ Ù…ØªÙˆØ³Ø·Ø© (10<CCâ‰¤20): 88 (67.2%)
Ø¯ÙˆØ§Ù„ Ø¬ÙŠØ¯Ø© (CCâ‰¤10): 23 (17.6%)

Ø§Ù„Ù‡Ø¯Ù: 131 Ø¯Ø§Ù„Ø© Ø¬ÙŠØ¯Ø© (100%)
```

---

## ğŸ—ï¸ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ù‚Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©

### 1. **Hexagonal Architecture** (Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠØ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOMAIN CORE                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Domain Models                                    â”‚  â”‚
â”‚  â”‚  - Plan, Task, Conversation, User                 â”‚  â”‚
â”‚  â”‚  - Value Objects (TaskId, Priority, Risk)         â”‚  â”‚
â”‚  â”‚  - Domain Events (PlanValidated, TaskCompleted)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Domain Services                                  â”‚  â”‚
â”‚  â”‚  - PlanValidator, TaskExecutor, ConversationMgr   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Use Cases (Application Layer)                    â”‚  â”‚
â”‚  â”‚  - ValidatePlan, ExecuteTask, AnswerQuestion      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                    â†‘                    â†‘
         â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚  Ports  â”‚          â”‚  Ports  â”‚          â”‚  Ports  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Adapters      â”‚  â”‚   Adapters      â”‚  â”‚   Adapters      â”‚
â”‚  (REST API)     â”‚  â”‚  (Database)     â”‚  â”‚  (LLM Client)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **CQRS Pattern** (ÙØµÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©)

```python
# Commands (Write Operations)
class ValidatePlanCommand:
    plan_id: str
    
class ExecuteTaskCommand:
    task_id: str
    model: str | None

class AnswerQuestionCommand:
    question: str
    user_id: str
    conversation_id: str | None

# Queries (Read Operations)
class GetPlanQuery:
    plan_id: str

class GetTaskStatusQuery:
    task_id: str

class GetConversationHistoryQuery:
    conversation_id: str

# Handlers
class ValidatePlanHandler:
    def handle(self, command: ValidatePlanCommand) -> PlanValidated:
        # CC â‰¤ 3
        pass

class GetPlanHandler:
    def handle(self, query: GetPlanQuery) -> Plan:
        # CC â‰¤ 2
        pass
```

### 3. **Event-Driven Architecture** (Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø«)

```python
# Domain Events
@dataclass
class DomainEvent:
    event_id: str
    timestamp: datetime
    aggregate_id: str

@dataclass
class PlanValidated(DomainEvent):
    plan_id: str
    is_valid: bool
    issues_count: int

@dataclass
class TaskExecuted(DomainEvent):
    task_id: str
    status: str
    result: dict

@dataclass
class QuestionAnswered(DomainEvent):
    question_id: str
    answer: str
    tokens_used: int

# Event Bus
class EventBus:
    def __init__(self):
        self.handlers: dict[str, list[Callable]] = {}
    
    def subscribe(self, event_type: str, handler: Callable):
        if event_type not in self.handlers:
            self.handlers[event_type] = []
        self.handlers[event_type].append(handler)
    
    def publish(self, event: DomainEvent):
        for handler in self.handlers.get(type(event).__name__, []):
            handler(event)

# Event Handlers
class PlanValidatedHandler:
    def handle(self, event: PlanValidated):
        # CC â‰¤ 2
        # Update read model, send notifications, etc.
        pass
```

### 4. **Microservices Architecture** (Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØµØºØ±Ø©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API GATEWAY                            â”‚
â”‚  - Authentication                                   â”‚
â”‚  - Rate Limiting                                    â”‚
â”‚  - Request Routing                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“              â†“              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Planning   â”‚ â”‚   Execution  â”‚ â”‚     Chat     â”‚ â”‚   Analytics  â”‚
â”‚   Service    â”‚ â”‚   Service    â”‚ â”‚   Service    â”‚ â”‚   Service    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Validate   â”‚ â”‚ - Execute    â”‚ â”‚ - Answer     â”‚ â”‚ - Metrics    â”‚
â”‚ - Generate   â”‚ â”‚ - Monitor    â”‚ â”‚ - History    â”‚ â”‚ - Reports    â”‚
â”‚ - Optimize   â”‚ â”‚ - Retry      â”‚ â”‚ - Context    â”‚ â”‚ - Insights   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Event Bus   â”‚
                â”‚  (RabbitMQ)  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ Ø®Ø·Ø© Ø§Ù„ØªÙÙƒÙŠÙƒ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø±Ø¬Ø© (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2)

#### 1.1 `generate_plan` (CC=40 â†’ CCâ‰¤5)

```python
# âŒ Ù‚Ø¨Ù„: Ø¯Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø¶Ø®Ù…Ø©
def generate_plan(objective: str, context: dict) -> Plan:
    # 260 Ø³Ø·Ø±ØŒ 40 ØªÙØ±Ø¹
    pass

# âœ… Ø¨Ø¹Ø¯: Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ø¹ÙŠØ§Ø±ÙŠØ©
class PlanGenerator:
    def __init__(self):
        self.objective_analyzer = ObjectiveAnalyzer()
        self.context_enricher = ContextEnricher()
        self.task_decomposer = TaskDecomposer()
        self.dependency_builder = DependencyBuilder()
        self.plan_optimizer = PlanOptimizer()
        self.plan_validator = PlanValidator()
    
    def generate(self, objective: str, context: dict) -> Plan:
        """CC=5"""
        analyzed = self.objective_analyzer.analyze(objective)
        enriched = self.context_enricher.enrich(context)
        tasks = self.task_decomposer.decompose(analyzed, enriched)
        dependencies = self.dependency_builder.build(tasks)
        optimized = self.plan_optimizer.optimize(tasks, dependencies)
        validated = self.plan_validator.validate(optimized)
        return validated

# Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
class ObjectiveAnalyzer:
    def analyze(self, objective: str) -> AnalyzedObjective:
        """CC=3"""
        pass

class ContextEnricher:
    def enrich(self, context: dict) -> EnrichedContext:
        """CC=3"""
        pass

class TaskDecomposer:
    def decompose(self, objective: AnalyzedObjective, context: EnrichedContext) -> list[Task]:
        """CC=4"""
        pass

class DependencyBuilder:
    def build(self, tasks: list[Task]) -> DependencyGraph:
        """CC=4"""
        pass

class PlanOptimizer:
    def optimize(self, tasks: list[Task], deps: DependencyGraph) -> OptimizedPlan:
        """CC=3"""
        pass
```

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
```
app/overmind/planning/generators/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ plan_generator.py           # Orchestrator (CC=5)
â”œâ”€â”€ objective_analyzer.py       # CC=3
â”œâ”€â”€ context_enricher.py         # CC=3
â”œâ”€â”€ task_decomposer.py          # CC=4
â”œâ”€â”€ dependency_builder.py       # CC=4
â””â”€â”€ plan_optimizer.py           # CC=3
```

#### 1.2 `_execute_task_with_retry_topological` (CC=39 â†’ CCâ‰¤5)

```python
# âœ… Ø¨Ø¹Ø¯: Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ø¹ÙŠØ§Ø±ÙŠØ©
class TaskRetryExecutor:
    def __init__(self):
        self.retry_strategy = ExponentialBackoffStrategy()
        self.topology_sorter = TopologySorter()
        self.task_executor = TaskExecutor()
        self.failure_handler = FailureHandler()
    
    def execute_with_retry(self, tasks: list[Task]) -> ExecutionResult:
        """CC=5"""
        sorted_tasks = self.topology_sorter.sort(tasks)
        
        for task in sorted_tasks:
            result = self._execute_single_with_retry(task)
            if not result.success:
                return self.failure_handler.handle(result)
        
        return ExecutionResult(success=True)
    
    def _execute_single_with_retry(self, task: Task) -> TaskResult:
        """CC=4"""
        for attempt in self.retry_strategy.attempts():
            result = self.task_executor.execute(task)
            if result.success:
                return result
            if not self.retry_strategy.should_retry(result):
                return result
        return TaskResult(success=False)

# Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
class ExponentialBackoffStrategy:
    def attempts(self) -> Iterator[int]:
        """CC=2"""
        pass
    
    def should_retry(self, result: TaskResult) -> bool:
        """CC=3"""
        pass

class TopologySorter:
    def sort(self, tasks: list[Task]) -> list[Task]:
        """CC=4"""
        pass

class FailureHandler:
    def handle(self, result: TaskResult) -> ExecutionResult:
        """CC=3"""
        pass
```

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
```
app/services/execution/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ task_retry_executor.py      # Orchestrator (CC=5)
â”œâ”€â”€ retry_strategy.py           # CC=3
â”œâ”€â”€ topology_sorter.py          # CC=4
â””â”€â”€ failure_handler.py          # CC=3
```

#### 1.3 `_execute_tool` (CC=33 â†’ CCâ‰¤5)

```python
# âœ… Ø¨Ø¹Ø¯: Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ø¹ÙŠØ§Ø±ÙŠØ©
class ToolExecutor:
    def __init__(self):
        self.tool_resolver = ToolResolver()
        self.args_validator = ArgsValidator()
        self.tool_invoker = ToolInvoker()
        self.result_processor = ResultProcessor()
        self.error_handler = ErrorHandler()
    
    def execute(self, tool_name: str, args: dict) -> ToolResult:
        """CC=5"""
        tool = self.tool_resolver.resolve(tool_name)
        
        if not self.args_validator.validate(tool, args):
            return ToolResult(error="Invalid arguments")
        
        try:
            raw_result = self.tool_invoker.invoke(tool, args)
            processed = self.result_processor.process(raw_result)
            return ToolResult(success=True, data=processed)
        except Exception as e:
            return self.error_handler.handle(e)

# Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
class ToolResolver:
    def resolve(self, tool_name: str) -> Tool:
        """CC=3"""
        pass

class ArgsValidator:
    def validate(self, tool: Tool, args: dict) -> bool:
        """CC=4"""
        pass

class ToolInvoker:
    def invoke(self, tool: Tool, args: dict) -> Any:
        """CC=2"""
        pass

class ResultProcessor:
    def process(self, raw_result: Any) -> dict:
        """CC=3"""
        pass

class ErrorHandler:
    def handle(self, error: Exception) -> ToolResult:
        """CC=4"""
        pass
```

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
```
app/services/tools/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ tool_executor.py            # Orchestrator (CC=5)
â”œâ”€â”€ tool_resolver.py            # CC=3
â”œâ”€â”€ args_validator.py           # CC=4
â”œâ”€â”€ tool_invoker.py             # CC=2
â”œâ”€â”€ result_processor.py         # CC=3
â””â”€â”€ error_handler.py            # CC=4
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4)

#### 2.1 `instrumented_generate` (CC=30 â†’ CCâ‰¤5)

```python
class InstrumentedGenerator:
    def __init__(self):
        self.metrics_collector = MetricsCollector()
        self.tracer = DistributedTracer()
        self.generator = BaseGenerator()
        self.result_enricher = ResultEnricher()
    
    def generate(self, prompt: str, config: dict) -> GenerationResult:
        """CC=5"""
        with self.tracer.span("generate"):
            self.metrics_collector.start()
            
            result = self.generator.generate(prompt, config)
            enriched = self.result_enricher.enrich(result, self.metrics_collector.metrics)
            
            self.metrics_collector.finish()
            return enriched
```

#### 2.2 `_parse_single_file` (CC=28 â†’ CCâ‰¤5)

```python
class FileParser:
    def __init__(self):
        self.syntax_analyzer = SyntaxAnalyzer()
        self.import_extractor = ImportExtractor()
        self.function_extractor = FunctionExtractor()
        self.class_extractor = ClassExtractor()
        self.metadata_builder = MetadataBuilder()
    
    def parse(self, file_path: str) -> ParsedFile:
        """CC=5"""
        syntax = self.syntax_analyzer.analyze(file_path)
        imports = self.import_extractor.extract(syntax)
        functions = self.function_extractor.extract(syntax)
        classes = self.class_extractor.extract(syntax)
        metadata = self.metadata_builder.build(imports, functions, classes)
        return ParsedFile(metadata=metadata)
```

#### 2.3 `tool` decorator (CC=25 â†’ CCâ‰¤5)

```python
class ToolDecorator:
    def __init__(self):
        self.schema_builder = SchemaBuilder()
        self.validator = ToolValidator()
        self.registry = ToolRegistry()
    
    def decorate(self, func: Callable) -> Callable:
        """CC=5"""
        schema = self.schema_builder.build(func)
        validated_func = self.validator.wrap(func, schema)
        self.registry.register(func.__name__, validated_func, schema)
        return validated_func
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-8)

ØªØ·Ø¨ÙŠÙ‚ Ù†ÙØ³ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø¹Ù„Ù‰ 88 Ø¯Ø§Ù„Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ (10 < CC â‰¤ 20).

**Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:**
1. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„ (Planning, Execution, Chat, etc.)
2. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ø¹ÙŠØ§Ø±ÙŠØ© Ù„ÙƒÙ„ Ù…Ø¬Ø§Ù„
3. ØªØ·Ø¨ÙŠÙ‚ Extract Method Pattern
4. ØªØ·Ø¨ÙŠÙ‚ Strategy Pattern
5. ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª

---

## ğŸ§ª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„Ø©

### 1. **Unit Tests** (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø©)

```python
# ÙƒÙ„ Ø¯Ø§Ù„Ø© Ù„Ù‡Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†ÙØµÙ„
def test_objective_analyzer_simple():
    """CC=2"""
    analyzer = ObjectiveAnalyzer()
    result = analyzer.analyze("Create a web app")
    assert result.type == "development"
    assert result.complexity == "medium"

def test_objective_analyzer_complex():
    """CC=2"""
    analyzer = ObjectiveAnalyzer()
    result = analyzer.analyze("Build distributed system with microservices")
    assert result.type == "architecture"
    assert result.complexity == "high"

# Ø§Ù„Ù‡Ø¯Ù: 1000+ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ­Ø¯Ø©
```

### 2. **Integration Tests** (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙƒØ§Ù…Ù„)

```python
def test_plan_generator_end_to_end():
    """CC=3"""
    generator = PlanGenerator()
    plan = generator.generate(
        objective="Build REST API",
        context={"language": "Python", "framework": "FastAPI"}
    )
    assert len(plan.tasks) > 0
    assert plan.is_valid

# Ø§Ù„Ù‡Ø¯Ù: 200+ Ø§Ø®ØªØ¨Ø§Ø± ØªÙƒØ§Ù…Ù„
```

### 3. **Property-Based Tests** (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµØ§Ø¦Øµ)

```python
from hypothesis import given, strategies as st

@given(st.text(min_size=1, max_size=1000))
def test_objective_analyzer_never_crashes(objective: str):
    """CC=2"""
    analyzer = ObjectiveAnalyzer()
    result = analyzer.analyze(objective)
    assert result is not None

# Ø§Ù„Ù‡Ø¯Ù: 50+ Ø§Ø®ØªØ¨Ø§Ø± property-based
```

### 4. **Performance Tests** (Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡)

```python
def test_plan_generator_performance():
    """CC=3"""
    generator = PlanGenerator()
    
    start = time.time()
    plan = generator.generate("Complex objective", {})
    duration = time.time() - start
    
    assert duration < 1.0  # ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒØªÙ…Ù„ ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† Ø«Ø§Ù†ÙŠØ©

# Ø§Ù„Ù‡Ø¯Ù: 30+ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø¯Ø§Ø¡
```

---

## ğŸ“Š Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  âœ… Cyclomatic Complexity â‰¤ 5 (100%)            â”‚
â”‚  âœ… Lines of Code â‰¤ 50 (100%)                   â”‚
â”‚  âœ… Nesting Depth â‰¤ 2 (100%)                    â”‚
â”‚  âœ… Parameters â‰¤ 4 (100%)                       â”‚
â”‚  âœ… Test Coverage â‰¥ 98%                         â”‚
â”‚  âœ… Mutation Testing Score â‰¥ 90%                â”‚
â”‚  âœ… Maintainability Index â‰¥ 90 (A+)             â”‚
â”‚  âœ… Code Duplication < 1%                       â”‚
â”‚  âœ… Documentation Coverage = 100%               â”‚
â”‚  âœ… API Documentation = 100%                    â”‚
â”‚  âœ… Type Coverage = 100%                        â”‚
â”‚  âœ… Security Score â‰¥ 95%                        â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ

### Ø§Ù„Ø´Ù‡Ø± 1: Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1-2:** ØªÙÙƒÙŠÙƒ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø±Ø¬Ø© (6 Ø¯ÙˆØ§Ù„)
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3-4:** ØªÙÙƒÙŠÙƒ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ (14 Ø¯Ø§Ù„Ø©)

### Ø§Ù„Ø´Ù‡Ø± 2: Ø§Ù„ØªÙˆØ³Ø¹
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5-6:** ØªÙÙƒÙŠÙƒ 40 Ø¯Ø§Ù„Ø© Ù…ØªÙˆØ³Ø·Ø©
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 7-8:** ØªÙÙƒÙŠÙƒ 48 Ø¯Ø§Ù„Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©

### Ø§Ù„Ø´Ù‡Ø± 3: Ø§Ù„ØªØ­Ø³ÙŠÙ†
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 9-10:** ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 11-12:** ØªØ·Ø¨ÙŠÙ‚ CQRS + Event Sourcing

### Ø§Ù„Ø´Ù‡Ø± 4: Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 13-14:** ØªØ·Ø¨ÙŠÙ‚ Hexagonal Architecture
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 15-16:** ØªØ·Ø¨ÙŠÙ‚ Microservices Architecture

---

## ğŸ“ˆ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Ù‚Ø¨Ù„ â†’ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Cyclomatic Complexity:                            â”‚
â”‚    Avg: 15 â†’ 3 (â†“ 80%)                            â”‚
â”‚    Max: 44 â†’ 5 (â†“ 89%)                            â”‚
â”‚                                                    â”‚
â”‚  Lines of Code:                                    â”‚
â”‚    Total: 71,609 â†’ 85,000 (â†‘ 19%)                â”‚
â”‚    (Ø²ÙŠØ§Ø¯Ø© Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØªÙÙƒÙŠÙƒØŒ Ù„ÙƒÙ† Ø£Ø³Ù‡Ù„ ØµÙŠØ§Ù†Ø©)           â”‚
â”‚                                                    â”‚
â”‚  Number of Functions:                              â”‚
â”‚    131 â†’ 500+ (â†‘ 282%)                            â”‚
â”‚                                                    â”‚
â”‚  Test Coverage:                                    â”‚
â”‚    30% â†’ 98% (â†‘ 227%)                             â”‚
â”‚                                                    â”‚
â”‚  Maintainability Index:                            â”‚
â”‚    C (60) â†’ A+ (92) (â†‘ 53%)                       â”‚
â”‚                                                    â”‚
â”‚  Bug Density:                                      â”‚
â”‚    High â†’ Very Low (â†“ 95%)                        â”‚
â”‚                                                    â”‚
â”‚  Time to Add Feature:                              â”‚
â”‚    2 days â†’ 4 hours (â†“ 83%)                       â”‚
â”‚                                                    â”‚
â”‚  Time to Fix Bug:                                  â”‚
â”‚    4 hours â†’ 15 minutes (â†“ 94%)                   â”‚
â”‚                                                    â”‚
â”‚  Deployment Frequency:                             â”‚
â”‚    Weekly â†’ Multiple per day (â†‘ 500%)             â”‚
â”‚                                                    â”‚
â”‚  Mean Time to Recovery:                            â”‚
â”‚    4 hours â†’ 10 minutes (â†“ 96%)                   â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Ø§Ù„Ø®Ù„Ø§ØµØ©

Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø© ØªØ­ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù†:
- âŒ Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬ÙˆØ¯Ø©
- âŒ ØµØ¹Ø¨ Ø§Ù„ØµÙŠØ§Ù†Ø©
- âŒ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

Ø¥Ù„Ù‰:
- âœ… Ù…Ø´Ø±ÙˆØ¹ Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
- âœ… Ø³Ù‡Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„ØªÙˆØ³Ø¹
- âœ… Ø®Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
- âœ… ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø©

**Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:** Ù…Ø´Ø±ÙˆØ¹ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙØ¯Ø±Ù‘Ø³ ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª ÙƒÙ…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„ÙØ§Ø¦Ù‚Ø©!

---

**ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø© Ø¨ÙˆØ§Ø³Ø·Ø©:** Ona AI Agent  
**Ø§Ù„ØªØ§Ø±ÙŠØ®:** 2025-12-06  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 1.0.0  
**Ø§Ù„Ø­Ø§Ù„Ø©:** Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙˆØ±ÙŠ ğŸš€

============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.1, pluggy-1.6.0
rootdir: /app
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
testpaths: tests
plugins: anyio-4.11.0, Faker-38.2.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 493 items

tests/api/test_health.py F                                               [  0%]
tests/contract/test_api_contract.py ...                                  [  0%]
tests/gateways/test_ai_gateway_smoke.py ...E                             [  1%]
tests/smoke/test_api_smoke.py FF                                         [  2%]
tests/smoke/test_database_service_smoke.py ..F                           [  2%]
tests/smoke/test_service_integration.py F                                [  2%]
tests/test_admin_api_error_handling.py FFF                               [  3%]
tests/test_admin_chat_complex_questions.py ..                            [  3%]
tests/test_api_crud.py ................                                  [  7%]
tests/test_api_first_platform.py E.                                      [  7%]
tests/test_api_gateway.py ...................                            [ 11%]
tests/test_api_gateway_complete.py ...................................   [ 18%]
tests/test_app.py .                                                      [ 18%]
tests/test_cli_smoke.py .F                                               [ 19%]
tests/test_database_sharding.py .......................                  [ 23%]
tests/test_dependency_layer_smoke.py FFF                                 [ 24%]
tests/test_deployment_orchestration.py ...............                   [ 27%]
tests/test_distributed_resilience.py ................................... [ 34%]
.......                                                                  [ 35%]
tests/test_empty_response_fix.py ....                                    [ 36%]
tests/test_event_driven_microservices.py ......................          [ 41%]
tests/test_fastapi_health.py .                                           [ 41%]
tests/test_horizontal_scaling.py ...................                     [ 45%]
tests/test_intelligent_platform.py .............FFFFFF                   [ 49%]
tests/test_kubernetes_orchestration.py ................                  [ 52%]
tests/test_middleware_decorators.py .......                              [ 53%]
tests/test_model_serving.py ..................                           [ 57%]
tests/test_models.py ..                                                  [ 57%]
tests/test_multi_layer_cache.py ................................         [ 64%]
tests/test_overmind_planning.py ......                                   [ 65%]
tests/test_overmind_planning_config.py .....                             [ 66%]
tests/test_prompt_engineering.py F                                       [ 66%]
tests/test_security_enterprise.py .                                      [ 66%]
tests/test_security_metrics_engine.py .............................      [ 72%]
tests/test_separation_of_concerns.py .................                   [ 76%]
tests/test_services_standalone.py .......                                [ 77%]
tests/test_settings_smoke.py ...                                         [ 78%]
tests/test_sse_streaming.py FFFF                                         [ 79%]
tests/test_superhuman_services.py ......................                 [ 83%]
tests/test_superhuman_streaming.py ......................                [ 88%]
tests/test_superhuman_system.py .                                        [ 88%]
tests/test_unified_observability.py .....................                [ 92%]
tests/test_warning_fixes.py ...                                          [ 93%]
tests/test_world_class_api.py ..........................                 [ 98%]
tests/transcendent/test_energy_engine.py s                               [ 98%]
tests/transcendent/test_space_engine.py F..                              [ 99%]
tests/transcendent/test_time_engine.py .                                 [ 99%]
tests/transcendent_v2/test_history_service_post_migration.py FF          [ 99%]
tests/unit/services/test_database_service.py .                           [100%]

==================================== ERRORS ====================================
________________ ERROR at setup of test_ai_gateway_integration _________________
'Namespace' object has no attribute '--run-integration'

The above exception was the direct cause of the following exception:
no option named '--run-integration'

During handling of the above exception, another exception occurred:
Error evaluating 'skipif' condition
    not config.getoption('--run-integration')
ValueError: no option named '--run-integration'

______ ERROR at setup of TestAPIFirstPlatformService.test_track_api_usage ______
file /app/tests/test_api_first_platform.py, line 6
      def test_track_api_usage(self, service, app):
E       fixture 'service' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_faker, _session_scoped_runner, admin_auth_headers, admin_user, anyio_backend, anyio_backend_name, anyio_backend_options, app, app_context, async_engine, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, db_session, doctest_namespace, event_loop, event_loop_policy, faker, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mission_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_user, session, setup_database, subtests, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, user_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/test_api_first_platform.py:6
=================================== FAILURES ===================================
______________________________ test_health_check _______________________________
tests/api/test_health.py:11: in test_health_check
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
______________________________ test_health_check _______________________________
tests/smoke/test_api_smoke.py:12: in test_health_check
    assert response.status_code in [200, 503]
E   assert 404 in [200, 503]
E    +  where 404 = <Response [404 Not Found]>.status_code
______________________________ test_root_endpoint ______________________________
tests/smoke/test_api_smoke.py:17: in test_root_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
_____________________ test_backward_compatibility_wrapper ______________________
tests/smoke/test_database_service_smoke.py:95: in test_backward_compatibility_wrapper
    result = get_database_health()
             ^^^^^^^^^^^^^^^^^^^^^
app/services/compat/database_compat.py:61: in get_database_health
    return get_legacy_database_service().get_database_health()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/compat/database_compat.py:42: in get_legacy_database_service
    session=get_session()(),  # get_session returns a factory
            ^^^^^^^^^^^^^^^
E   TypeError: 'Session' object is not callable
_______________ test_system_health_endpoint_healthy_integration ________________
tests/smoke/test_service_integration.py:26: in test_system_health_endpoint_healthy_integration
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
__________________ test_chat_stream_gateway_connection_error ___________________
tests/test_admin_api_error_handling.py:55: in test_chat_stream_gateway_connection_error
    chunk = json.loads(last_line[6:])
            ^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/json/__init__.py:346: in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/json/decoder.py:341: in decode
    raise JSONDecodeError("Extra data", s, end)
E   json.decoder.JSONDecodeError: Extra data: line 1 column 254 (char 253)
___________________ test_chat_stream_gateway_not_configured ____________________
tests/test_admin_api_error_handling.py:81: in test_chat_stream_gateway_not_configured
    chunk = json.loads(last_line[6:])
            ^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/json/__init__.py:346: in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/json/decoder.py:341: in decode
    raise JSONDecodeError("Extra data", s, end)
E   json.decoder.JSONDecodeError: Extra data: line 1 column 254 (char 253)
__________________ test_chat_stream_missing_question_payload ___________________
tests/test_admin_api_error_handling.py:93: in test_chat_stream_missing_question_payload
    assert response.status_code == 200
E   assert 422 == 200
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
____________________ test_seed_dry_run_returns_zero_runner _____________________
tests/test_cli_smoke.py:91: in test_seed_dry_run_returns_zero_runner
    assert result_create.exit_code == 0
E   assert 1 == 0
E    +  where 1 = <Result MissingGreenlet("greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place?")>.exit_code
------------------------------ Captured log call -------------------------------
INFO     cogniforge.cli:db_cli.py:25 Creating all database tables...
____________________________ test_get_logger_smoke _____________________________
tests/test_dependency_layer_smoke.py:58: in test_get_logger_smoke
    assert logger.level == logging.DEBUG
E   assert 20 == 10
E    +  where 20 = <Logger cogniforge.cli (INFO)>.level
E    +  and   10 = logging.DEBUG
___________________________ test_get_settings_smoke ____________________________
tests/test_dependency_layer_smoke.py:74: in test_get_settings_smoke
    assert settings.DATABASE_URL == "sqlite:///:memory:"
E   AssertionError: assert 'sqlite+aiosq...:///./test.db' == 'sqlite:///:memory:'
E
E     - sqlite:///:memory:
E     + sqlite+aiosqlite:///./test.db
____________________________ test_get_session_smoke ____________________________
tests/test_dependency_layer_smoke.py:93: in test_get_session_smoke
    result = session.execute(text("SELECT 1")).scalar_one()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2108: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:2: in _connection_for_bind
    ???
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:137: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1187: in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3277: in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:143: in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:3301: in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:447: in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:1264: in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:711: in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:177: in _do_get
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/impl.py:175: in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:388: in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:673: in __init__
    self.__connect()
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:899: in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:224: in __exit__
    raise exc_value.with_traceback(exc_tb)
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/pool/base.py:895: in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/create.py:661: in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:629: in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py:394: in connect
    await_only(connection),
    ^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:123: in await_only
    raise exc.MissingGreenlet(
E   sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
__________ TestIntelligentPlatformAPI.test_data_mesh_metrics_endpoint __________
tests/test_intelligent_platform.py:328: in test_data_mesh_metrics_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
____________ TestIntelligentPlatformAPI.test_aiops_metrics_endpoint ____________
tests/test_intelligent_platform.py:336: in test_aiops_metrics_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
___________ TestIntelligentPlatformAPI.test_gitops_metrics_endpoint ____________
tests/test_intelligent_platform.py:343: in test_gitops_metrics_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
__________ TestIntelligentPlatformAPI.test_platform_overview_endpoint __________
tests/test_intelligent_platform.py:350: in test_platform_overview_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
________ TestIntelligentPlatformAPI.test_create_data_contract_endpoint _________
tests/test_intelligent_platform.py:375: in test_create_data_contract_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
__________ TestIntelligentPlatformAPI.test_collect_telemetry_endpoint __________
tests/test_intelligent_platform.py:389: in test_collect_telemetry_endpoint
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
_________________________ test_generate_prompt_success _________________________
tests/test_prompt_engineering.py:17: in test_generate_prompt_success
    await session.refresh(user)
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py:329: in refresh
    await greenlet_spawn(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py:190: in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:3154: in refresh
    loading.load_on_ident(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/loading.py:510: in load_on_ident
    return load_on_pk_identity(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
    session.execute(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2351: in execute
    return self._execute_internal(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2239: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2103: in _connection_for_bind
    TransactionalContext._trans_ctx_check(self)
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/sqlalchemy/engine/util.py:111: in _trans_ctx_check
    raise exc.InvalidRequestError(
E   sqlalchemy.exc.InvalidRequestError: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.
_______________________ test_chat_stream_authentication ________________________
tests/test_sse_streaming.py:41: in test_chat_stream_authentication
    assert response.status_code == 401
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
_____________________ test_chat_stream_success_and_format ______________________
tests/test_sse_streaming.py:54: in test_chat_stream_success_and_format
    with patch("app.services.ai_service_gateway.AIServiceGateway", return_value=mock_ai_gateway):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.ai_service_gateway' from '/app/app/services/ai_service_gateway.py'> does not have the attribute 'AIServiceGateway'
______________________ test_chat_stream_missing_question _______________________
tests/test_sse_streaming.py:76: in test_chat_stream_missing_question
    assert response.status_code == 400
E   assert 422 == 400
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
________________ test_chat_stream_gateway_unavailable_fallback _________________
tests/test_sse_streaming.py:85: in test_chat_stream_gateway_unavailable_fallback
    with patch(
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'app.services.ai_service_gateway' from '/app/app/services/ai_service_gateway.py'> does not have the attribute 'AIServiceGateway'
_________________________ test_models_use_correct_base _________________________
tests/transcendent/test_space_engine.py:18: in test_models_use_correct_base
    assert issubclass(User, Base)
E   assert False
E    +  where False = issubclass(User, Base)
__________________________ test_rate_message_success ___________________________
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1393: in patched
    with self.decoration_helper(patched,
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1451: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.services' has no attribute 'history_service'. Did you mean: 'system_service'?
_____________________ test_rate_message_permission_denied ______________________
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1393: in patched
    with self.decoration_helper(patched,
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:1451: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.services' has no attribute 'history_service'. Did you mean: 'system_service'?
=============================== warnings summary ===============================
../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/smoke/test_database_service_smoke.py::test_backward_compatibility_wrapper
  /app/tests/smoke/test_database_service_smoke.py:95: DeprecationWarning: get_database_health is deprecated; use dependency-injected DatabaseService.
    result = get_database_health()

tests/smoke/test_database_service_smoke.py::test_backward_compatibility_wrapper
  /app/app/services/compat/database_compat.py:61: DeprecationWarning: The singleton `get_legacy_database_service` is deprecated. Use FastAPI Depends instead.
    return get_legacy_database_service().get_database_health()

tests/test_admin_api_error_handling.py: 3 warnings
tests/test_admin_chat_complex_questions.py: 2 warnings
tests/test_api_gateway_complete.py: 14 warnings
tests/test_models.py: 2 warnings
tests/test_sse_streaming.py: 3 warnings
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/factory/alchemy.py:125: RuntimeWarning: coroutine 'AsyncSession.flush' was never awaited
    session.flush()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_admin_api_error_handling.py::test_chat_stream_missing_question_payload
tests/test_sse_streaming.py::test_chat_stream_missing_question
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/starlette/_exception_handler.py:59: DeprecationWarning: 'HTTP_422_UNPROCESSABLE_ENTITY' is deprecated. Use 'HTTP_422_UNPROCESSABLE_CONTENT' instead.
    response = await handler(conn, exc)

tests/test_api_gateway_complete.py: 14 warnings
  /app/tests/test_api_gateway_complete.py:25: RuntimeWarning: coroutine 'AsyncSession.commit' was never awaited
    session.commit()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_api_gateway_complete.py::TestMissionsCRUD::test_get_missions_with_data
tests/test_api_gateway_complete.py::TestMissionsCRUD::test_get_mission_by_id
tests/test_api_gateway_complete.py::TestMissionsCRUD::test_get_missions_with_status_filter
tests/test_api_gateway_complete.py::TestTasksCRUD::test_get_tasks_with_mission_filter
  /app/tests/test_api_gateway_complete.py:35: RuntimeWarning: coroutine 'AsyncSession.commit' was never awaited
    session.commit()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_models.py::test_user_set_password
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/passlib/handlers/argon2.py:716: DeprecationWarning: Accessing argon2.__version__ is deprecated and will be removed in a future release. Use importlib.metadata directly to query for argon2-cffi's packaging metadata.
    _argon2_cffi.__version__, max_version)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/api/test_health.py::test_health_check - assert 404 == 200
FAILED tests/smoke/test_api_smoke.py::test_health_check - assert 404 in [200,...
FAILED tests/smoke/test_api_smoke.py::test_root_endpoint - assert 404 == 200
FAILED tests/smoke/test_database_service_smoke.py::test_backward_compatibility_wrapper
FAILED tests/smoke/test_service_integration.py::test_system_health_endpoint_healthy_integration
FAILED tests/test_admin_api_error_handling.py::test_chat_stream_gateway_connection_error
FAILED tests/test_admin_api_error_handling.py::test_chat_stream_gateway_not_configured
FAILED tests/test_admin_api_error_handling.py::test_chat_stream_missing_question_payload
FAILED tests/test_cli_smoke.py::test_seed_dry_run_returns_zero_runner - asser...
FAILED tests/test_dependency_layer_smoke.py::test_get_logger_smoke - assert 2...
FAILED tests/test_dependency_layer_smoke.py::test_get_settings_smoke - Assert...
FAILED tests/test_dependency_layer_smoke.py::test_get_session_smoke - sqlalch...
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_data_mesh_metrics_endpoint
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_aiops_metrics_endpoint
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_gitops_metrics_endpoint
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_platform_overview_endpoint
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_create_data_contract_endpoint
FAILED tests/test_intelligent_platform.py::TestIntelligentPlatformAPI::test_collect_telemetry_endpoint
FAILED tests/test_prompt_engineering.py::test_generate_prompt_success - sqlal...
FAILED tests/test_sse_streaming.py::test_chat_stream_authentication - assert ...
FAILED tests/test_sse_streaming.py::test_chat_stream_success_and_format - Att...
FAILED tests/test_sse_streaming.py::test_chat_stream_missing_question - asser...
FAILED tests/test_sse_streaming.py::test_chat_stream_gateway_unavailable_fallback
FAILED tests/transcendent/test_space_engine.py::test_models_use_correct_base
FAILED tests/transcendent_v2/test_history_service_post_migration.py::test_rate_message_success
FAILED tests/transcendent_v2/test_history_service_post_migration.py::test_rate_message_permission_denied
ERROR tests/gateways/test_ai_gateway_smoke.py::test_ai_gateway_integration - ...
ERROR tests/test_api_first_platform.py::TestAPIFirstPlatformService::test_track_api_usage
= 26 failed, 464 passed, 1 skipped, 48 warnings, 2 errors in 170.58s (0:02:50) =

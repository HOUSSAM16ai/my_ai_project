F401 [*] `asyncio` imported but unused
  --> app/ai/application/circuit_breaker.py:18:8
   |
16 | from __future__ import annotations
17 |
18 | import asyncio
   |        ^^^^^^^
19 | import random
20 | import threading
   |
help: Remove unused import: `asyncio`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/ai/application/circuit_breaker.py:24:1
   |
22 | from dataclasses import dataclass, field
23 | from enum import Enum
24 | from typing import Any, Callable, TypeVar
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |
26 | T = TypeVar("T")
   |
help: Import from `collections.abc`

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:31:1
   |
29 | class CircuitState(Enum):
30 |     """Circuit breaker states following the classic pattern."""
31 |
   | ^^^^
32 |     CLOSED = "closed"  # Normal operation
33 |     OPEN = "open"  # Failing, rejecting requests
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:40:1
   |
38 | class CircuitMetrics:
39 |     """Metrics for circuit breaker monitoring."""
40 |
   | ^^^^
41 |     total_requests: int = 0
42 |     successful_requests: int = 0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:50:1
   |
48 |     consecutive_failures: int = 0
49 |     consecutive_successes: int = 0
50 |
   | ^^^^
51 |     @property
52 |     def failure_rate(self) -> float:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:57:1
   |
55 |             return 0.0
56 |         return self.failed_requests / self.total_requests
57 |
   | ^^^^
58 |     @property
59 |     def success_rate(self) -> float:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:67:1
   |
65 | class CircuitBreakerConfig:
66 |     """Configuration for circuit breaker behavior."""
67 |
   | ^^^^
68 |     failure_threshold: int = 5
69 |     success_threshold: int = 2
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:75:1
   |
73 |     max_timeout: float = 300.0
74 |     jitter_factor: float = 0.1
75 |
   | ^^^^
76 |     def calculate_timeout(self, failure_count: int) -> float:
77 |         """Calculate adaptive timeout with exponential backoff and jitter."""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:89:1
   |
87 |     """
88 |     Advanced circuit breaker with adaptive behavior.
89 |
   | ^^^^
90 |     Implements the Circuit Breaker pattern with:
91 |     - Automatic failure detection
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/application/circuit_breaker.py:95:1
   |
93 |     - Health check probing
94 |     - Metrics collection
95 |
   | ^^^^
96 |     Thread-safe implementation using locks.
97 |     """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:98:1
    |
 96 |     Thread-safe implementation using locks.
 97 |     """
 98 |
    | ^^^^
 99 |     def __init__(
100 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:112:1
    |
110 |         self._lock = threading.RLock()
111 |         self._failure_streak = 0
112 |
    | ^^^^^^^^
113 |     def call(self, func: Callable[..., T], *args: Any, **kwargs: Any) -> T:
114 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:116:1
    |
114 |         """
115 |         Execute function with circuit breaker protection.
116 |
    | ^^^^^^^^
117 |         Args:
118 |             func: Function to execute
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:121:1
    |
119 |             *args: Positional arguments
120 |             **kwargs: Keyword arguments
121 |
    | ^^^^^^^^^^^^
122 |         Returns:
123 |             Function result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:124:1
    |
122 |         Returns:
123 |             Function result
124 |
    | ^^^^^^^^^^^^
125 |         Raises:
126 |             CircuitBreakerOpenError: If circuit is open
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:136:1
    |
134 |                     f"Retry after {self._time_until_retry():.1f}s"
135 |                 )
136 |
    | ^^^^^^^^^^^^
137 |             if self.state == CircuitState.HALF_OPEN:
138 |                 self.half_open_calls += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:139:1
    |
137 |             if self.state == CircuitState.HALF_OPEN:
138 |                 self.half_open_calls += 1
139 |
    | ^^^^^^^^
140 |         try:
141 |             result = func(*args, **kwargs)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:147:1
    |
145 |             self._on_failure(e)
146 |             raise
147 |
    | ^^^^
148 |     async def call_async(
149 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:156:1
    |
154 |         """
155 |         Execute async function with circuit breaker protection.
156 |
    | ^^^^^^^^
157 |         Args:
158 |             func: Async function to execute
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:161:1
    |
159 |             *args: Positional arguments
160 |             **kwargs: Keyword arguments
161 |
    | ^^^^^^^^^^^^
162 |         Returns:
163 |             Function result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:164:1
    |
162 |         Returns:
163 |             Function result
164 |
    | ^^^^^^^^^^^^
165 |         Raises:
166 |             CircuitBreakerOpenError: If circuit is open
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:176:1
    |
174 |                     f"Retry after {self._time_until_retry():.1f}s"
175 |                 )
176 |
    | ^^^^^^^^^^^^
177 |             if self.state == CircuitState.HALF_OPEN:
178 |                 self.half_open_calls += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:179:1
    |
177 |             if self.state == CircuitState.HALF_OPEN:
178 |                 self.half_open_calls += 1
179 |
    | ^^^^^^^^
180 |         try:
181 |             result = await func(*args, **kwargs)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:187:1
    |
185 |             self._on_failure(e)
186 |             raise
187 |
    | ^^^^
188 |     def _can_execute(self) -> bool:
189 |         """Check if request can be executed."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:192:1
    |
190 |         if self.state == CircuitState.CLOSED:
191 |             return True
192 |
    | ^^^^^^^^
193 |         if self.state == CircuitState.OPEN:
194 |             if self._should_attempt_reset():
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:198:1
    |
196 |                 return True
197 |             return False
198 |
    | ^^^^^^^^
199 |         if self.state == CircuitState.HALF_OPEN:
200 |             return self.half_open_calls < self.config.half_open_max_calls
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:201:1
    |
199 |         if self.state == CircuitState.HALF_OPEN:
200 |             return self.half_open_calls < self.config.half_open_max_calls
201 |
    | ^^^^^^^^
202 |         return False
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:203:1
    |
202 |         return False
203 |
    | ^^^^
204 |     def _should_attempt_reset(self) -> bool:
205 |         """Check if enough time has passed to attempt reset."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:208:1
    |
206 |         if self.opened_at is None:
207 |             return False
208 |
    | ^^^^^^^^
209 |         timeout = self.config.calculate_timeout(self._failure_streak)
210 |         return time.time() - self.opened_at >= timeout
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:211:1
    |
209 |         timeout = self.config.calculate_timeout(self._failure_streak)
210 |         return time.time() - self.opened_at >= timeout
211 |
    | ^^^^
212 |     def _time_until_retry(self) -> float:
213 |         """Calculate time until next retry attempt."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:216:1
    |
214 |         if self.opened_at is None:
215 |             return 0.0
216 |
    | ^^^^^^^^
217 |         timeout = self.config.calculate_timeout(self._failure_streak)
218 |         elapsed = time.time() - self.opened_at
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:220:1
    |
218 |         elapsed = time.time() - self.opened_at
219 |         return max(0.0, timeout - elapsed)
220 |
    | ^^^^
221 |     def _on_success(self) -> None:
222 |         """Handle successful execution."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:229:1
    |
227 |             self.metrics.consecutive_failures = 0
228 |             self.metrics.last_success_time = time.time()
229 |
    | ^^^^^^^^^^^^
230 |             if self.state == CircuitState.HALF_OPEN:
231 |                 if self.metrics.consecutive_successes >= self.config.success_threshold:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:235:1
    |
233 |             elif self.state == CircuitState.CLOSED:
234 |                 self._failure_streak = max(0, self._failure_streak - 1)
235 |
    | ^^^^
236 |     def _on_failure(self, error: Exception) -> None:
237 |         """Handle failed execution."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:244:1
    |
242 |             self.metrics.consecutive_successes = 0
243 |             self.metrics.last_failure_time = time.time()
244 |
    | ^^^^^^^^^^^^
245 |             if self.state == CircuitState.HALF_OPEN:
246 |                 self._transition_to_open()
    |
help: Remove whitespace from blank line

SIM102 Use a single `if` statement instead of nested `if` statements
   --> app/ai/application/circuit_breaker.py:247:13
    |
245 |               if self.state == CircuitState.HALF_OPEN:
246 |                   self._transition_to_open()
247 | /             elif self.state == CircuitState.CLOSED:
248 | |                 if self.metrics.consecutive_failures >= self.config.failure_threshold:
    | |______________________________________________________________________________________^
249 |                       self._transition_to_open()
    |
help: Combine `if` statements using `and`

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:250:1
    |
248 |                 if self.metrics.consecutive_failures >= self.config.failure_threshold:
249 |                     self._transition_to_open()
250 |
    | ^^^^
251 |     def _transition_to_open(self) -> None:
252 |         """Transition to OPEN state."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:257:1
    |
255 |         self._failure_streak += 1
256 |         self._record_transition("OPEN")
257 |
    | ^^^^
258 |     def _transition_to_half_open(self) -> None:
259 |         """Transition to HALF_OPEN state."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:263:1
    |
261 |         self.half_open_calls = 0
262 |         self._record_transition("HALF_OPEN")
263 |
    | ^^^^
264 |     def _transition_to_closed(self) -> None:
265 |         """Transition to CLOSED state."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:272:1
    |
270 |         self._failure_streak = 0
271 |         self._record_transition("CLOSED")
272 |
    | ^^^^
273 |     def _record_transition(self, to_state: str) -> None:
274 |         """Record state transition in metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:279:1
    |
277 |             self.metrics.state_transitions.get(key, 0) + 1
278 |         )
279 |
    | ^^^^
280 |     def reset(self) -> None:
281 |         """Manually reset circuit breaker to CLOSED state."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:285:1
    |
283 |             self._transition_to_closed()
284 |             self.metrics = CircuitMetrics()
285 |
    | ^^^^
286 |     def get_state(self) -> CircuitState:
287 |         """Get current circuit state."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:289:1
    |
287 |         """Get current circuit state."""
288 |         return self.state
289 |
    | ^^^^
290 |     def get_metrics(self) -> CircuitMetrics:
291 |         """Get current metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:293:1
    |
291 |         """Get current metrics."""
292 |         return self.metrics
293 |
    | ^^^^
294 |     def is_available(self) -> bool:
295 |         """Check if circuit is available for requests."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:308:1
    |
306 |     """
307 |     Registry for managing multiple circuit breakers.
308 |
    | ^^^^
309 |     Provides centralized management and monitoring of circuit breakers
310 |     across different services or endpoints.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:312:1
    |
310 |     across different services or endpoints.
311 |     """
312 |
    | ^^^^
313 |     def __init__(self):
314 |         self._breakers: dict[str, CircuitBreaker] = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:316:1
    |
314 |         self._breakers: dict[str, CircuitBreaker] = {}
315 |         self._lock = threading.RLock()
316 |
    | ^^^^
317 |     def get_or_create(
318 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:327:1
    |
325 |                 self._breakers[name] = CircuitBreaker(name, config)
326 |             return self._breakers[name]
327 |
    | ^^^^
328 |     def get(self, name: str) -> CircuitBreaker | None:
329 |         """Get circuit breaker by name."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:331:1
    |
329 |         """Get circuit breaker by name."""
330 |         return self._breakers.get(name)
331 |
    | ^^^^
332 |     def list_all(self) -> dict[str, CircuitBreaker]:
333 |         """List all registered circuit breakers."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:335:1
    |
333 |         """List all registered circuit breakers."""
334 |         return self._breakers.copy()
335 |
    | ^^^^
336 |     def get_all_metrics(self) -> dict[str, CircuitMetrics]:
337 |         """Get metrics for all circuit breakers."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/circuit_breaker.py:342:1
    |
340 |             for name, breaker in self._breakers.items()
341 |         }
342 |
    | ^^^^
343 |     def reset_all(self) -> None:
344 |         """Reset all circuit breakers."""
    |
help: Remove whitespace from blank line

F401 [*] `datetime.timedelta` imported but unused
  --> app/ai/application/cost_manager.py:22:32
   |
20 | import time
21 | from dataclasses import dataclass, field
22 | from datetime import datetime, timedelta
   |                                ^^^^^^^^^
23 | from enum import Enum
24 | from typing import Any
   |
help: Remove unused import: `datetime.timedelta`

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:29:1
   |
27 | class CostTier(Enum):
28 |     """Cost tiers for different usage levels."""
29 |
   | ^^^^
30 |     FREE = "free"
31 |     BASIC = "basic"
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:38:1
   |
36 | class BudgetPeriod(Enum):
37 |     """Budget period types."""
38 |
   | ^^^^
39 |     HOURLY = "hourly"
40 |     DAILY = "daily"
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:49:1
   |
47 | class ModelPricing:
48 |     """Pricing information for a specific model."""
49 |
   | ^^^^
50 |     model_name: str
51 |     input_cost_per_1k: float  # Cost per 1K input tokens
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:55:1
   |
53 |     context_window: int = 4096
54 |     tier: CostTier = CostTier.BASIC
55 |
   | ^^^^
56 |     def calculate_cost(self, input_tokens: int, output_tokens: int) -> float:
57 |         """Calculate total cost for token usage."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:66:1
   |
64 | class CostRecord:
65 |     """Record of a single cost transaction."""
66 |
   | ^^^^
67 |     timestamp: float
68 |     model: str
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:81:1
   |
79 | class BudgetConfig:
80 |     """Budget configuration with limits and alerts."""
81 |
   | ^^^^
82 |     limit: float
83 |     period: BudgetPeriod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/cost_manager.py:93:1
   |
91 | class CostMetrics:
92 |     """Aggregated cost metrics."""
93 |
   | ^^^^
94 |     total_cost: float = 0.0
95 |     total_requests: int = 0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:104:1
    |
102 |     average_cost_per_request: float = 0.0
103 |     peak_cost_per_hour: float = 0.0
104 |
    | ^^^^
105 |     def update(self, record: CostRecord) -> None:
106 |         """Update metrics with new cost record."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:111:1
    |
109 |         self.total_input_tokens += record.input_tokens
110 |         self.total_output_tokens += record.output_tokens
111 |
    | ^^^^^^^^
112 |         self.cost_by_model[record.model] = (
113 |             self.cost_by_model.get(record.model, 0.0) + record.cost
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:115:1
    |
113 |             self.cost_by_model.get(record.model, 0.0) + record.cost
114 |         )
115 |
    | ^^^^^^^^
116 |         if record.user_id:
117 |             self.cost_by_user[record.user_id] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:120:1
    |
118 |                 self.cost_by_user.get(record.user_id, 0.0) + record.cost
119 |             )
120 |
    | ^^^^^^^^
121 |         if record.project_id:
122 |             self.cost_by_project[record.project_id] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:125:1
    |
123 |                 self.cost_by_project.get(record.project_id, 0.0) + record.cost
124 |             )
125 |
    | ^^^^^^^^
126 |         self.requests_by_model[record.model] = (
127 |             self.requests_by_model.get(record.model, 0) + 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:129:1
    |
127 |             self.requests_by_model.get(record.model, 0) + 1
128 |         )
129 |
    | ^^^^^^^^
130 |         self.average_cost_per_request = self.total_cost / self.total_requests
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/cost_manager.py:136:1
    |
134 |     """
135 |     Advanced cost management system for LLM usage.
136 |
    | ^^^^
137 |     Provides:
138 |     - Real-time cost tracking
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/cost_manager.py:142:1
    |
140 |     - Cost optimization
141 |     - Usage analytics
142 |
    | ^^^^
143 |     Thread-safe implementation.
144 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:145:1
    |
143 |     Thread-safe implementation.
144 |     """
145 |
    | ^^^^
146 |     def __init__(self):
147 |         self._pricing: dict[str, ModelPricing] = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:154:1
    |
152 |         self._budget_reset_times: dict[str, float] = {}
153 |         self._lock = threading.RLock()
154 |
    | ^^^^^^^^
155 |         self._initialize_default_pricing()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:156:1
    |
155 |         self._initialize_default_pricing()
156 |
    | ^^^^
157 |     def _initialize_default_pricing(self) -> None:
158 |         """Initialize default pricing for common models."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:169:1
    |
167 |             ModelPricing("llama-2-70b", 0.0007, 0.0009, 4096, CostTier.BASIC),
168 |         ]
169 |
    | ^^^^^^^^
170 |         for pricing in default_models:
171 |             self._pricing[pricing.model_name] = pricing
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:172:1
    |
170 |         for pricing in default_models:
171 |             self._pricing[pricing.model_name] = pricing
172 |
    | ^^^^
173 |     def register_model_pricing(self, pricing: ModelPricing) -> None:
174 |         """Register or update pricing for a model."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:177:1
    |
175 |         with self._lock:
176 |             self._pricing[pricing.model_name] = pricing
177 |
    | ^^^^
178 |     def set_budget(
179 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:188:1
    |
186 |             self._budget_usage[budget_id] = 0.0
187 |             self._budget_reset_times[budget_id] = time.time()
188 |
    | ^^^^
189 |     def track_usage(
190 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/cost_manager.py:201:1
    |
199 |         """
200 |         Track LLM usage and calculate cost.
201 |
    | ^^^^^^^^
202 |         Args:
203 |             model: Model name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/cost_manager.py:210:1
    |
208 |             request_id: Optional request identifier
209 |             metadata: Optional additional metadata
210 |
    | ^^^^^^^^^^^^
211 |         Returns:
212 |             CostRecord with calculated cost
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/cost_manager.py:213:1
    |
211 |         Returns:
212 |             CostRecord with calculated cost
213 |
    | ^^^^^^^^^^^^
214 |         Raises:
215 |             BudgetExceededError: If budget limit is exceeded
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:222:1
    |
220 |                 pricing = ModelPricing(model, 0.001, 0.002)
221 |                 self._pricing[model] = pricing
222 |
    | ^^^^^^^^^^^^
223 |             cost = pricing.calculate_cost(input_tokens, output_tokens)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:224:1
    |
223 |             cost = pricing.calculate_cost(input_tokens, output_tokens)
224 |
    | ^^^^^^^^^^^^
225 |             record = CostRecord(
226 |                 timestamp=time.time(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:236:1
    |
234 |                 metadata=metadata or {}
235 |             )
236 |
    | ^^^^^^^^^^^^
237 |             self._check_budgets(cost, user_id, project_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:238:1
    |
237 |             self._check_budgets(cost, user_id, project_id)
238 |
    | ^^^^^^^^^^^^
239 |             self._records.append(record)
240 |             self._metrics.update(record)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:241:1
    |
239 |             self._records.append(record)
240 |             self._metrics.update(record)
241 |
    | ^^^^^^^^^^^^
242 |             self._update_budget_usage(cost, user_id, project_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:243:1
    |
242 |             self._update_budget_usage(cost, user_id, project_id)
243 |
    | ^^^^^^^^^^^^
244 |             return record
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:245:1
    |
244 |             return record
245 |
    | ^^^^
246 |     def _check_budgets(
247 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:256:1
    |
254 |             if self._should_check_budget(budget_id, user_id, project_id):
255 |                 self._reset_budget_if_needed(budget_id, config)
256 |
    | ^^^^^^^^^^^^^^^^
257 |                 current_usage = self._budget_usage.get(budget_id, 0.0)
258 |                 projected_usage = current_usage + cost
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:259:1
    |
257 |                 current_usage = self._budget_usage.get(budget_id, 0.0)
258 |                 projected_usage = current_usage + cost
259 |
    | ^^^^^^^^^^^^^^^^
260 |                 hard_limit = config.limit * config.hard_limit_percentage
261 |                 soft_limit = config.limit * config.soft_limit_percentage
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:262:1
    |
260 |                 hard_limit = config.limit * config.hard_limit_percentage
261 |                 soft_limit = config.limit * config.soft_limit_percentage
262 |
    | ^^^^^^^^^^^^^^^^
263 |                 if projected_usage > hard_limit:
264 |                     raise BudgetExceededError(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:268:1
    |
266 |                         f"${projected_usage:.4f} > ${hard_limit:.4f}"
267 |                     )
268 |
    | ^^^^^^^^^^^^^^^^
269 |                 if projected_usage > soft_limit and current_usage <= soft_limit:
270 |                     self._trigger_budget_alert(budget_id, projected_usage, config)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:271:1
    |
269 |                 if projected_usage > soft_limit and current_usage <= soft_limit:
270 |                     self._trigger_budget_alert(budget_id, projected_usage, config)
271 |
    | ^^^^
272 |     def _should_check_budget(
273 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:286:1
    |
284 |             return budget_id == f"project:{project_id}"
285 |         return False
286 |
    | ^^^^
287 |     def _reset_budget_if_needed(
288 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:295:1
    |
293 |         if not config.auto_reset:
294 |             return
295 |
    | ^^^^^^^^
296 |         last_reset = self._budget_reset_times.get(budget_id, 0.0)
297 |         period_seconds = self._get_period_seconds(config.period)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:298:1
    |
296 |         last_reset = self._budget_reset_times.get(budget_id, 0.0)
297 |         period_seconds = self._get_period_seconds(config.period)
298 |
    | ^^^^^^^^
299 |         if time.time() - last_reset >= period_seconds:
300 |             self._budget_usage[budget_id] = 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:302:1
    |
300 |             self._budget_usage[budget_id] = 0.0
301 |             self._budget_reset_times[budget_id] = time.time()
302 |
    | ^^^^
303 |     def _get_period_seconds(self, period: BudgetPeriod) -> float:
304 |         """Convert budget period to seconds."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:313:1
    |
311 |         }
312 |         return periods.get(period, 86400)
313 |
    | ^^^^
314 |     def _update_budget_usage(
315 |         self,
    |
help: Remove whitespace from blank line

SIM118 Use `key in dict` instead of `key in dict.keys()`
   --> app/ai/application/cost_manager.py:321:13
    |
319 |     ) -> None:
320 |         """Update budget usage counters."""
321 |         for budget_id in self._budgets.keys():
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
322 |             if self._should_check_budget(budget_id, user_id, project_id):
323 |                 self._budget_usage[budget_id] = (
    |
help: Remove `.keys()`

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:326:1
    |
324 |                     self._budget_usage.get(budget_id, 0.0) + cost
325 |                 )
326 |
    | ^^^^
327 |     def _trigger_budget_alert(
328 |         self,
    |
help: Remove whitespace from blank line

SIM105 Use `contextlib.suppress(Exception)` instead of `try`-`except`-`pass`
   --> app/ai/application/cost_manager.py:335:13
    |
333 |           """Trigger budget alert callback."""
334 |           if config.alert_callback:
335 | /             try:
336 | |                 config.alert_callback(budget_id, usage, config.limit)
337 | |             except Exception:
338 | |                 pass
    | |____________________^
339 |
340 |       def get_metrics(self) -> CostMetrics:
    |
help: Replace `try`-`except`-`pass` with `with contextlib.suppress(Exception): ...`

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:339:1
    |
337 |             except Exception:
338 |                 pass
339 |
    | ^^^^
340 |     def get_metrics(self) -> CostMetrics:
341 |         """Get current cost metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:343:1
    |
341 |         """Get current cost metrics."""
342 |         return self._metrics
343 |
    | ^^^^
344 |     def get_budget_status(self, budget_id: str) -> dict[str, Any]:
345 |         """Get budget status and usage."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:350:1
    |
348 |             if not config:
349 |                 return {}
350 |
    | ^^^^^^^^^^^^
351 |             usage = self._budget_usage.get(budget_id, 0.0)
352 |             percentage = (usage / config.limit) * 100 if config.limit > 0 else 0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:353:1
    |
351 |             usage = self._budget_usage.get(budget_id, 0.0)
352 |             percentage = (usage / config.limit) * 100 if config.limit > 0 else 0
353 |
    | ^^^^^^^^^^^^
354 |             return {
355 |                 "budget_id": budget_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:363:1
    |
361 |                 "status": self._get_budget_status_label(percentage, config)
362 |             }
363 |
    | ^^^^
364 |     def _get_budget_status_label(
365 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:378:1
    |
376 |         else:
377 |             return "healthy"
378 |
    | ^^^^
379 |     def get_cost_breakdown(
380 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:387:1
    |
385 |         with self._lock:
386 |             filtered_records = self._filter_records(start_time, end_time)
387 |
    | ^^^^^^^^^^^^
388 |             breakdown = {
389 |                 "total_cost": sum(r.cost for r in filtered_records),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:396:1
    |
394 |                 "by_hour": {},
395 |             }
396 |
    | ^^^^^^^^^^^^
397 |             for record in filtered_records:
398 |                 breakdown["by_model"][record.model] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:401:1
    |
399 |                     breakdown["by_model"].get(record.model, 0.0) + record.cost
400 |                 )
401 |
    | ^^^^^^^^^^^^^^^^
402 |                 if record.user_id:
403 |                     breakdown["by_user"][record.user_id] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:406:1
    |
404 |                         breakdown["by_user"].get(record.user_id, 0.0) + record.cost
405 |                     )
406 |
    | ^^^^^^^^^^^^^^^^
407 |                 if record.project_id:
408 |                     breakdown["by_project"][record.project_id] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:411:1
    |
409 |                         breakdown["by_project"].get(record.project_id, 0.0) + record.cost
410 |                     )
411 |
    | ^^^^^^^^^^^^^^^^
412 |                 hour_key = datetime.fromtimestamp(record.timestamp).strftime("%Y-%m-%d %H:00")
413 |                 breakdown["by_hour"][hour_key] = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:416:1
    |
414 |                     breakdown["by_hour"].get(hour_key, 0.0) + record.cost
415 |                 )
416 |
    | ^^^^^^^^^^^^
417 |             return breakdown
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:418:1
    |
417 |             return breakdown
418 |
    | ^^^^
419 |     def _filter_records(
420 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:426:1
    |
424 |         """Filter records by time range."""
425 |         filtered = self._records
426 |
    | ^^^^^^^^
427 |         if start_time:
428 |             filtered = [r for r in filtered if r.timestamp >= start_time]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:429:1
    |
427 |         if start_time:
428 |             filtered = [r for r in filtered if r.timestamp >= start_time]
429 |
    | ^^^^^^^^
430 |         if end_time:
431 |             filtered = [r for r in filtered if r.timestamp <= end_time]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:432:1
    |
430 |         if end_time:
431 |             filtered = [r for r in filtered if r.timestamp <= end_time]
432 |
    | ^^^^^^^^
433 |         return filtered
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:434:1
    |
433 |         return filtered
434 |
    | ^^^^
435 |     def predict_monthly_cost(self) -> float:
436 |         """Predict monthly cost based on recent usage."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:441:1
    |
439 |             week_ago = now - (7 * 86400)
440 |             recent_records = self._filter_records(week_ago, now)
441 |
    | ^^^^^^^^^^^^
442 |             if not recent_records:
443 |                 return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:444:1
    |
442 |             if not recent_records:
443 |                 return 0.0
444 |
    | ^^^^^^^^^^^^
445 |             weekly_cost = sum(r.cost for r in recent_records)
446 |             return (weekly_cost / 7) * 30
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:447:1
    |
445 |             weekly_cost = sum(r.cost for r in recent_records)
446 |             return (weekly_cost / 7) * 30
447 |
    | ^^^^
448 |     def get_optimization_recommendations(self) -> list[str]:
449 |         """Generate cost optimization recommendations."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:451:1
    |
449 |         """Generate cost optimization recommendations."""
450 |         recommendations = []
451 |
    | ^^^^^^^^
452 |         with self._lock:
453 |             if not self._metrics.cost_by_model:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:455:1
    |
453 |             if not self._metrics.cost_by_model:
454 |                 return recommendations
455 |
    | ^^^^^^^^^^^^
456 |             sorted_models = sorted(
457 |                 self._metrics.cost_by_model.items(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:461:1
    |
459 |                 reverse=True
460 |             )
461 |
    | ^^^^^^^^^^^^
462 |             top_model, top_cost = sorted_models[0]
463 |             total_cost = self._metrics.total_cost
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:464:1
    |
462 |             top_model, top_cost = sorted_models[0]
463 |             total_cost = self._metrics.total_cost
464 |
    | ^^^^^^^^^^^^
465 |             if top_cost / total_cost > 0.7:
466 |                 recommendations.append(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:470:1
    |
468 |                     f"of costs. Consider using a cheaper alternative for non-critical tasks."
469 |                 )
470 |
    | ^^^^^^^^^^^^
471 |             avg_tokens = (
472 |                 (self._metrics.total_input_tokens + self._metrics.total_output_tokens)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:476:1
    |
474 |                 if self._metrics.total_requests > 0 else 0
475 |             )
476 |
    | ^^^^^^^^^^^^
477 |             if avg_tokens > 2000:
478 |                 recommendations.append(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:482:1
    |
480 |                     f"Consider prompt optimization to reduce token consumption."
481 |                 )
482 |
    | ^^^^^^^^^^^^
483 |             predicted_monthly = self.predict_monthly_cost()
484 |             if predicted_monthly > 1000:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:489:1
    |
487 |                     f"Consider implementing caching or request batching."
488 |                 )
489 |
    | ^^^^^^^^
490 |         return recommendations
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/cost_manager.py:491:1
    |
490 |         return recommendations
491 |
    | ^^^^
492 |     def reset_metrics(self) -> None:
493 |         """Reset all metrics and records."""
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
 --> app/ai/application/payload_builder.py:1:1
  |
1 | / from __future__ import annotations
2 | |
3 | | import os
4 | | from typing import Any, List, Dict, Optional
  | |____________________________________________^
  |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
 --> app/ai/application/payload_builder.py:4:1
  |
3 | import os
4 | from typing import Any, List, Dict, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/ai/application/payload_builder.py:4:1
  |
3 | import os
4 | from typing import Any, List, Dict, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/payload_builder.py:13:39
   |
11 |     """
12 |
13 |     def __init__(self, default_model: Optional[str] = None):
   |                                       ^^^^^^^^^^^^^
14 |         self._force_model = os.getenv("LLM_FORCE_MODEL", "").strip() or None
15 |         self._default_model = default_model
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/ai/application/payload_builder.py:20:19
   |
18 |         self,
19 |         model: str,
20 |         messages: List[Dict[str, str]],
   |                   ^^^^
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/ai/application/payload_builder.py:20:24
   |
18 |         self,
19 |         model: str,
20 |         messages: List[Dict[str, str]],
   |                        ^^^^
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/payload_builder.py:22:16
   |
20 |         messages: List[Dict[str, str]],
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |         tool_choice: Optional[str] = None,
24 |         temperature: float = 0.7,
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/ai/application/payload_builder.py:22:25
   |
20 |         messages: List[Dict[str, str]],
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
   |                         ^^^^
23 |         tool_choice: Optional[str] = None,
24 |         temperature: float = 0.7,
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/ai/application/payload_builder.py:22:30
   |
20 |         messages: List[Dict[str, str]],
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
   |                              ^^^^
23 |         tool_choice: Optional[str] = None,
24 |         temperature: float = 0.7,
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/payload_builder.py:23:22
   |
21 |         *,
22 |         tools: Optional[List[Dict[str, Any]]] = None,
23 |         tool_choice: Optional[str] = None,
   |                      ^^^^^^^^^^^^^
24 |         temperature: float = 0.7,
25 |         max_tokens: Optional[int] = None,
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/payload_builder.py:25:21
   |
23 |         tool_choice: Optional[str] = None,
24 |         temperature: float = 0.7,
25 |         max_tokens: Optional[int] = None,
   |                     ^^^^^^^^^^^^^
26 |         extra: Optional[Dict[str, Any]] = None,
27 |     ) -> Dict[str, Any]:
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/payload_builder.py:26:16
   |
24 |         temperature: float = 0.7,
25 |         max_tokens: Optional[int] = None,
26 |         extra: Optional[Dict[str, Any]] = None,
   |                ^^^^^^^^^^^^^^^^^^^^^^^^
27 |     ) -> Dict[str, Any]:
28 |         """
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/ai/application/payload_builder.py:26:25
   |
24 |         temperature: float = 0.7,
25 |         max_tokens: Optional[int] = None,
26 |         extra: Optional[Dict[str, Any]] = None,
   |                         ^^^^
27 |     ) -> Dict[str, Any]:
28 |         """
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/ai/application/payload_builder.py:27:10
   |
25 |         max_tokens: Optional[int] = None,
26 |         extra: Optional[Dict[str, Any]] = None,
27 |     ) -> Dict[str, Any]:
   |          ^^^^
28 |         """
29 |         Builds and returns the standardized payload dictionary.
   |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> app/ai/application/response_normalizer.py:1:1
   |
 1 | / from __future__ import annotations
 2 | |
 3 | | import logging
 4 | | import os
 5 | | import re
 6 | | import contextlib
 7 | | import json
 8 | | from typing import Any, Optional
 9 | |
10 | | from app.services.llm.cost_manager import CostManager
   | |_____________________________________________________^
11 |
12 |   _LOG = logging.getLogger(__name__)
   |
help: Organize imports

UP045 [*] Use `X | None` for type annotations
  --> app/ai/application/response_normalizer.py:21:38
   |
19 |     """
20 |
21 |     def __init__(self, cost_manager: Optional[CostManager] = None):
   |                                      ^^^^^^^^^^^^^^^^^^^^^
22 |         self._cost_manager = cost_manager or CostManager()
23 |         self._sanitize_enabled = os.getenv("LLM_SANITIZE_OUTPUT", "0") == "1"
   |
help: Convert to `X | None`

F401 [*] `math` imported but unused
  --> app/ai/application/retry_strategy.py:19:8
   |
17 | from __future__ import annotations
18 |
19 | import math
   |        ^^^^
20 | import random
21 | import time
   |
help: Remove unused import: `math`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/ai/application/retry_strategy.py:25:1
   |
23 | from dataclasses import dataclass, field
24 | from enum import Enum
25 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Import from `collections.abc`

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:30:1
   |
28 | class ErrorCategory(Enum):
29 |     """Categories of errors for retry decisions."""
30 |
   | ^^^^
31 |     RATE_LIMIT = "rate_limit"  # 429, rate limit errors
32 |     NETWORK = "network"  # Connection, timeout errors
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:43:1
   |
41 | class RetryConfig:
42 |     """Configuration for retry behavior."""
43 |
   | ^^^^
44 |     max_attempts: int = 3
45 |     base_delay: float = 1.0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:63:1
   |
61 | class RetryMetrics:
62 |     """Metrics for retry operations."""
63 |
   | ^^^^
64 |     total_attempts: int = 0
65 |     successful_retries: int = 0
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:75:1
   |
73 |     """
74 |     Abstract base class for retry strategies.
75 |
   | ^^^^
76 |     Defines the interface for calculating retry delays
77 |     and determining retry eligibility.
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:79:1
   |
77 |     and determining retry eligibility.
78 |     """
79 |
   | ^^^^
80 |     def __init__(self, config: RetryConfig | None = None):
81 |         self.config = config or RetryConfig()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:83:1
   |
81 |         self.config = config or RetryConfig()
82 |         self.metrics = RetryMetrics()
83 |
   | ^^^^
84 |     @abstractmethod
85 |     def calculate_delay(self, attempt: int) -> float:
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:88:1
   |
86 |         """
87 |         Calculate delay before next retry attempt.
88 |
   | ^^^^^^^^
89 |         Args:
90 |             attempt: Current attempt number (0-indexed)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:91:1
   |
89 |         Args:
90 |             attempt: Current attempt number (0-indexed)
91 |
   | ^^^^^^^^^^^^
92 |         Returns:
93 |             Delay in seconds
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/application/retry_strategy.py:96:1
   |
94 |         """
95 |         pass
96 |
   | ^^^^
97 |     def should_retry(self, error: Exception, attempt: int) -> bool:
98 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:100:1
    |
 98 |         """
 99 |         Determine if request should be retried.
100 |
    | ^^^^^^^^
101 |         Args:
102 |             error: The exception that occurred
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:104:1
    |
102 |             error: The exception that occurred
103 |             attempt: Current attempt number (0-indexed)
104 |
    | ^^^^^^^^^^^^
105 |         Returns:
106 |             True if should retry, False otherwise
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:110:1
    |
108 |         if attempt >= self.config.max_attempts:
109 |             return False
110 |
    | ^^^^^^^^
111 |         category = self.classify_error(error)
112 |         return category in self.config.retry_on_categories
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:113:1
    |
111 |         category = self.classify_error(error)
112 |         return category in self.config.retry_on_categories
113 |
    | ^^^^
114 |     def classify_error(self, error: Exception) -> ErrorCategory:
115 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:117:1
    |
115 |         """
116 |         Classify error into category for retry decision.
117 |
    | ^^^^^^^^
118 |         Args:
119 |             error: The exception to classify
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:120:1
    |
118 |         Args:
119 |             error: The exception to classify
120 |
    | ^^^^^^^^^^^^
121 |         Returns:
122 |             ErrorCategory enum value
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:126:1
    |
124 |         error_str = str(error).lower()
125 |         error_type = type(error).__name__.lower()
126 |
    | ^^^^^^^^
127 |         if "429" in error_str or "rate limit" in error_str:
128 |             return ErrorCategory.RATE_LIMIT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:129:1
    |
127 |         if "429" in error_str or "rate limit" in error_str:
128 |             return ErrorCategory.RATE_LIMIT
129 |
    | ^^^^^^^^
130 |         if "timeout" in error_str or "timeout" in error_type:
131 |             return ErrorCategory.TIMEOUT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:132:1
    |
130 |         if "timeout" in error_str or "timeout" in error_type:
131 |             return ErrorCategory.TIMEOUT
132 |
    | ^^^^^^^^
133 |         if any(x in error_str for x in ["connection", "network", "dns"]):
134 |             return ErrorCategory.NETWORK
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:135:1
    |
133 |         if any(x in error_str for x in ["connection", "network", "dns"]):
134 |             return ErrorCategory.NETWORK
135 |
    | ^^^^^^^^
136 |         if "401" in error_str or "403" in error_str or "auth" in error_str:
137 |             return ErrorCategory.AUTHENTICATION
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:138:1
    |
136 |         if "401" in error_str or "403" in error_str or "auth" in error_str:
137 |             return ErrorCategory.AUTHENTICATION
138 |
    | ^^^^^^^^
139 |         if any(f"5{i}" in error_str for i in range(10)):
140 |             return ErrorCategory.SERVER_ERROR
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:141:1
    |
139 |         if any(f"5{i}" in error_str for i in range(10)):
140 |             return ErrorCategory.SERVER_ERROR
141 |
    | ^^^^^^^^
142 |         if any(f"4{i}" in error_str for i in range(10)):
143 |             return ErrorCategory.CLIENT_ERROR
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:144:1
    |
142 |         if any(f"4{i}" in error_str for i in range(10)):
143 |             return ErrorCategory.CLIENT_ERROR
144 |
    | ^^^^^^^^
145 |         return ErrorCategory.UNKNOWN
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:146:1
    |
145 |         return ErrorCategory.UNKNOWN
146 |
    | ^^^^
147 |     def add_jitter(self, delay: float) -> float:
148 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:150:1
    |
148 |         """
149 |         Add jitter to delay to prevent thundering herd.
150 |
    | ^^^^^^^^
151 |         Args:
152 |             delay: Base delay in seconds
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:153:1
    |
151 |         Args:
152 |             delay: Base delay in seconds
153 |
    | ^^^^^^^^^^^^
154 |         Returns:
155 |             Delay with jitter applied
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:159:1
    |
157 |         if not self.config.jitter:
158 |             return delay
159 |
    | ^^^^^^^^
160 |         jitter_amount = delay * self.config.jitter_factor
161 |         jitter = random.uniform(-jitter_amount, jitter_amount)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:163:1
    |
161 |         jitter = random.uniform(-jitter_amount, jitter_amount)
162 |         return max(0, delay + jitter)
163 |
    | ^^^^
164 |     def record_attempt(self, category: ErrorCategory, success: bool) -> None:
165 |         """Record retry attempt in metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:167:1
    |
165 |         """Record retry attempt in metrics."""
166 |         self.metrics.total_attempts += 1
167 |
    | ^^^^^^^^
168 |         if success:
169 |             self.metrics.successful_retries += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:172:1
    |
170 |         else:
171 |             self.metrics.failed_retries += 1
172 |
    | ^^^^^^^^
173 |         self.metrics.retries_by_category[category] = (
174 |             self.metrics.retries_by_category.get(category, 0) + 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:176:1
    |
174 |             self.metrics.retries_by_category.get(category, 0) + 1
175 |         )
176 |
    | ^^^^^^^^
177 |         if self.metrics.total_attempts > 0:
178 |             self.metrics.average_attempts = (
    |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
   --> app/ai/application/retry_strategy.py:179:46
    |
177 |         if self.metrics.total_attempts > 0:
178 |             self.metrics.average_attempts = (
179 |                 self.metrics.total_attempts /
    |                                              ^
180 |                 (self.metrics.successful_retries + self.metrics.failed_retries + 1)
181 |             )
    |
help: Remove trailing whitespace

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:182:1
    |
180 |                 (self.metrics.successful_retries + self.metrics.failed_retries + 1)
181 |             )
182 |
    | ^^^^
183 |     def get_metrics(self) -> RetryMetrics:
184 |         """Get current retry metrics."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:191:1
    |
189 |     """
190 |     Exponential backoff retry strategy.
191 |
    | ^^^^
192 |     Delay increases exponentially: base * (exponential_base ^ attempt)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:193:1
    |
192 |     Delay increases exponentially: base * (exponential_base ^ attempt)
193 |
    | ^^^^
194 |     Example with base=1, exponential_base=2:
195 |     - Attempt 0: 1s
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:200:1
    |
198 |     - Attempt 3: 8s
199 |     """
200 |
    | ^^^^
201 |     def calculate_delay(self, attempt: int) -> float:
202 |         """Calculate exponential backoff delay."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:213:1
    |
211 |     """
212 |     Linear backoff retry strategy.
213 |
    | ^^^^
214 |     Delay increases linearly: base * (attempt + 1)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:215:1
    |
214 |     Delay increases linearly: base * (attempt + 1)
215 |
    | ^^^^
216 |     Example with base=1:
217 |     - Attempt 0: 1s
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:222:1
    |
220 |     - Attempt 3: 4s
221 |     """
222 |
    | ^^^^
223 |     def calculate_delay(self, attempt: int) -> float:
224 |         """Calculate linear backoff delay."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:233:1
    |
231 |     """
232 |     Fibonacci backoff retry strategy.
233 |
    | ^^^^
234 |     Delay follows fibonacci sequence.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:235:1
    |
234 |     Delay follows fibonacci sequence.
235 |
    | ^^^^
236 |     Example with base=1:
237 |     - Attempt 0: 1s
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:244:1
    |
242 |     - Attempt 5: 8s
243 |     """
244 |
    | ^^^^
245 |     def __init__(self, config: RetryConfig | None = None):
246 |         super().__init__(config)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:248:1
    |
246 |         super().__init__(config)
247 |         self._fib_cache: dict[int, int] = {0: 1, 1: 1}
248 |
    | ^^^^
249 |     def _fibonacci(self, n: int) -> int:
250 |         """Calculate nth fibonacci number with caching."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:253:1
    |
251 |         if n in self._fib_cache:
252 |             return self._fib_cache[n]
253 |
    | ^^^^^^^^
254 |         self._fib_cache[n] = self._fibonacci(n - 1) + self._fibonacci(n - 2)
255 |         return self._fib_cache[n]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:256:1
    |
254 |         self._fib_cache[n] = self._fibonacci(n - 1) + self._fibonacci(n - 2)
255 |         return self._fib_cache[n]
256 |
    | ^^^^
257 |     def calculate_delay(self, attempt: int) -> float:
258 |         """Calculate fibonacci backoff delay."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:268:1
    |
266 |     """
267 |     Adaptive retry strategy that adjusts based on error patterns.
268 |
    | ^^^^
269 |     Features:
270 |     - Learns from error patterns
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:275:1
    |
273 |     - Slower retries for persistent errors
274 |     """
275 |
    | ^^^^
276 |     def __init__(self, config: RetryConfig | None = None):
277 |         super().__init__(config)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:280:1
    |
278 |         self._error_history: list[tuple[float, ErrorCategory]] = []
279 |         self._category_delays: dict[ErrorCategory, float] = {}
280 |
    | ^^^^
281 |     def calculate_delay(self, attempt: int) -> float:
282 |         """Calculate adaptive delay based on error history."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:285:1
    |
283 |         if not self._error_history:
284 |             return self._exponential_delay(attempt)
285 |
    | ^^^^^^^^
286 |         recent_category = self._error_history[-1][1]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:287:1
    |
286 |         recent_category = self._error_history[-1][1]
287 |
    | ^^^^^^^^
288 |         if recent_category == ErrorCategory.RATE_LIMIT:
289 |             return self._rate_limit_delay(attempt)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:296:1
    |
294 |         else:
295 |             return self._exponential_delay(attempt)
296 |
    | ^^^^
297 |     def _exponential_delay(self, attempt: int) -> float:
298 |         """Standard exponential backoff."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:302:1
    |
300 |         delay = min(delay, self.config.max_delay)
301 |         return self.add_jitter(delay)
302 |
    | ^^^^
303 |     def _rate_limit_delay(self, attempt: int) -> float:
304 |         """Longer delay for rate limits."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:309:1
    |
307 |         delay = min(delay, self.config.max_delay)
308 |         return self.add_jitter(delay)
309 |
    | ^^^^
310 |     def _network_delay(self, attempt: int) -> float:
311 |         """Shorter delay for network errors (likely transient)."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:316:1
    |
314 |         delay = min(delay, self.config.max_delay)
315 |         return self.add_jitter(delay)
316 |
    | ^^^^
317 |     def _server_error_delay(self, attempt: int) -> float:
318 |         """Moderate delay for server errors."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:322:1
    |
320 |         delay = min(delay, self.config.max_delay)
321 |         return self.add_jitter(delay)
322 |
    | ^^^^
323 |     def record_error(self, error: Exception) -> None:
324 |         """Record error for adaptive learning."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:327:1
    |
325 |         category = self.classify_error(error)
326 |         self._error_history.append((time.time(), category))
327 |
    | ^^^^^^^^
328 |         if len(self._error_history) > 100:
329 |             self._error_history = self._error_history[-100:]
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:335:1
    |
333 |     """
334 |     Executor for retry operations with strategy pattern.
335 |
    | ^^^^
336 |     Handles the actual retry loop with configurable strategy.
337 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:338:1
    |
336 |     Handles the actual retry loop with configurable strategy.
337 |     """
338 |
    | ^^^^
339 |     def __init__(self, strategy: RetryStrategy | None = None):
340 |         self.strategy = strategy or ExponentialBackoffRetry()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:341:1
    |
339 |     def __init__(self, strategy: RetryStrategy | None = None):
340 |         self.strategy = strategy or ExponentialBackoffRetry()
341 |
    | ^^^^
342 |     def execute(
343 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:350:1
    |
348 |         """
349 |         Execute function with retry logic.
350 |
    | ^^^^^^^^
351 |         Args:
352 |             func: Function to execute
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:355:1
    |
353 |             *args: Positional arguments
354 |             **kwargs: Keyword arguments
355 |
    | ^^^^^^^^^^^^
356 |         Returns:
357 |             Function result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:358:1
    |
356 |         Returns:
357 |             Function result
358 |
    | ^^^^^^^^^^^^
359 |         Raises:
360 |             Exception: Last exception if all retries fail
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:363:1
    |
361 |         """
362 |         last_error = None
363 |
    | ^^^^^^^^
364 |         for attempt in range(self.strategy.config.max_attempts):
365 |             try:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:367:1
    |
365 |             try:
366 |                 result = func(*args, **kwargs)
367 |
    | ^^^^^^^^^^^^^^^^
368 |                 if attempt > 0:
369 |                     category = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:374:1
    |
372 |                     )
373 |                     self.strategy.record_attempt(category, success=True)
374 |
    | ^^^^^^^^^^^^^^^^
375 |                 return result
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:376:1
    |
375 |                 return result
376 |
    | ^^^^^^^^^^^^^^^^
377 |             except Exception as e:
378 |                 last_error = e
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:380:1
    |
378 |                 last_error = e
379 |                 category = self.strategy.classify_error(e)
380 |
    | ^^^^^^^^^^^^^^^^
381 |                 if not self.strategy.should_retry(e, attempt):
382 |                     self.strategy.record_attempt(category, success=False)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:384:1
    |
382 |                     self.strategy.record_attempt(category, success=False)
383 |                     raise
384 |
    | ^^^^^^^^^^^^^^^^
385 |                 if attempt < self.strategy.config.max_attempts - 1:
386 |                     delay = self.strategy.calculate_delay(attempt)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:388:1
    |
386 |                     delay = self.strategy.calculate_delay(attempt)
387 |                     self.strategy.metrics.total_delay += delay
388 |
    | ^^^^^^^^^^^^^^^^^^^^
389 |                     if isinstance(self.strategy, AdaptiveRetry):
390 |                         self.strategy.record_error(e)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:391:1
    |
389 |                     if isinstance(self.strategy, AdaptiveRetry):
390 |                         self.strategy.record_error(e)
391 |
    | ^^^^^^^^^^^^^^^^^^^^
392 |                     time.sleep(delay)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:393:1
    |
392 |                     time.sleep(delay)
393 |
    | ^^^^^^^^
394 |         if last_error:
395 |             category = self.strategy.classify_error(last_error)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:398:1
    |
396 |             self.strategy.record_attempt(category, success=False)
397 |             raise last_error
398 |
    | ^^^^^^^^
399 |         raise RuntimeError("Retry loop completed without result or error")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:400:1
    |
399 |         raise RuntimeError("Retry loop completed without result or error")
400 |
    | ^^^^
401 |     async def execute_async(
402 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:409:1
    |
407 |         """
408 |         Execute async function with retry logic.
409 |
    | ^^^^^^^^
410 |         Args:
411 |             func: Async function to execute
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:414:1
    |
412 |             *args: Positional arguments
413 |             **kwargs: Keyword arguments
414 |
    | ^^^^^^^^^^^^
415 |         Returns:
416 |             Function result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:417:1
    |
415 |         Returns:
416 |             Function result
417 |
    | ^^^^^^^^^^^^
418 |         Raises:
419 |             Exception: Last exception if all retries fail
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:422:1
    |
420 |         """
421 |         import asyncio
422 |
    | ^^^^^^^^
423 |         last_error = None
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:424:1
    |
423 |         last_error = None
424 |
    | ^^^^^^^^
425 |         for attempt in range(self.strategy.config.max_attempts):
426 |             try:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:428:1
    |
426 |             try:
427 |                 result = await func(*args, **kwargs)
428 |
    | ^^^^^^^^^^^^^^^^
429 |                 if attempt > 0:
430 |                     category = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:435:1
    |
433 |                     )
434 |                     self.strategy.record_attempt(category, success=True)
435 |
    | ^^^^^^^^^^^^^^^^
436 |                 return result
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:437:1
    |
436 |                 return result
437 |
    | ^^^^^^^^^^^^^^^^
438 |             except Exception as e:
439 |                 last_error = e
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:441:1
    |
439 |                 last_error = e
440 |                 category = self.strategy.classify_error(e)
441 |
    | ^^^^^^^^^^^^^^^^
442 |                 if not self.strategy.should_retry(e, attempt):
443 |                     self.strategy.record_attempt(category, success=False)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:445:1
    |
443 |                     self.strategy.record_attempt(category, success=False)
444 |                     raise
445 |
    | ^^^^^^^^^^^^^^^^
446 |                 if attempt < self.strategy.config.max_attempts - 1:
447 |                     delay = self.strategy.calculate_delay(attempt)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:449:1
    |
447 |                     delay = self.strategy.calculate_delay(attempt)
448 |                     self.strategy.metrics.total_delay += delay
449 |
    | ^^^^^^^^^^^^^^^^^^^^
450 |                     if isinstance(self.strategy, AdaptiveRetry):
451 |                         self.strategy.record_error(e)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:452:1
    |
450 |                     if isinstance(self.strategy, AdaptiveRetry):
451 |                         self.strategy.record_error(e)
452 |
    | ^^^^^^^^^^^^^^^^^^^^
453 |                     await asyncio.sleep(delay)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:454:1
    |
453 |                     await asyncio.sleep(delay)
454 |
    | ^^^^^^^^
455 |         if last_error:
456 |             category = self.strategy.classify_error(last_error)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:459:1
    |
457 |             self.strategy.record_attempt(category, success=False)
458 |             raise last_error
459 |
    | ^^^^^^^^
460 |         raise RuntimeError("Retry loop completed without result or error")
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:469:1
    |
467 |     """
468 |     Decorator for adding retry logic to functions.
469 |
    | ^^^^
470 |     Args:
471 |         strategy: Retry strategy to use
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:473:1
    |
471 |         strategy: Retry strategy to use
472 |         config: Retry configuration (if strategy not provided)
473 |
    | ^^^^^^^^
474 |     Returns:
475 |         Decorated function with retry logic
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:476:1
    |
474 |     Returns:
475 |         Decorated function with retry logic
476 |
    | ^^^^^^^^
477 |     Example:
478 |         @with_retry(config=RetryConfig(max_attempts=5))
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:484:1
    |
482 |     if strategy is None:
483 |         strategy = ExponentialBackoffRetry(config)
484 |
    | ^^^^
485 |     executor = RetryExecutor(strategy)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:486:1
    |
485 |     executor = RetryExecutor(strategy)
486 |
    | ^^^^
487 |     def decorator(func: Callable) -> Callable:
488 |         def wrapper(*args: Any, **kwargs: Any) -> Any:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/application/retry_strategy.py:491:1
    |
489 |             return executor.execute(func, *args, **kwargs)
490 |         return wrapper
491 |
    | ^^^^
492 |     return decorator
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/ai/domain/__init__.py:26:11
   |
24 |   )
25 |
26 |   __all__ = [
   |  ___________^
27 | |     # Enums
28 | |     "LLMProvider",
29 | |     "MessageRole",
30 | |     "ErrorCategory",
31 | |     "CircuitState",
32 | |     # Value Objects
33 | |     "Message",
34 | |     "TokenUsage",
35 | |     "ModelResponse",
36 | |     # Entities
37 | |     "LLMRequest",
38 | |     "CostRecord",
39 | |     "CircuitBreakerStats",
40 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/ai/domain/models.py:13:1
   |
11 |   """
12 |
13 | / from __future__ import annotations
14 | |
15 | | from dataclasses import dataclass, field
16 | | from datetime import datetime
17 | | from enum import Enum
18 | | from typing import Any
   | |______________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/ai/domain/models.py:71:1
   |
69 |     """
70 |     Chat message value object.
71 |
   | ^^^^
72 |     Immutable representation of a single message in a conversation.
73 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/models.py:110:1
    |
108 |     """
109 |     Token usage value object.
110 |
    | ^^^^
111 |     Tracks token consumption for billing and optimization.
112 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/models.py:128:1
    |
126 |     """
127 |     LLM response value object.
128 |
    | ^^^^
129 |     Immutable representation of a complete LLM response.
130 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/models.py:163:1
    |
161 |     """
162 |     LLM request entity.
163 |
    | ^^^^
164 |     Mutable entity representing a request in progress.
165 |     Tracks state, attempts, and history.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/domain/models.py:174:1
    |
172 |     max_tokens: int | None = None
173 |     stream: bool = False
174 |
    | ^^^^
175 |     # State tracking
176 |     attempts: int = 0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/domain/models.py:180:1
    |
178 |     created_at: datetime = field(default_factory=datetime.utcnow)
179 |     updated_at: datetime = field(default_factory=datetime.utcnow)
180 |
    | ^^^^
181 |     # Additional parameters
182 |     extra_params: dict[str, Any] = field(default_factory=dict)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/models.py:212:1
    |
210 |     """
211 |     Cost tracking entity.
212 |
    | ^^^^
213 |     Mutable entity for tracking cumulative costs.
214 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/models.py:251:1
    |
249 |     """
250 |     Circuit breaker statistics entity.
251 |
    | ^^^^
252 |     Tracks circuit breaker health and performance.
253 |     """
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
   --> app/ai/domain/models.py:298:11
    |
296 |   # ======================================================================================
297 |
298 |   __all__ = [
    |  ___________^
299 | |     # Enums
300 | |     "LLMProvider",
301 | |     "MessageRole",
302 | |     "ErrorCategory",
303 | |     "CircuitState",
304 | |     # Value Objects
305 | |     "Message",
306 | |     "TokenUsage",
307 | |     "ModelResponse",
308 | |     # Entities
309 | |     "LLMRequest",
310 | |     "CostRecord",
311 | |     "CircuitBreakerStats",
312 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/ai/domain/ports/__init__.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | from typing import Any, Generator, Protocol
   | |___________________________________________^
   |
help: Organize imports

UP035 [*] Import from `collections.abc` instead: `Generator`
  --> app/ai/domain/ports/__init__.py:12:1
   |
10 | from __future__ import annotations
11 |
12 | from typing import Any, Generator, Protocol
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Import from `collections.abc`

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:23:1
   |
21 |     """
22 |     Port for LLM client interactions.
23 |
   | ^^^^
24 |     Infrastructure implementations:
25 |     - OpenRouterTransport
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:39:1
   |
37 |         """
38 |         Execute a chat completion request.
39 |
   | ^^^^^^^^
40 |         Args:
41 |             messages: List of message dictionaries
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:44:1
   |
42 |             model: Model identifier
43 |             **kwargs: Additional parameters (temperature, max_tokens, etc.)
44 |
   | ^^^^^^^^^^^^
45 |         Returns:
46 |             Response dictionary with 'content', 'usage', etc.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:58:1
   |
56 |         """
57 |         Execute a streaming chat completion request.
58 |
   | ^^^^^^^^
59 |         Args:
60 |             messages: List of message dictionaries
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:63:1
   |
61 |             model: Model identifier
62 |             **kwargs: Additional parameters
63 |
   | ^^^^^^^^^^^^
64 |         Yields:
65 |             Response chunks with incremental content
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:78:1
   |
76 |     """
77 |     Port for retry logic.
78 |
   | ^^^^
79 |     Implementations handle different retry patterns:
80 |     - ExponentialBackoffRetry
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:88:1
   |
86 |         """
87 |         Determine if request should be retried.
88 |
   | ^^^^^^^^
89 |         Args:
90 |             error: The exception that occurred
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/domain/ports/__init__.py:92:1
   |
90 |             error: The exception that occurred
91 |             attempt: Current attempt number (0-indexed)
92 |
   | ^^^^^^^^^^^^
93 |         Returns:
94 |             True if should retry, False otherwise
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:101:1
    |
 99 |         """
100 |         Calculate delay before next retry.
101 |
    | ^^^^^^^^
102 |         Args:
103 |             attempt: Current attempt number (0-indexed)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:104:1
    |
102 |         Args:
103 |             attempt: Current attempt number (0-indexed)
104 |
    | ^^^^^^^^^^^^
105 |         Returns:
106 |             Delay in seconds
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:114:1
    |
112 |         """
113 |         Classify error type for appropriate handling.
114 |
    | ^^^^^^^^
115 |         Args:
116 |             error: The exception to classify
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:117:1
    |
115 |         Args:
116 |             error: The exception to classify
117 |
    | ^^^^^^^^^^^^
118 |         Returns:
119 |             Error category (e.g., 'rate_limit', 'network', 'authentication')
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:132:1
    |
130 |     """
131 |     Port for circuit breaker pattern.
132 |
    | ^^^^
133 |     Implementations:
134 |     - SimpleCircuitBreaker
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:142:1
    |
140 |         """
141 |         Execute function with circuit breaker protection.
142 |
    | ^^^^^^^^
143 |         Args:
144 |             func: Function to execute
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:147:1
    |
145 |             *args: Positional arguments
146 |             **kwargs: Keyword arguments
147 |
    | ^^^^^^^^^^^^
148 |         Returns:
149 |             Function result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:150:1
    |
148 |         Returns:
149 |             Function result
150 |
    | ^^^^^^^^^^^^
151 |         Raises:
152 |             CircuitBreakerOpenError: If circuit is open
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:181:1
    |
179 |     """
180 |     Port for cost tracking and management.
181 |
    | ^^^^
182 |     Implementations:
183 |     - BasicCostManager
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:196:1
    |
194 |         """
195 |         Record token usage and calculate cost.
196 |
    | ^^^^^^^^
197 |         Args:
198 |             model: Model identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:201:1
    |
199 |             input_tokens: Number of input tokens
200 |             output_tokens: Number of output tokens
201 |
    | ^^^^^^^^^^^^
202 |         Returns:
203 |             Cost in USD
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:210:1
    |
208 |         """
209 |         Get total accumulated cost.
210 |
    | ^^^^^^^^
211 |         Args:
212 |             model: Optional model filter
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:213:1
    |
211 |         Args:
212 |             model: Optional model filter
213 |
    | ^^^^^^^^^^^^
214 |         Returns:
215 |             Total cost in USD
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:222:1
    |
220 |         """
221 |         Get usage statistics.
222 |
    | ^^^^^^^^
223 |         Returns:
224 |             Dictionary with usage stats (tokens, costs, etc.)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:237:1
    |
235 |     """
236 |     Port for caching LLM responses.
237 |
    | ^^^^
238 |     Implementations:
239 |     - RedisCache
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:247:1
    |
245 |         """
246 |         Retrieve cached value.
247 |
    | ^^^^^^^^
248 |         Args:
249 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:250:1
    |
248 |         Args:
249 |             key: Cache key
250 |
    | ^^^^^^^^^^^^
251 |         Returns:
252 |             Cached value or None if not found
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:259:1
    |
257 |         """
258 |         Store value in cache.
259 |
    | ^^^^^^^^
260 |         Args:
261 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:270:1
    |
268 |         """
269 |         Delete cached value.
270 |
    | ^^^^^^^^
271 |         Args:
272 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:283:1
    |
281 |         """
282 |         Check if key exists in cache.
283 |
    | ^^^^^^^^
284 |         Args:
285 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:286:1
    |
284 |         Args:
285 |             key: Cache key
286 |
    | ^^^^^^^^^^^^
287 |         Returns:
288 |             True if key exists, False otherwise
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:301:1
    |
299 |     """
300 |     Port for metrics collection and reporting.
301 |
    | ^^^^
302 |     Implementations:
303 |     - PrometheusMetrics
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:317:1
    |
315 |         """
316 |         Increment a counter metric.
317 |
    | ^^^^^^^^
318 |         Args:
319 |             name: Metric name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:333:1
    |
331 |         """
332 |         Record a gauge metric.
333 |
    | ^^^^^^^^
334 |         Args:
335 |             name: Metric name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:349:1
    |
347 |         """
348 |         Record a histogram/distribution metric.
349 |
    | ^^^^^^^^
350 |         Args:
351 |             name: Metric name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:360:1
    |
358 |         """
359 |         Get all collected metrics.
360 |
    | ^^^^^^^^
361 |         Returns:
362 |             Dictionary of metrics data
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:375:1
    |
373 |     """
374 |     Port for distributed tracing and observability.
375 |
    | ^^^^
376 |     Implementations:
377 |     - OpenTelemetryObserver
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:391:1
    |
389 |         """
390 |         Start a new tracing span.
391 |
    | ^^^^^^^^
392 |         Args:
393 |             operation: Operation name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:396:1
    |
394 |             parent_span: Parent span (for nested operations)
395 |             tags: Optional metadata tags
396 |
    | ^^^^^^^^^^^^
397 |         Returns:
398 |             Span object
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:410:1
    |
408 |         """
409 |         Finish a tracing span.
410 |
    | ^^^^^^^^
411 |         Args:
412 |             span: Span to finish
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/domain/ports/__init__.py:425:1
    |
423 |         """
424 |         Record a discrete event.
425 |
    | ^^^^^^^^
426 |         Args:
427 |             event_name: Event name
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/ai/domain/ports/__init__.py:437:11
    |
435 |   # ======================================================================================
436 |
437 |   __all__ = [
    |  ___________^
438 | |     "LLMClientPort",
439 | |     "RetryStrategyPort",
440 | |     "CircuitBreakerPort",
441 | |     "CostManagerPort",
442 | |     "CachePort",
443 | |     "MetricsPort",
444 | |     "ObservabilityPort",
445 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Callable`, `Generator`
  --> app/ai/facade.py:30:1
   |
28 | import threading
29 | import time
30 | from typing import Any, Callable, Generator
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 |
32 | from app.ai.application.circuit_breaker import (
   |
help: Import from `collections.abc`

F401 [*] `app.ai.application.circuit_breaker.CircuitBreaker` imported but unused
  --> app/ai/facade.py:33:5
   |
32 | from app.ai.application.circuit_breaker import (
33 |     CircuitBreaker,
   |     ^^^^^^^^^^^^^^
34 |     CircuitBreakerConfig,
35 |     get_circuit_breaker,
   |
help: Remove unused import: `app.ai.application.circuit_breaker.CircuitBreaker`

F401 [*] `app.ai.application.cost_manager.CostManager` imported but unused
  --> app/ai/facade.py:40:5
   |
38 |     BudgetConfig,
39 |     BudgetPeriod,
40 |     CostManager,
   |     ^^^^^^^^^^^
41 |     get_cost_manager,
42 | )
   |
help: Remove unused import: `app.ai.application.cost_manager.CostManager`

F401 [*] `app.ai.application.retry_strategy.ExponentialBackoffRetry` imported but unused
  --> app/ai/facade.py:47:5
   |
45 | from app.ai.application.retry_strategy import (
46 |     AdaptiveRetry,
47 |     ExponentialBackoffRetry,
   |     ^^^^^^^^^^^^^^^^^^^^^^^
48 |     RetryConfig,
49 |     RetryExecutor,
   |
help: Remove unused import: `app.ai.application.retry_strategy.ExponentialBackoffRetry`

F401 [*] `app.ai.infrastructure.transports.MockLLMTransport` imported but unused
  --> app/ai/facade.py:52:5
   |
50 | )
51 | from app.ai.infrastructure.transports import (
52 |     MockLLMTransport,
   |     ^^^^^^^^^^^^^^^^
53 |     OpenRouterTransport,
54 |     get_transport,
   |
help: Remove unused import

F401 [*] `app.ai.infrastructure.transports.OpenRouterTransport` imported but unused
  --> app/ai/facade.py:53:5
   |
51 | from app.ai.infrastructure.transports import (
52 |     MockLLMTransport,
53 |     OpenRouterTransport,
   |     ^^^^^^^^^^^^^^^^^^^
54 |     get_transport,
55 | )
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/ai/facade.py:63:1
   |
61 |     """
62 |     Facade for LLM Client operations.
63 |
   | ^^^^
64 |     **REFACTORED**: This class now delegates to specialized services
65 |     instead of implementing everything inline.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/facade.py:66:1
   |
64 |     **REFACTORED**: This class now delegates to specialized services
65 |     instead of implementing everything inline.
66 |
   | ^^^^
67 |     Maintains 100% backward compatibility with original API while
68 |     using clean layered architecture internally.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/facade.py:69:1
   |
67 |     Maintains 100% backward compatibility with original API while
68 |     using clean layered architecture internally.
69 |
   | ^^^^
70 |     Original responsibilities now delegated to:
71 |     - PayloadBuilder: Request construction
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/facade.py:78:1
   |
76 |     - Transports: Provider-specific implementations
77 |     """
78 |
   | ^^^^
79 |     def __init__(
80 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/facade.py:87:1
   |
85 |         """
86 |         Initialize LLM Client Service.
87 |
   | ^^^^^^^^
88 |         Args:
89 |             provider: LLM provider (openrouter, openai, anthropic, mock)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/facade.py:94:1
   |
92 |         """
93 |         self.provider = provider or os.getenv("LLM_PROVIDER", "openrouter")
94 |
   | ^^^^^^^^
95 |         self.payload_builder = PayloadBuilder()
96 |         self.cost_manager = get_cost_manager()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:98:1
    |
 96 |         self.cost_manager = get_cost_manager()
 97 |         self.response_normalizer = ResponseNormalizer(cost_manager=self.cost_manager)
 98 |
    | ^^^^^^^^
 99 |         self.circuit_breaker = get_circuit_breaker(
100 |             f"llm_client_{self.provider}",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:103:1
    |
101 |             circuit_breaker_config
102 |         )
103 |
    | ^^^^^^^^
104 |         retry_strategy = AdaptiveRetry(retry_config) if retry_config else AdaptiveRetry()
105 |         self.retry_executor = RetryExecutor(retry_strategy)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:106:1
    |
104 |         retry_strategy = AdaptiveRetry(retry_config) if retry_config else AdaptiveRetry()
105 |         self.retry_executor = RetryExecutor(retry_strategy)
106 |
    | ^^^^^^^^
107 |         self._transport = None
108 |         self._transport_lock = threading.RLock()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:109:1
    |
107 |         self._transport = None
108 |         self._transport_lock = threading.RLock()
109 |
    | ^^^^^^^^
110 |         self._pre_hooks: list[Callable[[dict[str, Any]], None]] = []
111 |         self._post_hooks: list[Callable[[dict[str, Any], dict[str, Any]], None]] = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:112:1
    |
110 |         self._pre_hooks: list[Callable[[dict[str, Any]], None]] = []
111 |         self._post_hooks: list[Callable[[dict[str, Any], dict[str, Any]], None]] = []
112 |
    | ^^^^^^^^
113 |         self._initialize_default_budgets()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:114:1
    |
113 |         self._initialize_default_budgets()
114 |
    | ^^^^
115 |     def _initialize_default_budgets(self) -> None:
116 |         """Initialize default budget configurations."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:119:1
    |
117 |         daily_limit = float(os.getenv("LLM_DAILY_BUDGET", "100.0"))
118 |         monthly_limit = float(os.getenv("LLM_MONTHLY_BUDGET", "3000.0"))
119 |
    | ^^^^^^^^
120 |         self.cost_manager.set_budget(
121 |             "global_daily",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:130:1
    |
128 |             )
129 |         )
130 |
    | ^^^^^^^^
131 |         self.cost_manager.set_budget(
132 |             "global_monthly",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:141:1
    |
139 |             )
140 |         )
141 |
    | ^^^^
142 |     def _get_transport(self) -> Any:
143 |         """Get or create transport instance."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:146:1
    |
144 |         if self._transport is not None:
145 |             return self._transport
146 |
    | ^^^^^^^^
147 |         with self._transport_lock:
148 |             if self._transport is None:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:152:1
    |
150 |                 _LOG.info(f"Initialized transport: {self.provider}")
151 |             return self._transport
152 |
    | ^^^^
153 |     def invoke_chat(
154 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/facade.py:169:1
    |
167 |         """
168 |         Invoke LLM chat completion.
169 |
    | ^^^^^^^^
170 |         Args:
171 |             model: Model identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/facade.py:181:1
    |
179 |             project_id: Optional project identifier for cost tracking
180 |             extra: Additional parameters
181 |
    | ^^^^^^^^^^^^
182 |         Returns:
183 |             Response dictionary or generator for streaming
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/facade.py:184:1
    |
182 |         Returns:
183 |             Response dictionary or generator for streaming
184 |
    | ^^^^^^^^^^^^
185 |         Raises:
186 |             CircuitBreakerOpenError: If circuit breaker is open
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:195:1
    |
193 |                 f"Service temporarily unavailable."
194 |             )
195 |
    | ^^^^^^^^
196 |         payload = self.payload_builder.build(
197 |             model=model,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:205:1
    |
203 |             extra=extra,
204 |         )
205 |
    | ^^^^^^^^
206 |         for hook in self._pre_hooks:
207 |             try:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:211:1
    |
209 |             except Exception as e:
210 |                 _LOG.warning(f"Pre-hook error: {e}")
211 |
    | ^^^^^^^^
212 |         if stream:
213 |             return self._invoke_streaming(payload, user_id, project_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:216:1
    |
214 |         else:
215 |             return self._invoke_non_streaming(payload, user_id, project_id)
216 |
    | ^^^^
217 |     def _invoke_non_streaming(
218 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:226:1
    |
224 |         start_time = time.time()
225 |         retry_schedule: list[float] = []
226 |
    | ^^^^^^^^
227 |         def _execute() -> dict[str, Any]:
228 |             transport = self._get_transport()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:229:1
    |
227 |         def _execute() -> dict[str, Any]:
228 |             transport = self._get_transport()
229 |
    | ^^^^^^^^^^^^
230 |             t0 = time.perf_counter()
231 |             completion = transport.chat_completion(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:240:1
    |
238 |             )
239 |             latency_ms = (time.perf_counter() - t0) * 1000.0
240 |
    | ^^^^^^^^^^^^
241 |             envelope = self.response_normalizer.normalize(
242 |                 completion=completion,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:250:1
    |
248 |                 attempts=1,
249 |             )
250 |
    | ^^^^^^^^^^^^
251 |             if "usage" in envelope:
252 |                 usage = envelope["usage"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:261:1
    |
259 |                     request_id=envelope.get("request_id"),
260 |                 )
261 |
    | ^^^^^^^^^^^^
262 |             for hook in self._post_hooks:
263 |                 try:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:267:1
    |
265 |                 except Exception as e:
266 |                     _LOG.warning(f"Post-hook error: {e}")
267 |
    | ^^^^^^^^^^^^
268 |             return envelope
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:269:1
    |
268 |             return envelope
269 |
    | ^^^^^^^^
270 |         try:
271 |             result = self.circuit_breaker.call(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:278:1
    |
276 |             _LOG.error(f"LLM invocation failed: {e}")
277 |             raise
278 |
    | ^^^^
279 |     def _invoke_streaming(
280 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:287:1
    |
285 |         """Execute streaming request."""
286 |         transport = self._get_transport()
287 |
    | ^^^^^^^^
288 |         try:
289 |             stream = transport.chat_completion_stream(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:297:1
    |
295 |                 max_tokens=payload.get("max_tokens"),
296 |             )
297 |
    | ^^^^^^^^^^^^
298 |             accumulated_tokens = 0
299 |             for chunk in stream:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:303:1
    |
301 |                     accumulated_tokens += len(chunk["content"].split())
302 |                 yield chunk
303 |
    | ^^^^^^^^^^^^
304 |             if accumulated_tokens > 0:
305 |                 self.cost_manager.track_usage(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:312:1
    |
310 |                     project_id=project_id,
311 |                 )
312 |
    | ^^^^^^^^
313 |         except Exception as e:
314 |             _LOG.error(f"Streaming invocation failed: {e}")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:316:1
    |
314 |             _LOG.error(f"Streaming invocation failed: {e}")
315 |             raise
316 |
    | ^^^^
317 |     def register_pre_hook(self, hook: Callable[[dict[str, Any]], None]) -> None:
318 |         """Register pre-invocation hook."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:320:1
    |
318 |         """Register pre-invocation hook."""
319 |         self._pre_hooks.append(hook)
320 |
    | ^^^^
321 |     def register_post_hook(
322 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:327:1
    |
325 |         """Register post-invocation hook."""
326 |         self._post_hooks.append(hook)
327 |
    | ^^^^
328 |     def get_cost_metrics(self) -> dict[str, Any]:
329 |         """Get cost metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:339:1
    |
337 |             "average_cost_per_request": metrics.average_cost_per_request,
338 |         }
339 |
    | ^^^^
340 |     def get_budget_status(self, budget_id: str = "global_daily") -> dict[str, Any]:
341 |         """Get budget status."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:343:1
    |
341 |         """Get budget status."""
342 |         return self.cost_manager.get_budget_status(budget_id)
343 |
    | ^^^^
344 |     def get_circuit_breaker_status(self) -> dict[str, Any]:
345 |         """Get circuit breaker status."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:356:1
    |
354 |             "is_available": self.circuit_breaker.is_available(),
355 |         }
356 |
    | ^^^^
357 |     def get_retry_metrics(self) -> dict[str, Any]:
358 |         """Get retry metrics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:370:1
    |
368 |             },
369 |         }
370 |
    | ^^^^
371 |     def reset_circuit_breaker(self) -> None:
372 |         """Manually reset circuit breaker."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:375:1
    |
373 |         self.circuit_breaker.reset()
374 |         _LOG.info("Circuit breaker reset")
375 |
    | ^^^^
376 |     def set_user_budget(
377 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:391:1
    |
389 |             )
390 |         )
391 |
    | ^^^^^^^^
392 |         if monthly_limit:
393 |             self.cost_manager.set_budget(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:401:1
    |
399 |                 )
400 |             )
401 |
    | ^^^^
402 |     def set_project_budget(
403 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:417:1
    |
415 |             )
416 |         )
417 |
    | ^^^^^^^^
418 |         if monthly_limit:
419 |             self.cost_manager.set_budget(
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/facade.py:440:1
    |
438 |     """
439 |     Get global LLM client service instance.
440 |
    | ^^^^
441 |     Args:
442 |         provider: Optional provider override
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/facade.py:443:1
    |
441 |     Args:
442 |         provider: Optional provider override
443 |
    | ^^^^^^^^
444 |     Returns:
445 |         LLMClientService instance
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:448:1
    |
446 |     """
447 |     global _GLOBAL_CLIENT
448 |
    | ^^^^
449 |     if _GLOBAL_CLIENT is not None and (provider is None or provider == _GLOBAL_CLIENT.provider):
450 |         return _GLOBAL_CLIENT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/facade.py:451:1
    |
449 |     if _GLOBAL_CLIENT is not None and (provider is None or provider == _GLOBAL_CLIENT.provider):
450 |         return _GLOBAL_CLIENT
451 |
    | ^^^^
452 |     with _GLOBAL_LOCK:
453 |         if _GLOBAL_CLIENT is None or (provider and provider != _GLOBAL_CLIENT.provider):
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/ai/infrastructure/__init__.py:36:11
   |
34 |   )
35 |
36 |   __all__ = [
   |  ___________^
37 | |     # Transports
38 | |     "OpenRouterTransport",
39 | |     "MockLLMTransport",
40 | |     "create_llm_transport",
41 | |     "get_transport",
42 | |     "register_transport",
43 | |     # Cache
44 | |     "InMemoryCache",
45 | |     "DiskCache",
46 | |     "NoOpCache",
47 | |     "get_cache",
48 | |     "reset_cache",
49 | |     # Metrics & Observability
50 | |     "InMemoryMetrics",
51 | |     "SimpleObserver",
52 | |     "Span",
53 | |     "get_metrics",
54 | |     "get_observer",
55 | |     "reset_observability",
56 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:37:1
   |
35 |     """
36 |     Thread-safe in-memory cache with LRU eviction.
37 |
   | ^^^^
38 |     Features:
39 |     - LRU eviction when max_size is reached
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:48:1
   |
46 |         """
47 |         Initialize in-memory cache.
48 |
   | ^^^^^^^^
49 |         Args:
50 |             max_size: Maximum number of entries (LRU eviction when exceeded)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:66:1
   |
64 |                 self._misses += 1
65 |                 return None
66 |
   | ^^^^^^^^^^^^
67 |             value, expiry = self._cache[key]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:68:1
   |
67 |             value, expiry = self._cache[key]
68 |
   | ^^^^^^^^^^^^
69 |             # Check expiration
70 |             if expiry is not None and time.time() > expiry:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:74:1
   |
72 |                 self._misses += 1
73 |                 return None
74 |
   | ^^^^^^^^^^^^
75 |             # Move to end (LRU)
76 |             self._cache.move_to_end(key)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:87:1
   |
85 |                 ttl = self._default_ttl
86 |             expiry = time.time() + ttl if ttl is not None else None
87 |
   | ^^^^^^^^^^^^
88 |             # Add/update entry
89 |             self._cache[key] = (value, expiry)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/cache.py:91:1
   |
89 |             self._cache[key] = (value, expiry)
90 |             self._cache.move_to_end(key)
91 |
   | ^^^^^^^^^^^^
92 |             # Evict oldest if size exceeded
93 |             if len(self._cache) > self._max_size:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:117:1
    |
115 |             total = self._hits + self._misses
116 |             hit_rate = self._hits / total if total > 0 else 0.0
117 |
    | ^^^^^^^^^^^^
118 |             return {
119 |                 "size": len(self._cache),
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:135:1
    |
133 |     """
134 |     Persistent disk-based cache.
135 |
    | ^^^^
136 |     Features:
137 |     - Persistent storage across restarts
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:150:1
    |
148 |         """
149 |         Initialize disk cache.
150 |
    | ^^^^^^^^
151 |         Args:
152 |             cache_dir: Directory for cache files
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:169:1
    |
167 |         """Retrieve cached value from disk."""
168 |         path = self._get_path(key)
169 |
    | ^^^^^^^^
170 |         if not path.exists():
171 |             return None
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:172:1
    |
170 |         if not path.exists():
171 |             return None
172 |
    | ^^^^^^^^
173 |         try:
174 |             with self._lock:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:177:1
    |
175 |                 with open(path) as f:
176 |                     data = json.load(f)
177 |
    | ^^^^^^^^^^^^^^^^
178 |                 # Check expiration
179 |                 expiry = data.get("expiry")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:183:1
    |
181 |                     path.unlink()
182 |                     return None
183 |
    | ^^^^^^^^^^^^^^^^
184 |                 return data.get("value")
185 |         except Exception as e:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:192:1
    |
190 |         """Store value to disk with optional TTL."""
191 |         path = self._get_path(key)
192 |
    | ^^^^^^^^
193 |         if ttl is None:
194 |             ttl = self._default_ttl
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:196:1
    |
194 |             ttl = self._default_ttl
195 |         expiry = time.time() + ttl if ttl is not None else None
196 |
    | ^^^^^^^^
197 |         data = {
198 |             "value": value,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:202:1
    |
200 |             "created_at": time.time(),
201 |         }
202 |
    | ^^^^^^^^
203 |         try:
204 |             with self._lock:
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:242:1
    |
240 |     """
241 |     No-operation cache that doesn't store anything.
242 |
    | ^^^^
243 |     Useful for disabling caching without changing code.
244 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:281:1
    |
279 |     """
280 |     Get or create cache instance.
281 |
    | ^^^^
282 |     Args:
283 |         cache_type: Type of cache (memory, disk, noop, redis)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:285:1
    |
283 |         cache_type: Type of cache (memory, disk, noop, redis)
284 |         **kwargs: Additional arguments for cache initialization
285 |
    | ^^^^^^^^
286 |     Returns:
287 |         Cache instance implementing CachePort
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:290:1
    |
288 |     """
289 |     global _CACHE_INSTANCE
290 |
    | ^^^^
291 |     # Check environment
292 |     if os.getenv("LLM_CACHE_ENABLED", "1") == "0":
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:294:1
    |
292 |     if os.getenv("LLM_CACHE_ENABLED", "1") == "0":
293 |         return NoOpCache()
294 |
    | ^^^^
295 |     if cache_type is None:
296 |         cache_type = os.getenv("LLM_CACHE_TYPE", "memory")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:297:1
    |
295 |     if cache_type is None:
296 |         cache_type = os.getenv("LLM_CACHE_TYPE", "memory")
297 |
    | ^^^^
298 |     # Return singleton if exists
299 |     if _CACHE_INSTANCE is not None:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:301:1
    |
299 |     if _CACHE_INSTANCE is not None:
300 |         return _CACHE_INSTANCE
301 |
    | ^^^^
302 |     with _CACHE_LOCK:
303 |         # Double-check after acquiring lock
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:306:1
    |
304 |         if _CACHE_INSTANCE is not None:
305 |             return _CACHE_INSTANCE
306 |
    | ^^^^^^^^
307 |         # Create cache instance
308 |         if cache_type == "memory":
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/cache.py:317:1
    |
315 |             _LOG.warning(f"Unknown cache type {cache_type}, using memory cache")
316 |             _CACHE_INSTANCE = InMemoryCache(**kwargs)
317 |
    | ^^^^^^^^
318 |         return _CACHE_INSTANCE
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/ai/infrastructure/cache.py:332:11
    |
330 |   # ======================================================================================
331 |
332 |   __all__ = [
    |  ___________^
333 | |     "InMemoryCache",
334 | |     "DiskCache",
335 | |     "NoOpCache",
336 | |     "get_cache",
337 | |     "reset_cache",
338 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `datetime.datetime` imported but unused
  --> app/ai/infrastructure/metrics.py:21:22
   |
19 | from collections import defaultdict
20 | from dataclasses import dataclass, field
21 | from datetime import datetime
   |                      ^^^^^^^^
22 | from typing import Any
   |
help: Remove unused import: `datetime.datetime`

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:39:1
   |
37 |     value: float = 0.0
38 |     tags: dict[str, str] = field(default_factory=dict)
39 |
   | ^^^^
40 |     def increment(self, value: float = 1.0) -> None:
41 |         """Increment counter."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:50:1
   |
48 |     value: float = 0.0
49 |     tags: dict[str, str] = field(default_factory=dict)
50 |
   | ^^^^
51 |     def set(self, value: float) -> None:
52 |         """Set gauge value."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:61:1
   |
59 |     values: list[float] = field(default_factory=list)
60 |     tags: dict[str, str] = field(default_factory=dict)
61 |
   | ^^^^
62 |     def record(self, value: float) -> None:
63 |         """Record a value."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:65:1
   |
63 |         """Record a value."""
64 |         self.values.append(value)
65 |
   | ^^^^
66 |     def percentile(self, p: float) -> float:
67 |         """Calculate percentile (p in 0-1)."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:73:1
   |
71 |         idx = int(len(sorted_values) * p)
72 |         return sorted_values[min(idx, len(sorted_values) - 1)]
73 |
   | ^^^^
74 |     def mean(self) -> float:
75 |         """Calculate mean."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:77:1
   |
75 |         """Calculate mean."""
76 |         return sum(self.values) / len(self.values) if self.values else 0.0
77 |
   | ^^^^
78 |     def min(self) -> float:
79 |         """Get minimum value."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:81:1
   |
79 |         """Get minimum value."""
80 |         return min(self.values) if self.values else 0.0
81 |
   | ^^^^
82 |     def max(self) -> float:
83 |         """Get maximum value."""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/metrics.py:95:1
   |
93 |     """
94 |     In-memory metrics collector.
95 |
   | ^^^^
96 |     Features:
97 |     - Thread-safe operations
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:167:1
    |
165 |                 "histograms": {},
166 |             }
167 |
    | ^^^^^^^^^^^^
168 |             # Counters
169 |             for key, counter in self._counters.items():
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:174:1
    |
172 |                     "tags": counter.tags,
173 |                 }
174 |
    | ^^^^^^^^^^^^
175 |             # Gauges
176 |             for key, gauge in self._gauges.items():
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:181:1
    |
179 |                     "tags": gauge.tags,
180 |                 }
181 |
    | ^^^^^^^^^^^^
182 |             # Histograms with stats
183 |             for key, histogram in self._histograms.items():
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:194:1
    |
192 |                     "tags": histogram.tags,
193 |                 }
194 |
    | ^^^^^^^^^^^^
195 |             return metrics
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:222:1
    |
220 |     error: Exception | None = None
221 |     end_time: float | None = None
222 |
    | ^^^^
223 |     @property
224 |     def duration_ms(self) -> float:
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:239:1
    |
237 |     """
238 |     Simple in-memory observability implementation.
239 |
    | ^^^^
240 |     Features:
241 |     - Distributed tracing with spans
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:268:1
    |
266 |             tags=tags or {},
267 |         )
268 |
    | ^^^^^^^^
269 |         with self._lock:
270 |             self._spans[span_id] = span
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:274:1
    |
272 |             thread_id = str(threading.get_ident())
273 |             self._active_spans[thread_id] = span_id
274 |
    | ^^^^^^^^
275 |         return span
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:288:1
    |
286 |             span.status = status
287 |             span.error = error
288 |
    | ^^^^^^^^^^^^
289 |             # Remove from active spans
290 |             thread_id = str(threading.get_ident())
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:305:1
    |
303 |             "attributes": attributes or {},
304 |         }
305 |
    | ^^^^^^^^
306 |         # Try to attach to current span
307 |         thread_id = str(threading.get_ident())
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:348:1
    |
346 |     """Get or create metrics instance."""
347 |     global _METRICS_INSTANCE
348 |
    | ^^^^
349 |     if _METRICS_INSTANCE is not None:
350 |         return _METRICS_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:351:1
    |
349 |     if _METRICS_INSTANCE is not None:
350 |         return _METRICS_INSTANCE
351 |
    | ^^^^
352 |     with _LOCK:
353 |         if _METRICS_INSTANCE is not None:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:355:1
    |
353 |         if _METRICS_INSTANCE is not None:
354 |             return _METRICS_INSTANCE
355 |
    | ^^^^^^^^
356 |         _METRICS_INSTANCE = InMemoryMetrics()
357 |         return _METRICS_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:363:1
    |
361 |     """Get or create observer instance."""
362 |     global _OBSERVER_INSTANCE
363 |
    | ^^^^
364 |     if _OBSERVER_INSTANCE is not None:
365 |         return _OBSERVER_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:366:1
    |
364 |     if _OBSERVER_INSTANCE is not None:
365 |         return _OBSERVER_INSTANCE
366 |
    | ^^^^
367 |     with _LOCK:
368 |         if _OBSERVER_INSTANCE is not None:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/metrics.py:370:1
    |
368 |         if _OBSERVER_INSTANCE is not None:
369 |             return _OBSERVER_INSTANCE
370 |
    | ^^^^^^^^
371 |         _OBSERVER_INSTANCE = SimpleObserver()
372 |         return _OBSERVER_INSTANCE
    |
help: Remove whitespace from blank line

UP035 [*] Import from `collections.abc` instead: `Generator`
  --> app/ai/infrastructure/transports/__init__.py:14:1
   |
12 | import logging
13 | import os
14 | from typing import Any, Generator
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | from app.ai.domain.ports import LLMClientPort
   |
help: Import from `collections.abc`

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/__init__.py:29:1
   |
27 |     """
28 |     OpenRouter API transport implementation.
29 |
   | ^^^^
30 |     Implements LLMClientPort for OpenRouter service.
31 |     Uses centralized AI client factory for actual HTTP communication.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/__init__.py:37:1
   |
35 |         """
36 |         Initialize OpenRouter transport.
37 |
   | ^^^^^^^^
38 |         Args:
39 |             client: OpenRouter client instance (from ai_client_factory)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/__init__.py:51:1
   |
49 |         """
50 |         Execute chat completion via OpenRouter.
51 |
   | ^^^^^^^^
52 |         Delegates to the underlying OpenRouter client.
53 |         """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/__init__.py:60:1
   |
58 |                 **kwargs,
59 |             )
60 |
   | ^^^^^^^^^^^^
61 |             # Normalize response format
62 |             return {
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/__init__.py:92:1
   |
90 |                 **kwargs,
91 |             )
92 |
   | ^^^^^^^^^^^^
93 |             for chunk in stream:
94 |                 if chunk.choices and chunk.choices[0].delta.content:
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:112:1
    |
110 |     """
111 |     Mock LLM transport for testing.
112 |
    | ^^^^
113 |     Returns predefined responses without calling external APIs.
114 |     Useful for testing and development.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:120:1
    |
118 |         """
119 |         Initialize mock transport.
120 |
    | ^^^^^^^^
121 |         Args:
122 |             default_response: Default text to return
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:137:1
    |
135 |         """
136 |         self._call_count += 1
137 |
    | ^^^^^^^^
138 |         return {
139 |             "content": self._default_response,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:161:1
    |
159 |         """
160 |         self._call_count += 1
161 |
    | ^^^^^^^^
162 |         # Split response into chunks
163 |         words = self._default_response.split()
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:192:1
    |
190 |     """
191 |     Factory function to create appropriate LLM transport.
192 |
    | ^^^^
193 |     Args:
194 |         client: Optional client instance (if None, will be created)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:196:1
    |
194 |         client: Optional client instance (if None, will be created)
195 |         force_mock: Force mock transport regardless of environment
196 |
    | ^^^^^^^^
197 |     Returns:
198 |         Transport implementing LLMClientPort
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:203:1
    |
201 |     if force_mock or os.getenv("LLM_FORCE_MOCK", "0") == "1":
202 |         return MockLLMTransport()
203 |
    | ^^^^
204 |     # For now, default to OpenRouter
205 |     # In the future, this could route to different transports based on model/config
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:209:1
    |
207 |         from app.core.ai_client_factory import get_ai_client
208 |         client = get_ai_client()
209 |
    | ^^^^
210 |     # Check if it's a mock client
211 |     if hasattr(client, "__class__") and "Mock" in client.__class__.__name__:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:213:1
    |
211 |     if hasattr(client, "__class__") and "Mock" in client.__class__.__name__:
212 |         return MockLLMTransport()
213 |
    | ^^^^
214 |     return OpenRouterTransport(client)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:235:1
    |
233 |     """
234 |     Get transport instance for provider.
235 |
    | ^^^^
236 |     Args:
237 |         provider: Provider name (openrouter, openai, anthropic, mock)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:239:1
    |
237 |         provider: Provider name (openrouter, openai, anthropic, mock)
238 |         **kwargs: Additional arguments for transport initialization
239 |
    | ^^^^^^^^
240 |     Returns:
241 |         Transport instance implementing LLMClientPort
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:245:1
    |
243 |     if os.getenv("LLM_FORCE_MOCK", "0") == "1":
244 |         return MockLLMTransport()
245 |
    | ^^^^
246 |     provider = provider.lower()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:247:1
    |
246 |     provider = provider.lower()
247 |
    | ^^^^
248 |     if provider == "openai":
249 |         from app.ai.infrastructure.transports.openai_transport import OpenAITransport
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:251:1
    |
249 |         from app.ai.infrastructure.transports.openai_transport import OpenAITransport
250 |         return OpenAITransport(**kwargs)
251 |
    | ^^^^
252 |     if provider == "anthropic":
253 |         from app.ai.infrastructure.transports.anthropic_transport import AnthropicTransport
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:255:1
    |
253 |         from app.ai.infrastructure.transports.anthropic_transport import AnthropicTransport
254 |         return AnthropicTransport(**kwargs)
255 |
    | ^^^^
256 |     if provider in _TRANSPORT_REGISTRY:
257 |         transport_class = _TRANSPORT_REGISTRY[provider]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/__init__.py:263:1
    |
261 |             return transport_class(client)
262 |         return transport_class(**kwargs)
263 |
    | ^^^^
264 |     raise ValueError(f"Unknown provider: {provider}")
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/ai/infrastructure/transports/__init__.py:271:11
    |
269 |   # ======================================================================================
270 |
271 |   __all__ = [
    |  ___________^
272 | |     "OpenRouterTransport",
273 | |     "MockLLMTransport",
274 | |     "create_llm_transport",
275 | |     "get_transport",
276 | |     "register_transport",
277 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Generator`
  --> app/ai/infrastructure/transports/anthropic_transport.py:19:1
   |
17 | import logging
18 | import os
19 | from typing import Any, Generator
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
20 |
21 | _LOG = logging.getLogger(__name__)
   |
help: Import from `collections.abc`

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:27:1
   |
25 |     """
26 |     Anthropic API transport implementation.
27 |
   | ^^^^
28 |     Implements LLMClientPort for Anthropic Claude models.
29 |     """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:30:1
   |
28 |     Implements LLMClientPort for Anthropic Claude models.
29 |     """
30 |
   | ^^^^
31 |     def __init__(self, api_key: str | None = None):
32 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:34:1
   |
32 |         """
33 |         Initialize Anthropic transport.
34 |
   | ^^^^^^^^
35 |         Args:
36 |             api_key: Anthropic API key (defaults to ANTHROPIC_API_KEY env var)
   |
help: Remove whitespace from blank line

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> app/ai/infrastructure/transports/anthropic_transport.py:41:13
   |
39 |               import anthropic
40 |           except ImportError:
41 | /             raise ImportError(
42 | |                 "Anthropic SDK not installed. Install with: pip install anthropic"
43 | |             )
   | |_____________^
44 |
45 |           self._api_key = api_key or os.getenv("ANTHROPIC_API_KEY")
   |

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:44:1
   |
42 |                 "Anthropic SDK not installed. Install with: pip install anthropic"
43 |             )
44 |
   | ^^^^^^^^
45 |         self._api_key = api_key or os.getenv("ANTHROPIC_API_KEY")
46 |         if not self._api_key:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:48:1
   |
46 |         if not self._api_key:
47 |             raise ValueError("Anthropic API key not provided")
48 |
   | ^^^^^^^^
49 |         self._client = anthropic.Anthropic(api_key=self._api_key)
50 |         _LOG.info("Anthropic transport initialized")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:51:1
   |
49 |         self._client = anthropic.Anthropic(api_key=self._api_key)
50 |         _LOG.info("Anthropic transport initialized")
51 |
   | ^^^^
52 |     def chat_completion(
53 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:60:1
   |
58 |         """
59 |         Execute chat completion via Anthropic.
60 |
   | ^^^^^^^^
61 |         Args:
62 |             messages: List of message dictionaries
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:65:1
   |
63 |             model: Model identifier (e.g., claude-3-opus, claude-3-sonnet)
64 |             **kwargs: Additional parameters
65 |
   | ^^^^^^^^^^^^
66 |         Returns:
67 |             Normalized response dictionary
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:71:1
   |
69 |         try:
70 |             converted_messages = self._convert_messages(messages)
71 |
   | ^^^^^^^^^^^^
72 |             system_message = kwargs.pop("system", None)
73 |             if not system_message and converted_messages:
   |
help: Remove whitespace from blank line

SIM102 Use a single `if` statement instead of nested `if` statements
  --> app/ai/infrastructure/transports/anthropic_transport.py:73:13
   |
72 |               system_message = kwargs.pop("system", None)
73 | /             if not system_message and converted_messages:
74 | |                 if converted_messages[0].get("role") == "system":
   | |_________________________________________________________________^
75 |                       system_message = converted_messages[0]["content"]
76 |                       converted_messages = converted_messages[1:]
   |
help: Combine `if` statements using `and`

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:77:1
   |
75 |                     system_message = converted_messages[0]["content"]
76 |                     converted_messages = converted_messages[1:]
77 |
   | ^^^^^^^^^^^^
78 |             max_tokens = kwargs.pop("max_tokens", 4096)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:79:1
   |
78 |             max_tokens = kwargs.pop("max_tokens", 4096)
79 |
   | ^^^^^^^^^^^^
80 |             response = self._client.messages.create(
81 |                 model=model,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:87:1
   |
85 |                 **kwargs,
86 |             )
87 |
   | ^^^^^^^^^^^^
88 |             return self._normalize_response(response)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:89:1
   |
88 |             return self._normalize_response(response)
89 |
   | ^^^^^^^^^^^^
90 |         except Exception as e:
91 |             _LOG.error(f"Anthropic transport error: {e}")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/anthropic_transport.py:93:1
   |
91 |             _LOG.error(f"Anthropic transport error: {e}")
92 |             raise
93 |
   | ^^^^
94 |     def chat_completion_stream(
95 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:102:1
    |
100 |         """
101 |         Execute streaming chat completion via Anthropic.
102 |
    | ^^^^^^^^
103 |         Args:
104 |             messages: List of message dictionaries
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:107:1
    |
105 |             model: Model identifier
106 |             **kwargs: Additional parameters
107 |
    | ^^^^^^^^^^^^
108 |         Yields:
109 |             Response chunks
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:113:1
    |
111 |         try:
112 |             converted_messages = self._convert_messages(messages)
113 |
    | ^^^^^^^^^^^^
114 |             system_message = kwargs.pop("system", None)
115 |             if not system_message and converted_messages:
    |
help: Remove whitespace from blank line

SIM102 Use a single `if` statement instead of nested `if` statements
   --> app/ai/infrastructure/transports/anthropic_transport.py:115:13
    |
114 |               system_message = kwargs.pop("system", None)
115 | /             if not system_message and converted_messages:
116 | |                 if converted_messages[0].get("role") == "system":
    | |_________________________________________________________________^
117 |                       system_message = converted_messages[0]["content"]
118 |                       converted_messages = converted_messages[1:]
    |
help: Combine `if` statements using `and`

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:119:1
    |
117 |                     system_message = converted_messages[0]["content"]
118 |                     converted_messages = converted_messages[1:]
119 |
    | ^^^^^^^^^^^^
120 |             max_tokens = kwargs.pop("max_tokens", 4096)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:121:1
    |
120 |             max_tokens = kwargs.pop("max_tokens", 4096)
121 |
    | ^^^^^^^^^^^^
122 |             with self._client.messages.stream(
123 |                 model=model,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:135:1
    |
133 |                         "model": model,
134 |                     }
135 |
    | ^^^^^^^^^^^^^^^^^^^^
136 |         except Exception as e:
137 |             _LOG.error(f"Anthropic streaming error: {e}")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:139:1
    |
137 |             _LOG.error(f"Anthropic streaming error: {e}")
138 |             raise
139 |
    | ^^^^
140 |     def _convert_messages(
141 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:146:1
    |
144 |         """
145 |         Convert OpenAI-style messages to Anthropic format.
146 |
    | ^^^^^^^^
147 |         Args:
148 |             messages: OpenAI-style messages
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:149:1
    |
147 |         Args:
148 |             messages: OpenAI-style messages
149 |
    | ^^^^^^^^^^^^
150 |         Returns:
151 |             Anthropic-style messages
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:154:1
    |
152 |         """
153 |         converted = []
154 |
    | ^^^^^^^^
155 |         for msg in messages:
156 |             role = msg.get("role", "user")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:158:1
    |
156 |             role = msg.get("role", "user")
157 |             content = msg.get("content", "")
158 |
    | ^^^^^^^^^^^^
159 |             if role == "system":
160 |                 converted.append({"role": "user", "content": f"[System: {content}]"})
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:165:1
    |
163 |             else:
164 |                 converted.append({"role": "user", "content": content})
165 |
    | ^^^^^^^^
166 |         return converted
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:167:1
    |
166 |         return converted
167 |
    | ^^^^
168 |     def _normalize_response(self, response: Any) -> dict[str, Any]:
169 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:171:1
    |
169 |         """
170 |         Normalize Anthropic response to standard format.
171 |
    | ^^^^^^^^
172 |         Args:
173 |             response: Raw Anthropic response
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:174:1
    |
172 |         Args:
173 |             response: Raw Anthropic response
174 |
    | ^^^^^^^^^^^^
175 |         Returns:
176 |             Normalized response dictionary
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:187:1
    |
185 |             else:
186 |                 content = str(response.content)
187 |
    | ^^^^^^^^
188 |         result = {
189 |             "content": content,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:193:1
    |
191 |             "finish_reason": response.stop_reason if hasattr(response, "stop_reason") else None,
192 |         }
193 |
    | ^^^^^^^^
194 |         if hasattr(response, "usage") and response.usage:
195 |             result["usage"] = {
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:200:1
    |
198 |                 "total_tokens": response.usage.input_tokens + response.usage.output_tokens,
199 |             }
200 |
    | ^^^^^^^^
201 |         if hasattr(response, "content") and response.content:
202 |             tool_uses = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:206:1
    |
204 |                 if hasattr(block, "type") and block.type == "tool_use"
205 |             ]
206 |
    | ^^^^^^^^^^^^
207 |             if tool_uses:
208 |                 result["tool_calls"] = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/anthropic_transport.py:219:1
    |
217 |                     for tool in tool_uses
218 |                 ]
219 |
    | ^^^^^^^^
220 |         return result
    |
help: Remove whitespace from blank line

UP035 [*] Import from `collections.abc` instead: `Generator`
  --> app/ai/infrastructure/transports/openai_transport.py:18:1
   |
16 | import logging
17 | import os
18 | from typing import Any, Generator
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |
20 | _LOG = logging.getLogger(__name__)
   |
help: Import from `collections.abc`

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:26:1
   |
24 |     """
25 |     OpenAI API transport implementation.
26 |
   | ^^^^
27 |     Implements LLMClientPort for OpenAI service using official SDK.
28 |     """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:29:1
   |
27 |     Implements LLMClientPort for OpenAI service using official SDK.
28 |     """
29 |
   | ^^^^
30 |     def __init__(self, api_key: str | None = None):
31 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:33:1
   |
31 |         """
32 |         Initialize OpenAI transport.
33 |
   | ^^^^^^^^
34 |         Args:
35 |             api_key: OpenAI API key (defaults to OPENAI_API_KEY env var)
   |
help: Remove whitespace from blank line

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> app/ai/infrastructure/transports/openai_transport.py:40:13
   |
38 |               import openai
39 |           except ImportError:
40 | /             raise ImportError(
41 | |                 "OpenAI SDK not installed. Install with: pip install openai"
42 | |             )
   | |_____________^
43 |
44 |           self._api_key = api_key or os.getenv("OPENAI_API_KEY")
   |

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:43:1
   |
41 |                 "OpenAI SDK not installed. Install with: pip install openai"
42 |             )
43 |
   | ^^^^^^^^
44 |         self._api_key = api_key or os.getenv("OPENAI_API_KEY")
45 |         if not self._api_key:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:47:1
   |
45 |         if not self._api_key:
46 |             raise ValueError("OpenAI API key not provided")
47 |
   | ^^^^^^^^
48 |         self._client = openai.OpenAI(api_key=self._api_key)
49 |         _LOG.info("OpenAI transport initialized")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:50:1
   |
48 |         self._client = openai.OpenAI(api_key=self._api_key)
49 |         _LOG.info("OpenAI transport initialized")
50 |
   | ^^^^
51 |     def chat_completion(
52 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:59:1
   |
57 |         """
58 |         Execute chat completion via OpenAI.
59 |
   | ^^^^^^^^
60 |         Args:
61 |             messages: List of message dictionaries
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:64:1
   |
62 |             model: Model identifier (e.g., gpt-4, gpt-3.5-turbo)
63 |             **kwargs: Additional parameters
64 |
   | ^^^^^^^^^^^^
65 |         Returns:
66 |             Normalized response dictionary
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:74:1
   |
72 |                 **kwargs,
73 |             )
74 |
   | ^^^^^^^^^^^^
75 |             return self._normalize_response(response)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:76:1
   |
75 |             return self._normalize_response(response)
76 |
   | ^^^^^^^^^^^^
77 |         except Exception as e:
78 |             _LOG.error(f"OpenAI transport error: {e}")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:80:1
   |
78 |             _LOG.error(f"OpenAI transport error: {e}")
79 |             raise
80 |
   | ^^^^
81 |     def chat_completion_stream(
82 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:89:1
   |
87 |         """
88 |         Execute streaming chat completion via OpenAI.
89 |
   | ^^^^^^^^
90 |         Args:
91 |             messages: List of message dictionaries
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/infrastructure/transports/openai_transport.py:94:1
   |
92 |             model: Model identifier
93 |             **kwargs: Additional parameters
94 |
   | ^^^^^^^^^^^^
95 |         Yields:
96 |             Response chunks
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:105:1
    |
103 |                 **kwargs,
104 |             )
105 |
    | ^^^^^^^^^^^^
106 |             for chunk in stream:
107 |                 if chunk.choices and chunk.choices[0].delta.content:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:114:1
    |
112 |                         "model": chunk.model,
113 |                     }
114 |
    | ^^^^^^^^^^^^^^^^^^^^
115 |         except Exception as e:
116 |             _LOG.error(f"OpenAI streaming error: {e}")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:118:1
    |
116 |             _LOG.error(f"OpenAI streaming error: {e}")
117 |             raise
118 |
    | ^^^^
119 |     def _normalize_response(self, response: Any) -> dict[str, Any]:
120 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:122:1
    |
120 |         """
121 |         Normalize OpenAI response to standard format.
122 |
    | ^^^^^^^^
123 |         Args:
124 |             response: Raw OpenAI response
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:125:1
    |
123 |         Args:
124 |             response: Raw OpenAI response
125 |
    | ^^^^^^^^^^^^
126 |         Returns:
127 |             Normalized response dictionary
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:130:1
    |
128 |         """
129 |         choice = response.choices[0] if response.choices else None
130 |
    | ^^^^^^^^
131 |         result = {
132 |             "content": choice.message.content if choice else "",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:136:1
    |
134 |             "finish_reason": choice.finish_reason if choice else None,
135 |         }
136 |
    | ^^^^^^^^
137 |         if hasattr(response, "usage") and response.usage:
138 |             result["usage"] = {
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:143:1
    |
141 |                 "total_tokens": response.usage.total_tokens,
142 |             }
143 |
    | ^^^^^^^^
144 |         if choice and hasattr(choice.message, "tool_calls") and choice.message.tool_calls:
145 |             result["tool_calls"] = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/infrastructure/transports/openai_transport.py:156:1
    |
154 |                 for tc in choice.message.tool_calls
155 |             ]
156 |
    | ^^^^^^^^
157 |         return result
    |
help: Remove whitespace from blank line

F401 `datetime.datetime` imported but unused
  --> app/ai/observability/__init__.py:23:22
   |
21 | from collections import defaultdict
22 | from dataclasses import dataclass, field
23 | from datetime import datetime
   |                      ^^^^^^^^
24 | from enum import Enum
25 | from typing import Any, Callable
   |
help: Remove unused import: `datetime.datetime`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/ai/observability/__init__.py:25:1
   |
23 | from datetime import datetime
24 | from enum import Enum
25 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 |
27 | _LOG = logging.getLogger(__name__)
   |
help: Import from `collections.abc`

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:32:1
   |
30 | class TraceLevel(Enum):
31 |     """Trace detail levels."""
32 |
   | ^^^^
33 |     MINIMAL = "minimal"  # Only basic info
34 |     STANDARD = "standard"  # Standard tracing
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:42:1
   |
40 | class TraceSpan:
41 |     """Represents a single trace span."""
42 |
   | ^^^^
43 |     span_id: str
44 |     trace_id: str
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:54:1
   |
52 |     tags: dict[str, str] = field(default_factory=dict)
53 |     logs: list[dict[str, Any]] = field(default_factory=list)
54 |
   | ^^^^
55 |     def finish(self, status: str = "success") -> None:
56 |         """Mark span as finished."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:60:1
   |
58 |         self.duration_ms = (self.end_time - self.start_time) * 1000
59 |         self.status = status
60 |
   | ^^^^
61 |     def add_log(self, message: str, level: str = "info", **kwargs: Any) -> None:
62 |         """Add log entry to span."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:69:1
   |
67 |             **kwargs
68 |         })
69 |
   | ^^^^
70 |     def set_tag(self, key: str, value: str) -> None:
71 |         """Set tag on span."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:73:1
   |
71 |         """Set tag on span."""
72 |         self.tags[key] = value
73 |
   | ^^^^
74 |     def set_metadata(self, key: str, value: Any) -> None:
75 |         """Set metadata on span."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/observability/__init__.py:82:1
   |
80 | class MetricPoint:
81 |     """Single metric data point."""
82 |
   | ^^^^
83 |     timestamp: float
84 |     name: str
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/observability/__init__.py:93:1
   |
91 |     """
92 |     Collects and aggregates metrics.
93 |
   | ^^^^
94 |     Supports:
95 |     - Counters
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:100:1
    |
 98 |     - Timers
 99 |     """
100 |
    | ^^^^
101 |     def __init__(self):
102 |         self._counters: dict[str, float] = defaultdict(float)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:107:1
    |
105 |         self._timers: dict[str, list[float]] = defaultdict(list)
106 |         self._lock = threading.RLock()
107 |
    | ^^^^
108 |     def increment(self, name: str, value: float = 1.0, tags: dict[str, str] | None = None) -> None:
109 |         """Increment counter."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:113:1
    |
111 |             key = self._make_key(name, tags)
112 |             self._counters[key] += value
113 |
    | ^^^^
114 |     def gauge(self, name: str, value: float, tags: dict[str, str] | None = None) -> None:
115 |         """Set gauge value."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:119:1
    |
117 |             key = self._make_key(name, tags)
118 |             self._gauges[key] = value
119 |
    | ^^^^
120 |     def histogram(self, name: str, value: float, tags: dict[str, str] | None = None) -> None:
121 |         """Record histogram value."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:125:1
    |
123 |             key = self._make_key(name, tags)
124 |             self._histograms[key].append(value)
125 |
    | ^^^^^^^^^^^^
126 |             if len(self._histograms[key]) > 1000:
127 |                 self._histograms[key] = self._histograms[key][-1000:]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:128:1
    |
126 |             if len(self._histograms[key]) > 1000:
127 |                 self._histograms[key] = self._histograms[key][-1000:]
128 |
    | ^^^^
129 |     def timing(self, name: str, duration_ms: float, tags: dict[str, str] | None = None) -> None:
130 |         """Record timing."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:134:1
    |
132 |             key = self._make_key(name, tags)
133 |             self._timers[key].append(duration_ms)
134 |
    | ^^^^^^^^^^^^
135 |             if len(self._timers[key]) > 1000:
136 |                 self._timers[key] = self._timers[key][-1000:]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:137:1
    |
135 |             if len(self._timers[key]) > 1000:
136 |                 self._timers[key] = self._timers[key][-1000:]
137 |
    | ^^^^
138 |     def _make_key(self, name: str, tags: dict[str, str] | None) -> str:
139 |         """Create metric key from name and tags."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:144:1
    |
142 |         tag_str = ",".join(f"{k}={v}" for k, v in sorted(tags.items()))
143 |         return f"{name}[{tag_str}]"
144 |
    | ^^^^
145 |     def get_counter(self, name: str, tags: dict[str, str] | None = None) -> float:
146 |         """Get counter value."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:149:1
    |
147 |         key = self._make_key(name, tags)
148 |         return self._counters.get(key, 0.0)
149 |
    | ^^^^
150 |     def get_gauge(self, name: str, tags: dict[str, str] | None = None) -> float | None:
151 |         """Get gauge value."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:154:1
    |
152 |         key = self._make_key(name, tags)
153 |         return self._gauges.get(key)
154 |
    | ^^^^
155 |     def get_histogram_stats(
156 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:163:1
    |
161 |         key = self._make_key(name, tags)
162 |         values = self._histograms.get(key, [])
163 |
    | ^^^^^^^^
164 |         if not values:
165 |             return {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:166:1
    |
164 |         if not values:
165 |             return {}
166 |
    | ^^^^^^^^
167 |         sorted_values = sorted(values)
168 |         count = len(sorted_values)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:169:1
    |
167 |         sorted_values = sorted(values)
168 |         count = len(sorted_values)
169 |
    | ^^^^^^^^
170 |         return {
171 |             "count": count,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:179:1
    |
177 |             "p99": sorted_values[int(count * 0.99)],
178 |         }
179 |
    | ^^^^
180 |     def get_timing_stats(
181 |         self,
    |
help: Remove whitespace from blank line

F841 Local variable `key` is assigned to but never used
   --> app/ai/observability/__init__.py:186:9
    |
184 |     ) -> dict[str, float]:
185 |         """Get timing statistics."""
186 |         key = self._make_key(name, tags)
    |         ^^^
187 |         return self.get_histogram_stats(name, tags)
    |
help: Remove assignment to unused variable `key`

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:188:1
    |
186 |         key = self._make_key(name, tags)
187 |         return self.get_histogram_stats(name, tags)
188 |
    | ^^^^
189 |     def get_all_metrics(self) -> dict[str, Any]:
190 |         """Get all metrics."""
    |
help: Remove whitespace from blank line

SIM118 Use `key in dict` instead of `key in dict.keys()`
   --> app/ai/observability/__init__.py:197:25
    |
195 |                 "histograms": {
196 |                     k: self.get_histogram_stats(k.split("[")[0])
197 |                     for k in self._histograms.keys()
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
198 |                 },
199 |                 "timers": {
    |
help: Remove `.keys()`

SIM118 Use `key in dict` instead of `key in dict.keys()`
   --> app/ai/observability/__init__.py:201:25
    |
199 |                 "timers": {
200 |                     k: self.get_timing_stats(k.split("[")[0])
201 |                     for k in self._timers.keys()
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^
202 |                 },
203 |             }
    |
help: Remove `.keys()`

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:204:1
    |
202 |                 },
203 |             }
204 |
    | ^^^^
205 |     def reset(self) -> None:
206 |         """Reset all metrics."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/observability/__init__.py:217:1
    |
215 |     """
216 |     Distributed tracing implementation.
217 |
    | ^^^^
218 |     Tracks request flows across components with spans.
219 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:220:1
    |
218 |     Tracks request flows across components with spans.
219 |     """
220 |
    | ^^^^
221 |     def __init__(self, level: TraceLevel = TraceLevel.STANDARD):
222 |         self.level = level
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:227:1
    |
225 |         self._lock = threading.RLock()
226 |         self._span_counter = 0
227 |
    | ^^^^
228 |     def start_span(
229 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:239:1
    |
237 |             self._span_counter += 1
238 |             span_id = f"span_{self._span_counter}_{int(time.time() * 1000)}"
239 |
    | ^^^^^^^^^^^^
240 |             if trace_id is None:
241 |                 trace_id = f"trace_{int(time.time() * 1000)}"
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:242:1
    |
240 |             if trace_id is None:
241 |                 trace_id = f"trace_{int(time.time() * 1000)}"
242 |
    | ^^^^^^^^^^^^
243 |             span = TraceSpan(
244 |                 span_id=span_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:251:1
    |
249 |                 metadata=metadata,
250 |             )
251 |
    | ^^^^^^^^^^^^
252 |             self._spans[span_id] = span
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:253:1
    |
252 |             self._spans[span_id] = span
253 |
    | ^^^^^^^^^^^^
254 |             thread_id = threading.get_ident()
255 |             self._active_spans[thread_id] = span_id
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:256:1
    |
254 |             thread_id = threading.get_ident()
255 |             self._active_spans[thread_id] = span_id
256 |
    | ^^^^^^^^^^^^
257 |             return span
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:258:1
    |
257 |             return span
258 |
    | ^^^^
259 |     def finish_span(self, span: TraceSpan, status: str = "success") -> None:
260 |         """Finish trace span."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:262:1
    |
260 |         """Finish trace span."""
261 |         span.finish(status)
262 |
    | ^^^^^^^^
263 |         thread_id = threading.get_ident()
264 |         if self._active_spans.get(thread_id) == span.span_id:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:266:1
    |
264 |         if self._active_spans.get(thread_id) == span.span_id:
265 |             del self._active_spans[thread_id]
266 |
    | ^^^^
267 |     def get_active_span(self) -> TraceSpan | None:
268 |         """Get active span for current thread."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:272:1
    |
270 |         span_id = self._active_spans.get(thread_id)
271 |         return self._spans.get(span_id) if span_id else None
272 |
    | ^^^^
273 |     def get_span(self, span_id: str) -> TraceSpan | None:
274 |         """Get span by ID."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:276:1
    |
274 |         """Get span by ID."""
275 |         return self._spans.get(span_id)
276 |
    | ^^^^
277 |     def get_trace(self, trace_id: str) -> list[TraceSpan]:
278 |         """Get all spans for trace."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:283:1
    |
281 |             if span.trace_id == trace_id
282 |         ]
283 |
    | ^^^^
284 |     def get_all_spans(self) -> list[TraceSpan]:
285 |         """Get all spans."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/observability/__init__.py:292:1
    |
290 |     """
291 |     Central observability manager.
292 |
    | ^^^^
293 |     Coordinates metrics, tracing, and monitoring.
294 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:295:1
    |
293 |     Coordinates metrics, tracing, and monitoring.
294 |     """
295 |
    | ^^^^
296 |     def __init__(self, trace_level: TraceLevel = TraceLevel.STANDARD):
297 |         self.metrics = MetricsCollector()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:300:1
    |
298 |         self.tracer = Tracer(trace_level)
299 |         self._hooks: list[Callable[[TraceSpan], None]] = []
300 |
    | ^^^^
301 |     def register_span_hook(self, hook: Callable[[TraceSpan], None]) -> None:
302 |         """Register hook to be called when span finishes."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:304:1
    |
302 |         """Register hook to be called when span finishes."""
303 |         self._hooks.append(hook)
304 |
    | ^^^^
305 |     def trace_operation(
306 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:314:1
    |
312 |         parent_span_id = active_span.span_id if active_span else None
313 |         trace_id = active_span.trace_id if active_span else None
314 |
    | ^^^^^^^^
315 |         span = self.tracer.start_span(
316 |             operation=operation,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:321:1
    |
319 |             **metadata
320 |         )
321 |
    | ^^^^^^^^
322 |         self.metrics.increment("traces.started", tags={"operation": operation})
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:323:1
    |
322 |         self.metrics.increment("traces.started", tags={"operation": operation})
323 |
    | ^^^^^^^^
324 |         return span
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:325:1
    |
324 |         return span
325 |
    | ^^^^
326 |     def finish_operation(
327 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:335:1
    |
333 |         for key, value in metadata.items():
334 |             span.set_metadata(key, value)
335 |
    | ^^^^^^^^
336 |         self.tracer.finish_span(span, status)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:337:1
    |
336 |         self.tracer.finish_span(span, status)
337 |
    | ^^^^^^^^
338 |         self.metrics.increment("traces.finished", tags={
339 |             "operation": span.operation,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:342:1
    |
340 |             "status": status
341 |         })
342 |
    | ^^^^^^^^
343 |         if span.duration_ms:
344 |             self.metrics.timing(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:349:1
    |
347 |                 tags={"operation": span.operation}
348 |             )
349 |
    | ^^^^^^^^
350 |         for hook in self._hooks:
351 |             try:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:355:1
    |
353 |             except Exception as e:
354 |                 _LOG.warning(f"Span hook error: {e}")
355 |
    | ^^^^
356 |     def get_dashboard_data(self) -> dict[str, Any]:
357 |         """Get data for monitoring dashboard."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:362:1
    |
360 |             if s.end_time and time.time() - s.end_time < 3600
361 |         ]
362 |
    | ^^^^^^^^
363 |         return {
364 |             "metrics": self.metrics.get_all_metrics(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:371:1
    |
369 |             "operations": self._get_operation_stats(recent_spans),
370 |         }
371 |
    | ^^^^
372 |     def _calculate_error_rate(self, spans: list[TraceSpan]) -> float:
373 |         """Calculate error rate from spans."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:376:1
    |
374 |         if not spans:
375 |             return 0.0
376 |
    | ^^^^^^^^
377 |         errors = len([s for s in spans if s.status == "error"])
378 |         return (errors / len(spans)) * 100
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:379:1
    |
377 |         errors = len([s for s in spans if s.status == "error"])
378 |         return (errors / len(spans)) * 100
379 |
    | ^^^^
380 |     def _calculate_avg_duration(self, spans: list[TraceSpan]) -> float:
381 |         """Calculate average duration from spans."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:384:1
    |
382 |         durations = [s.duration_ms for s in spans if s.duration_ms]
383 |         return sum(durations) / len(durations) if durations else 0.0
384 |
    | ^^^^
385 |     def _get_operation_stats(self, spans: list[TraceSpan]) -> dict[str, Any]:
386 |         """Get statistics by operation."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:392:1
    |
390 |             "total_duration": 0.0
391 |         })
392 |
    | ^^^^^^^^
393 |         for span in spans:
394 |             op_stats = stats[span.operation]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:400:1
    |
398 |             if span.duration_ms:
399 |                 op_stats["total_duration"] += span.duration_ms
400 |
    | ^^^^^^^^
401 |         for op, op_stats in stats.items():
402 |             if op_stats["count"] > 0:
    |
help: Remove whitespace from blank line

B007 Loop control variable `op` not used within loop body
   --> app/ai/observability/__init__.py:401:13
    |
399 |                 op_stats["total_duration"] += span.duration_ms
400 |
401 |         for op, op_stats in stats.items():
    |             ^^
402 |             if op_stats["count"] > 0:
403 |                 op_stats["avg_duration"] = op_stats["total_duration"] / op_stats["count"]
    |
help: Rename unused `op` to `_op`

W293 [*] Blank line contains whitespace
   --> app/ai/observability/__init__.py:405:1
    |
403 |                 op_stats["avg_duration"] = op_stats["total_duration"] / op_stats["count"]
404 |                 op_stats["error_rate"] = (op_stats["errors"] / op_stats["count"]) * 100
405 |
    | ^^^^^^^^
406 |         return dict(stats)
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/ai/observability/__init__.py:418:11
    |
418 |   __all__ = [
    |  ___________^
419 | |     "TraceLevel",
420 | |     "TraceSpan",
421 | |     "MetricPoint",
422 | |     "MetricsCollector",
423 | |     "Tracer",
424 | |     "ObservabilityManager",
425 | |     "get_observability",
426 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/ai/optimization/__init__.py:15:1
   |
13 |   """
14 |
15 | / from __future__ import annotations
16 | |
17 | | import hashlib
18 | | import threading
19 | | import time
20 | | from collections import defaultdict
21 | | from dataclasses import dataclass, field
22 | | from typing import Any, Callable
23 | |
24 | | import logging
   | |______________^
25 |
26 |   _LOG = logging.getLogger(__name__)
   |
help: Organize imports

F401 `collections.defaultdict` imported but unused
  --> app/ai/optimization/__init__.py:20:25
   |
18 | import threading
19 | import time
20 | from collections import defaultdict
   |                         ^^^^^^^^^^^
21 | from dataclasses import dataclass, field
22 | from typing import Any, Callable
   |
help: Remove unused import: `collections.defaultdict`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/ai/optimization/__init__.py:22:1
   |
20 | from collections import defaultdict
21 | from dataclasses import dataclass, field
22 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |
24 | import logging
   |
help: Import from `collections.abc`

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:32:1
   |
30 | class CacheEntry:
31 |     """Cache entry with metadata."""
32 |
   | ^^^^
33 |     key: str
34 |     value: Any
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:40:1
   |
38 |     ttl: float = 3600.0
39 |     metadata: dict[str, Any] = field(default_factory=dict)
40 |
   | ^^^^
41 |     def is_expired(self) -> bool:
42 |         """Check if entry is expired."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:44:1
   |
42 |         """Check if entry is expired."""
43 |         return time.time() - self.created_at > self.ttl
44 |
   | ^^^^
45 |     def touch(self) -> None:
46 |         """Update access time and count."""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/optimization/__init__.py:54:1
   |
52 |     """
53 |     Semantic cache for LLM responses.
54 |
   | ^^^^
55 |     Uses content hashing and optional semantic similarity
56 |     to cache and retrieve responses.
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:58:1
   |
56 |     to cache and retrieve responses.
57 |     """
58 |
   | ^^^^
59 |     def __init__(
60 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:68:1
   |
66 |         self.default_ttl = default_ttl
67 |         self.similarity_threshold = similarity_threshold
68 |
   | ^^^^^^^^
69 |         self._cache: dict[str, CacheEntry] = {}
70 |         self._lock = threading.RLock()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:71:1
   |
69 |         self._cache: dict[str, CacheEntry] = {}
70 |         self._lock = threading.RLock()
71 |
   | ^^^^^^^^
72 |         self._hits = 0
73 |         self._misses = 0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:74:1
   |
72 |         self._hits = 0
73 |         self._misses = 0
74 |
   | ^^^^
75 |     def get(self, key: str | dict[str, Any]) -> Any | None:
76 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/optimization/__init__.py:78:1
   |
76 |         """
77 |         Get value from cache.
78 |
   | ^^^^^^^^
79 |         Args:
80 |             key: Cache key (string or dict to be hashed)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/ai/optimization/__init__.py:81:1
   |
79 |         Args:
80 |             key: Cache key (string or dict to be hashed)
81 |
   | ^^^^^^^^^^^^
82 |         Returns:
83 |             Cached value or None
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:86:1
   |
84 |         """
85 |         cache_key = self._make_key(key)
86 |
   | ^^^^^^^^
87 |         with self._lock:
88 |             entry = self._cache.get(cache_key)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:89:1
   |
87 |         with self._lock:
88 |             entry = self._cache.get(cache_key)
89 |
   | ^^^^^^^^^^^^
90 |             if entry is None:
91 |                 self._misses += 1
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/ai/optimization/__init__.py:93:1
   |
91 |                 self._misses += 1
92 |                 return None
93 |
   | ^^^^^^^^^^^^
94 |             if entry.is_expired():
95 |                 del self._cache[cache_key]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:98:1
    |
 96 |                 self._misses += 1
 97 |                 return None
 98 |
    | ^^^^^^^^^^^^
 99 |             entry.touch()
100 |             self._hits += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:102:1
    |
100 |             self._hits += 1
101 |             return entry.value
102 |
    | ^^^^
103 |     def set(
104 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:112:1
    |
110 |         """
111 |         Set value in cache.
112 |
    | ^^^^^^^^
113 |         Args:
114 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:120:1
    |
118 |         """
119 |         cache_key = self._make_key(key)
120 |
    | ^^^^^^^^
121 |         with self._lock:
122 |             if len(self._cache) >= self.max_size:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:124:1
    |
122 |             if len(self._cache) >= self.max_size:
123 |                 self._evict_lru()
124 |
    | ^^^^^^^^^^^^
125 |             entry = CacheEntry(
126 |                 key=cache_key,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:133:1
    |
131 |                 metadata=metadata,
132 |             )
133 |
    | ^^^^^^^^^^^^
134 |             self._cache[cache_key] = entry
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:135:1
    |
134 |             self._cache[cache_key] = entry
135 |
    | ^^^^
136 |     def invalidate(self, key: str | dict[str, Any]) -> bool:
137 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:139:1
    |
137 |         """
138 |         Invalidate cache entry.
139 |
    | ^^^^^^^^
140 |         Args:
141 |             key: Cache key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:142:1
    |
140 |         Args:
141 |             key: Cache key
142 |
    | ^^^^^^^^^^^^
143 |         Returns:
144 |             True if entry was removed
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:147:1
    |
145 |         """
146 |         cache_key = self._make_key(key)
147 |
    | ^^^^^^^^
148 |         with self._lock:
149 |             if cache_key in self._cache:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:153:1
    |
151 |                 return True
152 |             return False
153 |
    | ^^^^
154 |     def clear(self) -> None:
155 |         """Clear all cache entries."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:160:1
    |
158 |             self._hits = 0
159 |             self._misses = 0
160 |
    | ^^^^
161 |     def _make_key(self, key: str | dict[str, Any]) -> str:
162 |         """Create cache key from input."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:165:1
    |
163 |         if isinstance(key, str):
164 |             return hashlib.sha256(key.encode()).hexdigest()
165 |
    | ^^^^^^^^
166 |         key_str = str(sorted(key.items()))
167 |         return hashlib.sha256(key_str.encode()).hexdigest()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:168:1
    |
166 |         key_str = str(sorted(key.items()))
167 |         return hashlib.sha256(key_str.encode()).hexdigest()
168 |
    | ^^^^
169 |     def _evict_lru(self) -> None:
170 |         """Evict least recently used entry."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:173:1
    |
171 |         if not self._cache:
172 |             return
173 |
    | ^^^^^^^^
174 |         lru_key = min(
175 |             self._cache.keys(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:179:1
    |
177 |         )
178 |         del self._cache[lru_key]
179 |
    | ^^^^
180 |     def get_stats(self) -> dict[str, Any]:
181 |         """Get cache statistics."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:185:1
    |
183 |             total_requests = self._hits + self._misses
184 |             hit_rate = (self._hits / total_requests * 100) if total_requests > 0 else 0
185 |
    | ^^^^^^^^^^^^
186 |             return {
187 |                 "size": len(self._cache),
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:199:1
    |
197 |     """
198 |     Batches multiple requests for efficient processing.
199 |
    | ^^^^
200 |     Collects requests over a time window and processes them together.
201 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:202:1
    |
200 |     Collects requests over a time window and processes them together.
201 |     """
202 |
    | ^^^^
203 |     def __init__(
204 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:212:1
    |
210 |         self.batch_timeout = batch_timeout
211 |         self.processor = processor
212 |
    | ^^^^^^^^
213 |         self._pending: list[tuple[Any, threading.Event, list]] = []
214 |         self._lock = threading.RLock()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:217:1
    |
215 |         self._batch_thread: threading.Thread | None = None
216 |         self._running = False
217 |
    | ^^^^
218 |     def start(self) -> None:
219 |         """Start batch processing thread."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:222:1
    |
220 |         if self._running:
221 |             return
222 |
    | ^^^^^^^^
223 |         self._running = True
224 |         self._batch_thread = threading.Thread(target=self._process_batches, daemon=True)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:226:1
    |
224 |         self._batch_thread = threading.Thread(target=self._process_batches, daemon=True)
225 |         self._batch_thread.start()
226 |
    | ^^^^
227 |     def stop(self) -> None:
228 |         """Stop batch processing thread."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:232:1
    |
230 |         if self._batch_thread:
231 |             self._batch_thread.join(timeout=1.0)
232 |
    | ^^^^
233 |     def submit(self, request: Any) -> Any:
234 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:236:1
    |
234 |         """
235 |         Submit request for batching.
236 |
    | ^^^^^^^^
237 |         Args:
238 |             request: Request to batch
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:239:1
    |
237 |         Args:
238 |             request: Request to batch
239 |
    | ^^^^^^^^^^^^
240 |         Returns:
241 |             Response for the request
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:245:1
    |
243 |         event = threading.Event()
244 |         result_container = []
245 |
    | ^^^^^^^^
246 |         with self._lock:
247 |             self._pending.append((request, event, result_container))
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:248:1
    |
246 |         with self._lock:
247 |             self._pending.append((request, event, result_container))
248 |
    | ^^^^^^^^^^^^
249 |             if len(self._pending) >= self.batch_size:
250 |                 self._flush_batch()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:251:1
    |
249 |             if len(self._pending) >= self.batch_size:
250 |                 self._flush_batch()
251 |
    | ^^^^^^^^
252 |         event.wait()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:253:1
    |
252 |         event.wait()
253 |
    | ^^^^^^^^
254 |         if result_container:
255 |             return result_container[0]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:257:1
    |
255 |             return result_container[0]
256 |         raise RuntimeError("Batch processing failed")
257 |
    | ^^^^
258 |     def _process_batches(self) -> None:
259 |         """Background thread for processing batches."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:262:1
    |
260 |         while self._running:
261 |             time.sleep(self.batch_timeout)
262 |
    | ^^^^^^^^^^^^
263 |             with self._lock:
264 |                 if self._pending:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:266:1
    |
264 |                 if self._pending:
265 |                     self._flush_batch()
266 |
    | ^^^^
267 |     def _flush_batch(self) -> None:
268 |         """Process pending batch."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:271:1
    |
269 |         if not self._pending:
270 |             return
271 |
    | ^^^^^^^^
272 |         batch = self._pending[:]
273 |         self._pending.clear()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:274:1
    |
272 |         batch = self._pending[:]
273 |         self._pending.clear()
274 |
    | ^^^^^^^^
275 |         requests = [item[0] for item in batch]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:276:1
    |
275 |         requests = [item[0] for item in batch]
276 |
    | ^^^^^^^^
277 |         try:
278 |             if self.processor:
    |
help: Remove whitespace from blank line

SIM108 Use ternary operator `results = self.processor(requests) if self.processor else requests` instead of `if`-`else`-block
   --> app/ai/optimization/__init__.py:278:13
    |
277 |           try:
278 | /             if self.processor:
279 | |                 results = self.processor(requests)
280 | |             else:
281 | |                 results = requests
    | |__________________________________^
282 |
283 |               for (_, event, result_container), result in zip(batch, results):
    |
help: Replace `if`-`else`-block with `results = self.processor(requests) if self.processor else requests`

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:282:1
    |
280 |             else:
281 |                 results = requests
282 |
    | ^^^^^^^^^^^^
283 |             for (_, event, result_container), result in zip(batch, results):
284 |                 result_container.append(result)
    |
help: Remove whitespace from blank line

B905 `zip()` without an explicit `strict=` parameter
   --> app/ai/optimization/__init__.py:283:57
    |
281 |                 results = requests
282 |
283 |             for (_, event, result_container), result in zip(batch, results):
    |                                                         ^^^^^^^^^^^^^^^^^^^
284 |                 result_container.append(result)
285 |                 event.set()
    |
help: Add explicit value for parameter `strict=`

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:286:1
    |
284 |                 result_container.append(result)
285 |                 event.set()
286 |
    | ^^^^^^^^
287 |         except Exception as e:
288 |             _LOG.error(f"Batch processing error: {e}")
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:296:1
    |
294 |     """
295 |     Optimizes prompts for token efficiency.
296 |
    | ^^^^
297 |     Provides strategies for reducing token usage while
298 |     maintaining semantic meaning.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:300:1
    |
298 |     maintaining semantic meaning.
299 |     """
300 |
    | ^^^^
301 |     @staticmethod
302 |     def compress_whitespace(text: str) -> str:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:307:1
    |
305 |         text = re.sub(r'\s+', ' ', text)
306 |         return text.strip()
307 |
    | ^^^^
308 |     @staticmethod
309 |     def remove_redundancy(text: str) -> str:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:318:1
    |
316 |             "in other words",
317 |         ]
318 |
    | ^^^^^^^^
319 |         result = text
320 |         for phrase in redundant_phrases:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:322:1
    |
320 |         for phrase in redundant_phrases:
321 |             result = result.replace(phrase, "")
322 |
    | ^^^^^^^^
323 |         return PromptOptimizer.compress_whitespace(result)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:324:1
    |
323 |         return PromptOptimizer.compress_whitespace(result)
324 |
    | ^^^^
325 |     @staticmethod
326 |     def truncate_to_tokens(
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:333:1
    |
331 |         """
332 |         Truncate text to maximum token count.
333 |
    | ^^^^^^^^
334 |         Args:
335 |             text: Text to truncate
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:338:1
    |
336 |             max_tokens: Maximum tokens
337 |             encoding: Tokenizer encoding
338 |
    | ^^^^^^^^^^^^
339 |         Returns:
340 |             Truncated text
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:346:1
    |
344 |             enc = tiktoken.get_encoding(encoding)
345 |             tokens = enc.encode(text)
346 |
    | ^^^^^^^^^^^^
347 |             if len(tokens) <= max_tokens:
348 |                 return text
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:349:1
    |
347 |             if len(tokens) <= max_tokens:
348 |                 return text
349 |
    | ^^^^^^^^^^^^
350 |             truncated_tokens = tokens[:max_tokens]
351 |             return enc.decode(truncated_tokens)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:352:1
    |
350 |             truncated_tokens = tokens[:max_tokens]
351 |             return enc.decode(truncated_tokens)
352 |
    | ^^^^^^^^
353 |         except ImportError:
354 |             words = text.split()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:356:1
    |
354 |             words = text.split()
355 |             estimated_tokens = len(words) * 1.3
356 |
    | ^^^^^^^^^^^^
357 |             if estimated_tokens <= max_tokens:
358 |                 return text
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:359:1
    |
357 |             if estimated_tokens <= max_tokens:
358 |                 return text
359 |
    | ^^^^^^^^^^^^
360 |             target_words = int(max_tokens / 1.3)
361 |             return " ".join(words[:target_words])
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:362:1
    |
360 |             target_words = int(max_tokens / 1.3)
361 |             return " ".join(words[:target_words])
362 |
    | ^^^^
363 |     @staticmethod
364 |     def optimize(
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:371:1
    |
369 |         """
370 |         Apply all optimization strategies.
371 |
    | ^^^^^^^^
372 |         Args:
373 |             text: Text to optimize
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:376:1
    |
374 |             max_tokens: Optional token limit
375 |             remove_redundancy: Whether to remove redundant phrases
376 |
    | ^^^^^^^^^^^^
377 |         Returns:
378 |             Optimized text
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:381:1
    |
379 |         """
380 |         result = PromptOptimizer.compress_whitespace(text)
381 |
    | ^^^^^^^^
382 |         if remove_redundancy:
383 |             result = PromptOptimizer.remove_redundancy(result)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:384:1
    |
382 |         if remove_redundancy:
383 |             result = PromptOptimizer.remove_redundancy(result)
384 |
    | ^^^^^^^^
385 |         if max_tokens:
386 |             result = PromptOptimizer.truncate_to_tokens(result, max_tokens)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:387:1
    |
385 |         if max_tokens:
386 |             result = PromptOptimizer.truncate_to_tokens(result, max_tokens)
387 |
    | ^^^^^^^^
388 |         return result
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:394:1
    |
392 |     """
393 |     Deduplicates similar requests to avoid redundant API calls.
394 |
    | ^^^^
395 |     Tracks in-flight requests and returns cached results for
396 |     identical concurrent requests.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:398:1
    |
396 |     identical concurrent requests.
397 |     """
398 |
    | ^^^^
399 |     def __init__(self):
400 |         self._in_flight: dict[str, tuple[threading.Event, list]] = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:402:1
    |
400 |         self._in_flight: dict[str, tuple[threading.Event, list]] = {}
401 |         self._lock = threading.RLock()
402 |
    | ^^^^
403 |     def deduplicate(
404 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:410:1
    |
408 |         """
409 |         Execute function with deduplication.
410 |
    | ^^^^^^^^
411 |         If same key is already executing, wait for that result.
412 |         Otherwise, execute and share result with waiters.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:413:1
    |
411 |         If same key is already executing, wait for that result.
412 |         Otherwise, execute and share result with waiters.
413 |
    | ^^^^^^^^
414 |         Args:
415 |             key: Deduplication key
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/ai/optimization/__init__.py:417:1
    |
415 |             key: Deduplication key
416 |             executor: Function to execute
417 |
    | ^^^^^^^^^^^^
418 |         Returns:
419 |             Function result
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:425:1
    |
423 |                 event, result_container = self._in_flight[key]
424 |                 _LOG.debug(f"Deduplicating request: {key}")
425 |
    | ^^^^^^^^
426 |         if key in self._in_flight:
427 |             event.wait()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:429:1
    |
427 |             event.wait()
428 |             return result_container[0]
429 |
    | ^^^^^^^^
430 |         event = threading.Event()
431 |         result_container = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:432:1
    |
430 |         event = threading.Event()
431 |         result_container = []
432 |
    | ^^^^^^^^
433 |         with self._lock:
434 |             self._in_flight[key] = (event, result_container)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:435:1
    |
433 |         with self._lock:
434 |             self._in_flight[key] = (event, result_container)
435 |
    | ^^^^^^^^
436 |         try:
437 |             result = executor()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/ai/optimization/__init__.py:440:1
    |
438 |             result_container.append(result)
439 |             return result
440 |
    | ^^^^^^^^
441 |         finally:
442 |             event.set()
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/ai/optimization/__init__.py:462:11
    |
462 |   __all__ = [
    |  ___________^
463 | |     "SemanticCache",
464 | |     "RequestBatcher",
465 | |     "PromptOptimizer",
466 | |     "ResponseDeduplicator",
467 | |     "get_cache",
468 | |     "get_deduplicator",
469 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/analytics/__init__.py:21:11
   |
19 |   from .facade import UserAnalyticsMetricsService
20 |
21 |   __all__ = [
   |  ___________^
22 | |     # Main service
23 | |     "UserAnalyticsMetricsService",
24 | |     "get_user_analytics_service",
25 | |     # Domain exports
26 | |     "EventType",
27 | |     "UserSegment",
28 | |     "ABTestVariant",
29 | |     "UserEvent",
30 | |     "UserSession",
31 | |     "EngagementMetrics",
32 | |     "ConversionMetrics",
33 | |     "RetentionMetrics",
34 | |     "NPSMetrics",
35 | |     "ABTestResults",
36 | |     "CohortAnalysis",
37 | |     "RevenueMetrics",
38 | | ]
   | |_^
39 |
40 |   # Singleton instance
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/analytics/application/__init__.py:10:11
   |
 8 |   from .user_segmentation import UserSegmentation
 9 |
10 |   __all__ = [
   |  ___________^
11 | |     "EventTracker",
12 | |     "SessionManager",
13 | |     "MetricsCalculator",
14 | |     "ABTestManager",
15 | |     "NPSManager",
16 | |     "UserSegmentation",
17 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `datetime.timedelta` imported but unused
 --> app/analytics/application/anomaly_detection.py:5:37
  |
3 | import statistics
4 | from collections import defaultdict
5 | from datetime import UTC, datetime, timedelta
  |                                     ^^^^^^^^^
6 |
7 | from app.analytics.domain.entities import Anomaly, UsageMetric
  |
help: Remove unused import: `datetime.timedelta`

SIM118 Use `key in dict` instead of `key in dict.keys()`
  --> app/analytics/application/anomaly_detection.py:57:13
   |
55 |         hourly_counts = self._group_by_hour(metrics)
56 |
57 |         for hour in hourly_counts.keys():
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 |             hour_metrics = [m for m in metrics if self._get_hour_key(m.timestamp) == hour and m.name == "api_request"]
   |
help: Remove `.keys()`

F401 [*] `datetime.timedelta` imported but unused
 --> app/analytics/application/behavior_analysis.py:5:22
  |
3 | import statistics
4 | from collections import Counter
5 | from datetime import timedelta
  |                      ^^^^^^^^^
6 |
7 | from app.analytics.domain.entities import BehaviorProfile, UsageMetric
  |
help: Remove unused import: `datetime.timedelta`

F401 [*] `datetime.timedelta` imported but unused
 --> app/analytics/application/custom_report_generators.py:6:22
  |
4 | """
5 |
6 | from datetime import timedelta
  |                      ^^^^^^^^^
7 | from typing import Any
  |
help: Remove unused import: `datetime.timedelta`

F841 Local variable `now` is assigned to but never used
  --> app/analytics/application/metrics_calculator.py:35:9
   |
33 |     def get_engagement_metrics(self, time_window: str = "30d") -> EngagementMetrics:
34 |         """Get user engagement metrics"""
35 |         now = datetime.now(UTC)
   |         ^^^
36 |
37 |         # Active users
   |
help: Remove assignment to unused variable `now`

F841 Local variable `now` is assigned to but never used
  --> app/analytics/application/metrics_calculator.py:86:9
   |
84 |     def get_conversion_metrics(self, conversion_event: str = "conversion") -> ConversionMetrics:
85 |         """Get conversion metrics"""
86 |         now = datetime.now(UTC)
   |         ^^^
87 |         recent_events = self.event_store.get_recent_events(days=30)
   |
help: Remove assignment to unused variable `now`

F401 [*] `datetime.UTC` imported but unused
  --> app/analytics/application/ml_anomaly_detection.py:60:30
   |
58 |     def _convert_to_anomalies(self, predictions: list[bool], metrics: list[UsageMetric]) -> list[Anomaly]:
59 |         """Convert predictions to Anomaly objects."""
60 |         from datetime import UTC, datetime
   |                              ^^^
61 |
62 |         anomalies = []
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/analytics/application/ml_anomaly_detection.py:60:35
   |
58 |     def _convert_to_anomalies(self, predictions: list[bool], metrics: list[UsageMetric]) -> list[Anomaly]:
59 |         """Convert predictions to Anomaly objects."""
60 |         from datetime import UTC, datetime
   |                                   ^^^^^^^^
61 |
62 |         anomalies = []
   |
help: Remove unused import

C401 Unnecessary generator (rewrite as a set comprehension)
  --> app/analytics/application/report_generation.py:36:28
   |
35 |         total_requests = len([m for m in metrics if m.name == "api_request"])
36 |         unique_users = len(set(m.user_id for m in metrics if m.user_id))
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |         errors = len([m for m in metrics if m.status_code and m.status_code >= 400])
38 |         error_rate = (errors / total_requests * 100) if total_requests > 0 else 0
   |
help: Rewrite as a set comprehension

RUF022 `__all__` is not sorted
  --> app/analytics/domain/__init__.py:25:11
   |
23 |   )
24 |
25 |   __all__ = [
   |  ___________^
26 | |     # Enums
27 | |     "EventType",
28 | |     "UserSegment",
29 | |     "ABTestVariant",
30 | |     # Models
31 | |     "UserEvent",
32 | |     "UserSession",
33 | |     "UserData",
34 | |     "EngagementMetrics",
35 | |     "ConversionMetrics",
36 | |     "RetentionMetrics",
37 | |     "NPSMetrics",
38 | |     "ABTestResults",
39 | |     "CohortAnalysis",
40 | |     "RevenueMetrics",
41 | |     # Ports
42 | |     "EventStorePort",
43 | |     "SessionStorePort",
44 | |     "UserStorePort",
45 | |     "ActiveUsersStorePort",
46 | |     "ABTestStorePort",
47 | |     "NPSStorePort",
48 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:20:1
   |
18 | class EventType(Enum):
19 |     """Event type enumeration."""
20 |
   | ^^^^
21 |     PAGE_VIEW = "page_view"
22 |     CLICK = "click"
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:36:1
   |
34 | class EventPriority(Enum):
35 |     """Event processing priority."""
36 |
   | ^^^^
37 |     CRITICAL = 0  # Immediate processing
38 |     HIGH = 1      # <100ms
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/domain/models/event.py:48:1
   |
46 |     """
47 |     Immutable event identifier with content-based hashing.
48 |
   | ^^^^
49 |     Uses SHA-256 for deterministic ID generation enabling
50 |     deduplication and idempotency.
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:52:1
   |
50 |     deduplication and idempotency.
51 |     """
52 |
   | ^^^^
53 |     value: str
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:54:1
   |
53 |     value: str
54 |
   | ^^^^
55 |     @classmethod
56 |     def generate(cls, user_id: str, timestamp: datetime, event_type: str) -> EventId:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:61:1
   |
59 |         hash_value = hashlib.sha256(content.encode()).hexdigest()[:16]
60 |         return cls(value=hash_value)
61 |
   | ^^^^
62 |     @classmethod
63 |     def random(cls) -> EventId:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:71:1
   |
69 | class EventMetadata:
70 |     """Event metadata for enrichment and routing."""
71 |
   | ^^^^
72 |     device_type: str | None = None
73 |     browser: str | None = None
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/domain/models/event.py:83:1
   |
81 |     utm_medium: str | None = None
82 |     utm_campaign: str | None = None
83 |
   | ^^^^
84 |     def to_dict(self) -> dict[str, Any]:
85 |         """Convert to dictionary."""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/domain/models/event.py:96:1
   |
94 |     """
95 |     Core event entity with quantum-inspired superposition.
96 |
   | ^^^^
97 |     Events can exist in multiple states simultaneously until
98 |     observed/processed, enabling speculative execution and
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:101:1
    |
 99 |     parallel hypothesis testing.
100 |     """
101 |
    | ^^^^
102 |     event_id: EventId
103 |     user_id: str
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:111:1
    |
109 |     metadata: EventMetadata = field(default_factory=EventMetadata)
110 |     priority: EventPriority = EventPriority.NORMAL
111 |
    | ^^^^
112 |     # Quantum-inspired fields
113 |     superposition_states: list[dict[str, Any]] = field(default_factory=list)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:115:1
    |
113 |     superposition_states: list[dict[str, Any]] = field(default_factory=list)
114 |     collapsed: bool = False
115 |
    | ^^^^
116 |     def add_superposition_state(self, state: dict[str, Any]) -> None:
117 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:119:1
    |
117 |         """
118 |         Add possible state to superposition.
119 |
    | ^^^^^^^^
120 |         Enables parallel hypothesis testing where multiple
121 |         interpretations of the event coexist.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:125:1
    |
123 |         if not self.collapsed:
124 |             self.superposition_states.append(state)
125 |
    | ^^^^
126 |     def collapse(self, selector: callable = None) -> dict[str, Any]:
127 |         """
    |
help: Remove whitespace from blank line

RUF013 PEP 484 prohibits implicit `Optional`
   --> app/analytics/domain/models/event.py:126:34
    |
124 |             self.superposition_states.append(state)
125 |
126 |     def collapse(self, selector: callable = None) -> dict[str, Any]:
    |                                  ^^^^^^^^
127 |         """
128 |         Collapse superposition to single state.
    |
help: Convert to `T | None`

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:129:1
    |
127 |         """
128 |         Collapse superposition to single state.
129 |
    | ^^^^^^^^
130 |         Args:
131 |             selector: Function to select state (default: highest probability)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:132:1
    |
130 |         Args:
131 |             selector: Function to select state (default: highest probability)
132 |
    | ^^^^^^^^^^^^
133 |         Returns:
134 |             Selected state
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:138:1
    |
136 |         if self.collapsed:
137 |             return self.properties
138 |
    | ^^^^^^^^
139 |         if not self.superposition_states:
140 |             self.collapsed = True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:142:1
    |
140 |             self.collapsed = True
141 |             return self.properties
142 |
    | ^^^^^^^^
143 |         if selector:
144 |             selected = selector(self.superposition_states)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:151:1
    |
149 |                 key=lambda s: s.get('probability', 0.0)
150 |             )
151 |
    | ^^^^^^^^
152 |         self.properties.update(selected)
153 |         self.collapsed = True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:155:1
    |
153 |         self.collapsed = True
154 |         return self.properties
155 |
    | ^^^^
156 |     def enrich(self, enrichment: dict[str, Any]) -> None:
157 |         """Enrich event with additional data."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:159:1
    |
157 |         """Enrich event with additional data."""
158 |         self.properties.update(enrichment)
159 |
    | ^^^^
160 |     def to_dict(self) -> dict[str, Any]:
161 |         """Convert to dictionary for serialization."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:173:1
    |
171 |             'priority': self.priority.value,
172 |         }
173 |
    | ^^^^
174 |     @classmethod
175 |     def from_dict(cls, data: dict[str, Any]) -> Event:
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:194:1
    |
192 |     """
193 |     Batch of events for efficient processing.
194 |
    | ^^^^
195 |     Implements interference pattern where operations
196 |     can be combined or cancelled.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:198:1
    |
196 |     can be combined or cancelled.
197 |     """
198 |
    | ^^^^
199 |     batch_id: str
200 |     events: list[Event]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:202:1
    |
200 |     events: list[Event]
201 |     created_at: datetime = field(default_factory=datetime.utcnow)
202 |
    | ^^^^
203 |     def optimize(self) -> EventBatch:
204 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:206:1
    |
204 |         """
205 |         Optimize batch using interference patterns.
206 |
    | ^^^^^^^^
207 |         - Combine similar events (constructive interference)
208 |         - Cancel opposing events (destructive interference)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:213:1
    |
211 |         optimized_events = []
212 |         event_map: dict[str, Event] = {}
213 |
    | ^^^^^^^^
214 |         for event in self.events:
215 |             key = f"{event.user_id}:{event.event_type.value}:{event.event_name}"
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:216:1
    |
214 |         for event in self.events:
215 |             key = f"{event.user_id}:{event.event_type.value}:{event.event_name}"
216 |
    | ^^^^^^^^^^^^
217 |             if key in event_map:
218 |                 # Constructive interference: combine events
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:224:1
    |
222 |                     existing.properties['last_timestamp'] = event.timestamp
223 |                     continue
224 |
    | ^^^^^^^^^^^^
225 |             event_map[key] = event
226 |             optimized_events.append(event)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:227:1
    |
225 |             event_map[key] = event
226 |             optimized_events.append(event)
227 |
    | ^^^^^^^^
228 |         return EventBatch(
229 |             batch_id=self.batch_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:233:1
    |
231 |             created_at=self.created_at
232 |         )
233 |
    | ^^^^
234 |     def _can_combine(self, event1: Event, event2: Event) -> bool:
235 |         """Check if events can be combined."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:238:1
    |
236 |         time_diff = abs((event2.timestamp - event1.timestamp).total_seconds())
237 |         return time_diff < 60  # Within 1 minute
238 |
    | ^^^^
239 |     def size(self) -> int:
240 |         """Get batch size."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:242:1
    |
240 |         """Get batch size."""
241 |         return len(self.events)
242 |
    | ^^^^
243 |     def split(self, chunk_size: int) -> list[EventBatch]:
244 |         """Split batch into smaller chunks."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/domain/models/event.py:260:1
    |
258 |     """
259 |     Continuous stream of events with windowing support.
260 |
    | ^^^^
261 |     Implements tumbling and sliding windows for
262 |     real-time aggregation.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:264:1
    |
262 |     real-time aggregation.
263 |     """
264 |
    | ^^^^
265 |     stream_id: str
266 |     window_size: int  # seconds
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:269:1
    |
267 |     slide_interval: int  # seconds
268 |     events: list[Event] = field(default_factory=list)
269 |
    | ^^^^
270 |     def add(self, event: Event) -> None:
271 |         """Add event to stream."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:274:1
    |
272 |         self.events.append(event)
273 |         self._cleanup_old_events()
274 |
    | ^^^^
275 |     def _cleanup_old_events(self) -> None:
276 |         """Remove events outside window."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:279:1
    |
277 |         if not self.events:
278 |             return
279 |
    | ^^^^^^^^
280 |         cutoff = datetime.utcnow().timestamp() - self.window_size
281 |         self.events = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:285:1
    |
283 |             if e.timestamp.timestamp() >= cutoff
284 |         ]
285 |
    | ^^^^
286 |     def get_window(self, window_start: datetime, window_end: datetime) -> list[Event]:
287 |         """Get events in time window."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:292:1
    |
290 |             if window_start <= e.timestamp < window_end
291 |         ]
292 |
    | ^^^^
293 |     def tumbling_windows(self) -> list[list[Event]]:
294 |         """Get non-overlapping tumbling windows."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:297:1
    |
295 |         if not self.events:
296 |             return []
297 |
    | ^^^^^^^^
298 |         windows = []
299 |         current_window = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:301:1
    |
299 |         current_window = []
300 |         window_start = self.events[0].timestamp
301 |
    | ^^^^^^^^
302 |         for event in self.events:
303 |             if (event.timestamp - window_start).total_seconds() >= self.window_size:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:309:1
    |
307 |             else:
308 |                 current_window.append(event)
309 |
    | ^^^^^^^^
310 |         if current_window:
311 |             windows.append(current_window)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:312:1
    |
310 |         if current_window:
311 |             windows.append(current_window)
312 |
    | ^^^^^^^^
313 |         return windows
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:314:1
    |
313 |         return windows
314 |
    | ^^^^
315 |     def sliding_windows(self) -> list[list[Event]]:
316 |         """Get overlapping sliding windows."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:319:1
    |
317 |         if not self.events:
318 |             return []
319 |
    | ^^^^^^^^
320 |         windows = []
321 |         start_time = self.events[0].timestamp
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:323:1
    |
321 |         start_time = self.events[0].timestamp
322 |         end_time = self.events[-1].timestamp
323 |
    | ^^^^^^^^
324 |         current = start_time
325 |         while current <= end_time:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/domain/models/event.py:331:1
    |
329 |                 windows.append(window_events)
330 |             current += timedelta(seconds=self.slide_interval)
331 |
    | ^^^^^^^^
332 |         return windows
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/analytics/domain/models/event.py:337:11
    |
335 |   from datetime import timedelta
336 |
337 |   __all__ = [
    |  ___________^
338 | |     'EventType',
339 | |     'EventPriority',
340 | |     'EventId',
341 | |     'EventMetadata',
342 | |     'Event',
343 | |     'EventBatch',
344 | |     'EventStream',
345 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/analytics/facade.py:36:1
   |
34 |     """
35 |     User Analytics & Business Metrics Service Facade
36 |
   | ^^^^
37 |     Provides backward-compatible interface while delegating to specialized services.
38 |     """
   |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
  --> app/analytics/infrastructure/__init__.py:12:11
   |
10 |   )
11 |
12 |   __all__ = [
   |  ___________^
13 | |     "InMemoryEventStore",
14 | |     "InMemorySessionStore",
15 | |     "InMemoryUserStore",
16 | |     "InMemoryActiveUsersStore",
17 | |     "InMemoryABTestStore",
18 | |     "InMemoryNPSStore",
19 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Iterable`
  --> app/analytics/infrastructure/stores/hyperloglog.py:19:1
   |
17 | import hashlib
18 | import math
19 | from typing import Any, Iterable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Import from `collections.abc`

F401 [*] `typing.Iterable` imported but unused
  --> app/analytics/infrastructure/stores/hyperloglog.py:19:25
   |
17 | import hashlib
18 | import math
19 | from typing import Any, Iterable
   |                         ^^^^^^^^
   |
help: Remove unused import: `typing.Iterable`

W293 Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:25:1
   |
23 |     """
24 |     HyperLogLog probabilistic cardinality counter.
25 |
   | ^^^^
26 |     Provides accurate cardinality estimation using minimal memory.
27 |     Perfect for counting unique users, sessions, or events.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:28:1
   |
26 |     Provides accurate cardinality estimation using minimal memory.
27 |     Perfect for counting unique users, sessions, or events.
28 |
   | ^^^^
29 |     Example:
30 |         >>> hll = HyperLogLog(precision=14)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:35:1
   |
33 |         >>> unique_users = hll.count()
34 |     """
35 |
   | ^^^^
36 |     def __init__(self, precision: int = 14):
37 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:39:1
   |
37 |         """
38 |         Initialize HyperLogLog counter.
39 |
   | ^^^^^^^^
40 |         Args:
41 |             precision: Precision parameter (4-16)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:47:1
   |
45 |         if not 4 <= precision <= 16:
46 |             raise ValueError("Precision must be between 4 and 16")
47 |
   | ^^^^^^^^
48 |         self.precision = precision
49 |         self.m = 2 ** precision
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:52:1
   |
50 |         self.registers = [0] * self.m
51 |         self.alpha = self._get_alpha(self.m)
52 |
   | ^^^^
53 |     def add(self, item: Any) -> None:
54 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:56:1
   |
54 |         """
55 |         Add item to set.
56 |
   | ^^^^^^^^
57 |         Args:
58 |             item: Item to add (will be hashed)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:62:1
   |
60 |         # Hash item to 64-bit integer
61 |         h = self._hash(item)
62 |
   | ^^^^^^^^
63 |         # Use first p bits for register index
64 |         j = h & (self.m - 1)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:65:1
   |
63 |         # Use first p bits for register index
64 |         j = h & (self.m - 1)
65 |
   | ^^^^^^^^
66 |         # Count leading zeros in remaining bits
67 |         w = h >> self.precision
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:69:1
   |
67 |         w = h >> self.precision
68 |         leading_zeros = self._leading_zeros(w, 64 - self.precision) + 1
69 |
   | ^^^^^^^^
70 |         # Update register with maximum
71 |         self.registers[j] = max(self.registers[j], leading_zeros)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:72:1
   |
70 |         # Update register with maximum
71 |         self.registers[j] = max(self.registers[j], leading_zeros)
72 |
   | ^^^^
73 |     def count(self) -> int:
74 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:76:1
   |
74 |         """
75 |         Estimate cardinality.
76 |
   | ^^^^^^^^
77 |         Returns:
78 |             Estimated number of unique items
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:84:1
   |
82 |             2 ** -register for register in self.registers
83 |         )
84 |
   | ^^^^^^^^
85 |         # Apply bias correction for different ranges
86 |         if raw_estimate <= 2.5 * self.m:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:91:1
   |
89 |             if zeros != 0:
90 |                 return int(self.m * math.log(self.m / zeros))
91 |
   | ^^^^^^^^
92 |         if raw_estimate <= (1/30) * (2 ** 32):
93 |             # No correction
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/analytics/infrastructure/stores/hyperloglog.py:95:1
   |
93 |             # No correction
94 |             return int(raw_estimate)
95 |
   | ^^^^^^^^
96 |         # Large range correction
97 |         return int(-2 ** 32 * math.log(1 - raw_estimate / (2 ** 32)))
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:98:1
    |
 96 |         # Large range correction
 97 |         return int(-2 ** 32 * math.log(1 - raw_estimate / (2 ** 32)))
 98 |
    | ^^^^
 99 |     def merge(self, other: HyperLogLog) -> HyperLogLog:
100 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:102:1
    |
100 |         """
101 |         Merge with another HyperLogLog.
102 |
    | ^^^^^^^^
103 |         Args:
104 |             other: Another HyperLogLog with same precision
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:105:1
    |
103 |         Args:
104 |             other: Another HyperLogLog with same precision
105 |
    | ^^^^^^^^^^^^
106 |         Returns:
107 |             New merged HyperLogLog
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:111:1
    |
109 |         if self.precision != other.precision:
110 |             raise ValueError("Cannot merge HyperLogLogs with different precision")
111 |
    | ^^^^^^^^
112 |         merged = HyperLogLog(self.precision)
113 |         merged.registers = [
    |
help: Remove whitespace from blank line

B905 `zip()` without an explicit `strict=` parameter
   --> app/analytics/infrastructure/stores/hyperloglog.py:114:35
    |
112 |         merged = HyperLogLog(self.precision)
113 |         merged.registers = [
114 |             max(a, b) for a, b in zip(self.registers, other.registers)
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
115 |         ]
116 |         return merged
    |
help: Add explicit value for parameter `strict=`

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:117:1
    |
115 |         ]
116 |         return merged
117 |
    | ^^^^
118 |     def _hash(self, item: Any) -> int:
119 |         """Hash item to 64-bit integer."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:125:1
    |
123 |             h = int(hashlib.sha256(str(item).encode()).hexdigest()[:16], 16)
124 |         return h & ((1 << 64) - 1)
125 |
    | ^^^^
126 |     def _leading_zeros(self, w: int, max_width: int) -> int:
127 |         """Count leading zeros in binary representation."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:131:1
    |
129 |             return max_width
130 |         return max_width - w.bit_length()
131 |
    | ^^^^
132 |     def _get_alpha(self, m: int) -> float:
133 |         """Get alpha constant for bias correction."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:142:1
    |
140 |         else:
141 |             return 0.7213 / (1 + 1.079 / m)
142 |
    | ^^^^
143 |     def __len__(self) -> int:
144 |         """Get estimated cardinality."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:146:1
    |
144 |         """Get estimated cardinality."""
145 |         return self.count()
146 |
    | ^^^^
147 |     def __add__(self, other: HyperLogLog) -> HyperLogLog:
148 |         """Merge using + operator."""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:155:1
    |
153 |     """
154 |     HyperLogLog++ with improved accuracy.
155 |
    | ^^^^
156 |     Improvements over standard HyperLogLog:
157 |     - 64-bit hash function
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:160:1
    |
158 |     - Sparse representation for small cardinalities
159 |     - Improved bias correction
160 |
    | ^^^^
161 |     Error: ~0.65% (vs ~0.8% for standard HLL)
162 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:163:1
    |
161 |     Error: ~0.65% (vs ~0.8% for standard HLL)
162 |     """
163 |
    | ^^^^
164 |     def __init__(self, precision: int = 14):
165 |         super().__init__(precision)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:169:1
    |
167 |         self.sparse_list: list[int] = []
168 |         self.sparse_threshold = 6 * self.m
169 |
    | ^^^^
170 |     def add(self, item: Any) -> None:
171 |         """Add item with sparse representation support."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:173:1
    |
171 |         """Add item with sparse representation support."""
172 |         h = self._hash(item)
173 |
    | ^^^^^^^^
174 |         if self.sparse_mode:
175 |             self._add_sparse(h)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:178:1
    |
176 |         else:
177 |             super().add(item)
178 |
    | ^^^^
179 |     def _add_sparse(self, h: int) -> None:
180 |         """Add to sparse representation."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:185:1
    |
183 |         w = h >> self.precision
184 |         leading_zeros = self._leading_zeros(w, 64 - self.precision) + 1
185 |
    | ^^^^^^^^
186 |         sparse_entry = (j << 6) | leading_zeros
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:187:1
    |
186 |         sparse_entry = (j << 6) | leading_zeros
187 |
    | ^^^^^^^^
188 |         if sparse_entry not in self.sparse_list:
189 |             self.sparse_list.append(sparse_entry)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:190:1
    |
188 |         if sparse_entry not in self.sparse_list:
189 |             self.sparse_list.append(sparse_entry)
190 |
    | ^^^^^^^^
191 |         # Convert to dense if threshold exceeded
192 |         if len(self.sparse_list) > self.sparse_threshold:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:194:1
    |
192 |         if len(self.sparse_list) > self.sparse_threshold:
193 |             self._convert_to_dense()
194 |
    | ^^^^
195 |     def _convert_to_dense(self) -> None:
196 |         """Convert from sparse to dense representation."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:201:1
    |
199 |             leading_zeros = entry & 0x3F
200 |             self.registers[j] = max(self.registers[j], leading_zeros)
201 |
    | ^^^^^^^^
202 |         self.sparse_list = []
203 |         self.sparse_mode = False
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:204:1
    |
202 |         self.sparse_list = []
203 |         self.sparse_mode = False
204 |
    | ^^^^
205 |     def count(self) -> int:
206 |         """Estimate cardinality with improved accuracy."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:209:1
    |
207 |         if self.sparse_mode:
208 |             return len(set(self.sparse_list))
209 |
    | ^^^^^^^^
210 |         return super().count()
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:216:1
    |
214 |     """
215 |     Count-Min Sketch for frequency estimation.
216 |
    | ^^^^
217 |     Probabilistic data structure for estimating frequency of items
218 |     in a stream with bounded error.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:219:1
    |
217 |     Probabilistic data structure for estimating frequency of items
218 |     in a stream with bounded error.
219 |
    | ^^^^
220 |     Space: O(log n)
221 |     Error:  with probability 1-
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:222:1
    |
220 |     Space: O(log n)
221 |     Error:  with probability 1-
222 |
    | ^^^^
223 |     Example:
224 |         >>> cms = CountMinSketch(epsilon=0.01, delta=0.01)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:228:1
    |
226 |         >>> frequency = cms.estimate("user_123")
227 |     """
228 |
    | ^^^^
229 |     def __init__(self, epsilon: float = 0.01, delta: float = 0.01):
230 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:232:1
    |
230 |         """
231 |         Initialize Count-Min Sketch.
232 |
    | ^^^^^^^^
233 |         Args:
234 |             epsilon: Error bound (smaller = more accurate)
    |
help: Remove whitespace from blank line

RUF046 Value being cast to `int` is already an integer
   --> app/analytics/infrastructure/stores/hyperloglog.py:237:22
    |
235 |             delta: Confidence (smaller = higher confidence)
236 |         """
237 |         self.width = int(math.ceil(math.e / epsilon))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 |         self.depth = int(math.ceil(math.log(1 / delta)))
239 |         self.table = [[0] * self.width for _ in range(self.depth)]
    |
help: Remove unnecessary `int` call

RUF046 Value being cast to `int` is already an integer
   --> app/analytics/infrastructure/stores/hyperloglog.py:238:22
    |
236 |         """
237 |         self.width = int(math.ceil(math.e / epsilon))
238 |         self.depth = int(math.ceil(math.log(1 / delta)))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
239 |         self.table = [[0] * self.width for _ in range(self.depth)]
240 |         self.hash_seeds = [i * 0x9e3779b9 for i in range(self.depth)]
    |
help: Remove unnecessary `int` call

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:241:1
    |
239 |         self.table = [[0] * self.width for _ in range(self.depth)]
240 |         self.hash_seeds = [i * 0x9e3779b9 for i in range(self.depth)]
241 |
    | ^^^^
242 |     def add(self, item: Any, count: int = 1) -> None:
243 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:245:1
    |
243 |         """
244 |         Add item with count.
245 |
    | ^^^^^^^^
246 |         Args:
247 |             item: Item to add
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:253:1
    |
251 |             j = self._hash(item, self.hash_seeds[i]) % self.width
252 |             self.table[i][j] += count
253 |
    | ^^^^
254 |     def estimate(self, item: Any) -> int:
255 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:257:1
    |
255 |         """
256 |         Estimate frequency of item.
257 |
    | ^^^^^^^^
258 |         Args:
259 |             item: Item to estimate
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:260:1
    |
258 |         Args:
259 |             item: Item to estimate
260 |
    | ^^^^^^^^^^^^
261 |         Returns:
262 |             Estimated frequency (upper bound)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:268:1
    |
266 |             for i in range(self.depth)
267 |         )
268 |
    | ^^^^
269 |     def _hash(self, item: Any, seed: int) -> int:
270 |         """Hash item with seed."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:273:1
    |
271 |         h = hashlib.sha256(f"{item}{seed}".encode()).digest()
272 |         return int.from_bytes(h[:8], 'big')
273 |
    | ^^^^
274 |     def merge(self, other: CountMinSketch) -> CountMinSketch:
275 |         """Merge with another Count-Min Sketch."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:278:1
    |
276 |         if self.width != other.width or self.depth != other.depth:
277 |             raise ValueError("Cannot merge sketches with different dimensions")
278 |
    | ^^^^^^^^
279 |         merged = CountMinSketch.__new__(CountMinSketch)
280 |         merged.width = self.width
    |
help: Remove whitespace from blank line

B905 `zip()` without an explicit `strict=` parameter
   --> app/analytics/infrastructure/stores/hyperloglog.py:284:32
    |
282 |         merged.hash_seeds = self.hash_seeds
283 |         merged.table = [
284 |             [a + b for a, b in zip(row_a, row_b)]
    |                                ^^^^^^^^^^^^^^^^^
285 |             for row_a, row_b in zip(self.table, other.table)
286 |         ]
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> app/analytics/infrastructure/stores/hyperloglog.py:285:33
    |
283 |         merged.table = [
284 |             [a + b for a, b in zip(row_a, row_b)]
285 |             for row_a, row_b in zip(self.table, other.table)
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
286 |         ]
287 |         return merged
    |
help: Add explicit value for parameter `strict=`

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:293:1
    |
291 |     """
292 |     T-Digest for streaming percentile estimation.
293 |
    | ^^^^
294 |     Provides accurate percentile estimates with bounded memory,
295 |     especially accurate for extreme percentiles (p99, p99.9).
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:296:1
    |
294 |     Provides accurate percentile estimates with bounded memory,
295 |     especially accurate for extreme percentiles (p99, p99.9).
296 |
    | ^^^^
297 |     Based on "Computing Extremely Accurate Quantiles Using t-Digests"
298 |     by Ted Dunning.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:299:1
    |
297 |     Based on "Computing Extremely Accurate Quantiles Using t-Digests"
298 |     by Ted Dunning.
299 |
    | ^^^^
300 |     Example:
301 |         >>> td = TDigest(compression=100)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:306:1
    |
304 |         >>> p99 = td.quantile(0.99)
305 |     """
306 |
    | ^^^^
307 |     def __init__(self, compression: int = 100):
308 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:310:1
    |
308 |         """
309 |         Initialize T-Digest.
310 |
    | ^^^^^^^^
311 |         Args:
312 |             compression: Compression factor (higher = more accurate)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:319:1
    |
317 |         self.min_value = float('inf')
318 |         self.max_value = float('-inf')
319 |
    | ^^^^
320 |     def add(self, value: float, weight: float = 1.0) -> None:
321 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:323:1
    |
321 |         """
322 |         Add value to digest.
323 |
    | ^^^^^^^^
324 |         Args:
325 |             value: Value to add
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:332:1
    |
330 |         self.min_value = min(self.min_value, value)
331 |         self.max_value = max(self.max_value, value)
332 |
    | ^^^^^^^^
333 |         # Compress if too many centroids
334 |         if len(self.centroids) > self.compression * 10:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:336:1
    |
334 |         if len(self.centroids) > self.compression * 10:
335 |             self._compress()
336 |
    | ^^^^
337 |     def quantile(self, q: float) -> float:
338 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:340:1
    |
338 |         """
339 |         Estimate quantile.
340 |
    | ^^^^^^^^
341 |         Args:
342 |             q: Quantile to estimate (0.0 to 1.0)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:343:1
    |
341 |         Args:
342 |             q: Quantile to estimate (0.0 to 1.0)
343 |
    | ^^^^^^^^^^^^
344 |         Returns:
345 |             Estimated value at quantile
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:349:1
    |
347 |         if not self.centroids:
348 |             return 0.0
349 |
    | ^^^^^^^^
350 |         if q <= 0:
351 |             return self.min_value
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:354:1
    |
352 |         if q >= 1:
353 |             return self.max_value
354 |
    | ^^^^^^^^
355 |         self._compress()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:356:1
    |
355 |         self._compress()
356 |
    | ^^^^^^^^
357 |         target = q * self.count
358 |         cumulative = 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:359:1
    |
357 |         target = q * self.count
358 |         cumulative = 0.0
359 |
    | ^^^^^^^^
360 |         sorted_centroids = sorted(self.centroids, key=lambda c: c[0])
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:361:1
    |
360 |         sorted_centroids = sorted(self.centroids, key=lambda c: c[0])
361 |
    | ^^^^^^^^
362 |         for i, (mean, weight) in enumerate(sorted_centroids):
363 |             cumulative += weight
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:364:1
    |
362 |         for i, (mean, weight) in enumerate(sorted_centroids):
363 |             cumulative += weight
364 |
    | ^^^^^^^^^^^^
365 |             if cumulative >= target:
366 |                 if i == 0:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:368:1
    |
366 |                 if i == 0:
367 |                     return mean
368 |
    | ^^^^^^^^^^^^^^^^
369 |                 # Interpolate between centroids
370 |                 prev_mean, prev_weight = sorted_centroids[i - 1]
    |
help: Remove whitespace from blank line

RUF059 Unpacked variable `prev_weight` is never used
   --> app/analytics/infrastructure/stores/hyperloglog.py:370:28
    |
369 |                 # Interpolate between centroids
370 |                 prev_mean, prev_weight = sorted_centroids[i - 1]
    |                            ^^^^^^^^^^^
371 |                 prev_cumulative = cumulative - weight
    |
help: Prefix it with an underscore or any other dummy variable pattern

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:372:1
    |
370 |                 prev_mean, prev_weight = sorted_centroids[i - 1]
371 |                 prev_cumulative = cumulative - weight
372 |
    | ^^^^^^^^^^^^^^^^
373 |                 fraction = (target - prev_cumulative) / weight
374 |                 return prev_mean + fraction * (mean - prev_mean)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:375:1
    |
373 |                 fraction = (target - prev_cumulative) / weight
374 |                 return prev_mean + fraction * (mean - prev_mean)
375 |
    | ^^^^^^^^
376 |         return sorted_centroids[-1][0]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:377:1
    |
376 |         return sorted_centroids[-1][0]
377 |
    | ^^^^
378 |     def _compress(self) -> None:
379 |         """Compress centroids to maintain bounded memory."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:382:1
    |
380 |         if len(self.centroids) <= self.compression:
381 |             return
382 |
    | ^^^^^^^^
383 |         sorted_centroids = sorted(self.centroids, key=lambda c: c[0])
384 |         compressed = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:385:1
    |
383 |         sorted_centroids = sorted(self.centroids, key=lambda c: c[0])
384 |         compressed = []
385 |
    | ^^^^^^^^
386 |         current_mean, current_weight = sorted_centroids[0]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:387:1
    |
386 |         current_mean, current_weight = sorted_centroids[0]
387 |
    | ^^^^^^^^
388 |         for mean, weight in sorted_centroids[1:]:
389 |             if len(compressed) < self.compression:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:397:1
    |
395 |                 compressed.append((current_mean, current_weight))
396 |                 current_mean, current_weight = mean, weight
397 |
    | ^^^^^^^^
398 |         compressed.append((current_mean, current_weight))
399 |         self.centroids = compressed
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:400:1
    |
398 |         compressed.append((current_mean, current_weight))
399 |         self.centroids = compressed
400 |
    | ^^^^
401 |     def percentile(self, p: float) -> float:
402 |         """Estimate percentile (convenience method)."""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/analytics/infrastructure/stores/hyperloglog.py:404:1
    |
402 |         """Estimate percentile (convenience method)."""
403 |         return self.quantile(p / 100.0)
404 |
    | ^^^^
405 |     def merge(self, other: TDigest) -> TDigest:
406 |         """Merge with another T-Digest."""
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/analytics/infrastructure/stores/hyperloglog.py:416:11
    |
416 |   __all__ = [
    |  ___________^
417 | |     'HyperLogLog',
418 | |     'HyperLogLogPlusPlus',
419 | |     'CountMinSketch',
420 | |     'TDigest',
421 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

W293 [*] Blank line contains whitespace
  --> app/api/routers/crud.py:46:1
   |
44 |     """Get a single user by ID."""
45 |     result = await service.get_user_by_id(user_id)
46 |
   | ^^^^
47 |     if result["status"] == "error":
48 |         raise HTTPException(status_code=404, detail=result["message"])
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/api/routers/crud.py:49:1
   |
47 |     if result["status"] == "error":
48 |         raise HTTPException(status_code=404, detail=result["message"])
49 |
   | ^^^^
50 |     return result
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/api/routers/crud.py:69:1
   |
67 |     """Get a single mission by ID."""
68 |     result = await service.get_mission_by_id(mission_id)
69 |
   | ^^^^
70 |     if result["status"] == "error":
71 |         raise HTTPException(status_code=404, detail=result["message"])
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/api/routers/crud.py:72:1
   |
70 |     if result["status"] == "error":
71 |         raise HTTPException(status_code=404, detail=result["message"])
72 |
   | ^^^^
73 |     return result
   |
help: Remove whitespace from blank line

F401 [*] `uuid` imported but unused
 --> app/api/routers/intelligent_platform.py:1:8
  |
1 | import uuid
  |        ^^^^
2 | from datetime import UTC, datetime
3 | from typing import Any
  |
help: Remove unused import: `uuid`

F401 [*] `datetime.UTC` imported but unused
 --> app/api/routers/intelligent_platform.py:2:22
  |
1 | import uuid
2 | from datetime import UTC, datetime
  |                      ^^^
3 | from typing import Any
  |
help: Remove unused import: `datetime.UTC`

I001 [*] Import block is un-sorted or un-formatted
  --> app/cli_handlers/genesis_cli.py:6:1
   |
 4 |   Connects the simple agent to the command line.
 5 |   """
 6 | / import click
 7 | | import logging
 8 | | import datetime
 9 | | from app.genesis.core import GenesisAgent
10 | | from app.core.cli_logging import setup_cli_logger
11 | | from app.genesis.tools.code_explorer import grep_code, read_file_segment, list_files, identify_hotspots
   | |_______________________________________________________________________________________________________^
12 |
13 |   logger = logging.getLogger("genesis.cli")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/ai_gateway.py:9:1
   |
 7 |   """
 8 |
 9 | / import logging
10 | | from typing import Protocol, runtime_checkable, Any
11 | |
12 | | # --- Import Atomic Modules ---
13 | | from app.core.gateway.exceptions import (
14 | |     AIError,
15 | |     AIProviderError,
16 | |     AICircuitOpenError,
17 | |     AIConnectionError,
18 | |     AIAllModelsExhaustedError,
19 | |     AIRateLimitError,
20 | | )
21 | | from app.core.gateway.circuit_breaker import CircuitBreaker, CircuitState
22 | | from app.core.gateway.node import NeuralNode
23 | | from app.core.gateway.connection import ConnectionManager
24 | | from app.core.gateway.mesh import NeuralRoutingMesh, AIClient, get_ai_client
25 | | from app.core.superhuman_performance_optimizer import get_performance_optimizer
   | |_______________________________________________________________________________^
26 |
27 |   # Re-export key components for backward compatibility
   |
help: Organize imports

F401 [*] `typing.Protocol` imported but unused
  --> app/core/ai_gateway.py:10:20
   |
 9 | import logging
10 | from typing import Protocol, runtime_checkable, Any
   |                    ^^^^^^^^
11 |
12 | # --- Import Atomic Modules ---
   |
help: Remove unused import

F401 [*] `typing.runtime_checkable` imported but unused
  --> app/core/ai_gateway.py:10:30
   |
 9 | import logging
10 | from typing import Protocol, runtime_checkable, Any
   |                              ^^^^^^^^^^^^^^^^^
11 |
12 | # --- Import Atomic Modules ---
   |
help: Remove unused import

RUF022 [*] `__all__` is not sorted
  --> app/core/ai_gateway.py:28:11
   |
27 |   # Re-export key components for backward compatibility
28 |   __all__ = [
   |  ___________^
29 | |     "AIError",
30 | |     "AIProviderError",
31 | |     "AICircuitOpenError",
32 | |     "AIConnectionError",
33 | |     "AIAllModelsExhaustedError",
34 | |     "AIRateLimitError",
35 | |     "CircuitBreaker",
36 | |     "CircuitState",
37 | |     "NeuralNode",
38 | |     "ConnectionManager",
39 | |     "NeuralRoutingMesh",
40 | |     "AIClient",
41 | |     "get_ai_client",
42 | |     "get_performance_report",
43 | |     "get_recommended_model",
44 | | ]
   | |_^
45 |
46 |   logger = logging.getLogger(__name__)
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/engine/factory.py:1:1
   |
 1 | / import copy
 2 | | import logging
 3 | | import os
 4 | | from typing import Any
 5 | |
 6 | | from sqlalchemy import create_engine, pool
 7 | | from sqlalchemy.engine import Engine
 8 | | from sqlalchemy.ext.asyncio import AsyncEngine, create_async_engine
 9 | |
10 | | from app.core.engine.exceptions import FatalEngineError
11 | | from app.core.engine.naming import QuantumStatementNameGenerator
12 | | from app.core.engine.pooler import AdaptivePoolerDetector
13 | | from app.core.engine.types import DatabaseType, PoolerType
14 | | from app.core.engine.url_tools import DatabaseURLSanitizer
15 | | from app.core.engine.diagnostics import EngineDiagnostics
   | |_________________________________________________________^
16 |
17 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `app.core.engine.diagnostics.EngineDiagnostics` imported but unused
  --> app/core/engine/factory.py:15:41
   |
13 | from app.core.engine.types import DatabaseType, PoolerType
14 | from app.core.engine.url_tools import DatabaseURLSanitizer
15 | from app.core.engine.diagnostics import EngineDiagnostics
   |                                         ^^^^^^^^^^^^^^^^^
16 |
17 | logger = logging.getLogger(__name__)
   |
help: Remove unused import: `app.core.engine.diagnostics.EngineDiagnostics`

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/engine_factory.py:26:1
   |
25 |   # Re-exporting everything from the decomposed package to maintain backward compatibility
26 | / from app.core.engine.diagnostics import EngineDiagnostics
27 | | from app.core.engine.exceptions import FatalEngineError
28 | | from app.core.engine.factory import (
29 | |     create_unified_async_engine,
30 | |     create_unified_sync_engine,
31 | | )
32 | | from app.core.engine.naming import QuantumStatementNameGenerator
33 | | from app.core.engine.pooler import AdaptivePoolerDetector, POOLER_SIGNATURES
34 | | from app.core.engine.types import DatabaseType, PoolerType, PoolerSignature
35 | | from app.core.engine.url_tools import DatabaseURLSanitizer
36 | |
37 | | # Internal helpers are needed for some tests that import them (even though they shouldn't)
38 | | from app.core.engine.factory import (
39 | |     _configure_postgres_engine,
40 | |     _configure_sqlite_engine,
41 | |     _detect_database_type,
42 | |     _validate_postgres_security,
43 | | )
   | |_^
44 |
45 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/core/engine_factory.py:45:11
   |
43 |   )
44 |
45 |   __all__ = [
   |  ___________^
46 | |     "AdaptivePoolerDetector",
47 | |     "DatabaseType",
48 | |     "DatabaseURLSanitizer",
49 | |     "EngineDiagnostics",
50 | |     "FatalEngineError",
51 | |     "PoolerType",
52 | |     "PoolerSignature",
53 | |     "POOLER_SIGNATURES",
54 | |     "QuantumStatementNameGenerator",
55 | |     "create_unified_async_engine",
56 | |     "create_unified_sync_engine",
57 | |     "_configure_postgres_engine",
58 | |     "_configure_sqlite_engine",
59 | |     "_detect_database_type",
60 | |     "_validate_postgres_security",
61 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/gateway/circuit_breaker.py:6:1
   |
 4 |   """
 5 |
 6 | / import time
 7 | | import logging
 8 | | from enum import Enum
   | |_____________________^
 9 |
10 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/core/gateway/connection.py:6:1
  |
4 |   """
5 |
6 | / import httpx
7 | | import logging
  | |______________^
8 |
9 |   logger = logging.getLogger(__name__)
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/gateway/mesh.py:6:1
   |
 4 |   """
 5 |
 6 | / import asyncio
 7 | | import hashlib
 8 | | import json
 9 | | import logging
10 | | import random
11 | | import time
12 | | from collections.abc import AsyncGenerator
13 | | from typing import Protocol, runtime_checkable
14 | |
15 | | import httpx
16 | |
17 | | # Import new atomic modules
18 | | from app.core.gateway.exceptions import (
19 | |     AIAllModelsExhaustedError,
20 | |     AIConnectionError,
21 | |     AIRateLimitError,
22 | | )
23 | | from app.core.gateway.circuit_breaker import CircuitBreaker
24 | | from app.core.gateway.node import NeuralNode
25 | | from app.core.gateway.connection import ConnectionManager, BASE_TIMEOUT
26 | |
27 | | # Config imports
28 | | from app.config.ai_models import get_ai_config
29 | | from app.core.cognitive_cache import get_cognitive_engine
30 | | from app.core.math.omni_router import get_omni_router
31 | | from app.core.superhuman_performance_optimizer import get_performance_optimizer
   | |_______________________________________________________________________________^
32 |
33 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `random` imported but unused
  --> app/core/gateway/mesh.py:10:8
   |
 8 | import json
 9 | import logging
10 | import random
   |        ^^^^^^
11 | import time
12 | from collections.abc import AsyncGenerator
   |
help: Remove unused import: `random`

RUF010 [*] Use explicit conversion flag
   --> app/core/gateway/mesh.py:265:51
    |
263 |                 node.circuit_breaker.record_failure()
264 |                 self._record_metrics(node, prompt, 0, False)
265 |                 errors.append(f"{node.model_id}: {str(e)}")
    |                                                   ^^^^^^
266 |                 logger.warning(f"Node {node.model_id} failed: {e}")
267 |                 continue
    |
help: Replace with conversion flag

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/gateway/node.py:6:1
   |
 4 |   """
 5 |
 6 | / import asyncio
 7 | | from dataclasses import dataclass, field
 8 | | from app.core.gateway.circuit_breaker import CircuitBreaker
   | |___________________________________________________________^
 9 |
10 |   @dataclass
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/interfaces/__init__.py:12:1
   |
11 |   # Legacy interfaces (kept for backward compatibility)
12 | / from .planner_interface import PlannerInterface
13 | | from .repository_interface import RepositoryInterface
14 | | from .service_interface import ServiceInterface
15 | | from .strategy_interface import StrategyInterface
16 | |
17 | | # New simplified interfaces
18 | | from .base import ILifecycle, IPlugin, IService
19 | | from .data import ICommand, IQuery, IRepository
20 | | from .processing import IHandler, IProcessor, IValidator
   | |________________________________________________________^
21 |
22 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/core/interfaces/__init__.py:22:11
   |
20 |   from .processing import IHandler, IProcessor, IValidator
21 |
22 |   __all__ = [
   |  ___________^
23 | |     # Legacy (backward compatibility)
24 | |     "PlannerInterface",
25 | |     "RepositoryInterface",
26 | |     "ServiceInterface",
27 | |     "StrategyInterface",
28 | |     # New simplified interfaces
29 | |     "ILifecycle",
30 | |     "IPlugin",
31 | |     "IService",
32 | |     "ICommand",
33 | |     "IQuery",
34 | |     "IRepository",
35 | |     "IHandler",
36 | |     "IProcessor",
37 | |     "IValidator",
38 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/core/interfaces/base.py:10:1
   |
 9 | from abc import ABC, abstractmethod
10 | from typing import Any, Dict, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F401 [*] `typing.Optional` imported but unused
  --> app/core/interfaces/base.py:10:31
   |
 9 | from abc import ABC, abstractmethod
10 | from typing import Any, Dict, Optional
   |                               ^^^^^^^^
   |
help: Remove unused import: `typing.Optional`

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:15:1
   |
13 | class ILifecycle(ABC):
14 |     """   - Lifecycle Interface"""
15 |
   | ^^^^
16 |     @abstractmethod
17 |     async def initialize(self) -> None:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:20:1
   |
18 |         """Initialize the component"""
19 |         pass
20 |
   | ^^^^
21 |     @abstractmethod
22 |     async def shutdown(self) -> None:
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/core/interfaces/base.py:31:1
   |
29 |       
30 |     Base Service Interface
31 |
   | ^^^^
32 |     All services MUST implement this interface.
33 |     :    
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:35:1
   |
33 |     :    
34 |     """
35 |
   | ^^^^
36 |     @property
37 |     @abstractmethod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:41:1
   |
39 |         """Service unique name"""
40 |         pass
41 |
   | ^^^^
42 |     @property
43 |     @abstractmethod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:47:1
   |
45 |         """Service version"""
46 |         pass
47 |
   | ^^^^
48 |     @abstractmethod
49 |     async def health_check(self) -> Dict[str, Any]:
   |
help: Remove whitespace from blank line

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/interfaces/base.py:49:37
   |
48 |     @abstractmethod
49 |     async def health_check(self) -> Dict[str, Any]:
   |                                     ^^^^
50 |         """Check service health"""
51 |         pass
   |
help: Replace with `dict`

W293 Blank line contains whitespace
  --> app/core/interfaces/base.py:58:1
   |
56 |      
57 |     Plugin Interface
58 |
   | ^^^^
59 |     Plugins extend the system without modifying core code.
60 |     """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:61:1
   |
59 |     Plugins extend the system without modifying core code.
60 |     """
61 |
   | ^^^^
62 |     @property
63 |     @abstractmethod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:67:1
   |
65 |         """Type of plugin (service, processor, etc.)"""
66 |         pass
67 |
   | ^^^^
68 |     @property
69 |     @abstractmethod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/base.py:73:1
   |
71 |         """List of required dependencies"""
72 |         pass
73 |
   | ^^^^
74 |     @abstractmethod
75 |     def configure(self, config: Dict[str, Any]) -> None:
   |
help: Remove whitespace from blank line

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/interfaces/base.py:75:33
   |
74 |     @abstractmethod
75 |     def configure(self, config: Dict[str, Any]) -> None:
   |                                 ^^^^
76 |         """Configure the plugin"""
77 |         pass
   |
help: Replace with `dict`

F401 [*] `typing.Any` imported but unused
  --> app/core/interfaces/data.py:9:20
   |
 8 | from abc import ABC, abstractmethod
 9 | from typing import Any, Generic, Optional, TypeVar
   |                    ^^^
10 |
11 | T = TypeVar('T')
   |
help: Remove unused import: `typing.Any`

UP046 Generic class `IRepository` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/data.py:15:24
   |
15 | class IRepository(ABC, Generic[T, ID]):
   |                        ^^^^^^^^^^^^^^
16 |     """
17 |      
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/data.py:20:1
   |
18 |     Repository Interface - Generic pattern
19 |     """
20 |
   | ^^^^
21 |     @abstractmethod
22 |     async def get(self, id: ID) -> Optional[T]:
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
  --> app/core/interfaces/data.py:22:36
   |
21 |     @abstractmethod
22 |     async def get(self, id: ID) -> Optional[T]:
   |                                    ^^^^^^^^^^^
23 |         """Get entity by ID"""
24 |         pass
   |
help: Convert to `X | None`

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/data.py:25:1
   |
23 |         """Get entity by ID"""
24 |         pass
25 |
   | ^^^^
26 |     @abstractmethod
27 |     async def save(self, entity: T) -> T:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/data.py:30:1
   |
28 |         """Save entity"""
29 |         pass
30 |
   | ^^^^
31 |     @abstractmethod
32 |     async def delete(self, id: ID) -> bool:
   |
help: Remove whitespace from blank line

UP046 Generic class `IQuery` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/data.py:37:19
   |
37 | class IQuery(ABC, Generic[T]):
   |                   ^^^^^^^^^^
38 |     """
39 |       - Query Interface
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/data.py:42:1
   |
40 |     CQRS Pattern - Read side
41 |     """
42 |
   | ^^^^
43 |     @abstractmethod
44 |     async def execute(self) -> T:
   |
help: Remove whitespace from blank line

UP046 Generic class `ICommand` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/data.py:49:21
   |
49 | class ICommand(ABC, Generic[T]):
   |                     ^^^^^^^^^^
50 |     """
51 |       - Command Interface
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/data.py:54:1
   |
52 |     CQRS Pattern - Write side
53 |     """
54 |
   | ^^^^
55 |     @abstractmethod
56 |     async def execute(self) -> T:
   |
help: Remove whitespace from blank line

F401 [*] `typing.Any` imported but unused
  --> app/core/interfaces/processing.py:9:20
   |
 8 | from abc import ABC, abstractmethod
 9 | from typing import Any, Generic, TypeVar
   |                    ^^^
10 |
11 | TInput = TypeVar('TInput')
   |
help: Remove unused import: `typing.Any`

UP046 Generic class `IProcessor` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/processing.py:15:23
   |
15 | class IProcessor(ABC, Generic[TInput, TOutput]):
   |                       ^^^^^^^^^^^^^^^^^^^^^^^^
16 |     """
17 |      
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/processing.py:20:1
   |
18 |     Processor Interface - Generic pattern
19 |     """
20 |
   | ^^^^
21 |     @abstractmethod
22 |     async def process(self, input: TInput) -> TOutput:
   |
help: Remove whitespace from blank line

UP046 Generic class `IHandler` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/processing.py:27:21
   |
27 | class IHandler(ABC, Generic[TInput, TOutput]):
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^
28 |     """
29 |        Chain of Responsibility
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/processing.py:32:1
   |
30 |     Handler Interface - Can be chained
31 |     """
32 |
   | ^^^^
33 |     @abstractmethod
34 |     async def handle(self, input: TInput) -> TOutput:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/processing.py:37:1
   |
35 |         """Handle input"""
36 |         pass
37 |
   | ^^^^
38 |     @abstractmethod
39 |     def set_next(self, handler: 'IHandler') -> 'IHandler':
   |
help: Remove whitespace from blank line

UP046 Generic class `IValidator` uses `Generic` subclass instead of type parameters
  --> app/core/interfaces/processing.py:44:23
   |
44 | class IValidator(ABC, Generic[TInput]):
   |                       ^^^^^^^^^^^^^^^
45 |     """
46 |      
   |
help: Use type parameters

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/processing.py:49:1
   |
47 |     Validator Interface
48 |     """
49 |
   | ^^^^
50 |     @abstractmethod
51 |     async def validate(self, input: TInput) -> bool:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/interfaces/processing.py:54:1
   |
52 |         """Validate input"""
53 |         pass
54 |
   | ^^^^
55 |     @abstractmethod
56 |     def get_errors(self) -> list[str]:
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/patterns/strategy.py:7:1
   |
 5 |   """
 6 |
 7 | / from abc import ABC, abstractmethod
 8 | | from typing import TypeVar
 9 | | import inspect
   | |______________^
10 |
11 |   T = TypeVar("T")
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/core/registry/__init__.py:9:1
   |
 7 |   """
 8 |
 9 | / from app.core.registry.plugin_registry import PluginRegistry
10 | | from app.core.registry.plugin_loader import PluginLoader
11 | | from app.core.registry.plugin_discovery import discover_plugins
   | |_______________________________________________________________^
12 |
13 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/core/registry/__init__.py:13:11
   |
11 |   from app.core.registry.plugin_discovery import discover_plugins
12 |
13 |   __all__ = [
   |  ___________^
14 | |     "PluginRegistry",
15 | |     "PluginLoader",
16 | |     "discover_plugins",
17 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/core/registry/plugin_discovery.py:15:1
   |
13 | import pkgutil
14 | from pathlib import Path
15 | from typing import Any, Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 | from app.core.interfaces import IPlugin
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> app/core/registry/plugin_discovery.py:15:1
   |
13 | import pkgutil
14 | from pathlib import Path
15 | from typing import Any, Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 |
17 | from app.core.interfaces import IPlugin
   |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/core/registry/plugin_discovery.py:26:6
   |
24 |     plugin_dir: str = "app.plugins",
25 |     auto_register: bool = True
26 | ) -> List[IPlugin]:
   |      ^^^^
27 |     """
28 |       
   |
help: Replace with `list`

W293 Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:30:1
   |
28 |       
29 |     Discover all plugins in directory
30 |
   | ^^^^
31 |     Convention: Each plugin module must have a 'plugin' variable
32 |     that contains the plugin instance.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:33:1
   |
31 |     Convention: Each plugin module must have a 'plugin' variable
32 |     that contains the plugin instance.
33 |
   | ^^^^
34 |     Example:
35 |         app/plugins/chat/plugin.py:
   |
help: Remove whitespace from blank line

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/core/registry/plugin_discovery.py:39:17
   |
37 |             plugin = ChatPlugin()
38 |     """
39 |     discovered: List[IPlugin] = []
   |                 ^^^^
40 |
41 |     try:
   |
help: Replace with `list`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:40:1
   |
38 |     """
39 |     discovered: List[IPlugin] = []
40 |
   | ^^^^
41 |     try:
42 |         # Import plugin package
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:45:1
   |
43 |         package = importlib.import_module(plugin_dir)
44 |         package_path = Path(package.__file__).parent
45 |
   | ^^^^^^^^
46 |         # Iterate through all submodules
47 |         for _, module_name, is_pkg in pkgutil.iter_modules(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:52:1
   |
50 |             if not is_pkg:
51 |                 continue
52 |
   | ^^^^^^^^^^^^
53 |             try:
54 |                 # Import plugin module
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:59:1
   |
57 |                     f"{full_name}.plugin"
58 |                 )
59 |
   | ^^^^^^^^^^^^^^^^
60 |                 # Get plugin instance
61 |                 if hasattr(plugin_module, 'plugin'):
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:63:1
   |
61 |                 if hasattr(plugin_module, 'plugin'):
62 |                     plugin = plugin_module.plugin
63 |
   | ^^^^^^^^^^^^^^^^^^^^
64 |                     if isinstance(plugin, IPlugin):
65 |                         discovered.append(plugin)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:66:1
   |
64 |                     if isinstance(plugin, IPlugin):
65 |                         discovered.append(plugin)
66 |
   | ^^^^^^^^^^^^^^^^^^^^^^^^
67 |                         # Auto-register
68 |                         if auto_register:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:79:1
   |
77 |                             f"but it's not IPlugin"
78 |                         )
79 |
   | ^^^^^^^^^^^^^^^^^^^^^^^^
80 |             except ImportError as e:
81 |                 logger.debug(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:88:1
   |
86 |                     f"Error loading plugin {module_name}: {e}"
87 |                 )
88 |
   | ^^^^
89 |     except ImportError:
90 |         logger.warning(f"Plugin directory '{plugin_dir}' not found")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_discovery.py:91:1
   |
89 |     except ImportError:
90 |         logger.warning(f"Plugin directory '{plugin_dir}' not found")
91 |
   | ^^^^
92 |     return discovered
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
  --> app/core/registry/plugin_discovery.py:97:13
   |
95 | def discover_and_configure(
96 |     plugin_dir: str = "app.plugins",
97 |     config: Optional[Dict[str, Dict[str, Any]]] = None
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 | ) -> List[IPlugin]:
99 |     """
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_discovery.py:97:22
   |
95 | def discover_and_configure(
96 |     plugin_dir: str = "app.plugins",
97 |     config: Optional[Dict[str, Dict[str, Any]]] = None
   |                      ^^^^
98 | ) -> List[IPlugin]:
99 |     """
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_discovery.py:97:32
   |
95 | def discover_and_configure(
96 |     plugin_dir: str = "app.plugins",
97 |     config: Optional[Dict[str, Dict[str, Any]]] = None
   |                                ^^^^
98 | ) -> List[IPlugin]:
99 |     """
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/core/registry/plugin_discovery.py:98:6
    |
 96 |     plugin_dir: str = "app.plugins",
 97 |     config: Optional[Dict[str, Dict[str, Any]]] = None
 98 | ) -> List[IPlugin]:
    |      ^^^^
 99 |     """
100 |       
    |
help: Replace with `list`

W293 [*] Blank line contains whitespace
   --> app/core/registry/plugin_discovery.py:104:1
    |
102 |     """
103 |     plugins = discover_plugins(plugin_dir, auto_register=True)
104 |
    | ^^^^
105 |     if config:
106 |         for plugin in plugins:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/core/registry/plugin_discovery.py:110:1
    |
108 |             if plugin_config:
109 |                 plugin.configure(plugin_config)
110 |
    | ^^^^
111 |     return plugins
    |
help: Remove whitespace from blank line

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/core/registry/plugin_loader.py:12:1
   |
11 | import logging
12 | from typing import Any, Dict, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | from app.core.interfaces import IPlugin
   |

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:25:1
   |
23 |     Plugin Loader with dependency resolution
24 |     """
25 |
   | ^^^^
26 |     def __init__(self):
27 |         self._loaded: set[str] = set()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:28:1
   |
26 |     def __init__(self):
27 |         self._loaded: set[str] = set()
28 |
   | ^^^^
29 |     async def load(
30 |         self,
   |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
  --> app/core/registry/plugin_loader.py:30:14
   |
29 |     async def load(
30 |         self,
   |              ^
31 |         plugin: IPlugin,
32 |         config: Optional[Dict[str, Any]] = None
   |
help: Remove trailing whitespace

W291 [*] Trailing whitespace
  --> app/core/registry/plugin_loader.py:31:25
   |
29 |     async def load(
30 |         self,
31 |         plugin: IPlugin,
   |                         ^
32 |         config: Optional[Dict[str, Any]] = None
33 |     ) -> bool:
   |
help: Remove trailing whitespace

UP045 [*] Use `X | None` for type annotations
  --> app/core/registry/plugin_loader.py:32:17
   |
30 |         self,
31 |         plugin: IPlugin,
32 |         config: Optional[Dict[str, Any]] = None
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^
33 |     ) -> bool:
34 |         """
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_loader.py:32:26
   |
30 |         self,
31 |         plugin: IPlugin,
32 |         config: Optional[Dict[str, Any]] = None
   |                          ^^^^
33 |     ) -> bool:
34 |         """
   |
help: Replace with `dict`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:39:1
   |
37 |         """
38 |         name = plugin.name
39 |
   | ^^^^^^^^
40 |         # Already loaded
41 |         if name in self._loaded:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:44:1
   |
42 |             logger.debug(f"Plugin '{name}' already loaded")
43 |             return True
44 |
   | ^^^^^^^^
45 |         # Load dependencies first
46 |         deps = plugin.dependencies
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:54:1
   |
52 |                 )
53 |                 return False
54 |
   | ^^^^^^^^^^^^
55 |             # Recursive load
56 |             if not await self.load(dep_plugin):
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:58:1
   |
56 |             if not await self.load(dep_plugin):
57 |                 return False
58 |
   | ^^^^^^^^
59 |         # Configure plugin
60 |         if config:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:62:1
   |
60 |         if config:
61 |             plugin.configure(config)
62 |
   | ^^^^^^^^
63 |         # Initialize plugin
64 |         try:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:72:1
   |
70 |             logger.error(f"Failed to load plugin '{name}': {e}")
71 |             return False
72 |
   | ^^^^
73 |     async def unload(self, plugin: IPlugin) -> bool:
74 |         """Unload plugin"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:76:1
   |
74 |         """Unload plugin"""
75 |         name = plugin.name
76 |
   | ^^^^^^^^
77 |         if name not in self._loaded:
78 |             return False
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:79:1
   |
77 |         if name not in self._loaded:
78 |             return False
79 |
   | ^^^^^^^^
80 |         try:
81 |             await plugin.shutdown()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:88:1
   |
86 |             logger.error(f"Failed to unload plugin '{name}': {e}")
87 |             return False
88 |
   | ^^^^
89 |     def is_loaded(self, name: str) -> bool:
90 |         """Check if plugin is loaded"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_loader.py:92:1
   |
90 |         """Check if plugin is loaded"""
91 |         return name in self._loaded
92 |
   | ^^^^
93 |     def get_loaded(self) -> set[str]:
94 |         """Get all loaded plugin names"""
   |
help: Remove whitespace from blank line

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/core/registry/plugin_registry.py:11:1
   |
 9 | """
10 |
11 | from typing import Any, Dict, Optional, Type
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 |
13 | from app.core.interfaces import IPlugin
   |

UP035 `typing.Type` is deprecated, use `type` instead
  --> app/core/registry/plugin_registry.py:11:1
   |
 9 | """
10 |
11 | from typing import Any, Dict, Optional, Type
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
12 |
13 | from app.core.interfaces import IPlugin
   |

F401 [*] `typing.Type` imported but unused
  --> app/core/registry/plugin_registry.py:11:41
   |
 9 | """
10 |
11 | from typing import Any, Dict, Optional, Type
   |                                         ^^^^
12 |
13 | from app.core.interfaces import IPlugin
   |
help: Remove unused import: `typing.Type`

W293 Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:20:1
   |
18 |       
19 |     Central Plugin Registry
20 |
   | ^^^^
21 |     Thread-safe singleton for managing all plugins.
22 |     """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:23:1
   |
21 |     Thread-safe singleton for managing all plugins.
22 |     """
23 |
   | ^^^^
24 |     _instance: Optional['PluginRegistry'] = None
25 |     _initialized: bool = False
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:26:1
   |
24 |     _instance: Optional['PluginRegistry'] = None
25 |     _initialized: bool = False
26 |
   | ^^^^
27 |     def __new__(cls):
28 |         if cls._instance is None:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:31:1
   |
29 |             cls._instance = super().__new__(cls)
30 |         return cls._instance
31 |
   | ^^^^
32 |     def __init__(self):
33 |         if not self._initialized:
   |
help: Remove whitespace from blank line

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:34:28
   |
32 |     def __init__(self):
33 |         if not self._initialized:
34 |             self._plugins: Dict[str, IPlugin] = {}
   |                            ^^^^
35 |             self._metadata: Dict[str, Dict[str, Any]] = {}
36 |             self._initialized = True
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:35:29
   |
33 |         if not self._initialized:
34 |             self._plugins: Dict[str, IPlugin] = {}
35 |             self._metadata: Dict[str, Dict[str, Any]] = {}
   |                             ^^^^
36 |             self._initialized = True
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:35:39
   |
33 |         if not self._initialized:
34 |             self._plugins: Dict[str, IPlugin] = {}
35 |             self._metadata: Dict[str, Dict[str, Any]] = {}
   |                                       ^^^^
36 |             self._initialized = True
   |
help: Replace with `dict`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:37:1
   |
35 |             self._metadata: Dict[str, Dict[str, Any]] = {}
36 |             self._initialized = True
37 |
   | ^^^^
38 |     def register(
39 |         self,
   |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
  --> app/core/registry/plugin_registry.py:39:14
   |
38 |     def register(
39 |         self,
   |              ^
40 |         plugin: IPlugin,
41 |         metadata: Optional[Dict[str, Any]] = None
   |
help: Remove trailing whitespace

W291 [*] Trailing whitespace
  --> app/core/registry/plugin_registry.py:40:25
   |
38 |     def register(
39 |         self,
40 |         plugin: IPlugin,
   |                         ^
41 |         metadata: Optional[Dict[str, Any]] = None
42 |     ) -> None:
   |
help: Remove trailing whitespace

UP045 [*] Use `X | None` for type annotations
  --> app/core/registry/plugin_registry.py:41:19
   |
39 |         self,
40 |         plugin: IPlugin,
41 |         metadata: Optional[Dict[str, Any]] = None
   |                   ^^^^^^^^^^^^^^^^^^^^^^^^
42 |     ) -> None:
43 |         """
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:41:28
   |
39 |         self,
40 |         plugin: IPlugin,
41 |         metadata: Optional[Dict[str, Any]] = None
   |                            ^^^^
42 |     ) -> None:
43 |         """
   |
help: Replace with `dict`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:48:1
   |
46 |         """
47 |         name = plugin.name
48 |
   | ^^^^^^^^
49 |         if name in self._plugins:
50 |             raise ValueError(f"Plugin '{name}' already registered")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:51:1
   |
49 |         if name in self._plugins:
50 |             raise ValueError(f"Plugin '{name}' already registered")
51 |
   | ^^^^^^^^
52 |         self._plugins[name] = plugin
53 |         self._metadata[name] = metadata or {}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:54:1
   |
52 |         self._plugins[name] = plugin
53 |         self._metadata[name] = metadata or {}
54 |
   | ^^^^
55 |     def get(self, name: str) -> Optional[IPlugin]:
56 |         """Get plugin by name"""
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
  --> app/core/registry/plugin_registry.py:55:33
   |
53 |         self._metadata[name] = metadata or {}
54 |
55 |     def get(self, name: str) -> Optional[IPlugin]:
   |                                 ^^^^^^^^^^^^^^^^^
56 |         """Get plugin by name"""
57 |         return self._plugins.get(name)
   |
help: Convert to `X | None`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:58:1
   |
56 |         """Get plugin by name"""
57 |         return self._plugins.get(name)
58 |
   | ^^^^
59 |     def get_all(self) -> Dict[str, IPlugin]:
60 |         """Get all registered plugins"""
   |
help: Remove whitespace from blank line

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:59:26
   |
57 |         return self._plugins.get(name)
58 |
59 |     def get_all(self) -> Dict[str, IPlugin]:
   |                          ^^^^
60 |         """Get all registered plugins"""
61 |         return self._plugins.copy()
   |
help: Replace with `dict`

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:62:1
   |
60 |         """Get all registered plugins"""
61 |         return self._plugins.copy()
62 |
   | ^^^^
63 |     def get_by_type(self, plugin_type: str) -> list[IPlugin]:
64 |         """Get all plugins of specific type"""
   |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
  --> app/core/registry/plugin_registry.py:66:46
   |
64 |         """Get all plugins of specific type"""
65 |         return [
66 |             p for p in self._plugins.values()
   |                                              ^
67 |             if p.plugin_type == plugin_type
68 |         ]
   |
help: Remove trailing whitespace

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:69:1
   |
67 |             if p.plugin_type == plugin_type
68 |         ]
69 |
   | ^^^^
70 |     def unregister(self, name: str) -> bool:
71 |         """Unregister plugin"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:77:1
   |
75 |             return True
76 |         return False
77 |
   | ^^^^
78 |     def clear(self) -> None:
79 |         """Clear all plugins (for testing)"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/core/registry/plugin_registry.py:82:1
   |
80 |         self._plugins.clear()
81 |         self._metadata.clear()
82 |
   | ^^^^
83 |     def get_metadata(self, name: str) -> Dict[str, Any]:
84 |         """Get plugin metadata"""
   |
help: Remove whitespace from blank line

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/core/registry/plugin_registry.py:83:42
   |
81 |         self._metadata.clear()
82 |
83 |     def get_metadata(self, name: str) -> Dict[str, Any]:
   |                                          ^^^^
84 |         """Get plugin metadata"""
85 |         return self._metadata.get(name, {})
   |
help: Replace with `dict`

UP035 `typing.List` is deprecated, use `list` instead
  --> app/genesis/brain.py:8:1
   |
 7 | import logging
 8 | from typing import Any, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | from app.core.ai_client_factory import get_ai_client
   |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/genesis/brain.py:24:31
   |
22 |         self.model = model
23 |
24 |     def think(self, messages: List[dict], tools: Optional[List[dict]] = None) -> Any:
   |                               ^^^^
25 |         """
26 |         Send context to the LLM and get a response (Message object).
   |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
  --> app/genesis/brain.py:24:50
   |
22 |         self.model = model
23 |
24 |     def think(self, messages: List[dict], tools: Optional[List[dict]] = None) -> Any:
   |                                                  ^^^^^^^^^^^^^^^^^^^^
25 |         """
26 |         Send context to the LLM and get a response (Message object).
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/genesis/brain.py:24:59
   |
22 |         self.model = model
23 |
24 |     def think(self, messages: List[dict], tools: Optional[List[dict]] = None) -> Any:
   |                                                           ^^^^
25 |         """
26 |         Send context to the LLM and get a response (Message object).
   |
help: Replace with `list`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> app/genesis/brain.py:47:13
   |
45 |         except Exception as e:
46 |             logger.error(f"Cortex Failure: {e}")
47 |             raise RuntimeError(f"Brain freeze: {e}")
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/genesis/core.py:10:1
   |
 8 | import json
 9 | import logging
10 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 |
12 | from app.genesis.brain import Cortex
   |
help: Import from `collections.abc`

F401 [*] `typing.Any` imported but unused
  --> app/genesis/core.py:10:20
   |
 8 | import json
 9 | import logging
10 | from typing import Any, Callable
   |                    ^^^
11 |
12 | from app.genesis.brain import Cortex
   |
help: Remove unused import: `typing.Any`

I001 [*] Import block is un-sorted or un-formatted
  --> app/genesis/memory.py:5:1
   |
 3 |   Simple sliding window memory.
 4 |   """
 5 | / from __future__ import annotations
 6 | |
 7 | | import json
 8 | | from typing import Any, List
   | |____________________________^
 9 |
10 |   class ShortTermMemory:
   |
help: Organize imports

F401 [*] `json` imported but unused
 --> app/genesis/memory.py:7:8
  |
5 | from __future__ import annotations
6 |
7 | import json
  |        ^^^^
8 | from typing import Any, List
  |
help: Remove unused import: `json`

UP035 `typing.List` is deprecated, use `list` instead
  --> app/genesis/memory.py:8:1
   |
 7 | import json
 8 | from typing import Any, List
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | class ShortTermMemory:
   |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/genesis/memory.py:16:24
   |
15 |     def __init__(self):
16 |         self.messages: List[dict] = []
   |                        ^^^^
17 |         self.system_prompt = (
18 |             "You are Genesis, a Super Intelligent Agent built on the Principle of Simplicity. "
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/genesis/memory.py:45:30
   |
43 |         })
44 |
45 |     def get_context(self) -> List[dict]:
   |                              ^^^^
46 |         """Return full context including system prompt."""
47 |         return [{"role": "system", "content": self.system_prompt}] + self.messages
   |
help: Replace with `list`

RUF005 Consider iterable unpacking instead of concatenation
  --> app/genesis/memory.py:47:16
   |
45 |     def get_context(self) -> List[dict]:
46 |         """Return full context including system prompt."""
47 |         return [{"role": "system", "content": self.system_prompt}] + self.messages
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Replace with iterable unpacking

I001 [*] Import block is un-sorted or un-formatted
 --> app/genesis/registry.py:4:1
  |
2 |   Genesis Tools: Capability Registry.
3 |   """
4 | / from __future__ import annotations
5 | |
6 | | import inspect
7 | | from typing import Any, Callable, Dict, List
  | |____________________________________________^
8 |
9 |   class ToolRegistry:
  |
help: Organize imports

UP035 [*] Import from `collections.abc` instead: `Callable`
 --> app/genesis/registry.py:7:1
  |
6 | import inspect
7 | from typing import Any, Callable, Dict, List
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
8 |
9 | class ToolRegistry:
  |
help: Import from `collections.abc`

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/genesis/registry.py:7:1
  |
6 | import inspect
7 | from typing import Any, Callable, Dict, List
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
8 |
9 | class ToolRegistry:
  |

UP035 `typing.List` is deprecated, use `list` instead
 --> app/genesis/registry.py:7:1
  |
6 | import inspect
7 | from typing import Any, Callable, Dict, List
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
8 |
9 | class ToolRegistry:
  |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/genesis/registry.py:15:22
   |
14 |     def __init__(self):
15 |         self._tools: Dict[str, Callable] = {}
   |                      ^^^^
16 |
17 |     def register(self, func: Callable) -> None:
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/genesis/registry.py:29:34
   |
27 |         return self._tools[name](**kwargs)
28 |
29 |     def get_definitions(self) -> List[dict]:
   |                                  ^^^^
30 |         """
31 |         Generate OpenAI-compatible tool definitions.
   |
help: Replace with `list`

E721 Use `is` and `is not` for type comparisons, or `isinstance()` for isinstance checks
  --> app/genesis/registry.py:56:16
   |
54 |         for param_name, param in sig.parameters.items():
55 |             param_type = "string"
56 |             if param.annotation == int:
   |                ^^^^^^^^^^^^^^^^^^^^^^^
57 |                 param_type = "integer"
58 |             elif param.annotation == float:
   |

E721 Use `is` and `is not` for type comparisons, or `isinstance()` for isinstance checks
  --> app/genesis/registry.py:58:18
   |
56 |             if param.annotation == int:
57 |                 param_type = "integer"
58 |             elif param.annotation == float:
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^
59 |                 param_type = "number"
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/genesis/tools/code_explorer.py:5:1
   |
 3 |   Provides 'Superhuman' vision into the codebase: Grep, Read, Analyze.
 4 |   """
 5 | / import os
 6 | | import glob
 7 | | import logging
 8 | | import subprocess
 9 | | from typing import List, Dict
   | |_____________________________^
10 |
11 |   logger = logging.getLogger("genesis.tools.code")
   |
help: Organize imports

F401 [*] `glob` imported but unused
 --> app/genesis/tools/code_explorer.py:6:8
  |
4 | """
5 | import os
6 | import glob
  |        ^^^^
7 | import logging
8 | import subprocess
  |
help: Remove unused import: `glob`

UP035 `typing.List` is deprecated, use `list` instead
  --> app/genesis/tools/code_explorer.py:9:1
   |
 7 | import logging
 8 | import subprocess
 9 | from typing import List, Dict
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
10 |
11 | logger = logging.getLogger("genesis.tools.code")
   |

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/genesis/tools/code_explorer.py:9:1
   |
 7 | import logging
 8 | import subprocess
 9 | from typing import List, Dict
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
10 |
11 | logger = logging.getLogger("genesis.tools.code")
   |

F401 [*] `typing.List` imported but unused
  --> app/genesis/tools/code_explorer.py:9:20
   |
 7 | import logging
 8 | import subprocess
 9 | from typing import List, Dict
   |                    ^^^^
10 |
11 | logger = logging.getLogger("genesis.tools.code")
   |
help: Remove unused import

F401 [*] `typing.Dict` imported but unused
  --> app/genesis/tools/code_explorer.py:9:26
   |
 7 | import logging
 8 | import subprocess
 9 | from typing import List, Dict
   |                          ^^^^
10 |
11 | logger = logging.getLogger("genesis.tools.code")
   |
help: Remove unused import

UP015 [*] Unnecessary mode argument
  --> app/genesis/tools/code_explorer.py:67:29
   |
65 |             return f"Error: File {filepath} not found."
66 |
67 |         with open(filepath, 'r', encoding='utf-8') as f:
   |                             ^^^
68 |             lines = f.readlines()
   |
help: Remove mode argument

E701 Multiple statements on one line (colon)
  --> app/genesis/tools/code_explorer.py:71:26
   |
70 |         total_lines = len(lines)
71 |         if start_line < 1: start_line = 1
   |                          ^
72 |         if end_line == -1 or end_line > total_lines: end_line = total_lines
   |

E701 Multiple statements on one line (colon)
  --> app/genesis/tools/code_explorer.py:72:52
   |
70 |         total_lines = len(lines)
71 |         if start_line < 1: start_line = 1
72 |         if end_line == -1 or end_line > total_lines: end_line = total_lines
   |                                                    ^
73 |
74 |         if start_line > total_lines:
   |

RUF013 PEP 484 prohibits implicit `Optional`
  --> app/genesis/tools/code_explorer.py:84:44
   |
82 |         return f"Error reading file: {e}"
83 |
84 | def list_files(path: str = ".", extension: str = None) -> str:
   |                                            ^^^
85 |     """
86 |     Lists files in a directory, optionally filtering by extension.
   |
help: Convert to `T | None`

E701 Multiple statements on one line (colon)
   --> app/genesis/tools/code_explorer.py:114:68
    |
112 |     large_files = []
113 |     for root, _, filenames in os.walk("."):
114 |         if any(x in root for x in [".git", "node_modules", "dist"]): continue
    |                                                                    ^
115 |         for name in filenames:
116 |             if name.endswith(".py"):
    |

UP015 [*] Unnecessary mode argument
   --> app/genesis/tools/code_explorer.py:119:37
    |
117 |                 path = os.path.join(root, name)
118 |                 try:
119 |                     with open(path, 'r') as f:
    |                                     ^^^
120 |                         lines = sum(1 for _ in f)
121 |                         if lines > 300:
    |
help: Remove mode argument

E722 Do not use bare `except`
   --> app/genesis/tools/code_explorer.py:123:17
    |
121 |                         if lines > 300:
122 |                             large_files.append((path, lines))
123 |                 except: pass
    |                 ^^^^^^
124 |
125 |     report += "\n[Large Files (>300 LOC)]:\n"
    |

E701 Multiple statements on one line (colon)
   --> app/genesis/tools/code_explorer.py:123:23
    |
121 |                         if lines > 300:
122 |                             large_files.append((path, lines))
123 |                 except: pass
    |                       ^
124 |
125 |     report += "\n[Large Files (>300 LOC)]:\n"
    |

W605 [*] Invalid escape sequence: `\|`
   --> app/genesis/tools/code_explorer.py:130:28
    |
129 |     # 2. TODOs/FIXMEs
130 |     todos = grep_code("TODO\|FIXME")
    |                            ^^
131 |     count_todos = len(todos.splitlines()) if "No matches" not in todos else 0
132 |     report += f"\n[Technical Debt]: Found {count_todos} markers (TODO/FIXME).\n"
    |
help: Use a raw string literal

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/analyzers/complexity.py:1:1
  |
1 | / import ast
2 | | from typing import List, Dict, Any, Optional
  | |____________________________________________^
3 |
4 |   class ComplexityAnalyzer(ast.NodeVisitor):
  |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
 --> app/overmind/code_intelligence/analyzers/complexity.py:2:1
  |
1 | import ast
2 | from typing import List, Dict, Any, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 | class ComplexityAnalyzer(ast.NodeVisitor):
  |

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/overmind/code_intelligence/analyzers/complexity.py:2:1
  |
1 | import ast
2 | from typing import List, Dict, Any, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 | class ComplexityAnalyzer(ast.NodeVisitor):
  |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/analyzers/complexity.py:9:25
   |
 7 |     def __init__(self):
 8 |         self.file_complexity = 0
 9 |         self.functions: List[Dict[str, Any]] = []
   |                         ^^^^
10 |         self.classes: List[Dict[str, Any]] = []
11 |         self.current_class: Optional[str] = None
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/overmind/code_intelligence/analyzers/complexity.py:9:30
   |
 7 |     def __init__(self):
 8 |         self.file_complexity = 0
 9 |         self.functions: List[Dict[str, Any]] = []
   |                              ^^^^
10 |         self.classes: List[Dict[str, Any]] = []
11 |         self.current_class: Optional[str] = None
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/analyzers/complexity.py:10:23
   |
 8 |         self.file_complexity = 0
 9 |         self.functions: List[Dict[str, Any]] = []
10 |         self.classes: List[Dict[str, Any]] = []
   |                       ^^^^
11 |         self.current_class: Optional[str] = None
12 |         self.imports: List[str] = []
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/overmind/code_intelligence/analyzers/complexity.py:10:28
   |
 8 |         self.file_complexity = 0
 9 |         self.functions: List[Dict[str, Any]] = []
10 |         self.classes: List[Dict[str, Any]] = []
   |                            ^^^^
11 |         self.current_class: Optional[str] = None
12 |         self.imports: List[str] = []
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/overmind/code_intelligence/analyzers/complexity.py:11:29
   |
 9 |         self.functions: List[Dict[str, Any]] = []
10 |         self.classes: List[Dict[str, Any]] = []
11 |         self.current_class: Optional[str] = None
   |                             ^^^^^^^^^^^^^
12 |         self.imports: List[str] = []
13 |         self.max_nesting = 0
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/analyzers/complexity.py:12:23
   |
10 |         self.classes: List[Dict[str, Any]] = []
11 |         self.current_class: Optional[str] = None
12 |         self.imports: List[str] = []
   |                       ^^^^
13 |         self.max_nesting = 0
   |
help: Replace with `list`

SIM114 [*] Combine `if` branches using logical `or` operator
  --> app/overmind/code_intelligence/analyzers/complexity.py:72:13
   |
70 |           for child in ast.walk(node):
71 |               # Decision points
72 | /             if isinstance(child, (ast.If, ast.While, ast.For, ast.AsyncFor)):
73 | |                 complexity += 1
74 | |             elif isinstance(child, ast.ExceptHandler):
75 | |                 complexity += 1
   | |_______________________________^
76 |               elif isinstance(child, (ast.With, ast.AsyncWith)):
77 |                   complexity += 1
   |
help: Combine `if` branches

SIM114 [*] Combine `if` branches using logical `or` operator
  --> app/overmind/code_intelligence/analyzers/complexity.py:74:13
   |
72 |               if isinstance(child, (ast.If, ast.While, ast.For, ast.AsyncFor)):
73 |                   complexity += 1
74 | /             elif isinstance(child, ast.ExceptHandler):
75 | |                 complexity += 1
76 | |             elif isinstance(child, (ast.With, ast.AsyncWith)):
77 | |                 complexity += 1
   | |_______________________________^
78 |               # Boolean operators
79 |               elif isinstance(child, ast.BoolOp):
   |
help: Combine `if` branches

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/analyzers/git.py:1:1
  |
1 | / import subprocess
2 | | import sys
3 | | from pathlib import Path
4 | | from typing import Dict, Any, Set
  | |_________________________________^
5 |
6 |   class GitAnalyzer:
  |
help: Organize imports

F401 [*] `sys` imported but unused
 --> app/overmind/code_intelligence/analyzers/git.py:2:8
  |
1 | import subprocess
2 | import sys
  |        ^^^
3 | from pathlib import Path
4 | from typing import Dict, Any, Set
  |
help: Remove unused import: `sys`

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/overmind/code_intelligence/analyzers/git.py:4:1
  |
2 | import sys
3 | from pathlib import Path
4 | from typing import Dict, Any, Set
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
5 |
6 | class GitAnalyzer:
  |

UP035 `typing.Set` is deprecated, use `set` instead
 --> app/overmind/code_intelligence/analyzers/git.py:4:1
  |
2 | import sys
3 | from pathlib import Path
4 | from typing import Dict, Any, Set
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
5 |
6 | class GitAnalyzer:
  |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/overmind/code_intelligence/analyzers/git.py:12:55
   |
10 |         self.repo_path = repo_path
11 |
12 |     def analyze_file_history(self, file_path: str) -> Dict[str, Any]:
   |                                                       ^^^^
13 |         """Analyze file modification history"""
14 |         try:
   |
help: Replace with `dict`

UP006 [*] Use `set` instead of `Set` for type annotation
  --> app/overmind/code_intelligence/analyzers/git.py:85:23
   |
83 |                 timeout=10,
84 |             )
85 |             branches: Set[str] = set()
   |                       ^^^
86 |             if result_branches.stdout.strip():
87 |                 for line in result_branches.stdout.strip().split("\n"):
   |
help: Replace with `set`

F841 [*] Local variable `e` is assigned to but never used
   --> app/overmind/code_intelligence/analyzers/git.py:106:29
    |
104 |             }
105 |
106 |         except Exception as e:
    |                             ^
107 |             # Silence errors in non-git environments or timeouts
108 |             # print(f"Warning: Git analysis failed for {file_path}: {e}", file=sys.stderr)
    |
help: Remove assignment to unused variable `e`

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/overmind/code_intelligence/analyzers/smells.py:1:1
  |
1 | from typing import Dict, List, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from ..models import FileMetrics
  |

UP035 `typing.List` is deprecated, use `list` instead
 --> app/overmind/code_intelligence/analyzers/smells.py:1:1
  |
1 | from typing import Dict, List, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from ..models import FileMetrics
  |

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/analyzers/smells.py:1:1
  |
1 | / from typing import Dict, List, Optional
2 | | from ..models import FileMetrics
  | |________________________________^
3 |
4 |   class StructuralSmellDetector:
  |
help: Organize imports

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/overmind/code_intelligence/analyzers/smells.py:12:22
   |
11 |       # Layer mixing patterns
12 |       LAYER_PATTERNS = {
   |  ______________________^
13 | |         "api": ["api", "routers", "endpoints", "controllers"],
14 | |         "service": ["services", "use_cases", "application"],
15 | |         "infrastructure": ["infrastructure", "repositories", "adapters"],
16 | |         "domain": ["domain", "models", "entities"],
17 | |     }
   | |_____^
18 |
19 |       def detect_smells(self, file_path: str, metrics: FileMetrics, imports: List[str]) -> Dict[str, bool]:
   |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/analyzers/smells.py:19:76
   |
17 |     }
18 |
19 |     def detect_smells(self, file_path: str, metrics: FileMetrics, imports: List[str]) -> Dict[str, bool]:
   |                                                                            ^^^^
20 |         """Detect structural smells"""
21 |         smells = {
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/overmind/code_intelligence/analyzers/smells.py:19:90
   |
17 |     }
18 |
19 |     def detect_smells(self, file_path: str, metrics: FileMetrics, imports: List[str]) -> Dict[str, bool]:
   |                                                                                          ^^^^
20 |         """Detect structural smells"""
21 |         smells = {
   |
help: Replace with `dict`

SIM114 [*] Combine `if` branches using logical `or` operator
  --> app/overmind/code_intelligence/analyzers/smells.py:29:13
   |
27 |           # God class detection
28 |           if metrics.num_classes > 0:
29 | /             if metrics.code_lines > self.GOD_CLASS_LOC_THRESHOLD:
30 | |                 smells["is_god_class"] = True
31 | |             elif metrics.num_functions > self.GOD_CLASS_METHODS_THRESHOLD:
32 | |                 smells["is_god_class"] = True
   | |_____________________________________________^
33 |
34 |           # Detect current file layer
   |
help: Combine `if` branches

UP045 [*] Use `X | None` for type annotations
  --> app/overmind/code_intelligence/analyzers/smells.py:55:43
   |
53 |         return smells
54 |
55 |     def _detect_layer(self, path: str) -> Optional[str]:
   |                                           ^^^^^^^^^^^^^
56 |         """Detect architectural layer from path"""
57 |         path_lower = path.lower()
   |
help: Convert to `X | None`

I001 [*] Import block is un-sorted or un-formatted
  --> app/overmind/code_intelligence/cli.py:1:1
   |
 1 | / import argparse
 2 | | from datetime import datetime
 3 | | from pathlib import Path
 4 | | from .core import StructuralCodeIntelligence
 5 | | from .reporters.json_reporter import save_json_report
 6 | | from .reporters.csv_reporter import save_csv_report
 7 | | from .reporters.html_reporter import generate_heatmap_html
 8 | | from .reporters.markdown_reporter import generate_markdown_report
   | |_________________________________________________________________^
 9 |
10 |   def main():
   |
help: Organize imports

F541 [*] f-string without any placeholders
  --> app/overmind/code_intelligence/cli.py:60:11
   |
59 |     print("\n Analysis complete!")
60 |     print(f"\n Summary:")
   |           ^^^^^^^^^^^^^^^^
61 |     print(f"  - Files analyzed: {analysis.total_files}")
62 |     print(f"  - Critical hotspots: {len(analysis.critical_hotspots)}")
   |
help: Remove extraneous `f` prefix

I001 [*] Import block is un-sorted or un-formatted
  --> app/overmind/code_intelligence/core.py:1:1
   |
 1 | / import ast
 2 | | import sys
 3 | | from datetime import datetime
 4 | | from pathlib import Path
 5 | | from typing import List, Optional
 6 | |
 7 | | from .models import FileMetrics, ProjectAnalysis
 8 | | from .analyzers.git import GitAnalyzer
 9 | | from .analyzers.smells import StructuralSmellDetector
10 | | from .analyzers.complexity import ComplexityAnalyzer
   | |____________________________________________________^
   |
help: Organize imports

F401 [*] `sys` imported but unused
 --> app/overmind/code_intelligence/core.py:2:8
  |
1 | import ast
2 | import sys
  |        ^^^
3 | from datetime import datetime
4 | from pathlib import Path
  |
help: Remove unused import: `sys`

UP035 `typing.List` is deprecated, use `list` instead
 --> app/overmind/code_intelligence/core.py:5:1
  |
3 | from datetime import datetime
4 | from pathlib import Path
5 | from typing import List, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
6 |
7 | from .models import FileMetrics, ProjectAnalysis
  |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/core.py:16:55
   |
14 |     """Main Structural Intelligence Analyzer"""
15 |
16 |     def __init__(self, repo_path: Path, target_paths: List[str]):
   |                                                       ^^^^
17 |         self.repo_path = repo_path
18 |         self.target_paths = target_paths
   |
help: Replace with `list`

SIM201 Use `file_path.suffix != ".py"` instead of `not file_path.suffix == ".py"`
  --> app/overmind/code_intelligence/core.py:47:12
   |
46 |         # Must be Python file
47 |         if not file_path.suffix == ".py":
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
48 |             return False
   |
help: Replace with `!=` operator

SIM110 Use `return any(target in path_str for target in self.target_paths)` instead of `for` loop
  --> app/overmind/code_intelligence/core.py:51:9
   |
50 |           # Must be in target paths
51 | /         for target in self.target_paths:
52 | |             if target in path_str:
53 | |                 return True
54 | |
55 | |         return False
   | |____________________^
56 |
57 |       def analyze_file(self, file_path: Path) -> Optional[FileMetrics]:
   |
help: Replace with `return any(target in path_str for target in self.target_paths)`

UP045 [*] Use `X | None` for type annotations
  --> app/overmind/code_intelligence/core.py:57:48
   |
55 |         return False
56 |
57 |     def analyze_file(self, file_path: Path) -> Optional[FileMetrics]:
   |                                                ^^^^^^^^^^^^^^^^^^^^^
58 |         """Comprehensive single file analysis"""
59 |         try:
   |
help: Convert to `X | None`

F841 [*] Local variable `e` is assigned to but never used
   --> app/overmind/code_intelligence/core.py:147:29
    |
145 |             return metrics
146 |
147 |         except Exception as e:
    |                             ^
148 |             # print(f"Error analyzing {file_path}: {e}", file=sys.stderr)
149 |             return None
    |
help: Remove assignment to unused variable `e`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/overmind/code_intelligence/core.py:151:53
    |
149 |             return None
150 |
151 |     def calculate_hotspot_scores(self, all_metrics: List[FileMetrics]) -> None:
    |                                                     ^^^^
152 |         """Calculate hotspot scores with normalization"""
153 |         if not all_metrics:
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/overmind/code_intelligence/core.py:165:31
    |
164 |         # Normalize to 0-1 range
165 |         def normalize(values: List[float]) -> List[float]:
    |                               ^^^^
166 |             if not values or max(values) == 0:
167 |                 return [0.0] * len(values)
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/overmind/code_intelligence/core.py:165:47
    |
164 |         # Normalize to 0-1 range
165 |         def normalize(values: List[float]) -> List[float]:
    |                                               ^^^^
166 |             if not values or max(values) == 0:
167 |                 return [0.0] * len(values)
    |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/models.py:1:1
  |
1 | / from dataclasses import dataclass, field
2 | | from typing import Any, List, Dict
  | |__________________________________^
3 |
4 |   @dataclass
  |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
 --> app/overmind/code_intelligence/models.py:2:1
  |
1 | from dataclasses import dataclass, field
2 | from typing import Any, List, Dict
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 | @dataclass
  |

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/overmind/code_intelligence/models.py:2:1
  |
1 | from dataclasses import dataclass, field
2 | from typing import Any, List, Dict
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 |
4 | @dataclass
  |

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/models.py:48:23
   |
47 |     # Function Details
48 |     function_details: List[Dict[str, Any]] = field(default_factory=list)
   |                       ^^^^
49 |
50 |     # Hotspot Scores
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/overmind/code_intelligence/models.py:48:28
   |
47 |     # Function Details
48 |     function_details: List[Dict[str, Any]] = field(default_factory=list)
   |                            ^^^^
49 |
50 |     # Hotspot Scores
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/models.py:72:24
   |
71 |     # Hotspots
72 |     critical_hotspots: List[str] = field(default_factory=list)  # Top 20
   |                        ^^^^
73 |     high_hotspots: List[str] = field(default_factory=list)  # Next 20
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/models.py:73:20
   |
71 |     # Hotspots
72 |     critical_hotspots: List[str] = field(default_factory=list)  # Top 20
73 |     high_hotspots: List[str] = field(default_factory=list)  # Next 20
   |                    ^^^^
74 |
75 |     files: List[FileMetrics] = field(default_factory=list)
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/overmind/code_intelligence/models.py:75:12
   |
73 |     high_hotspots: List[str] = field(default_factory=list)  # Next 20
74 |
75 |     files: List[FileMetrics] = field(default_factory=list)
   |            ^^^^
   |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/reporters/csv_reporter.py:1:1
  |
1 | / import csv
2 | | from pathlib import Path
3 | | from ..models import ProjectAnalysis
  | |____________________________________^
4 |
5 |   def save_csv_report(analysis: ProjectAnalysis, output_path: Path) -> None:
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/reporters/html_reporter.py:1:1
  |
1 | / from pathlib import Path
2 | | from ..models import ProjectAnalysis
  | |____________________________________^
3 |
4 |   def generate_heatmap_html(analysis: ProjectAnalysis, output_path: Path) -> None:
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/reporters/json_reporter.py:1:1
  |
1 | / import json
2 | | from dataclasses import asdict
3 | | from pathlib import Path
4 | | from ..models import ProjectAnalysis
  | |____________________________________^
5 |
6 |   def save_json_report(analysis: ProjectAnalysis, output_path: Path) -> None:
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/code_intelligence/reporters/markdown_reporter.py:1:1
  |
1 | / from collections import defaultdict
2 | | from pathlib import Path
3 | | from ..models import ProjectAnalysis
  | |____________________________________^
4 |
5 |   def generate_markdown_report(analysis: ProjectAnalysis, output_path: Path) -> None:
  |
help: Organize imports

RUF022 [*] `__all__` is not sorted
 --> app/overmind/planning/deep_indexer_v2/__init__.py:9:11
  |
7 | from .summary import summarize_for_prompt
8 |
9 | __all__ = ["build_index", "summarize_for_prompt", "IndexResult"]
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/overmind/planning/hyper_planner/planning_logic.py:30:1
   |
28 |     """
29 |     Calculate optimal chunking strategy for the given files and requested lines.
30 |
   | ^^^^
31 |     Returns:
32 |         tuple: (total_chunks, per_chunk, adaptive_chunking)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/overmind/planning/hyper_planner/planning_logic.py:55:1
   |
53 |     """
54 |     Determine if streaming should be used based on configuration and chunk count.
55 |
   | ^^^^
56 |     Args:
57 |         total_chunks: Number of chunks to process
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/overmind/planning/hyper_planner/planning_logic.py:59:1
   |
57 |         total_chunks: Number of chunks to process
58 |         can_stream: Whether streaming is technically possible
59 |
   | ^^^^^^^^
60 |     Returns:
61 |         bool: True if streaming should be used
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/overmind/planning/hyper_planner/planning_logic.py:71:1
   |
69 |     """
70 |     Check if streaming/append mode is allowed based on configuration.
71 |
   | ^^^^
72 |     Returns:
73 |         bool: True if streaming is allowed
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/overmind/planning/hyper_planner/planning_logic.py:95:1
   |
93 |     """
94 |     Prune optional tasks if the total exceeds the global task cap.
95 |
   | ^^^^
96 |     Args:
97 |         tasks: List of planned tasks (modified in place)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:100:1
    |
 98 |         idx: Current task index
 99 |         final_writes: List of final write task IDs that should not be pruned
100 |
    | ^^^^^^^^
101 |     Returns:
102 |         tuple: (next_idx, list of pruned task IDs)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:106:1
    |
104 |     if len(tasks) <= config.GLOBAL_TASK_CAP:
105 |         return idx, []
106 |
    | ^^^^
107 |     pruned = []
108 |     group_map = {
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:113:1
    |
111 |         "deep_arch_report": lambda t: "deep architecture report" in t.description.lower(),
112 |     }
113 |
    | ^^^^
114 |     for group in config.OPTIONAL_GROUPS:
115 |         if len(tasks) <= config.GLOBAL_TASK_CAP:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:130:1
    |
128 |             if len(tasks) <= config.GLOBAL_TASK_CAP:
129 |                 break
130 |
    | ^^^^
131 |     return idx, pruned
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:147:1
    |
145 |     """
146 |     Build comprehensive metadata for the mission plan.
147 |
    | ^^^^
148 |     Args:
149 |         ctx: Planning context dictionary
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:155:1
    |
153 |         container_files: Whether container files were detected
154 |         append_allowed: Whether append mode is allowed
155 |
    | ^^^^^^^^
156 |     Returns:
157 |         dict: Metadata dictionary
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:196:1
    |
194 |     """
195 |     Extract and normalize file names from the objective.
196 |
    | ^^^^
197 |     Args:
198 |         objective: The mission objective string
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:199:1
    |
197 |     Args:
198 |         objective: The mission objective string
199 |
    | ^^^^^^^^
200 |     Returns:
201 |         list: Normalized file names (up to MAX_FILES)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:217:1
    |
215 |     """
216 |     Read content from a file with format-specific handling.
217 |
    | ^^^^
218 |     Supports YAML, JSON, and plain text files.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:219:1
    |
218 |     Supports YAML, JSON, and plain text files.
219 |
    | ^^^^
220 |     Args:
221 |         file_path: Path to the file to read
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:222:1
    |
220 |     Args:
221 |         file_path: Path to the file to read
222 |
    | ^^^^^^^^
223 |     Returns:
224 |         File content (parsed dict for YAML/JSON, string for text, None on error)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:252:1
    |
250 |     """
251 |     Validate that the objective is meaningful and not trivial.
252 |
    | ^^^^
253 |     Args:
254 |         objective: The objective string to validate
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:255:1
    |
253 |     Args:
254 |         objective: The objective string to validate
255 |
    | ^^^^^^^^
256 |     Returns:
257 |         bool: True if valid, False otherwise
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:272:1
    |
270 |     """
271 |     Validate the generated plan for consistency and completeness.
272 |
    | ^^^^
273 |     Raises PlanValidationError if validation fails.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:274:1
    |
273 |     Raises PlanValidationError if validation fails.
274 |
    | ^^^^
275 |     Args:
276 |         tasks: List of planned tasks
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:280:1
    |
278 |         objective: The mission objective
279 |         planner_name: Name of the planner (for error reporting)
280 |
    | ^^^^^^^^
281 |     Raises:
282 |         PlanValidationError: If validation fails
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:285:1
    |
283 |     """
284 |     from ..base_planner import PlanValidationError
285 |
    | ^^^^
286 |     # Check task count
287 |     if len(tasks) > config.GLOBAL_TASK_CAP:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:289:1
    |
287 |     if len(tasks) > config.GLOBAL_TASK_CAP:
288 |         raise PlanValidationError("excessive_tasks", planner_name, objective)
289 |
    | ^^^^
290 |     # Check for dangling dependencies
291 |     ids = {t.task_id for t in tasks}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/overmind/planning/hyper_planner/planning_logic.py:298:1
    |
296 |                     f"dangling_dependency:{t.task_id}->{d}", planner_name, objective
297 |                 )
298 |
    | ^^^^
299 |     # Check for missing file writes (if strict enforcement is enabled)
300 |     if config.STRICT_WRITE_ENF:
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
 --> app/overmind/planning/hyper_planner/scan_logic.py:1:1
  |
1 | / import glob
2 | | import logging
3 | | import os
4 | |
5 | | from app.overmind.planning.schemas import PlannedTask
6 | | from . import config, utils
  | |___________________________^
7 |
8 |   _LOG = logging.getLogger("ultra_hyper_planner.scan")
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/security_metrics/__init__.py:7:1
   |
 5 |   """
 6 |
 7 | / from app.security_metrics.api.security_metrics_facade import SecurityMetricsFacade
 8 | | from app.security_metrics.domain.entities import DeveloperSecurityScore, RiskScore, SecurityFinding, SecurityMetrics
   | |____________________________________________________________________________________________________________________^
 9 |
10 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/security_metrics/__init__.py:10:11
   |
 8 |   from app.security_metrics.domain.entities import DeveloperSecurityScore, RiskScore, SecurityFinding, SecurityMetrics
 9 |
10 |   __all__ = [
   |  ___________^
11 | |     "SecurityMetricsFacade",
12 | |     "SecurityFinding",
13 | |     "SecurityMetrics",
14 | |     "RiskScore",
15 | |     "DeveloperSecurityScore",
16 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/security_metrics/api/__init__.py:3:1
  |
1 | """API layer - Facade and entry points."""
2 |
3 | from app.security_metrics.api.security_metrics_facade import SecurityMetricsFacade, get_security_metrics_facade
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
4 |
5 | __all__ = ["SecurityMetricsFacade", "get_security_metrics_facade"]
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/security_metrics/api/security_metrics_facade.py:3:1
   |
 1 |   """Security Metrics Facade - Unified interface following Facade Pattern."""
 2 |
 3 | / from typing import Any
 4 | |
 5 | | from app.security_metrics.application.developer_scoring import DeveloperSecurityScorer
 6 | | from app.security_metrics.application.report_generation import SecurityReportGenerator
 7 | | from app.security_metrics.application.risk_scoring import RiskScoreCalculator
 8 | | from app.security_metrics.domain.entities import DeveloperSecurityScore, RiskScore, SecurityFinding
 9 | | from app.security_metrics.domain.interfaces import ReportGenerator, RiskCalculator, SecurityRepository
10 | | from app.security_metrics.domain.value_objects import Severity
11 | | from app.security_metrics.infrastructure.in_memory_repository import InMemorySecurityRepository
   | |_______________________________________________________________________________________________^
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/security_metrics/application/__init__.py:7:11
   |
 5 |   from app.security_metrics.application.risk_scoring import RiskScoreCalculator
 6 |
 7 |   __all__ = [
   |  ___________^
 8 | |     "RiskScoreCalculator",
 9 | |     "DeveloperSecurityScorer",
10 | |     "SecurityReportGenerator",
11 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `app.security_metrics.domain.entities.SecurityFinding` imported but unused
 --> app/security_metrics/application/developer_scoring.py:6:74
  |
4 | from datetime import datetime
5 |
6 | from app.security_metrics.domain.entities import DeveloperSecurityScore, SecurityFinding
  |                                                                          ^^^^^^^^^^^^^^^
7 | from app.security_metrics.domain.interfaces import SecurityRepository
  |
help: Remove unused import: `app.security_metrics.domain.entities.SecurityFinding`

I001 [*] Import block is un-sorted or un-formatted
 --> app/security_metrics/application/report_generation.py:3:1
  |
1 |   """Security report generation use case - Single Responsibility Principle."""
2 |
3 | / from collections import defaultdict
4 | | from datetime import datetime
5 | | from typing import Any
6 | |
7 | | from app.security_metrics.domain.entities import RiskScore, SecurityFinding
8 | | from app.security_metrics.domain.interfaces import ReportGenerator, RiskCalculator, SecurityRepository
9 | | from app.security_metrics.domain.value_objects import RiskLevel, Severity
  | |_________________________________________________________________________^
  |
help: Organize imports

RUF012 Mutable class attributes should be annotated with `typing.ClassVar`
  --> app/security_metrics/application/risk_scoring.py:13:24
   |
11 |       """Risk score calculator - SRP: Only calculates risk scores."""
12 |
13 |       SEVERITY_WEIGHTS = {
   |  ________________________^
14 | |         Severity.CRITICAL: 10.0,
15 | |         Severity.HIGH: 7.5,
16 | |         Severity.MEDIUM: 5.0,
17 | |         Severity.LOW: 2.5,
18 | |         Severity.INFO: 1.0,
19 | |     }
   | |_____^
20 |
21 |       def calculate(self, findings: list[SecurityFinding]) -> RiskScore:
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/security_metrics/domain/__init__.py:3:1
   |
 1 |   """Domain layer - Pure business logic and entities."""
 2 |
 3 | / from app.security_metrics.domain.entities import (
 4 | |     DeveloperSecurityScore,
 5 | |     RiskScore,
 6 | |     SecurityDebt,
 7 | |     SecurityFinding,
 8 | |     SecurityMetrics,
 9 | | )
10 | | from app.security_metrics.domain.interfaces import ReportGenerator, RiskCalculator, SecurityRepository
11 | | from app.security_metrics.domain.value_objects import RiskLevel, Severity, TrendDirection
   | |_________________________________________________________________________________________^
12 |
13 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/security_metrics/domain/__init__.py:13:11
   |
11 |   from app.security_metrics.domain.value_objects import RiskLevel, Severity, TrendDirection
12 |
13 |   __all__ = [
   |  ___________^
14 | |     "SecurityFinding",
15 | |     "SecurityMetrics",
16 | |     "RiskScore",
17 | |     "DeveloperSecurityScore",
18 | |     "SecurityDebt",
19 | |     "Severity",
20 | |     "RiskLevel",
21 | |     "TrendDirection",
22 | |     "SecurityRepository",
23 | |     "RiskCalculator",
24 | |     "ReportGenerator",
25 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/adaptive/__init__.py:14:1
   |
12 |   """
13 |
14 | / from app.services.adaptive.domain import (
15 | |     ScalingDecision,
16 | |     ScalingDirection,
17 | |     ServiceHealth,
18 | |     ServiceInstance,
19 | |     ServiceMetrics,
20 | | )
21 | | from app.services.adaptive.application import (
22 | |     AIScalingEngine,
23 | |     IntelligentRouter,
24 | |     PredictiveHealthMonitor,
25 | | )
26 | | from app.services.adaptive.infrastructure import (
27 | |     InMemoryServiceInstanceRepository,
28 | |     InMemoryMetricsRepository,
29 | | )
30 | | from app.services.adaptive.facade import (
31 | |     SelfAdaptiveMicroservices,
32 | |     get_adaptive_microservices,
33 | | )
   | |_^
34 |
35 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/adaptive/__init__.py:35:11
   |
33 |   )
34 |
35 |   __all__ = [
   |  ___________^
36 | |     # Domain
37 | |     "ServiceHealth",
38 | |     "ScalingDirection",
39 | |     "ServiceMetrics",
40 | |     "ScalingDecision",
41 | |     "ServiceInstance",
42 | |     # Application
43 | |     "AIScalingEngine",
44 | |     "IntelligentRouter",
45 | |     "PredictiveHealthMonitor",
46 | |     # Infrastructure
47 | |     "InMemoryServiceInstanceRepository",
48 | |     "InMemoryMetricsRepository",
49 | |     # Facade
50 | |     "SelfAdaptiveMicroservices",
51 | |     "get_adaptive_microservices",
52 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/adaptive/application/__init__.py:4:1
  |
2 |   """Application layer for adaptive microservices"""
3 |
4 | / from app.services.adaptive.application.scaling_engine import AIScalingEngine
5 | | from app.services.adaptive.application.intelligent_router import IntelligentRouter
6 | | from app.services.adaptive.application.health_monitor import PredictiveHealthMonitor
  | |____________________________________________________________________________________^
7 |
8 |   __all__ = [
  |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/adaptive/domain/__init__.py:16:11
   |
14 |   )
15 |
16 |   __all__ = [
   |  ___________^
17 | |     # Enums
18 | |     "ServiceHealth",
19 | |     "ScalingDirection",
20 | |     # Models
21 | |     "ServiceMetrics",
22 | |     "ScalingDecision",
23 | |     "ServiceInstance",
24 | |     # Ports
25 | |     "ServiceInstanceRepository",
26 | |     "MetricsRepository",
27 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/adaptive/facade.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | import statistics
11 | | import threading
12 | | from collections import defaultdict
13 | | from datetime import datetime
14 | | from typing import Any
15 | |
16 | | from app.services.adaptive.domain.models import (
17 | |     ScalingDecision,
18 | |     ScalingDirection,
19 | |     ServiceHealth,
20 | |     ServiceInstance,
21 | |     ServiceMetrics,
22 | | )
23 | | from app.services.adaptive.application.scaling_engine import AIScalingEngine
24 | | from app.services.adaptive.application.intelligent_router import IntelligentRouter
25 | | from app.services.adaptive.application.health_monitor import PredictiveHealthMonitor
   | |____________________________________________________________________________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/adaptive/facade.py:31:1
   |
29 |     """
30 |          
31 |
   | ^^^^
32 |     Maintains backward compatibility with original monolithic API
33 |     while delegating to clean hexagonal architecture.
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/adaptive/infrastructure/__init__.py:4:1
  |
2 |   """Infrastructure layer for adaptive microservices"""
3 |
4 | / from app.services.adaptive.infrastructure.in_memory_repository import (
5 | |     InMemoryServiceInstanceRepository,
6 | |     InMemoryMetricsRepository,
7 | | )
  | |_^
8 |
9 |   __all__ = [
  |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/adaptive/infrastructure/__init__.py:9:11
   |
 7 |   )
 8 |
 9 |   __all__ = [
   |  ___________^
10 | |     "InMemoryServiceInstanceRepository",
11 | |     "InMemoryMetricsRepository",
12 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/admin_ai/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/admin_ai/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/admin_ai/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/admin_ai/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/admin_ai/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/admin_ai/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/admin_ai/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/admin_ai/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/admin_ai/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/admin_ai/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/admin_chat_boundary/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/admin_chat_boundary/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/admin_chat_boundary/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/admin_chat_boundary/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/admin_chat_boundary/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/admin_chat_boundary/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/admin_chat_boundary/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/admin_chat_boundary/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/admin_chat_boundary/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/admin_chat_boundary/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/admin_chat_performance/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/admin_chat_performance/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/admin_chat_performance/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/admin_chat_performance/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/admin_chat_performance/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/admin_chat_performance/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/admin_chat_performance/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/admin_chat_performance/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/admin_chat_performance/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/admin_chat_performance/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/admin_chat_streaming/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/admin_chat_streaming/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/admin_chat_streaming/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/admin_chat_streaming/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/admin_chat_streaming/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/admin_chat_streaming/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/admin_chat_streaming/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/admin_chat_streaming/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/admin_chat_streaming/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/admin_chat_streaming/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/advanced_streaming/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/advanced_streaming/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/advanced_streaming/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/advanced_streaming/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/advanced_streaming/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/advanced_streaming/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/advanced_streaming/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/advanced_streaming/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/advanced_streaming/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/advanced_streaming/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ai_adaptive_microservices.py:24:1
   |
22 |   """
23 |
24 | / from __future__ import annotations
25 | |
26 | | # Re-export everything from the refactored hexagonal architecture
27 | | from app.services.adaptive import (
28 | |     # Domain models
29 | |     ServiceHealth,
30 | |     ScalingDirection,
31 | |     ServiceMetrics,
32 | |     ScalingDecision,
33 | |     ServiceInstance,
34 | |     # Application services
35 | |     AIScalingEngine,
36 | |     IntelligentRouter,
37 | |     PredictiveHealthMonitor,
38 | |     # Infrastructure
39 | |     InMemoryServiceInstanceRepository,
40 | |     InMemoryMetricsRepository,
41 | |     # Main facade (most common usage)
42 | |     SelfAdaptiveMicroservices,
43 | |     get_adaptive_microservices,
44 | | )
   | |_^
45 |
46 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/ai_adaptive_microservices.py:46:11
   |
44 |   )
45 |
46 |   __all__ = [
   |  ___________^
47 | |     # Enums
48 | |     "ServiceHealth",
49 | |     "ScalingDirection",
50 | |     # Models
51 | |     "ServiceMetrics",
52 | |     "ScalingDecision",
53 | |     "ServiceInstance",
54 | |     # Application services
55 | |     "AIScalingEngine",
56 | |     "IntelligentRouter",
57 | |     "PredictiveHealthMonitor",
58 | |     # Infrastructure
59 | |     "InMemoryServiceInstanceRepository",
60 | |     "InMemoryMetricsRepository",
61 | |     # Service facade
62 | |     "SelfAdaptiveMicroservices",
63 | |     "get_adaptive_microservices",
64 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ai_advanced_security.py:20:1
   |
18 |   """
19 |
20 | / import warnings
21 | |
22 | | # Import from refactored module
23 | | from app.services.ai_security import (
24 | |     # Facade
25 | |     SuperhumanSecuritySystem,
26 | |     get_superhuman_security_system,
27 | |     # Domain Models
28 | |     SecurityEvent,
29 | |     ThreatDetection,
30 | |     ThreatLevel,
31 | |     ThreatType,
32 | |     UserBehaviorProfile,
33 | | )
   | |_^
34 |
35 |   # Emit deprecation warning
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/ai_advanced_security.py:45:11
   |
44 |   # Re-export everything for backward compatibility
45 |   __all__ = [
   |  ___________^
46 | |     # Main service
47 | |     "SuperhumanSecuritySystem",
48 | |     "get_superhuman_security_system",
49 | |     # Domain models
50 | |     "SecurityEvent",
51 | |     "ThreatDetection",
52 | |     "ThreatLevel",
53 | |     "ThreatType",
54 | |     "UserBehaviorProfile",
55 | |     # Legacy aliases
56 | |     "DeepLearningThreatDetector",
57 | |     "BehavioralAnalyzer",
58 | |     "AutomatedResponseSystem",
59 | | ]
   | |_^
60 |
61 |   # Legacy class aliases for backward compatibility
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ai_advanced_security.py:64:5
   |
62 |   # These delegate to the new implementations
63 |   try:
64 | /     from app.services.ai_security.infrastructure import (
65 | |         DeepLearningThreatDetector,
66 | |         SimpleBehavioralAnalyzer as BehavioralAnalyzer,
67 | |         SimpleResponseSystem as AutomatedResponseSystem,
68 | |     )
   | |_____^
69 |   except ImportError:
70 |       # Fallback if infrastructure not fully imported
   |
help: Organize imports

F811 Redefinition of unused `RefactoringEngine` from line 23
  --> app/services/ai_auto_refactoring.py:36:1
   |
34 | CodeQualityMetrics = CodeQualityMetrics
35 | CodeAnalyzer = CodeAnalyzer
36 | RefactoringEngine = AIAutoRefactoringService
   | ^^^^^^^^^^^^^^^^^ `RefactoringEngine` redefined here
   |
  ::: app/services/ai_auto_refactoring.py:23:5
   |
21 |     CodeIssue,
22 |     CodeQualityMetrics,
23 |     RefactoringEngine,
   |     ----------------- previous definition of `RefactoringEngine` here
24 |     RefactoringSuggestion,
25 |     RefactoringType,
   |
help: Remove definition: `RefactoringEngine`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_auto_refactoring.py:39:11
   |
39 |   __all__ = [
   |  ___________^
40 | |     "AIAutoRefactoringService",
41 | |     "CodeAnalyzer",
42 | |     "RefactoringEngine",
43 | |     "CodeIssue",
44 | |     "CodeQualityMetrics",
45 | |     "RefactoringSuggestion",
46 | |     "RefactoringType",
47 | |     "Severity",
48 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F541 [*] f-string without any placeholders
  --> app/services/ai_auto_refactoring.py:66:11
   |
64 |     issues, metrics = engine.analyze_file(sample_code, "utils.py")
65 |
66 |     print(f"\n Code Quality Metrics:")
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
67 |     print(f"  Grade: {metrics.overall_grade}")
68 |     print(f"  Maintainability: {metrics.maintainability_index:.1f}/100")
   |
help: Remove extraneous `f` prefix

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_auto_refactoring/__init__.py:17:11
   |
15 |   )
16 |
17 |   __all__ = [
   |  ___________^
18 | |     "AIAutoRefactoringService",
19 | |     "CodeAnalyzer",
20 | |     "RefactoringEngine",
21 | |     "CodeIssue",
22 | |     "CodeQualityMetrics",
23 | |     "RefactoringSuggestion",
24 | |     "RefactoringType",
25 | |     "Severity",
26 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

SIM102 Use a single `if` statement instead of nested `if` statements
  --> app/services/ai_auto_refactoring/application/code_analyzer.py:93:13
   |
91 |           """Check naming conventions"""
92 |           for node in ast.walk(tree):
93 | /             if isinstance(node, ast.FunctionDef):
94 | |                 if not re.match(r"^[a-z_][a-z0-9_]*$", node.name):
   | |__________________________________________________________________^
95 |                       self.issues_found.append(
96 |                           CodeIssue(
   |
help: Combine `if` statements using `and`

SIM102 Use a single `if` statement instead of nested `if` statements
   --> app/services/ai_auto_refactoring/application/refactoring_engine.py:104:13
    |
103 |           for node in ast.walk(tree):
104 | /             if isinstance(node, ast.FunctionDef):
105 | |                 if not node.returns or not all(arg.annotation for arg in node.args.args):
    | |_________________________________________________________________________________________^
106 |                       suggestions.append(
107 |                           RefactoringSuggestion(
    |
help: Combine `if` statements using `and`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_auto_refactoring/domain/__init__.py:12:11
   |
10 |   from .ports import CodeAnalyzerPort, MetricsCalculatorPort, RefactoringEnginePort
11 |
12 |   __all__ = [
   |  ___________^
13 | |     "CodeIssue",
14 | |     "CodeQualityMetrics",
15 | |     "RefactoringSuggestion",
16 | |     "RefactoringType",
17 | |     "Severity",
18 | |     "CodeAnalyzerPort",
19 | |     "MetricsCalculatorPort",
20 | |     "RefactoringEnginePort",
21 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_auto_refactoring/facade.py:46:11
   |
46 |   __all__ = [
   |  ___________^
47 | |     "AIAutoRefactoringService",
48 | |     "CodeIssue",
49 | |     "CodeQualityMetrics",
50 | |     "RefactoringSuggestion",
51 | |     "RefactoringType",
52 | |     "Severity",
53 | |     "CodeAnalyzer",
54 | |     "RefactoringEngine",
55 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ai_intelligent_testing.py:8:1
   |
 6 |   # This service has been refactored into a modular structure at app/services/ai_testing/
 7 |
 8 | / from app.services.ai_testing.domain.models import (
 9 | |     TestType,
10 | |     CoverageType,
11 | |     TestCase,
12 | |     CodeAnalysis,
13 | | )
14 | | from app.services.ai_testing.generators.test_generator import AITestGenerator
15 | | from app.services.ai_testing.selectors.smart_selector import SmartTestSelector
16 | | from app.services.ai_testing.optimizers.coverage_optimizer import CoverageOptimizer
17 | | from app.services.ai_testing.application.manager import (
18 | |     IntelligentTestingSystem,
19 | |     testing_system,
20 | | )
   | |_^
21 |
22 |   # Re-export all public members
   |
help: Organize imports

F401 [*] `app.services.ai_testing.application.manager.testing_system` imported but unused
  --> app/services/ai_intelligent_testing.py:19:5
   |
17 | from app.services.ai_testing.application.manager import (
18 |     IntelligentTestingSystem,
19 |     testing_system,
   |     ^^^^^^^^^^^^^^
20 | )
   |
help: Remove unused import: `app.services.ai_testing.application.manager.testing_system`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_intelligent_testing.py:23:11
   |
22 |   # Re-export all public members
23 |   __all__ = [
   |  ___________^
24 | |     "TestType",
25 | |     "CoverageType",
26 | |     "TestCase",
27 | |     "CodeAnalysis",
28 | |     "AITestGenerator",
29 | |     "SmartTestSelector",
30 | |     "CoverageOptimizer",
31 | |     "IntelligentTestingSystem",  # New unified manager
32 | | ]
   | |_^
33 |
34 |   # Note: The original file had a main block for example usage.
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_project_management/__init__.py:19:11
   |
17 |   )
18 |
19 |   __all__ = [
   |  ___________^
20 | |     "ProjectOrchestrator",
21 | |     "PredictiveTaskAnalyzer",
22 | |     "SmartScheduler",
23 | |     "RiskAssessor",
24 | |     "Task",
25 | |     "TeamMember",
26 | |     "Risk",
27 | |     "TaskPriority",
28 | |     "TaskStatus",
29 | |     "RiskLevel",
30 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `..domain.models.TaskPriority` imported but unused
  --> app/services/ai_project_management/application/services.py:11:52
   |
 9 | from typing import Any
10 |
11 | from ..domain.models import Risk, RiskLevel, Task, TaskPriority, TaskStatus, TeamMember
   |                                                    ^^^^^^^^^^^^
   |
help: Remove unused import: `..domain.models.TaskPriority`

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_project_management/facade.py:13:11
   |
11 |   from .domain.models import Risk, RiskLevel, Task, TaskPriority, TaskStatus, TeamMember
12 |
13 |   __all__ = [
   |  ___________^
14 | |     "ProjectOrchestrator",
15 | |     "PredictiveTaskAnalyzer",
16 | |     "SmartScheduler",
17 | |     "RiskAssessor",
18 | |     "Task",
19 | |     "TeamMember",
20 | |     "Risk",
21 | |     "TaskPriority",
22 | |     "TaskStatus",
23 | |     "RiskLevel",
24 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/ai_security/__init__.py:16:1
   |
14 | Usage:
15 |     from app.services.ai_security import get_superhuman_security_system
16 |
   | ^^^^
17 |     security = get_superhuman_security_system()
18 |     threats = security.analyze_event(event)
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/ai_security/__init__.py:30:11
   |
28 |   from .facade import SuperhumanSecuritySystem, get_superhuman_security_system
29 |
30 |   __all__ = [
   |  ___________^
31 | |     # Facade
32 | |     "SuperhumanSecuritySystem",
33 | |     "get_superhuman_security_system",
34 | |     # Domain Models
35 | |     "SecurityEvent",
36 | |     "ThreatDetection",
37 | |     "ThreatLevel",
38 | |     "ThreatType",
39 | |     "UserBehaviorProfile",
40 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/ai_security/application/security_manager.py:24:1
   |
22 |     """
23 |        - Main security orchestrator
24 |
   | ^^^^
25 |     Coordinates threat detection, behavioral analysis, and automated response.
26 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/application/security_manager.py:38:1
   |
36 |         """
37 |         Initialize security manager with dependencies.
38 |
   | ^^^^^^^^
39 |         Args:
40 |             threat_detector: Threat detection implementation
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/application/security_manager.py:55:1
   |
53 |         """
54 |         Analyze security event for threats.
55 |
   | ^^^^^^^^
56 |         Performs:
57 |         1. Pattern-based threat detection
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/application/security_manager.py:61:1
   |
59 |         3. Automated response if needed
60 |         4. Threat logging
61 |
   | ^^^^^^^^
62 |         Args:
63 |             event: Security event to analyze
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/application/security_manager.py:64:1
   |
62 |         Args:
63 |             event: Security event to analyze
64 |
   | ^^^^^^^^^^^^
65 |         Returns:
66 |             List of detected threats
   |
help: Remove whitespace from blank line

F841 Local variable `response_details` is assigned to but never used
  --> app/services/ai_security/application/security_manager.py:90:17
   |
88 |         for threat in all_threats:
89 |             if self.response_system.should_auto_block(threat):
90 |                 response_details = self.response_system.execute_response(threat)
   |                 ^^^^^^^^^^^^^^^^
91 |                 threat.auto_blocked = True
   |
help: Remove assignment to unused variable `response_details`

W293 Blank line contains whitespace
   --> app/services/ai_security/application/security_manager.py:101:1
    |
 99 |         """
100 |         Get recently detected threats.
101 |
    | ^^^^^^^^
102 |         Args:
103 |             limit: Maximum number of threats to return
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/application/security_manager.py:104:1
    |
102 |         Args:
103 |             limit: Maximum number of threats to return
104 |
    | ^^^^^^^^^^^^
105 |         Returns:
106 |             List of recent threat detections
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/application/security_manager.py:113:1
    |
111 |         """
112 |         Get user behavioral profile.
113 |
    | ^^^^^^^^
114 |         Args:
115 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/application/security_manager.py:116:1
    |
114 |         Args:
115 |             user_id: User identifier
116 |
    | ^^^^^^^^^^^^
117 |         Returns:
118 |             User profile or None if not found
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/ai_security/domain/__init__.py:22:11
   |
20 |   )
21 |
22 |   __all__ = [
   |  ___________^
23 | |     # Models
24 | |     "SecurityEvent",
25 | |     "ThreatDetection",
26 | |     "ThreatLevel",
27 | |     "ThreatType",
28 | |     "UserBehaviorProfile",
29 | |     # Ports
30 | |     "ThreatDetectorPort",
31 | |     "BehavioralAnalyzerPort",
32 | |     "ResponseSystemPort",
33 | |     "ProfileRepositoryPort",
34 | |     "ThreatLoggerPort",
35 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/models.py:44:1
   |
42 |     """
43 |       - Security event from system monitoring
44 |
   | ^^^^
45 |     Represents a single security-relevant event in the system.
46 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/models.py:79:1
   |
77 |     """
78 |       - Detected security threat
79 |
   | ^^^^
80 |     Represents a detected threat with evidence and recommended action.
81 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/domain/models.py:116:1
    |
114 |     """
115 |        - User behavioral profile
116 |
    | ^^^^
117 |     Tracks normal user behavior patterns for anomaly detection.
118 |     """
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/ai_security/domain/models.py:131:11
    |
131 |   __all__ = [
    |  ___________^
132 | |     "ThreatLevel",
133 | |     "ThreatType",
134 | |     "SecurityEvent",
135 | |     "ThreatDetection",
136 | |     "UserBehaviorProfile",
137 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `abc.ABC` imported but unused
  --> app/services/ai_security/domain/ports.py:9:17
   |
 7 | """
 8 |
 9 | from abc import ABC, abstractmethod
   |                 ^^^
10 | from typing import Protocol
   |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
  --> app/services/ai_security/domain/ports.py:9:22
   |
 7 | """
 8 |
 9 | from abc import ABC, abstractmethod
   |                      ^^^^^^^^^^^^^^
10 | from typing import Protocol
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:18:1
   |
16 |     """
17 |       - Threat detection interface
18 |
   | ^^^^
19 |     Defines the contract for threat detection implementations.
20 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:25:1
   |
23 |         """
24 |         Detect security threats in an event.
25 |
   | ^^^^^^^^
26 |         Args:
27 |             event: Security event to analyze
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:28:1
   |
26 |         Args:
27 |             event: Security event to analyze
28 |
   | ^^^^^^^^^^^^
29 |         Returns:
30 |             List of detected threats (empty if none)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:37:1
   |
35 |         """
36 |         Analyze payload for malicious patterns.
37 |
   | ^^^^^^^^
38 |         Args:
39 |             payload: Request payload to analyze
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:40:1
   |
38 |         Args:
39 |             payload: Request payload to analyze
40 |
   | ^^^^^^^^^^^^
41 |         Returns:
42 |             List of detected patterns/issues
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:50:1
   |
48 |     """
49 |       - Behavioral analysis interface
50 |
   | ^^^^
51 |     Defines the contract for user behavior analysis.
52 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:59:1
   |
57 |         """
58 |         Analyze event against user's normal behavior.
59 |
   | ^^^^^^^^
60 |         Args:
61 |             event: Current security event
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:63:1
   |
61 |             event: Current security event
62 |             profile: User's behavioral profile
63 |
   | ^^^^^^^^^^^^
64 |         Returns:
65 |             List of behavioral anomalies detected
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:72:1
   |
70 |         """
71 |         Update user profile with new event data.
72 |
   | ^^^^^^^^
73 |         Args:
74 |             event: New security event
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:83:1
   |
81 |     """
82 |       - Automated response interface
83 |
   | ^^^^
84 |     Defines the contract for automated threat response.
85 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:90:1
   |
88 |         """
89 |         Execute automated response to a threat.
90 |
   | ^^^^^^^^
91 |         Args:
92 |             detection: Detected threat to respond to
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/domain/ports.py:93:1
   |
91 |         Args:
92 |             detection: Detected threat to respond to
93 |
   | ^^^^^^^^^^^^
94 |         Returns:
95 |             Response action details
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/domain/ports.py:102:1
    |
100 |         """
101 |         Determine if threat should be automatically blocked.
102 |
    | ^^^^^^^^
103 |         Args:
104 |             detection: Detected threat
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/domain/ports.py:105:1
    |
103 |         Args:
104 |             detection: Detected threat
105 |
    | ^^^^^^^^^^^^
106 |         Returns:
107 |             True if should auto-block
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/ai_security/domain/ports.py:140:11
    |
140 |   __all__ = [
    |  ___________^
141 | |     "ThreatDetectorPort",
142 | |     "BehavioralAnalyzerPort",
143 | |     "ResponseSystemPort",
144 | |     "ProfileRepositoryPort",
145 | |     "ThreatLoggerPort",
146 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:25:1
   |
23 |     """
24 |        - Superhuman Security System
25 |
   | ^^^^
26 |     Facade providing unified interface to AI security capabilities.
27 |     Maintains backward compatibility with original monolithic implementation.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:33:1
   |
31 |         """
32 |         Initialize security system with default implementations.
33 |
   | ^^^^^^^^
34 |         Creates all necessary components using dependency injection.
35 |         """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:55:1
   |
53 |         """
54 |         Analyze security event for threats.
55 |
   | ^^^^^^^^
56 |         Args:
57 |             event: Security event to analyze
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:58:1
   |
56 |         Args:
57 |             event: Security event to analyze
58 |
   | ^^^^^^^^^^^^
59 |         Returns:
60 |             List of detected threats
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:67:1
   |
65 |         """
66 |         Get recently detected threats.
67 |
   | ^^^^^^^^
68 |         Args:
69 |             limit: Maximum number of threats to return
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:70:1
   |
68 |         Args:
69 |             limit: Maximum number of threats to return
70 |
   | ^^^^^^^^^^^^
71 |         Returns:
72 |             List of recent threat detections
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
  --> app/services/ai_security/facade.py:76:49
   |
74 |         return self._security_manager.get_recent_threats(limit)
75 |
76 |     def get_user_profile(self, user_id: str) -> Optional[UserBehaviorProfile]:
   |                                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |         """
78 |         Get user behavioral profile.
   |
help: Convert to `X | None`

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:79:1
   |
77 |         """
78 |         Get user behavioral profile.
79 |
   | ^^^^^^^^
80 |         Args:
81 |             user_id: User identifier
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:82:1
   |
80 |         Args:
81 |             user_id: User identifier
82 |
   | ^^^^^^^^^^^^
83 |         Returns:
84 |             User profile or None if not found
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:91:1
   |
89 |         """
90 |         Check if IP address is blocked.
91 |
   | ^^^^^^^^
92 |         Args:
93 |             ip_address: IP address to check
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/facade.py:94:1
   |
92 |         Args:
93 |             ip_address: IP address to check
94 |
   | ^^^^^^^^^^^^
95 |         Returns:
96 |             True if IP is blocked
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
   --> app/services/ai_security/facade.py:102:28
    |
101 | # Singleton instance for backward compatibility
102 | _security_system_instance: Optional[SuperhumanSecuritySystem] = None
    |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |
help: Convert to `X | None`

W293 Blank line contains whitespace
   --> app/services/ai_security/facade.py:108:1
    |
106 |     """
107 |     Get singleton instance of security system.
108 |
    | ^^^^
109 |     Returns:
110 |         SuperhumanSecuritySystem instance
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
  --> app/services/ai_security/infrastructure/__init__.py:11:11
   |
 9 |   from .responders import SimpleResponseSystem
10 |
11 |   __all__ = [
   |  ___________^
12 | |     "DeepLearningThreatDetector",
13 | |     "SimpleBehavioralAnalyzer",
14 | |     "InMemoryProfileRepository",
15 | |     "InMemoryThreatLogger",
16 | |     "SimpleResponseSystem",
17 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/ai_security/infrastructure/detectors/behavioral_analyzer.py:9:1
   |
 7 |   """
 8 |
 9 | / import uuid
10 | | from datetime import datetime
11 | |
12 | | from ...domain.models import SecurityEvent, ThreatDetection, ThreatLevel, ThreatType, UserBehaviorProfile
   | |_________________________________________________________________________________________________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/behavioral_analyzer.py:18:1
   |
16 |     """
17 |       
18 |
   | ^^^^
19 |     Simple implementation of behavioral analysis.
20 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/behavioral_analyzer.py:27:1
   |
25 |         """
26 |         Analyze event against user profile.
27 |
   | ^^^^^^^^
28 |         Args:
29 |             event: Current security event
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/behavioral_analyzer.py:31:1
   |
29 |             event: Current security event
30 |             profile: User's behavioral profile
31 |
   | ^^^^^^^^^^^^
32 |         Returns:
33 |             List of detected anomalies
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/behavioral_analyzer.py:59:1
   |
57 |         """
58 |         Update user profile with new event.
59 |
   | ^^^^^^^^
60 |         Args:
61 |             event: New security event
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/ml_threat_detector.py:19:1
   |
17 |     """
18 |        
19 |
   | ^^^^
20 |     Implements ThreatDetectorPort using pattern matching and heuristics.
21 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/ml_threat_detector.py:47:1
   |
45 |         """
46 |         Detect threats in security event.
47 |
   | ^^^^^^^^
48 |         Args:
49 |             event: Security event to analyze
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/ml_threat_detector.py:50:1
   |
48 |         Args:
49 |             event: Security event to analyze
50 |
   | ^^^^^^^^^^^^
51 |         Returns:
52 |             List of detected threats
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/detectors/ml_threat_detector.py:97:1
   |
95 |         """
96 |         Analyze payload for malicious patterns.
97 |
   | ^^^^^^^^
98 |         Args:
99 |             payload: Request payload
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/ai_security/infrastructure/detectors/ml_threat_detector.py:100:1
    |
 98 |         Args:
 99 |             payload: Request payload
100 |
    | ^^^^^^^^^^^^
101 |         Returns:
102 |             List of detected issues
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/repositories/in_memory_repos.py:18:1
   |
16 |     """
17 |         
18 |
   | ^^^^
19 |     In-memory storage for user behavioral profiles.
20 |     """
   |
help: Remove whitespace from blank line

UP045 [*] Use `X | None` for type annotations
  --> app/services/ai_security/infrastructure/repositories/in_memory_repos.py:26:44
   |
24 |         self._profiles: dict[str, UserBehaviorProfile] = {}
25 |
26 |     def get_profile(self, user_id: str) -> Optional[UserBehaviorProfile]:
   |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 |         """Get user profile by ID"""
28 |         return self._profiles.get(user_id)
   |
help: Convert to `X | None`

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/repositories/in_memory_repos.py:42:1
   |
40 |     """
41 |        
42 |
   | ^^^^
43 |     In-memory storage for detected threats.
44 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/repositories/in_memory_repos.py:49:1
   |
47 |         """
48 |         Initialize threat logger.
49 |
   | ^^^^^^^^
50 |         Args:
51 |             max_size: Maximum number of threats to keep in memory
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/responders/auto_responder.py:15:1
   |
13 |     """
14 |       
15 |
   | ^^^^
16 |     Simple implementation of automated threat response.
17 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/responders/auto_responder.py:26:1
   |
24 |         """
25 |         Execute automated response.
26 |
   | ^^^^^^^^
27 |         Args:
28 |             detection: Detected threat
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/responders/auto_responder.py:29:1
   |
27 |         Args:
28 |             detection: Detected threat
29 |
   | ^^^^^^^^^^^^
30 |         Returns:
31 |             Response details
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/responders/auto_responder.py:50:1
   |
48 |         """
49 |         Determine if threat should be auto-blocked.
50 |
   | ^^^^^^^^
51 |         Args:
52 |             detection: Detected threat
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/ai_security/infrastructure/responders/auto_responder.py:53:1
   |
51 |         Args:
52 |             detection: Detected threat
53 |
   | ^^^^^^^^^^^^
54 |         Returns:
55 |             True if should auto-block
   |
help: Remove whitespace from blank line

F401 [*] `typing.Any` imported but unused
 --> app/services/ai_testing/application/manager.py:1:20
  |
1 | from typing import Any
  |                    ^^^
2 |
3 | from app.services.ai_testing.domain.models import CodeAnalysis, TestCase
  |
help: Remove unused import: `typing.Any`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/aiops_self_healing/application/service.py:1:1
   |
 1 | / from __future__ import annotations
 2 | |
 3 | | import logging
 4 | | import statistics
 5 | | import threading
 6 | | import uuid
 7 | | from datetime import UTC, datetime, timedelta
 8 | | from typing import Any, List, Dict, Optional
 9 | |
10 | | from ..domain.models import (
11 | |     TelemetryData,
12 | |     AnomalyDetection,
13 | |     AnomalyType,
14 | |     AnomalySeverity,
15 | |     MetricType,
16 | |     HealingDecision,
17 | |     HealingAction,
18 | |     LoadForecast,
19 | |     CapacityPlan
20 | | )
21 | | from ..domain.ports import (
22 | |     TelemetryRepository,
23 | |     AnomalyRepository,
24 | |     HealingDecisionRepository,
25 | |     ForecastRepository,
26 | |     CapacityPlanRepository
27 | | )
28 | | from ..infrastructure.repositories import (
29 | |     InMemoryTelemetryRepository,
30 | |     InMemoryAnomalyRepository,
31 | |     InMemoryHealingDecisionRepository,
32 | |     InMemoryForecastRepository,
33 | |     InMemoryCapacityPlanRepository
34 | | )
   | |_^
   |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
  --> app/services/aiops_self_healing/application/service.py:8:1
   |
 6 | import uuid
 7 | from datetime import UTC, datetime, timedelta
 8 | from typing import Any, List, Dict, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | from ..domain.models import (
   |

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/services/aiops_self_healing/application/service.py:8:1
   |
 6 | import uuid
 7 | from datetime import UTC, datetime, timedelta
 8 | from typing import Any, List, Dict, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | from ..domain.models import (
   |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/application/service.py:58:32
   |
56 |         self.capacity_repo = capacity_repo or InMemoryCapacityPlanRepository()
57 |
58 |         self.baseline_metrics: Dict[str, Dict[str, float]] = {}
   |                                ^^^^
59 |         self.lock = threading.RLock()
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/application/service.py:58:42
   |
56 |         self.capacity_repo = capacity_repo or InMemoryCapacityPlanRepository()
57 |
58 |         self.baseline_metrics: Dict[str, Dict[str, float]] = {}
   |                                          ^^^^
59 |         self.lock = threading.RLock()
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/aiops_self_healing/application/service.py:95:29
   |
94 |     @staticmethod
95 |     def _percentile(values: List[float], percentile: int) -> float:
   |                             ^^^^
96 |         """Calculate percentile"""
97 |         sorted_values = sorted(values)
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/application/service.py:137:46
    |
136 |     def _detect_zscore_anomaly(
137 |         self, data: TelemetryData, baseline: Dict[str, float]
    |                                              ^^^^
138 |     ) -> Optional[AnomalyDetection]:
139 |         """Detect anomaly using Z-score"""
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/application/service.py:138:10
    |
136 |     def _detect_zscore_anomaly(
137 |         self, data: TelemetryData, baseline: Dict[str, float]
138 |     ) -> Optional[AnomalyDetection]:
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^
139 |         """Detect anomaly using Z-score"""
140 |         mean = baseline["mean"]
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/application/service.py:203:71
    |
201 |         self._execute_healing(decision)
202 |
203 |     def _determine_healing_action(self, anomaly: AnomalyDetection) -> Optional[Dict[str, Any]]:
    |                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^
204 |         """Determine appropriate healing action"""
205 |         if anomaly.anomaly_type == AnomalyType.LATENCY_SPIKE:
    |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/application/service.py:203:80
    |
201 |         self._execute_healing(decision)
202 |
203 |     def _determine_healing_action(self, anomaly: AnomalyDetection) -> Optional[Dict[str, Any]]:
    |                                                                                ^^^^
204 |         """Determine appropriate healing action"""
205 |         if anomaly.anomaly_type == AnomalyType.LATENCY_SPIKE:
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/application/service.py:257:10
    |
255 |     def forecast_load(
256 |         self, service_name: str, metric_type: MetricType, hours_ahead: int = 24
257 |     ) -> Optional[LoadForecast]:
    |          ^^^^^^^^^^^^^^^^^^^^^^
258 |         """Forecast future load using ML"""
259 |         data_points = self.telemetry_repo.get_by_service(service_name, metric_type)
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/aiops_self_healing/application/service.py:289:34
    |
288 |     @staticmethod
289 |     def _calculate_trend(values: List[float]) -> float:
    |                                  ^^^^
290 |         """Calculate trend using simple linear regression"""
291 |         n = len(values)
    |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/application/service.py:310:10
    |
308 |     def generate_capacity_plan(
309 |         self, service_name: str, forecast_horizon_hours: int = 72
310 |     ) -> Optional[CapacityPlan]:
    |          ^^^^^^^^^^^^^^^^^^^^^^
311 |         """Generate capacity planning recommendation"""
312 |         forecast = self.forecast_load(service_name, MetricType.REQUEST_RATE, forecast_horizon_hours)
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/aiops_self_healing/application/service.py:341:54
    |
339 |     # ==================================================================================
340 |
341 |     def analyze_root_cause(self, anomaly_id: str) -> List[str]:
    |                                                      ^^^^
342 |         """Analyze root cause of anomaly using AI"""
343 |         anomaly = self.anomaly_repo.get(anomaly_id)
    |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/aiops_self_healing/application/service.py:370:77
    |
368 |         return root_causes
369 |
370 |     def _get_service_metrics(self, service_name: str, minutes: int = 30) -> List[TelemetryData]:
    |                                                                             ^^^^
371 |         """Get service metrics for time window"""
372 |         cutoff = datetime.now(UTC) - timedelta(minutes=minutes)
    |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/application/service.py:386:36
    |
384 |     # ==================================================================================
385 |
386 |     def get_aiops_metrics(self) -> Dict[str, Any]:
    |                                    ^^^^
387 |         """Get AIOps service metrics"""
388 |         all_anomalies = self.anomaly_repo.get_all()
    |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/application/service.py:412:56
    |
410 |         }
411 |
412 |     def get_service_health(self, service_name: str) -> Dict[str, Any]:
    |                                                        ^^^^
413 |         """Get service health status"""
414 |         all_anomalies = self.anomaly_repo.get_all()
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/application/service.py:444:18
    |
443 | # Singleton Instance
444 | _aiops_instance: Optional[AIOpsService] = None
    |                  ^^^^^^^^^^^^^^^^^^^^^^
445 | _aiops_lock = threading.Lock()
    |
help: Convert to `X | None`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/aiops_self_healing/domain/models.py:1:1
  |
1 | / from enum import Enum
2 | | from dataclasses import dataclass, field
3 | | from datetime import datetime
4 | | from typing import Any, List, Dict, Optional
  | |____________________________________________^
5 |
6 |   # ======================================================================================
  |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
 --> app/services/aiops_self_healing/domain/models.py:4:1
  |
2 | from dataclasses import dataclass, field
3 | from datetime import datetime
4 | from typing import Any, List, Dict, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
5 |
6 | # ======================================================================================
  |

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/services/aiops_self_healing/domain/models.py:4:1
  |
2 | from dataclasses import dataclass, field
3 | from datetime import datetime
4 | from typing import Any, List, Dict, Optional
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
5 |
6 | # ======================================================================================
  |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/models.py:71:13
   |
69 |     value: float
70 |     timestamp: datetime
71 |     labels: Dict[str, str] = field(default_factory=dict)
   |             ^^^^
72 |     unit: str = ""
   |
help: Replace with `dict`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/aiops_self_healing/domain/models.py:88:18
   |
86 |     confidence: float  # 0-1
87 |     description: str
88 |     root_causes: List[str] = field(default_factory=list)
   |                  ^^^^
89 |     resolved: bool = False
90 |     resolved_at: Optional[datetime] = None
   |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
  --> app/services/aiops_self_healing/domain/models.py:90:18
   |
88 |     root_causes: List[str] = field(default_factory=list)
89 |     resolved: bool = False
90 |     resolved_at: Optional[datetime] = None
   |                  ^^^^^^^^^^^^^^^^^^
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/domain/models.py:115:17
    |
113 |     action: HealingAction
114 |     reason: str
115 |     parameters: Dict[str, Any]
    |                 ^^^^
116 |     executed_at: Optional[datetime] = None
117 |     success: Optional[bool] = None
    |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/domain/models.py:116:18
    |
114 |     reason: str
115 |     parameters: Dict[str, Any]
116 |     executed_at: Optional[datetime] = None
    |                  ^^^^^^^^^^^^^^^^^^
117 |     success: Optional[bool] = None
118 |     impact: Dict[str, Any] = field(default_factory=dict)
    |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> app/services/aiops_self_healing/domain/models.py:117:14
    |
115 |     parameters: Dict[str, Any]
116 |     executed_at: Optional[datetime] = None
117 |     success: Optional[bool] = None
    |              ^^^^^^^^^^^^^^
118 |     impact: Dict[str, Any] = field(default_factory=dict)
    |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/aiops_self_healing/domain/models.py:118:13
    |
116 |     executed_at: Optional[datetime] = None
117 |     success: Optional[bool] = None
118 |     impact: Dict[str, Any] = field(default_factory=dict)
    |             ^^^^
    |
help: Replace with `dict`

UP035 `typing.List` is deprecated, use `list` instead
 --> app/services/aiops_self_healing/domain/ports.py:1:1
  |
1 | from typing import Protocol, List, Dict, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from .models import (
3 |     TelemetryData,
  |

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/services/aiops_self_healing/domain/ports.py:1:1
  |
1 | from typing import Protocol, List, Dict, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from .models import (
3 |     TelemetryData,
  |

UP035 `typing.Deque` is deprecated, use `collections.deque` instead
 --> app/services/aiops_self_healing/domain/ports.py:1:1
  |
1 | from typing import Protocol, List, Dict, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from .models import (
3 |     TelemetryData,
  |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/aiops_self_healing/domain/ports.py:1:1
   |
 1 | / from typing import Protocol, List, Dict, Optional, Deque
 2 | | from .models import (
 3 | |     TelemetryData,
 4 | |     AnomalyDetection,
 5 | |     LoadForecast,
 6 | |     HealingDecision,
 7 | |     CapacityPlan,
 8 | |     MetricType
 9 | | )
   | |_^
10 |
11 |   class TelemetryRepository(Protocol):
   |
help: Organize imports

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:13:77
   |
11 | class TelemetryRepository(Protocol):
12 |     def add(self, data: TelemetryData) -> None: ...
13 |     def get_by_service(self, service_name: str, metric_type: MetricType) -> List[TelemetryData]: ...
   |                                                                             ^^^^
14 |     def get_all(self) -> Dict[str, Deque[TelemetryData]]: ...
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:14:26
   |
12 |     def add(self, data: TelemetryData) -> None: ...
13 |     def get_by_service(self, service_name: str, metric_type: MetricType) -> List[TelemetryData]: ...
14 |     def get_all(self) -> Dict[str, Deque[TelemetryData]]: ...
   |                          ^^^^
15 |
16 | class AnomalyRepository(Protocol):
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:14:36
   |
12 |     def add(self, data: TelemetryData) -> None: ...
13 |     def get_by_service(self, service_name: str, metric_type: MetricType) -> List[TelemetryData]: ...
14 |     def get_all(self) -> Dict[str, Deque[TelemetryData]]: ...
   |                                    ^^^^^
15 |
16 | class AnomalyRepository(Protocol):
   |
help: Replace with `collections.deque`

UP045 [*] Use `X | None` for type annotations
  --> app/services/aiops_self_healing/domain/ports.py:18:39
   |
16 | class AnomalyRepository(Protocol):
17 |     def add(self, anomaly: AnomalyDetection) -> None: ...
18 |     def get(self, anomaly_id: str) -> Optional[AnomalyDetection]: ...
   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |     def get_all(self) -> Dict[str, AnomalyDetection]: ...
20 |     def update(self, anomaly: AnomalyDetection) -> None: ...
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:19:26
   |
17 |     def add(self, anomaly: AnomalyDetection) -> None: ...
18 |     def get(self, anomaly_id: str) -> Optional[AnomalyDetection]: ...
19 |     def get_all(self) -> Dict[str, AnomalyDetection]: ...
   |                          ^^^^
20 |     def update(self, anomaly: AnomalyDetection) -> None: ...
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:24:26
   |
22 | class HealingDecisionRepository(Protocol):
23 |     def add(self, decision: HealingDecision) -> None: ...
24 |     def get_all(self) -> Dict[str, HealingDecision]: ...
   |                          ^^^^
25 |
26 | class ForecastRepository(Protocol):
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:28:41
   |
26 | class ForecastRepository(Protocol):
27 |     def add(self, service_name: str, forecast: LoadForecast) -> None: ...
28 |     def get(self, service_name: str) -> Deque[LoadForecast]: ...
   |                                         ^^^^^
29 |     def get_all(self) -> Dict[str, Deque[LoadForecast]]: ...
   |
help: Replace with `collections.deque`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:29:26
   |
27 |     def add(self, service_name: str, forecast: LoadForecast) -> None: ...
28 |     def get(self, service_name: str) -> Deque[LoadForecast]: ...
29 |     def get_all(self) -> Dict[str, Deque[LoadForecast]]: ...
   |                          ^^^^
30 |
31 | class CapacityPlanRepository(Protocol):
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:29:36
   |
27 |     def add(self, service_name: str, forecast: LoadForecast) -> None: ...
28 |     def get(self, service_name: str) -> Deque[LoadForecast]: ...
29 |     def get_all(self) -> Dict[str, Deque[LoadForecast]]: ...
   |                                    ^^^^^
30 |
31 | class CapacityPlanRepository(Protocol):
   |
help: Replace with `collections.deque`

UP045 [*] Use `X | None` for type annotations
  --> app/services/aiops_self_healing/domain/ports.py:33:41
   |
31 | class CapacityPlanRepository(Protocol):
32 |     def add(self, service_name: str, plan: CapacityPlan) -> None: ...
33 |     def get(self, service_name: str) -> Optional[CapacityPlan]: ...
   |                                         ^^^^^^^^^^^^^^^^^^^^^^
34 |     def get_all(self) -> Dict[str, CapacityPlan]: ...
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/domain/ports.py:34:26
   |
32 |     def add(self, service_name: str, plan: CapacityPlan) -> None: ...
33 |     def get(self, service_name: str) -> Optional[CapacityPlan]: ...
34 |     def get_all(self) -> Dict[str, CapacityPlan]: ...
   |                          ^^^^
   |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/aiops_self_healing/infrastructure/repositories.py:1:1
   |
 1 | / from collections import defaultdict, deque
 2 | | from typing import Dict, List, Optional, Deque
 3 | | from ..domain.models import (
 4 | |     TelemetryData,
 5 | |     AnomalyDetection,
 6 | |     LoadForecast,
 7 | |     HealingDecision,
 8 | |     CapacityPlan,
 9 | |     MetricType
10 | | )
11 | | from ..domain.ports import (
12 | |     TelemetryRepository,
13 | |     AnomalyRepository,
14 | |     HealingDecisionRepository,
15 | |     ForecastRepository,
16 | |     CapacityPlanRepository
17 | | )
   | |_^
18 |
19 |   class InMemoryTelemetryRepository(TelemetryRepository):
   |
help: Organize imports

UP035 `typing.Dict` is deprecated, use `dict` instead
 --> app/services/aiops_self_healing/infrastructure/repositories.py:2:1
  |
1 | from collections import defaultdict, deque
2 | from typing import Dict, List, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 | from ..domain.models import (
4 |     TelemetryData,
  |

UP035 `typing.List` is deprecated, use `list` instead
 --> app/services/aiops_self_healing/infrastructure/repositories.py:2:1
  |
1 | from collections import defaultdict, deque
2 | from typing import Dict, List, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 | from ..domain.models import (
4 |     TelemetryData,
  |

UP035 `typing.Deque` is deprecated, use `collections.deque` instead
 --> app/services/aiops_self_healing/infrastructure/repositories.py:2:1
  |
1 | from collections import defaultdict, deque
2 | from typing import Dict, List, Optional, Deque
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
3 | from ..domain.models import (
4 |     TelemetryData,
  |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:21:21
   |
19 | class InMemoryTelemetryRepository(TelemetryRepository):
20 |     def __init__(self):
21 |         self._data: Dict[str, Deque[TelemetryData]] = defaultdict(lambda: deque(maxlen=10000))
   |                     ^^^^
22 |
23 |     def add(self, data: TelemetryData) -> None:
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:21:31
   |
19 | class InMemoryTelemetryRepository(TelemetryRepository):
20 |     def __init__(self):
21 |         self._data: Dict[str, Deque[TelemetryData]] = defaultdict(lambda: deque(maxlen=10000))
   |                               ^^^^^
22 |
23 |     def add(self, data: TelemetryData) -> None:
   |
help: Replace with `collections.deque`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:27:77
   |
25 |         self._data[key].append(data)
26 |
27 |     def get_by_service(self, service_name: str, metric_type: MetricType) -> List[TelemetryData]:
   |                                                                             ^^^^
28 |         key = f"{service_name}:{metric_type.value}"
29 |         return list(self._data.get(key, []))
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:31:26
   |
29 |         return list(self._data.get(key, []))
30 |
31 |     def get_all(self) -> Dict[str, Deque[TelemetryData]]:
   |                          ^^^^
32 |         return self._data
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:31:36
   |
29 |         return list(self._data.get(key, []))
30 |
31 |     def get_all(self) -> Dict[str, Deque[TelemetryData]]:
   |                                    ^^^^^
32 |         return self._data
   |
help: Replace with `collections.deque`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:36:21
   |
34 | class InMemoryAnomalyRepository(AnomalyRepository):
35 |     def __init__(self):
36 |         self._data: Dict[str, AnomalyDetection] = {}
   |                     ^^^^
37 |
38 |     def add(self, anomaly: AnomalyDetection) -> None:
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/services/aiops_self_healing/infrastructure/repositories.py:41:39
   |
39 |         self._data[anomaly.anomaly_id] = anomaly
40 |
41 |     def get(self, anomaly_id: str) -> Optional[AnomalyDetection]:
   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |         return self._data.get(anomaly_id)
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:44:26
   |
42 |         return self._data.get(anomaly_id)
43 |
44 |     def get_all(self) -> Dict[str, AnomalyDetection]:
   |                          ^^^^
45 |         return self._data
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:52:21
   |
50 | class InMemoryHealingDecisionRepository(HealingDecisionRepository):
51 |     def __init__(self):
52 |         self._data: Dict[str, HealingDecision] = {}
   |                     ^^^^
53 |
54 |     def add(self, decision: HealingDecision) -> None:
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:57:26
   |
55 |         self._data[decision.decision_id] = decision
56 |
57 |     def get_all(self) -> Dict[str, HealingDecision]:
   |                          ^^^^
58 |         return self._data
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:62:21
   |
60 | class InMemoryForecastRepository(ForecastRepository):
61 |     def __init__(self):
62 |         self._data: Dict[str, Deque[LoadForecast]] = defaultdict(lambda: deque(maxlen=100))
   |                     ^^^^
63 |
64 |     def add(self, service_name: str, forecast: LoadForecast) -> None:
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:62:31
   |
60 | class InMemoryForecastRepository(ForecastRepository):
61 |     def __init__(self):
62 |         self._data: Dict[str, Deque[LoadForecast]] = defaultdict(lambda: deque(maxlen=100))
   |                               ^^^^^
63 |
64 |     def add(self, service_name: str, forecast: LoadForecast) -> None:
   |
help: Replace with `collections.deque`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:67:41
   |
65 |         self._data[service_name].append(forecast)
66 |
67 |     def get(self, service_name: str) -> Deque[LoadForecast]:
   |                                         ^^^^^
68 |         return self._data.get(service_name, deque())
   |
help: Replace with `collections.deque`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:70:26
   |
68 |         return self._data.get(service_name, deque())
69 |
70 |     def get_all(self) -> Dict[str, Deque[LoadForecast]]:
   |                          ^^^^
71 |         return self._data
   |
help: Replace with `dict`

UP006 [*] Use `collections.deque` instead of `Deque` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:70:36
   |
68 |         return self._data.get(service_name, deque())
69 |
70 |     def get_all(self) -> Dict[str, Deque[LoadForecast]]:
   |                                    ^^^^^
71 |         return self._data
   |
help: Replace with `collections.deque`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:75:21
   |
73 | class InMemoryCapacityPlanRepository(CapacityPlanRepository):
74 |     def __init__(self):
75 |         self._data: Dict[str, CapacityPlan] = {}
   |                     ^^^^
76 |
77 |     def add(self, service_name: str, plan: CapacityPlan) -> None:
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/services/aiops_self_healing/infrastructure/repositories.py:80:41
   |
78 |         self._data[service_name] = plan
79 |
80 |     def get(self, service_name: str) -> Optional[CapacityPlan]:
   |                                         ^^^^^^^^^^^^^^^^^^^^^^
81 |         return self._data.get(service_name)
   |
help: Convert to `X | None`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/aiops_self_healing/infrastructure/repositories.py:83:26
   |
81 |         return self._data.get(service_name)
82 |
83 |     def get_all(self) -> Dict[str, CapacityPlan]:
   |                          ^^^^
84 |         return self._data
   |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/aiops_self_healing_service.py:20:1
   |
18 |   Status:  Wave 10 Refactored
19 |   """
20 | / from __future__ import annotations
21 | |
22 | | # Import from new modular structure
23 | | from .aiops_self_healing.domain.models import (
24 | |     AnomalyType,
25 | |     AnomalySeverity,
26 | |     HealingAction,
27 | |     MetricType,
28 | |     TelemetryData,
29 | |     AnomalyDetection,
30 | |     LoadForecast,
31 | |     HealingDecision,
32 | |     CapacityPlan,
33 | | )
34 | | from .aiops_self_healing.application.service import (
35 | |     AIOpsService,
36 | |     get_aiops_service,
37 | | )
   | |_^
38 |
39 |   # Re-export for backward compatibility
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/aiops_self_healing_service.py:40:11
   |
39 |   # Re-export for backward compatibility
40 |   __all__ = [
   |  ___________^
41 | |     "AnomalyType",
42 | |     "AnomalySeverity",
43 | |     "HealingAction",
44 | |     "MetricType",
45 | |     "TelemetryData",
46 | |     "AnomalyDetection",
47 | |     "LoadForecast",
48 | |     "HealingDecision",
49 | |     "CapacityPlan",
50 | |     "AIOpsService",
51 | |     "get_aiops_service",
52 | | ]
   | |_^
53 |
54 |   # Singleton instance
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/analytics/__init__.py:20:1
   |
19 |   # Domain exports
20 | / from app.services.analytics.domain import (
21 | |     ABTestResults,
22 | |     ABTestVariant,
23 | |     CohortAnalysis,
24 | |     ConversionMetrics,
25 | |     EngagementMetrics,
26 | |     EventType,
27 | |     NPSMetrics,
28 | |     RetentionMetrics,
29 | |     RevenueMetrics,
30 | |     UserEvent,
31 | |     UserSegment,
32 | |     UserSession,
33 | | )
34 | |
35 | | # Application layer exports
36 | | from app.services.analytics.application.event_tracker import EventTracker
37 | | from app.services.analytics.application.engagement_analyzer import EngagementAnalyzer
38 | |
39 | | # Infrastructure exports
40 | | from app.services.analytics.infrastructure.in_memory_repository import (
41 | |     InMemoryEventRepository,
42 | |     InMemorySessionRepository,
43 | | )
44 | |
45 | | # Facade (backward compatibility)
46 | | from app.services.analytics.facade import (
47 | |     UserAnalyticsMetricsService,
48 | |     get_user_analytics_service,
49 | |     reset_analytics_service,
50 | | )
   | |_^
51 |
52 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/analytics/__init__.py:52:11
   |
50 |   )
51 |
52 |   __all__ = [
   |  ___________^
53 | |     # Domain models
54 | |     "EventType",
55 | |     "UserSegment",
56 | |     "ABTestVariant",
57 | |     "UserEvent",
58 | |     "EngagementMetrics",
59 | |     "ConversionMetrics",
60 | |     "RetentionMetrics",
61 | |     "NPSMetrics",
62 | |     "UserSession",
63 | |     "ABTestResults",
64 | |     "CohortAnalysis",
65 | |     "RevenueMetrics",
66 | |     # Application services
67 | |     "EventTracker",
68 | |     "EngagementAnalyzer",
69 | |     # Infrastructure
70 | |     "InMemoryEventRepository",
71 | |     "InMemorySessionRepository",
72 | |     # Facade (backward compatibility)
73 | |     "UserAnalyticsMetricsService",
74 | |     "get_user_analytics_service",
75 | |     "reset_analytics_service",
76 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `random` imported but unused
  --> app/services/analytics/application/ab_test_manager.py:11:8
   |
10 | import hashlib
11 | import random
   |        ^^^^^^
12 | from typing import Any
   |
help: Remove unused import: `random`

W293 Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:18:1
   |
16 |     """
17 |     A/B test experiment manager.
18 |
   | ^^^^
19 |     Responsibilities:
20 |     - Create A/B tests
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:25:1
   |
23 |     - Calculate statistical significance
24 |     """
25 |
   | ^^^^
26 |     def __init__(self):
27 |         self._tests: dict[str, dict[str, Any]] = {}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:30:1
   |
28 |         self._user_assignments: dict[str, dict[int, str]] = {}  # test_id -> {user_id -> variant}
29 |         self._conversions: dict[str, dict[str, set[int]]] = {}  # test_id -> {variant -> user_ids}
30 |
   | ^^^^
31 |     def create_test(
32 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:39:1
   |
37 |         """Create new A/B test"""
38 |         test_id = hashlib.sha256(f"{test_name}{len(self._tests)}".encode()).hexdigest()[:16]
39 |
   | ^^^^^^^^
40 |         # Default equal split if not provided
41 |         if traffic_split is None:
   |
help: Remove whitespace from blank line

C420 [*] Unnecessary dict comprehension for iterable; use `dict.fromkeys` instead
  --> app/services/analytics/application/ab_test_manager.py:43:29
   |
41 |         if traffic_split is None:
42 |             split_percent = 1.0 / len(variants)
43 |             traffic_split = {v: split_percent for v in variants}
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 |
45 |         self._tests[test_id] = {
   |
help: Replace with `dict.fromkeys(iterable)`)

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:44:1
   |
42 |             split_percent = 1.0 / len(variants)
43 |             traffic_split = {v: split_percent for v in variants}
44 |
   | ^^^^^^^^
45 |         self._tests[test_id] = {
46 |             "test_name": test_name,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:51:1
   |
49 |             "created_at": None,  # Could add datetime
50 |         }
51 |
   | ^^^^^^^^
52 |         self._user_assignments[test_id] = {}
53 |         self._conversions[test_id] = {v: set() for v in variants}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:54:1
   |
52 |         self._user_assignments[test_id] = {}
53 |         self._conversions[test_id] = {v: set() for v in variants}
54 |
   | ^^^^^^^^
55 |         return test_id
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:56:1
   |
55 |         return test_id
56 |
   | ^^^^
57 |     def assign_variant(self, test_id: str, user_id: int) -> str:
58 |         """Assign variant to user (deterministic based on user_id)"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:61:1
   |
59 |         if test_id not in self._tests:
60 |             raise ValueError(f"Test {test_id} not found")
61 |
   | ^^^^^^^^
62 |         # Check if user already assigned
63 |         if user_id in self._user_assignments[test_id]:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:65:1
   |
63 |         if user_id in self._user_assignments[test_id]:
64 |             return self._user_assignments[test_id][user_id]
65 |
   | ^^^^^^^^
66 |         # Deterministic assignment based on user_id hash
67 |         variants = self._tests[test_id]["variants"]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:71:1
   |
69 |         index = int(hash_val, 16) % len(variants)
70 |         variant = variants[index]
71 |
   | ^^^^^^^^
72 |         self._user_assignments[test_id][user_id] = variant
73 |         return variant
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:74:1
   |
72 |         self._user_assignments[test_id][user_id] = variant
73 |         return variant
74 |
   | ^^^^
75 |     def record_conversion(self, test_id: str, user_id: int) -> None:
76 |         """Record conversion for user"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:79:1
   |
77 |         if test_id not in self._tests:
78 |             raise ValueError(f"Test {test_id} not found")
79 |
   | ^^^^^^^^
80 |         # Get user's assigned variant
81 |         variant = self._user_assignments[test_id].get(user_id)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:84:1
   |
82 |         if variant:
83 |             self._conversions[test_id][variant].add(user_id)
84 |
   | ^^^^
85 |     def get_results(self, test_id: str) -> dict[str, Any] | None:
86 |         """Get A/B test results"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:89:1
   |
87 |         if test_id not in self._tests:
88 |             return None
89 |
   | ^^^^^^^^
90 |         test = self._tests[test_id]
91 |         variants = test["variants"]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/ab_test_manager.py:92:1
   |
90 |         test = self._tests[test_id]
91 |         variants = test["variants"]
92 |
   | ^^^^^^^^
93 |         # Calculate conversion rates per variant
94 |         variant_stats = {}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:101:1
    |
 99 |             conversions = len(self._conversions[test_id][variant])
100 |             conversion_rate = conversions / assigned if assigned > 0 else 0.0
101 |
    | ^^^^^^^^^^^^
102 |             variant_stats[variant] = {
103 |                 "assigned": assigned,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:107:1
    |
105 |                 "conversion_rate": conversion_rate,
106 |             }
107 |
    | ^^^^^^^^
108 |         # Find winner (highest conversion rate)
109 |         winner = max(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:113:1
    |
111 |             key=lambda v: variant_stats[v]["conversion_rate"],
112 |         ) if variant_stats else None
113 |
    | ^^^^^^^^
114 |         # Calculate improvement vs control (first variant)
115 |         control = variants[0] if variants else None
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:122:1
    |
120 |             if control_rate > 0:
121 |                 improvement_percent = ((winner_rate - control_rate) / control_rate) * 100
122 |
    | ^^^^^^^^
123 |         # Statistical significance (simplified)
124 |         statistical_significance = self._calculate_significance(variant_stats)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:125:1
    |
123 |         # Statistical significance (simplified)
124 |         statistical_significance = self._calculate_significance(variant_stats)
125 |
    | ^^^^^^^^
126 |         return {
127 |             "test_id": test_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:134:1
    |
132 |             "statistical_significance": statistical_significance,
133 |         }
134 |
    | ^^^^
135 |     def _calculate_significance(self, variant_stats: dict[str, Any]) -> float:
136 |         """Calculate statistical significance (simplified p-value)"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/ab_test_manager.py:140:1
    |
138 |         # like chi-square or z-test
139 |         total_samples = sum(v["assigned"] for v in variant_stats.values())
140 |
    | ^^^^^^^^
141 |         if total_samples < 100:
142 |             return 0.0  # Not enough data
    |
help: Remove whitespace from blank line

F401 [*] `datetime.datetime` imported but unused
  --> app/services/analytics/application/conversion_analyzer.py:11:22
   |
10 | import statistics
11 | from datetime import datetime, timedelta
   |                      ^^^^^^^^
12 | from typing import Any, Protocol
   |
help: Remove unused import

F401 [*] `datetime.timedelta` imported but unused
  --> app/services/analytics/application/conversion_analyzer.py:11:32
   |
10 | import statistics
11 | from datetime import datetime, timedelta
   |                                ^^^^^^^^^
12 | from typing import Any, Protocol
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:27:1
   |
25 |     """
26 |     Conversion metrics analyzer.
27 |
   | ^^^^
28 |     Responsibilities:
29 |     - Calculate conversion rates
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:33:1
   |
31 |     - Time to convert
32 |     """
33 |
   | ^^^^
34 |     def __init__(self, event_repository: EventRepository):
35 |         self._event_repo = event_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:36:1
   |
34 |     def __init__(self, event_repository: EventRepository):
35 |         self._event_repo = event_repository
36 |
   | ^^^^
37 |     def get_conversion_metrics(
38 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:44:1
   |
42 |         """Calculate conversion metrics"""
43 |         recent_events = self._event_repo.get_recent(days)
44 |
   | ^^^^^^^^
45 |         if not recent_events:
46 |             return self._empty_metrics()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:47:1
   |
45 |         if not recent_events:
46 |             return self._empty_metrics()
47 |
   | ^^^^^^^^
48 |         # Filter conversion events
49 |         conversions = [e for e in recent_events if e.event_name == conversion_event]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:50:1
   |
48 |         # Filter conversion events
49 |         conversions = [e for e in recent_events if e.event_name == conversion_event]
50 |
   | ^^^^^^^^
51 |         # Calculate unique visitors and converters
52 |         unique_visitors = len({e.user_id for e in recent_events})
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:54:1
   |
52 |         unique_visitors = len({e.user_id for e in recent_events})
53 |         unique_converters = len({e.user_id for e in conversions})
54 |
   | ^^^^^^^^
55 |         conversion_rate = unique_converters / unique_visitors if unique_visitors > 0 else 0.0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:56:1
   |
55 |         conversion_rate = unique_converters / unique_visitors if unique_visitors > 0 else 0.0
56 |
   | ^^^^^^^^
57 |         # Calculate average time to convert
58 |         avg_time_to_convert = self._calculate_time_to_convert(recent_events, conversion_event)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:59:1
   |
57 |         # Calculate average time to convert
58 |         avg_time_to_convert = self._calculate_time_to_convert(recent_events, conversion_event)
59 |
   | ^^^^^^^^
60 |         # Calculate conversion value
61 |         conversion_value = sum(e.properties.get("value", 0.0) for e in conversions)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:62:1
   |
60 |         # Calculate conversion value
61 |         conversion_value = sum(e.properties.get("value", 0.0) for e in conversions)
62 |
   | ^^^^^^^^
63 |         return {
64 |             "conversion_rate": conversion_rate,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:73:1
   |
71 |             "drop_off_points": {},  # Placeholder for funnel analysis
72 |         }
73 |
   | ^^^^
74 |     def _calculate_time_to_convert(
75 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:82:1
   |
80 |         user_first_event = {}
81 |         user_conversion_time = {}
82 |
   | ^^^^^^^^
83 |         # Sort events by timestamp
84 |         sorted_events = sorted(events, key=lambda e: e.timestamp)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:85:1
   |
83 |         # Sort events by timestamp
84 |         sorted_events = sorted(events, key=lambda e: e.timestamp)
85 |
   | ^^^^^^^^
86 |         for event in sorted_events:
87 |             # Track first event per user
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:90:1
   |
88 |             if event.user_id not in user_first_event:
89 |                 user_first_event[event.user_id] = event.timestamp
90 |
   | ^^^^^^^^^^^^
91 |             # Track conversion time
92 |             if event.event_name == conversion_event and event.user_id not in user_conversion_time:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/conversion_analyzer.py:94:1
   |
92 |             if event.event_name == conversion_event and event.user_id not in user_conversion_time:
93 |                 user_conversion_time[event.user_id] = event.timestamp
94 |
   | ^^^^^^^^
95 |         # Calculate time differences
96 |         conversion_times = []
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/conversion_analyzer.py:101:1
    |
 99 |                 time_diff = (conversion_time - user_first_event[user_id]).total_seconds()
100 |                 conversion_times.append(time_diff)
101 |
    | ^^^^^^^^
102 |         return statistics.mean(conversion_times) if conversion_times else 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/conversion_analyzer.py:103:1
    |
102 |         return statistics.mean(conversion_times) if conversion_times else 0.0
103 |
    | ^^^^
104 |     def _empty_metrics(self) -> dict[str, Any]:
105 |         """Return empty metrics"""
    |
help: Remove whitespace from blank line

F401 [*] `typing.Any` imported but unused
  --> app/services/analytics/application/engagement_analyzer.py:14:20
   |
12 | import logging
13 | from datetime import datetime, timedelta
14 | from typing import Any
   |                    ^^^
15 |
16 | from app.services.analytics.domain.models import EngagementMetrics, EventType
   |
help: Remove unused import: `typing.Any`

F401 [*] `app.services.analytics.domain.models.EventType` imported but unused
  --> app/services/analytics/application/engagement_analyzer.py:16:69
   |
14 | from typing import Any
15 |
16 | from app.services.analytics.domain.models import EngagementMetrics, EventType
   |                                                                     ^^^^^^^^^
17 | from app.services.analytics.domain.ports import EventRepositoryPort, SessionRepositoryPort
   |
help: Remove unused import: `app.services.analytics.domain.models.EventType`

W293 Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:30:1
   |
28 |     """
29 |     Engagement analysis service.
30 |
   | ^^^^
31 |     Responsibilities:
32 |     - Calculate DAU/WAU/MAU metrics
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:45:1
   |
43 |         """
44 |         Initialize engagement analyzer.
45 |
   | ^^^^^^^^
46 |         Args:
47 |             event_repository: Event storage repository
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:60:1
   |
58 |         """
59 |         Calculate comprehensive engagement metrics.
60 |
   | ^^^^^^^^
61 |         Args:
62 |             start_time: Start of analysis period (defaults to 30 days ago)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:64:1
   |
62 |             start_time: Start of analysis period (defaults to 30 days ago)
63 |             end_time: End of analysis period (defaults to now)
64 |
   | ^^^^^^^^^^^^
65 |         Returns:
66 |             EngagementMetrics value object
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:72:1
   |
70 |         if start_time is None:
71 |             start_time = end_time - timedelta(days=30)
72 |
   | ^^^^^^^^
73 |         # Calculate active users
74 |         dau = self._calculate_dau(end_time)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:77:1
   |
75 |         wau = self._calculate_wau(end_time)
76 |         mau = self._calculate_mau(end_time)
77 |
   | ^^^^^^^^
78 |         # Calculate session metrics
79 |         avg_session_duration = self._calculate_avg_session_duration(start_time, end_time)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:81:1
   |
79 |         avg_session_duration = self._calculate_avg_session_duration(start_time, end_time)
80 |         avg_events_per_session = self._calculate_avg_events_per_session(start_time, end_time)
81 |
   | ^^^^^^^^
82 |         # Calculate rates
83 |         bounce_rate = self._calculate_bounce_rate(start_time, end_time)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/engagement_analyzer.py:85:1
   |
83 |         bounce_rate = self._calculate_bounce_rate(start_time, end_time)
84 |         return_rate = self._calculate_return_rate(start_time, end_time)
85 |
   | ^^^^^^^^
86 |         return EngagementMetrics(
87 |             dau=dau,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:99:1
    |
 97 |         """
 98 |         Get count of active users in last N days.
 99 |
    | ^^^^^^^^
100 |         Args:
101 |             days: Number of days to look back
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:102:1
    |
100 |         Args:
101 |             days: Number of days to look back
102 |
    | ^^^^^^^^^^^^
103 |         Returns:
104 |             Number of unique active users
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:108:1
    |
106 |         end_time = datetime.utcnow()
107 |         start_time = end_time - timedelta(days=days)
108 |
    | ^^^^^^^^
109 |         events = self._event_repo.get_events(
110 |             start_time=start_time,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:114:1
    |
112 |             limit=float('inf'),  # type: ignore
113 |         )
114 |
    | ^^^^^^^^
115 |         unique_users = set(event.user_id for event in events)
116 |         return len(unique_users)
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
   --> app/services/analytics/application/engagement_analyzer.py:115:24
    |
113 |         )
114 |
115 |         unique_users = set(event.user_id for event in events)
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
116 |         return len(unique_users)
    |
help: Rewrite as a set comprehension

W293 Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:125:1
    |
123 |         """
124 |         Calculate engagement score for a user.
125 |
    | ^^^^^^^^
126 |         Engagement score is a composite metric based on:
127 |         - Visit frequency
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:131:1
    |
129 |         - Feature usage
130 |         - Recency of activity
131 |
    | ^^^^^^^^
132 |         Args:
133 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:135:1
    |
133 |             user_id: User identifier
134 |             days: Number of days to analyze
135 |
    | ^^^^^^^^^^^^
136 |         Returns:
137 |             Engagement score (0-100)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:141:1
    |
139 |         end_time = datetime.utcnow()
140 |         start_time = end_time - timedelta(days=days)
141 |
    | ^^^^^^^^
142 |         # Get user events
143 |         events = self._event_repo.get_events(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:149:1
    |
147 |             limit=float('inf'),  # type: ignore
148 |         )
149 |
    | ^^^^^^^^
150 |         if not events:
151 |             return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:152:1
    |
150 |         if not events:
151 |             return 0.0
152 |
    | ^^^^^^^^
153 |         # Get user sessions
154 |         sessions = self._session_repo.get_user_sessions(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:159:1
    |
157 |             end_time=end_time,
158 |         )
159 |
    | ^^^^^^^^
160 |         # Calculate components
161 |         frequency_score = min(len(sessions) / days * 100, 30)  # Max 30 points
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:167:1
    |
165 |         )
166 |         activity_score = min(len(events) / (days * 10) * 100, 30)  # Max 30 points
167 |
    | ^^^^^^^^
168 |         # Recency bonus (last 7 days)
169 |         recent_events = [e for e in events if e.timestamp > end_time - timedelta(days=7)]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:171:1
    |
169 |         recent_events = [e for e in events if e.timestamp > end_time - timedelta(days=7)]
170 |         recency_score = min(len(recent_events) / 10 * 10, 10)  # Max 10 points
171 |
    | ^^^^^^^^
172 |         total_score = frequency_score + duration_score + activity_score + recency_score
173 |         return min(total_score, 100.0)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:179:1
    |
177 |         start_time = date.replace(hour=0, minute=0, second=0, microsecond=0)
178 |         end_time = start_time + timedelta(days=1)
179 |
    | ^^^^^^^^
180 |         events = self._event_repo.get_events(
181 |             start_time=start_time,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:185:1
    |
183 |             limit=float('inf'),  # type: ignore
184 |         )
185 |
    | ^^^^^^^^
186 |         return len(set(event.user_id for event in events))
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
   --> app/services/analytics/application/engagement_analyzer.py:186:20
    |
184 |         )
185 |
186 |         return len(set(event.user_id for event in events))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
187 |
188 |     def _calculate_wau(self, date: datetime) -> int:
    |
help: Rewrite as a set comprehension

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:192:1
    |
190 |         end_time = date
191 |         start_time = end_time - timedelta(days=7)
192 |
    | ^^^^^^^^
193 |         events = self._event_repo.get_events(
194 |             start_time=start_time,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:198:1
    |
196 |             limit=float('inf'),  # type: ignore
197 |         )
198 |
    | ^^^^^^^^
199 |         return len(set(event.user_id for event in events))
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
   --> app/services/analytics/application/engagement_analyzer.py:199:20
    |
197 |         )
198 |
199 |         return len(set(event.user_id for event in events))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
200 |
201 |     def _calculate_mau(self, date: datetime) -> int:
    |
help: Rewrite as a set comprehension

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:205:1
    |
203 |         end_time = date
204 |         start_time = end_time - timedelta(days=30)
205 |
    | ^^^^^^^^
206 |         events = self._event_repo.get_events(
207 |             start_time=start_time,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:211:1
    |
209 |             limit=float('inf'),  # type: ignore
210 |         )
211 |
    | ^^^^^^^^
212 |         return len(set(event.user_id for event in events))
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
   --> app/services/analytics/application/engagement_analyzer.py:212:20
    |
210 |         )
211 |
212 |         return len(set(event.user_id for event in events))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
213 |
214 |     def _calculate_avg_session_duration(
    |
help: Rewrite as a set comprehension

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:221:1
    |
219 |         """Calculate average session duration in seconds."""
220 |         sessions = self._session_repo.get_active_sessions(since=start_time)
221 |
    | ^^^^^^^^
222 |         if not sessions:
223 |             return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:224:1
    |
222 |         if not sessions:
223 |             return 0.0
224 |
    | ^^^^^^^^
225 |         total_duration = sum(s.duration_seconds for s in sessions)
226 |         return total_duration / len(sessions)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:235:1
    |
233 |         """Calculate average events per session."""
234 |         sessions = self._session_repo.get_active_sessions(since=start_time)
235 |
    | ^^^^^^^^
236 |         if not sessions:
237 |             return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:238:1
    |
236 |         if not sessions:
237 |             return 0.0
238 |
    | ^^^^^^^^
239 |         total_events = sum(s.events for s in sessions)
240 |         return total_events / len(sessions)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:249:1
    |
247 |         """Calculate bounce rate (sessions with 1 or fewer page views)."""
248 |         sessions = self._session_repo.get_active_sessions(since=start_time)
249 |
    | ^^^^^^^^
250 |         if not sessions:
251 |             return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:252:1
    |
250 |         if not sessions:
251 |             return 0.0
252 |
    | ^^^^^^^^
253 |         bounced_sessions = sum(1 for s in sessions if s.is_bounce)
254 |         return bounced_sessions / len(sessions)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:263:1
    |
261 |         """Calculate return rate (users with multiple sessions)."""
262 |         sessions = self._session_repo.get_active_sessions(since=start_time)
263 |
    | ^^^^^^^^
264 |         if not sessions:
265 |             return 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:266:1
    |
264 |         if not sessions:
265 |             return 0.0
266 |
    | ^^^^^^^^
267 |         # Count sessions per user
268 |         user_sessions: dict[int, int] = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:271:1
    |
269 |         for session in sessions:
270 |             user_sessions[session.user_id] = user_sessions.get(session.user_id, 0) + 1
271 |
    | ^^^^^^^^
272 |         # Count users with multiple sessions
273 |         returning_users = sum(1 for count in user_sessions.values() if count > 1)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/engagement_analyzer.py:275:1
    |
273 |         returning_users = sum(1 for count in user_sessions.values() if count > 1)
274 |         total_users = len(user_sessions)
275 |
    | ^^^^^^^^
276 |         return returning_users / total_users if total_users > 0 else 0.0
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:32:1
   |
30 |     """
31 |     Event tracking service.
32 |
   | ^^^^
33 |     Responsibilities:
34 |     - Create and validate user events
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:47:1
   |
45 |         """
46 |         Initialize event tracker.
47 |
   | ^^^^^^^^
48 |         Args:
49 |             event_repository: Event storage repository
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:68:1
   |
66 |         """
67 |         Track a user event.
68 |
   | ^^^^^^^^
69 |         Args:
70 |             user_id: User identifier
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:78:1
   |
76 |             device_type: Device type (mobile, desktop, tablet)
77 |             timestamp: Event timestamp (current time if None)
78 |
   | ^^^^^^^^^^^^
79 |         Returns:
80 |             Generated event ID
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:84:1
   |
82 |         # Generate event ID
83 |         event_id = self._generate_event_id(user_id, event_name)
84 |
   | ^^^^^^^^
85 |         # Use current time if not provided
86 |         if timestamp is None:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/event_tracker.py:88:1
   |
86 |         if timestamp is None:
87 |             timestamp = datetime.utcnow()
88 |
   | ^^^^^^^^
89 |         # Create event
90 |         event = UserEvent(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:101:1
    |
 99 |             device_type=device_type,
100 |         )
101 |
    | ^^^^^^^^
102 |         # Store event
103 |         self._event_repo.store_event(event)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:104:1
    |
102 |         # Store event
103 |         self._event_repo.store_event(event)
104 |
    | ^^^^^^^^
105 |         # Update session
106 |         self._update_session(event)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:107:1
    |
105 |         # Update session
106 |         self._update_session(event)
107 |
    | ^^^^^^^^
108 |         _LOG.debug(f"Tracked event: {event_id} for user {user_id}")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:109:1
    |
108 |         _LOG.debug(f"Tracked event: {event_id} for user {user_id}")
109 |
    | ^^^^^^^^
110 |         return event_id
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:121:1
    |
119 |         """
120 |         Track a page view event.
121 |
    | ^^^^^^^^
122 |         Args:
123 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:127:1
    |
125 |             session_id: Session identifier
126 |             **kwargs: Additional properties
127 |
    | ^^^^^^^^^^^^
128 |         Returns:
129 |             Event ID
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:150:1
    |
148 |         """
149 |         Track a conversion event.
150 |
    | ^^^^^^^^
151 |         Args:
152 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:157:1
    |
155 |             value: Conversion value
156 |             **kwargs: Additional properties
157 |
    | ^^^^^^^^^^^^
158 |         Returns:
159 |             Event ID
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:164:1
    |
162 |         if value is not None:
163 |             properties["value"] = value
164 |
    | ^^^^^^^^
165 |         return self.track_event(
166 |             user_id=user_id,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:183:1
    |
181 |         """
182 |         Track a purchase event.
183 |
    | ^^^^^^^^
184 |         Args:
185 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:190:1
    |
188 |             session_id: Session identifier
189 |             **kwargs: Additional properties (product_id, quantity, etc.)
190 |
    | ^^^^^^^^^^^^
191 |         Returns:
192 |             Event ID
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:199:1
    |
197 |             "currency": currency,
198 |         })
199 |
    | ^^^^^^^^
200 |         return self.track_event(
201 |             user_id=user_id,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:216:1
    |
214 |         """
215 |         Get events for a user.
216 |
    | ^^^^^^^^
217 |         Args:
218 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:221:1
    |
219 |             event_type: Optional event type filter
220 |             limit: Maximum number of events
221 |
    | ^^^^^^^^^^^^
222 |         Returns:
223 |             List of user events
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:245:1
    |
243 |         # Get or create session
244 |         session = self._session_repo.get_session(event.session_id)
245 |
    | ^^^^^^^^
246 |         if session is None:
247 |             # Create new session
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:249:1
    |
247 |             # Create new session
248 |             from app.services.analytics.domain.models import UserSession
249 |
    | ^^^^^^^^^^^^
250 |             session = UserSession(
251 |                 session_id=event.session_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:257:1
    |
255 |                 entry_page=event.page_url or "/",
256 |             )
257 |
    | ^^^^^^^^
258 |         # Update session with event
259 |         session.update_activity(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/event_tracker.py:264:1
    |
262 |             timestamp=event.timestamp,
263 |         )
264 |
    | ^^^^^^^^
265 |         # Store updated session
266 |         self._session_repo.store_session(session)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:18:1
   |
16 |     """
17 |     Net Promoter Score manager.
18 |
   | ^^^^
19 |     Responsibilities:
20 |     - Record NPS responses
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:24:1
   |
22 |     - Classify promoters/passives/detractors
23 |     """
24 |
   | ^^^^
25 |     def __init__(self):
26 |         self._responses: list[dict[str, Any]] = []
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:27:1
   |
25 |     def __init__(self):
26 |         self._responses: list[dict[str, Any]] = []
27 |
   | ^^^^
28 |     def record_response(
29 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:37:1
   |
35 |         if not 0 <= score <= 10:
36 |             raise ValueError("NPS score must be between 0 and 10")
37 |
   | ^^^^^^^^
38 |         response = {
39 |             "user_id": user_id,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:44:1
   |
42 |             "timestamp": datetime.utcnow(),
43 |         }
44 |
   | ^^^^^^^^
45 |         self._responses.append(response)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:46:1
   |
45 |         self._responses.append(response)
46 |
   | ^^^^
47 |     def get_metrics(self) -> dict[str, Any]:
48 |         """Calculate NPS metrics"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:51:1
   |
49 |         if not self._responses:
50 |             return self._empty_metrics()
51 |
   | ^^^^^^^^
52 |         scores = [r["score"] for r in self._responses]
53 |         total = len(scores)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:54:1
   |
52 |         scores = [r["score"] for r in self._responses]
53 |         total = len(scores)
54 |
   | ^^^^^^^^
55 |         # Classify responses
56 |         # Promoters: 9-10
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:62:1
   |
60 |         passives = sum(1 for s in scores if 7 <= s <= 8)
61 |         detractors = sum(1 for s in scores if s <= 6)
62 |
   | ^^^^^^^^
63 |         promoters_percent = (promoters / total) * 100
64 |         passives_percent = (passives / total) * 100
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:66:1
   |
64 |         passives_percent = (passives / total) * 100
65 |         detractors_percent = (detractors / total) * 100
66 |
   | ^^^^^^^^
67 |         # NPS = % promoters - % detractors
68 |         nps_score = promoters_percent - detractors_percent
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:69:1
   |
67 |         # NPS = % promoters - % detractors
68 |         nps_score = promoters_percent - detractors_percent
69 |
   | ^^^^^^^^
70 |         avg_score = statistics.mean(scores)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:71:1
   |
70 |         avg_score = statistics.mean(scores)
71 |
   | ^^^^^^^^
72 |         return {
73 |             "nps_score": nps_score,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:80:1
   |
78 |             "avg_score": avg_score,
79 |         }
80 |
   | ^^^^
81 |     def _empty_metrics(self) -> dict[str, Any]:
82 |         """Return empty metrics"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/nps_manager.py:91:1
   |
89 |             "avg_score": 0.0,
90 |         }
91 |
   | ^^^^
92 |     def get_recent_comments(self, limit: int = 10) -> list[dict[str, Any]]:
93 |         """Get recent NPS comments"""
   |
help: Remove whitespace from blank line

F401 [*] `datetime.timedelta` imported but unused
  --> app/services/analytics/application/report_generator.py:10:32
   |
 8 | from __future__ import annotations
 9 |
10 | from datetime import datetime, timedelta
   |                                ^^^^^^^^^
11 | from typing import Any, Protocol
   |
help: Remove unused import: `datetime.timedelta`

W293 Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:45:1
   |
43 |     """
44 |     Analytics report generator.
45 |
   | ^^^^
46 |     Responsibilities:
47 |     - User segmentation
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:51:1
   |
49 |     - Generate comprehensive reports
50 |     """
51 |
   | ^^^^
52 |     def __init__(
53 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:65:1
   |
63 |         self._nps = nps_manager
64 |         self._user_repo = user_repository
65 |
   | ^^^^
66 |     def segment_users(self) -> dict[str, list[int]]:
67 |         """Segment users based on behavior"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:70:1
   |
68 |         users = self._user_repo.get_all()
69 |         now = datetime.utcnow()
70 |
   | ^^^^^^^^
71 |         segments = {
72 |             UserSegment.NEW.value: [],
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:79:1
   |
77 |             UserSegment.RESURRECTED.value: [],
78 |         }
79 |
   | ^^^^^^^^
80 |         for user_id, data in users.items():
81 |             first_seen = data.get("first_seen", now)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:84:1
   |
82 |             last_seen = data.get("last_seen", now)
83 |             total_events = data.get("total_events", 0)
84 |
   | ^^^^^^^^^^^^
85 |             days_since_signup = (now - first_seen).days
86 |             days_since_last_seen = (now - last_seen).days
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/report_generator.py:87:1
   |
85 |             days_since_signup = (now - first_seen).days
86 |             days_since_last_seen = (now - last_seen).days
87 |
   | ^^^^^^^^^^^^
88 |             # Segment logic
89 |             if days_since_signup <= 7:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:100:1
    |
 98 |             elif days_since_last_seen <= 7:
 99 |                 segments[UserSegment.ACTIVE.value].append(user_id)
100 |
    | ^^^^^^^^^^^^
101 |             # Resurrected: came back after being churned
102 |             if days_since_last_seen <= 7 and 30 < max(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:106:1
    |
104 |             ) < 90:
105 |                 segments[UserSegment.RESURRECTED.value].append(user_id)
106 |
    | ^^^^^^^^
107 |         return segments
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:108:1
    |
107 |         return segments
108 |
    | ^^^^
109 |     def export_metrics_summary(self) -> dict[str, Any]:
110 |         """Generate comprehensive metrics summary"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:116:1
    |
114 |         nps = self._nps.get_metrics()
115 |         segments = self.segment_users()
116 |
    | ^^^^^^^^
117 |         # Calculate segment sizes
118 |         segment_counts = {k: len(v) for k, v in segments.items()}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:119:1
    |
117 |         # Calculate segment sizes
118 |         segment_counts = {k: len(v) for k, v in segments.items()}
119 |
    | ^^^^^^^^
120 |         return {
121 |             "timestamp": datetime.utcnow().isoformat(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:131:1
    |
129 |             ),
130 |         }
131 |
    | ^^^^
132 |     def _calculate_health_score(
133 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:147:1
    |
145 |             "nps": 0.1,
146 |         }
147 |
    | ^^^^^^^^
148 |         # Normalize metrics to 0-100 scale
149 |         engagement_score = min(engagement.get("stickiness", 0) * 100, 100)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:153:1
    |
151 |         retention_score = retention.get("day_7_retention", 0) * 100
152 |         nps_score = (nps.get("nps_score", 0) + 100) / 2  # NPS is -100 to 100
153 |
    | ^^^^^^^^
154 |         health_score = (
155 |             engagement_score * weights["engagement"] +
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/application/report_generator.py:160:1
    |
158 |             nps_score * weights["nps"]
159 |         )
160 |
    | ^^^^^^^^
161 |         return round(health_score, 2)
    |
help: Remove whitespace from blank line

F401 [*] `app.services.analytics.domain.models.UserSegment` imported but unused
  --> app/services/analytics/application/retention_analyzer.py:14:50
   |
12 | from typing import Any, Protocol
13 |
14 | from app.services.analytics.domain.models import UserSegment
   |                                                  ^^^^^^^^^^^
   |
help: Remove unused import: `app.services.analytics.domain.models.UserSegment`

W293 Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:26:1
   |
24 |     """
25 |     User retention analyzer.
26 |
   | ^^^^
27 |     Responsibilities:
28 |     - Calculate retention rates
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:32:1
   |
30 |     - Churn calculations
31 |     """
32 |
   | ^^^^
33 |     def __init__(self, user_repository: UserRepository):
34 |         self._user_repo = user_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:35:1
   |
33 |     def __init__(self, user_repository: UserRepository):
34 |         self._user_repo = user_repository
35 |
   | ^^^^
36 |     def get_retention_metrics(
37 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:43:1
   |
41 |         if cohort_date is None:
42 |             cohort_date = datetime.utcnow() - timedelta(days=30)
43 |
   | ^^^^^^^^
44 |         users = self._user_repo.get_all()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:45:1
   |
44 |         users = self._user_repo.get_all()
45 |
   | ^^^^^^^^
46 |         # Get cohort users (joined on cohort_date)
47 |         cohort_users = [
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:52:1
   |
50 |             if data.get("first_seen") and data["first_seen"].date() == cohort_date.date()
51 |         ]
52 |
   | ^^^^^^^^
53 |         cohort_size = len(cohort_users)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:54:1
   |
53 |         cohort_size = len(cohort_users)
54 |
   | ^^^^^^^^
55 |         if cohort_size == 0:
56 |             return self._empty_metrics()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:57:1
   |
55 |         if cohort_size == 0:
56 |             return self._empty_metrics()
57 |
   | ^^^^^^^^
58 |         # Calculate retention for different periods
59 |         now = datetime.utcnow()
   |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
  --> app/services/analytics/application/retention_analyzer.py:61:42
   |
59 |         now = datetime.utcnow()
60 |         day_1_active = sum(
61 |             1 for user_id in cohort_users
   |                                          ^
62 |             if (now - users[user_id].get("last_seen", now)).days <= 1
63 |         )
   |
help: Remove trailing whitespace

W291 [*] Trailing whitespace
  --> app/services/analytics/application/retention_analyzer.py:65:42
   |
63 |         )
64 |         day_7_active = sum(
65 |             1 for user_id in cohort_users
   |                                          ^
66 |             if (now - users[user_id].get("last_seen", now)).days <= 7
67 |         )
   |
help: Remove trailing whitespace

W291 [*] Trailing whitespace
  --> app/services/analytics/application/retention_analyzer.py:69:42
   |
67 |         )
68 |         day_30_active = sum(
69 |             1 for user_id in cohort_users
   |                                          ^
70 |             if (now - users[user_id].get("last_seen", now)).days <= 30
71 |         )
   |
help: Remove trailing whitespace

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:72:1
   |
70 |             if (now - users[user_id].get("last_seen", now)).days <= 30
71 |         )
72 |
   | ^^^^^^^^
73 |         day_1_retention = day_1_active / cohort_size
74 |         day_7_retention = day_7_active / cohort_size
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:76:1
   |
74 |         day_7_retention = day_7_active / cohort_size
75 |         day_30_retention = day_30_active / cohort_size
76 |
   | ^^^^^^^^
77 |         # Calculate churn rate
78 |         churn_rate = 1.0 - day_30_retention
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:79:1
   |
77 |         # Calculate churn rate
78 |         churn_rate = 1.0 - day_30_retention
79 |
   | ^^^^^^^^
80 |         # Calculate average lifetime
81 |         lifetimes = [
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:87:1
   |
85 |         ]
86 |         avg_lifetime_days = statistics.mean(lifetimes) if lifetimes else 0.0
87 |
   | ^^^^^^^^
88 |         return {
89 |             "day_1_retention": day_1_retention,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/retention_analyzer.py:96:1
   |
94 |             "avg_lifetime_days": avg_lifetime_days,
95 |         }
96 |
   | ^^^^
97 |     def _empty_metrics(self) -> dict[str, Any]:
98 |         """Return empty metrics"""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:29:1
   |
27 |     """
28 |     Session lifecycle manager.
29 |
   | ^^^^
30 |     Responsibilities:
31 |     - Start sessions
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:35:1
   |
33 |     - Update session activity
34 |     """
35 |
   | ^^^^
36 |     def __init__(self, session_repository: SessionRepository):
37 |         self._session_repo = session_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:38:1
   |
36 |     def __init__(self, session_repository: SessionRepository):
37 |         self._session_repo = session_repository
38 |
   | ^^^^
39 |     def start_session(
40 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:47:1
   |
45 |         """Start new user session"""
46 |         session_id = self._generate_session_id(user_id)
47 |
   | ^^^^^^^^
48 |         session = UserSession(
49 |             session_id=session_id,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:55:1
   |
53 |             entry_page=entry_page,
54 |         )
55 |
   | ^^^^^^^^
56 |         self._session_repo.save(session)
57 |         return session_id
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:58:1
   |
56 |         self._session_repo.save(session)
57 |         return session_id
58 |
   | ^^^^
59 |     def end_session(self, session_id: str) -> None:
60 |         """End user session"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:66:1
   |
64 |             session.duration_seconds = (session.end_time - session.start_time).total_seconds()
65 |             self._session_repo.update(session)
66 |
   | ^^^^
67 |     def update_session_activity(
68 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:78:1
   |
76 |             session.update_activity(event_type, page_url)
77 |             self._session_repo.update(session)
78 |
   | ^^^^
79 |     def get_session(self, session_id: str) -> UserSession | None:
80 |         """Get session by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:82:1
   |
80 |         """Get session by ID"""
81 |         return self._session_repo.get(session_id)
82 |
   | ^^^^
83 |     def get_user_sessions(self, user_id: int) -> list[UserSession]:
84 |         """Get all sessions for user"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/application/session_manager.py:86:1
   |
84 |         """Get all sessions for user"""
85 |         return self._session_repo.get_by_user(user_id)
86 |
   | ^^^^
87 |     def _generate_session_id(self, user_id: int) -> str:
88 |         """Generate unique session ID"""
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/analytics/domain/__init__.py:28:11
   |
26 |   )
27 |
28 |   __all__ = [
   |  ___________^
29 | |     # Enums
30 | |     "EventType",
31 | |     "UserSegment",
32 | |     "ABTestVariant",
33 | |     # Value Objects
34 | |     "UserEvent",
35 | |     "EngagementMetrics",
36 | |     "ConversionMetrics",
37 | |     "RetentionMetrics",
38 | |     "NPSMetrics",
39 | |     # Entities
40 | |     "UserSession",
41 | |     "ABTestResults",
42 | |     "CohortAnalysis",
43 | |     "RevenueMetrics",
44 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/analytics/domain/models.py:13:1
   |
11 |   """
12 |
13 | / from __future__ import annotations
14 | |
15 | | from dataclasses import dataclass, field
16 | | from datetime import datetime
17 | | from enum import Enum
18 | | from typing import Any
   | |______________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/analytics/domain/models.py:68:1
   |
66 |     """
67 |     Immutable user event value object.
68 |
   | ^^^^
69 |     Represents a single user interaction with the system.
70 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:100:1
    |
 98 |     """
 99 |     Engagement metrics value object.
100 |
    | ^^^^
101 |     Calculated metrics for user engagement analysis.
102 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:121:1
    |
119 |     """
120 |     Conversion metrics value object.
121 |
    | ^^^^
122 |     Tracks conversion rates and funnel performance.
123 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:145:1
    |
143 |     """
144 |     User retention metrics value object.
145 |
    | ^^^^
146 |     Tracks user retention and churn.
147 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:167:1
    |
165 |     """
166 |     Net Promoter Score metrics value object.
167 |
    | ^^^^
168 |     Customer satisfaction and loyalty metrics.
169 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:196:1
    |
194 |     """
195 |     User session entity.
196 |
    | ^^^^
197 |     Mutable entity representing an active user session.
198 |     Tracks interactions and state changes over time.
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:221:1
    |
219 |         if timestamp is None:
220 |             timestamp = datetime.utcnow()
221 |
    | ^^^^^^^^
222 |         self.events += 1
223 |         if event_type == EventType.PAGE_VIEW:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:227:1
    |
225 |         if event_type == EventType.CONVERSION:
226 |             self.conversions += 1
227 |
    | ^^^^^^^^
228 |         self.end_time = timestamp
229 |         self.duration_seconds = (self.end_time - self.start_time).total_seconds()
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:248:1
    |
246 |     """
247 |     A/B test results entity.
248 |
    | ^^^^
249 |     Mutable entity for tracking A/B test performance.
250 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:282:1
    |
280 |         if not self.variants:
281 |             return None
282 |
    | ^^^^^^^^
283 |         best_variant = None
284 |         best_rate = 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:285:1
    |
283 |         best_variant = None
284 |         best_rate = 0.0
285 |
    | ^^^^^^^^
286 |         for variant in self.variants:
287 |             rate = self.get_conversion_rate(variant)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:291:1
    |
289 |                 best_rate = rate
290 |                 best_variant = variant
291 |
    | ^^^^^^^^
292 |         return best_variant
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:299:1
    |
297 |     """
298 |     Cohort analysis entity.
299 |
    | ^^^^
300 |     Tracks behavior of user cohorts over time.
301 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:307:1
    |
305 |     users: set[int] = field(default_factory=set)
306 |     retention_data: dict[int, float] = field(default_factory=dict)  # day -> retention_rate
307 |
    | ^^^^
308 |     def add_user(self, user_id: int) -> None:
309 |         """Add user to cohort"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:311:1
    |
309 |         """Add user to cohort"""
310 |         self.users.add(user_id)
311 |
    | ^^^^
312 |     def record_retention(self, days_since_creation: int, active_users: int) -> None:
313 |         """Record retention rate for specific day"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:317:1
    |
315 |         retention_rate = (active_users / total_users) if total_users > 0 else 0.0
316 |         self.retention_data[days_since_creation] = retention_rate
317 |
    | ^^^^
318 |     def get_retention_curve(self) -> list[tuple[int, float]]:
319 |         """Get retention curve data"""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/models.py:327:1
    |
325 |     """
326 |     Revenue metrics entity.
327 |
    | ^^^^
328 |     Tracks financial performance metrics.
329 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:335:1
    |
333 |     revenue_by_segment: dict[UserSegment, float] = field(default_factory=dict)
334 |     created_at: datetime = field(default_factory=datetime.utcnow)
335 |
    | ^^^^
336 |     def record_transaction(
337 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:346:1
    |
344 |         self.total_transactions += 1
345 |         self.unique_paying_users.add(user_id)
346 |
    | ^^^^^^^^
347 |         if segment:
348 |             if segment not in self.revenue_by_segment:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:351:1
    |
349 |                 self.revenue_by_segment[segment] = 0.0
350 |             self.revenue_by_segment[segment] += amount
351 |
    | ^^^^
352 |     @property
353 |     def average_transaction_value(self) -> float:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/domain/models.py:356:1
    |
354 |         """Calculate average transaction value"""
355 |         return (self.total_revenue / self.total_transactions) if self.total_transactions > 0 else 0.0
356 |
    | ^^^^
357 |     @property
358 |     def arpu(self) -> float:
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
   --> app/services/analytics/domain/models.py:368:11
    |
366 |   # ======================================================================================
367 |
368 |   __all__ = [
    |  ___________^
369 | |     # Enums
370 | |     "EventType",
371 | |     "UserSegment",
372 | |     "ABTestVariant",
373 | |     # Value Objects
374 | |     "UserEvent",
375 | |     "EngagementMetrics",
376 | |     "ConversionMetrics",
377 | |     "RetentionMetrics",
378 | |     "NPSMetrics",
379 | |     # Entities
380 | |     "UserSession",
381 | |     "ABTestResults",
382 | |     "CohortAnalysis",
383 | |     "RevenueMetrics",
384 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/analytics/domain/ports.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | from datetime import datetime
13 | | from typing import Any, Protocol
14 | |
15 | | from app.services.analytics.domain.models import (
16 | |     ABTestVariant,
17 | |     EventType,
18 | |     UserEvent,
19 | |     UserSegment,
20 | |     UserSession,
21 | | )
   | |_^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:32:1
   |
30 |     """
31 |     Port for event storage and retrieval.
32 |
   | ^^^^
33 |     Implementations:
34 |     - InMemoryEventRepository
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:42:1
   |
40 |         """
41 |         Store a user event.
42 |
   | ^^^^^^^^
43 |         Args:
44 |             event: UserEvent to store
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:59:1
   |
57 |         """
58 |         Retrieve events matching filters.
59 |
   | ^^^^^^^^
60 |         Args:
61 |             user_id: Filter by user ID
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:67:1
   |
65 |             end_time: Filter events before this time
66 |             limit: Maximum number of events to return
67 |
   | ^^^^^^^^^^^^
68 |         Returns:
69 |             List of matching events
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:82:1
   |
80 |         """
81 |         Count events matching filters.
82 |
   | ^^^^^^^^
83 |         Args:
84 |             user_id: Filter by user ID
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:88:1
   |
86 |             start_time: Filter events after this time
87 |             end_time: Filter events before this time
88 |
   | ^^^^^^^^^^^^
89 |         Returns:
90 |             Number of matching events
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/domain/ports.py:97:1
   |
95 |         """
96 |         Delete events older than specified time.
97 |
   | ^^^^^^^^
98 |         Args:
99 |             before: Delete events before this time
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:100:1
    |
 98 |         Args:
 99 |             before: Delete events before this time
100 |
    | ^^^^^^^^^^^^
101 |         Returns:
102 |             Number of deleted events
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:115:1
    |
113 |     """
114 |     Port for session storage and retrieval.
115 |
    | ^^^^
116 |     Implementations:
117 |     - InMemorySessionRepository
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:125:1
    |
123 |         """
124 |         Store or update a user session.
125 |
    | ^^^^^^^^
126 |         Args:
127 |             session: UserSession to store
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:134:1
    |
132 |         """
133 |         Retrieve session by ID.
134 |
    | ^^^^^^^^
135 |         Args:
136 |             session_id: Session identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:137:1
    |
135 |         Args:
136 |             session_id: Session identifier
137 |
    | ^^^^^^^^^^^^
138 |         Returns:
139 |             UserSession if found, None otherwise
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:151:1
    |
149 |         """
150 |         Retrieve all sessions for a user.
151 |
    | ^^^^^^^^
152 |         Args:
153 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:156:1
    |
154 |             start_time: Filter sessions after this time
155 |             end_time: Filter sessions before this time
156 |
    | ^^^^^^^^^^^^
157 |         Returns:
158 |             List of user sessions
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:165:1
    |
163 |         """
164 |         Get all active sessions.
165 |
    | ^^^^^^^^
166 |         Args:
167 |             since: Only include sessions active since this time
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:168:1
    |
166 |         Args:
167 |             since: Only include sessions active since this time
168 |
    | ^^^^^^^^^^^^
169 |         Returns:
170 |             List of active sessions
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:183:1
    |
181 |     """
182 |     Port for analytics calculations and aggregations.
183 |
    | ^^^^
184 |     Implementations:
185 |     - InMemoryAggregator
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:197:1
    |
195 |         """
196 |         Calculate engagement metrics for time period.
197 |
    | ^^^^^^^^
198 |         Args:
199 |             start_time: Start of analysis period
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:201:1
    |
199 |             start_time: Start of analysis period
200 |             end_time: End of analysis period
201 |
    | ^^^^^^^^^^^^
202 |         Returns:
203 |             Dictionary with engagement metrics
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:215:1
    |
213 |         """
214 |         Calculate conversion metrics for funnel.
215 |
    | ^^^^^^^^
216 |         Args:
217 |             funnel_steps: List of event types in funnel
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:220:1
    |
218 |             start_time: Start of analysis period
219 |             end_time: End of analysis period
220 |
    | ^^^^^^^^^^^^
221 |         Returns:
222 |             Dictionary with conversion metrics
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:233:1
    |
231 |         """
232 |         Calculate retention metrics for cohort.
233 |
    | ^^^^^^^^
234 |         Args:
235 |             cohort_id: Cohort identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:237:1
    |
235 |             cohort_id: Cohort identifier
236 |             days: Number of days to analyze
237 |
    | ^^^^^^^^^^^^
238 |         Returns:
239 |             Dictionary with retention metrics
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:252:1
    |
250 |     """
251 |     Port for user segmentation and classification.
252 |
    | ^^^^
253 |     Implementations:
254 |     - RuleBasedSegmentation
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:266:1
    |
264 |         """
265 |         Classify user into a segment.
266 |
    | ^^^^^^^^
267 |         Args:
268 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:270:1
    |
268 |             user_id: User identifier
269 |             user_data: User behavior data
270 |
    | ^^^^^^^^^^^^
271 |         Returns:
272 |             UserSegment classification
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:282:1
    |
280 |         """
281 |         Get all users in a segment.
282 |
    | ^^^^^^^^
283 |         Args:
284 |             segment: User segment
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:285:1
    |
283 |         Args:
284 |             segment: User segment
285 |
    | ^^^^^^^^^^^^
286 |         Returns:
287 |             List of user IDs in segment
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:294:1
    |
292 |         """
293 |         Update all user segments.
294 |
    | ^^^^^^^^
295 |         Returns:
296 |             Dictionary mapping segments to user counts
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:309:1
    |
307 |     """
308 |     Port for A/B testing management.
309 |
    | ^^^^
310 |     Implementations:
311 |     - SimpleABTestManager
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:324:1
    |
322 |         """
323 |         Create a new A/B test.
324 |
    | ^^^^^^^^
325 |         Args:
326 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:339:1
    |
337 |         """
338 |         Assign user to a test variant.
339 |
    | ^^^^^^^^
340 |         Args:
341 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:343:1
    |
341 |             test_id: Test identifier
342 |             user_id: User identifier
343 |
    | ^^^^^^^^^^^^
344 |         Returns:
345 |             Assigned variant
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:357:1
    |
355 |         """
356 |         Record conversion for test variant.
357 |
    | ^^^^^^^^
358 |         Args:
359 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:371:1
    |
369 |         """
370 |         Get A/B test results.
371 |
    | ^^^^^^^^
372 |         Args:
373 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/domain/ports.py:374:1
    |
372 |         Args:
373 |             test_id: Test identifier
374 |
    | ^^^^^^^^^^^^
375 |         Returns:
376 |             Dictionary with test results
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/analytics/domain/ports.py:385:11
    |
383 |   # ======================================================================================
384 |
385 |   __all__ = [
    |  ___________^
386 | |     "EventRepositoryPort",
387 | |     "SessionRepositoryPort",
388 | |     "AnalyticsAggregatorPort",
389 | |     "UserSegmentationPort",
390 | |     "ABTestManagerPort",
391 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `app.services.analytics.domain.models.UserSegment` imported but unused
  --> app/services/analytics/facade.py:27:61
   |
25 |     SessionManager,
26 | )
27 | from app.services.analytics.domain.models import EventType, UserSegment
   |                                                             ^^^^^^^^^^^
28 | from app.services.analytics.infrastructure.in_memory_repository import (
29 |     InMemoryEventRepository,
   |
help: Remove unused import: `app.services.analytics.domain.models.UserSegment`

W293 Blank line contains whitespace
  --> app/services/analytics/facade.py:40:1
   |
38 |     """
39 |     User Analytics & Metrics Service - Complete Facade
40 |
   | ^^^^
41 |     100% backward compatible with original 800-line service.
42 |     Now delegates to specialized services following SRP.
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade.py:44:1
   |
42 |     Now delegates to specialized services following SRP.
43 |     """
44 |
   | ^^^^
45 |     def __init__(self):
46 |         """Initialize analytics service with all components"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade.py:51:1
   |
49 |         self._session_repo = InMemorySessionRepository()
50 |         self._user_repo = InMemoryUserRepository()
51 |
   | ^^^^^^^^
52 |         # Application layer
53 |         self._event_tracker = EventTracker(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade.py:79:1
   |
77 |             user_repository=self._user_repo,
78 |         )
79 |
   | ^^^^^^^^
80 |         # Legacy compatibility
81 |         self.lock = threading.RLock()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade.py:85:1
   |
83 |         self.active_users_7d: set[int] = set()
84 |         self.active_users_30d: set[int] = set()
85 |
   | ^^^^
86 |     # ==================================================================================
87 |     # EVENT TRACKING
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade.py:89:1
   |
87 |     # EVENT TRACKING
88 |     # ==================================================================================
89 |
   | ^^^^
90 |     def track_event(
91 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:105:1
    |
103 |         if isinstance(event_type, str):
104 |             event_type = EventType(event_type)
105 |
    | ^^^^^^^^
106 |         # Update legacy sets
107 |         with self.lock:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:111:1
    |
109 |             self.active_users_7d.add(user_id)
110 |             self.active_users_30d.add(user_id)
111 |
    | ^^^^^^^^
112 |         return self._event_tracker.track_event(
113 |             user_id=user_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:121:1
    |
119 |             device_type=device_type,
120 |         )
121 |
    | ^^^^
122 |     # ==================================================================================
123 |     # SESSION MANAGEMENT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:125:1
    |
123 |     # SESSION MANAGEMENT
124 |     # ==================================================================================
125 |
    | ^^^^
126 |     def _generate_session_id(self, user_id: int) -> str:
127 |         """Generate unique session ID"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:131:1
    |
129 |             f"{user_id}{time.time_ns()}".encode()
130 |         ).hexdigest()[:16]
131 |
    | ^^^^
132 |     def start_session(
133 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:144:1
    |
142 |             entry_page=entry_page,
143 |         )
144 |
    | ^^^^
145 |     def end_session(self, session_id: str) -> None:
146 |         """End user session"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:148:1
    |
146 |         """End user session"""
147 |         self._session_manager.end_session(session_id)
148 |
    | ^^^^
149 |     # ==================================================================================
150 |     # ENGAGEMENT METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:152:1
    |
150 |     # ENGAGEMENT METRICS
151 |     # ==================================================================================
152 |
    | ^^^^
153 |     def get_engagement_metrics(self, time_window: str = "30d") -> dict[str, Any]:
154 |         """Get engagement metrics"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:157:1
    |
155 |         # Map time_window to engagement analyzer format
156 |         return self._engagement_analyzer.calculate_engagement_metrics()
157 |
    | ^^^^
158 |     # ==================================================================================
159 |     # CONVERSION METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:161:1
    |
159 |     # CONVERSION METRICS
160 |     # ==================================================================================
161 |
    | ^^^^
162 |     def get_conversion_metrics(
163 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:171:1
    |
169 |             days=30,
170 |         )
171 |
    | ^^^^
172 |     # ==================================================================================
173 |     # RETENTION METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:175:1
    |
173 |     # RETENTION METRICS
174 |     # ==================================================================================
175 |
    | ^^^^
176 |     def get_retention_metrics(
177 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:184:1
    |
182 |             cohort_date=cohort_date,
183 |         )
184 |
    | ^^^^
185 |     # ==================================================================================
186 |     # NPS (NET PROMOTER SCORE)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:188:1
    |
186 |     # NPS (NET PROMOTER SCORE)
187 |     # ==================================================================================
188 |
    | ^^^^
189 |     def record_nps_response(
190 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:201:1
    |
199 |             comment=comment,
200 |         )
201 |
    | ^^^^
202 |     def get_nps_metrics(self) -> dict[str, Any]:
203 |         """Get NPS metrics"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:205:1
    |
203 |         """Get NPS metrics"""
204 |         return self._nps_manager.get_metrics()
205 |
    | ^^^^
206 |     # ==================================================================================
207 |     # A/B TESTING
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:209:1
    |
207 |     # A/B TESTING
208 |     # ==================================================================================
209 |
    | ^^^^
210 |     def create_ab_test(
211 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:222:1
    |
220 |             traffic_split=traffic_split,
221 |         )
222 |
    | ^^^^
223 |     def assign_variant(self, test_id: str, user_id: int) -> str:
224 |         """Assign variant to user"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:229:1
    |
227 |             user_id=user_id,
228 |         )
229 |
    | ^^^^
230 |     def record_ab_conversion(self, test_id: str, user_id: int) -> None:
231 |         """Record A/B test conversion"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:236:1
    |
234 |             user_id=user_id,
235 |         )
236 |
    | ^^^^
237 |     def get_ab_test_results(self, test_id: str) -> dict[str, Any] | None:
238 |         """Get A/B test results"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:240:1
    |
238 |         """Get A/B test results"""
239 |         return self._ab_test_manager.get_results(test_id)
240 |
    | ^^^^
241 |     # ==================================================================================
242 |     # REPORTING & SEGMENTATION
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:244:1
    |
242 |     # REPORTING & SEGMENTATION
243 |     # ==================================================================================
244 |
    | ^^^^
245 |     def segment_users(self) -> dict[str, list[int]]:
246 |         """Segment users by behavior"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:248:1
    |
246 |         """Segment users by behavior"""
247 |         return self._report_generator.segment_users()
248 |
    | ^^^^
249 |     def export_metrics_summary(self) -> dict[str, Any]:
250 |         """Export comprehensive metrics summary"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:265:1
    |
263 |     """Get or create analytics service singleton"""
264 |     global _SERVICE_INSTANCE
265 |
    | ^^^^
266 |     if _SERVICE_INSTANCE is not None:
267 |         return _SERVICE_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade.py:268:1
    |
266 |     if _SERVICE_INSTANCE is not None:
267 |         return _SERVICE_INSTANCE
268 |
    | ^^^^
269 |     with _SERVICE_LOCK:
270 |         if _SERVICE_INSTANCE is None:
    |
help: Remove whitespace from blank line

F401 [*] `app.services.analytics.domain.models.UserSegment` imported but unused
  --> app/services/analytics/facade_complete.py:27:61
   |
25 |     SessionManager,
26 | )
27 | from app.services.analytics.domain.models import EventType, UserSegment
   |                                                             ^^^^^^^^^^^
28 | from app.services.analytics.infrastructure.in_memory_repository import (
29 |     InMemoryEventRepository,
   |
help: Remove unused import: `app.services.analytics.domain.models.UserSegment`

W293 Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:40:1
   |
38 |     """
39 |     User Analytics & Metrics Service - Complete Facade
40 |
   | ^^^^
41 |     100% backward compatible with original 800-line service.
42 |     Now delegates to specialized services following SRP.
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:44:1
   |
42 |     Now delegates to specialized services following SRP.
43 |     """
44 |
   | ^^^^
45 |     def __init__(self):
46 |         """Initialize analytics service with all components"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:51:1
   |
49 |         self._session_repo = InMemorySessionRepository()
50 |         self._user_repo = InMemoryUserRepository()
51 |
   | ^^^^^^^^
52 |         # Application layer
53 |         self._event_tracker = EventTracker(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:79:1
   |
77 |             user_repository=self._user_repo,
78 |         )
79 |
   | ^^^^^^^^
80 |         # Legacy compatibility
81 |         self.lock = threading.RLock()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:85:1
   |
83 |         self.active_users_7d: set[int] = set()
84 |         self.active_users_30d: set[int] = set()
85 |
   | ^^^^
86 |     # ==================================================================================
87 |     # EVENT TRACKING
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_complete.py:89:1
   |
87 |     # EVENT TRACKING
88 |     # ==================================================================================
89 |
   | ^^^^
90 |     def track_event(
91 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:105:1
    |
103 |         if isinstance(event_type, str):
104 |             event_type = EventType(event_type)
105 |
    | ^^^^^^^^
106 |         # Update legacy sets
107 |         with self.lock:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:111:1
    |
109 |             self.active_users_7d.add(user_id)
110 |             self.active_users_30d.add(user_id)
111 |
    | ^^^^^^^^
112 |         return self._event_tracker.track_event(
113 |             user_id=user_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:121:1
    |
119 |             device_type=device_type,
120 |         )
121 |
    | ^^^^
122 |     # ==================================================================================
123 |     # SESSION MANAGEMENT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:125:1
    |
123 |     # SESSION MANAGEMENT
124 |     # ==================================================================================
125 |
    | ^^^^
126 |     def _generate_session_id(self, user_id: int) -> str:
127 |         """Generate unique session ID"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:131:1
    |
129 |             f"{user_id}{time.time_ns()}".encode()
130 |         ).hexdigest()[:16]
131 |
    | ^^^^
132 |     def start_session(
133 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:144:1
    |
142 |             entry_page=entry_page,
143 |         )
144 |
    | ^^^^
145 |     def end_session(self, session_id: str) -> None:
146 |         """End user session"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:148:1
    |
146 |         """End user session"""
147 |         self._session_manager.end_session(session_id)
148 |
    | ^^^^
149 |     # ==================================================================================
150 |     # ENGAGEMENT METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:152:1
    |
150 |     # ENGAGEMENT METRICS
151 |     # ==================================================================================
152 |
    | ^^^^
153 |     def get_engagement_metrics(self, time_window: str = "30d") -> dict[str, Any]:
154 |         """Get engagement metrics"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:157:1
    |
155 |         # Map time_window to engagement analyzer format
156 |         return self._engagement_analyzer.calculate_engagement_metrics()
157 |
    | ^^^^
158 |     # ==================================================================================
159 |     # CONVERSION METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:161:1
    |
159 |     # CONVERSION METRICS
160 |     # ==================================================================================
161 |
    | ^^^^
162 |     def get_conversion_metrics(
163 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:171:1
    |
169 |             days=30,
170 |         )
171 |
    | ^^^^
172 |     # ==================================================================================
173 |     # RETENTION METRICS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:175:1
    |
173 |     # RETENTION METRICS
174 |     # ==================================================================================
175 |
    | ^^^^
176 |     def get_retention_metrics(
177 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:184:1
    |
182 |             cohort_date=cohort_date,
183 |         )
184 |
    | ^^^^
185 |     # ==================================================================================
186 |     # NPS (NET PROMOTER SCORE)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:188:1
    |
186 |     # NPS (NET PROMOTER SCORE)
187 |     # ==================================================================================
188 |
    | ^^^^
189 |     def record_nps_response(
190 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:201:1
    |
199 |             comment=comment,
200 |         )
201 |
    | ^^^^
202 |     def get_nps_metrics(self) -> dict[str, Any]:
203 |         """Get NPS metrics"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:205:1
    |
203 |         """Get NPS metrics"""
204 |         return self._nps_manager.get_metrics()
205 |
    | ^^^^
206 |     # ==================================================================================
207 |     # A/B TESTING
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:209:1
    |
207 |     # A/B TESTING
208 |     # ==================================================================================
209 |
    | ^^^^
210 |     def create_ab_test(
211 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:222:1
    |
220 |             traffic_split=traffic_split,
221 |         )
222 |
    | ^^^^
223 |     def assign_variant(self, test_id: str, user_id: int) -> str:
224 |         """Assign variant to user"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:229:1
    |
227 |             user_id=user_id,
228 |         )
229 |
    | ^^^^
230 |     def record_ab_conversion(self, test_id: str, user_id: int) -> None:
231 |         """Record A/B test conversion"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:236:1
    |
234 |             user_id=user_id,
235 |         )
236 |
    | ^^^^
237 |     def get_ab_test_results(self, test_id: str) -> dict[str, Any] | None:
238 |         """Get A/B test results"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:240:1
    |
238 |         """Get A/B test results"""
239 |         return self._ab_test_manager.get_results(test_id)
240 |
    | ^^^^
241 |     # ==================================================================================
242 |     # REPORTING & SEGMENTATION
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:244:1
    |
242 |     # REPORTING & SEGMENTATION
243 |     # ==================================================================================
244 |
    | ^^^^
245 |     def segment_users(self) -> dict[str, list[int]]:
246 |         """Segment users by behavior"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:248:1
    |
246 |         """Segment users by behavior"""
247 |         return self._report_generator.segment_users()
248 |
    | ^^^^
249 |     def export_metrics_summary(self) -> dict[str, Any]:
250 |         """Export comprehensive metrics summary"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:265:1
    |
263 |     """Get or create analytics service singleton"""
264 |     global _SERVICE_INSTANCE
265 |
    | ^^^^
266 |     if _SERVICE_INSTANCE is not None:
267 |         return _SERVICE_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_complete.py:268:1
    |
266 |     if _SERVICE_INSTANCE is not None:
267 |         return _SERVICE_INSTANCE
268 |
    | ^^^^
269 |     with _SERVICE_LOCK:
270 |         if _SERVICE_INSTANCE is None:
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/facade_old.py:37:1
   |
35 |     """
36 |     User analytics & metrics service facade.
37 |
   | ^^^^
38 |     Backward-compatible interface that delegates to layered architecture:
39 |     - EventTracker for event tracking
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_old.py:50:1
   |
48 |         self._event_repo = InMemoryEventRepository(max_events=100000)
49 |         self._session_repo = InMemorySessionRepository()
50 |
   | ^^^^^^^^
51 |         # Application layer
52 |         self._event_tracker = EventTracker(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_old.py:60:1
   |
58 |             session_repository=self._session_repo,
59 |         )
60 |
   | ^^^^^^^^
61 |         # Legacy compatibility - maintain original structure
62 |         self.lock = threading.RLock()
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/facade_old.py:79:1
   |
77 |         """
78 |         Track a user event.
79 |
   | ^^^^^^^^
80 |         Delegates to EventTracker and updates legacy tracking sets.
81 |         """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/facade_old.py:87:1
   |
85 |             self.active_users_7d.add(user_id)
86 |             self.active_users_30d.add(user_id)
87 |
   | ^^^^^^^^
88 |         # Delegate to event tracker
89 |         return self._event_tracker.track_event(
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/facade_old.py:138:1
    |
136 |         """
137 |         Get engagement metrics.
138 |
    | ^^^^^^^^
139 |         Returns dictionary for backward compatibility.
140 |         """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:145:1
    |
143 |             end_time=end_time,
144 |         )
145 |
    | ^^^^^^^^
146 |         return {
147 |             "dau": metrics.dau,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/facade_old.py:160:1
    |
158 |         """
159 |         Get active users count for period.
160 |
    | ^^^^^^^^
161 |         Args:
162 |             period: Time period ("1d", "7d", "30d")
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/facade_old.py:163:1
    |
161 |         Args:
162 |             period: Time period ("1d", "7d", "30d")
163 |
    | ^^^^^^^^^^^^
164 |         Returns:
165 |             Number of active users
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:173:1
    |
171 |         }
172 |         days = days_map.get(period, 1)
173 |
    | ^^^^^^^^
174 |         return self._engagement_analyzer.get_active_users_count(days=days)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/facade_old.py:191:1
    |
189 |         """
190 |         Segment a user based on their behavior.
191 |
    | ^^^^^^^^
192 |         Simple rule-based segmentation for now.
193 |         """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:195:1
    |
193 |         """
194 |         score = self.get_user_engagement_score(user_id, days=30)
195 |
    | ^^^^^^^^
196 |         if score >= 80:
197 |             return UserSegment.POWER
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:211:1
    |
209 |         try:
210 |             metrics = self.get_engagement_metrics()
211 |
    | ^^^^^^^^^^^^
212 |             return {
213 |                 "status": "healthy",
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/facade_old.py:239:1
    |
237 |     """
238 |     Get or create analytics service singleton.
239 |
    | ^^^^
240 |     Returns:
241 |         UserAnalyticsMetricsService instance
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:244:1
    |
242 |     """
243 |     global _SERVICE_INSTANCE
244 |
    | ^^^^
245 |     if _SERVICE_INSTANCE is not None:
246 |         return _SERVICE_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:247:1
    |
245 |     if _SERVICE_INSTANCE is not None:
246 |         return _SERVICE_INSTANCE
247 |
    | ^^^^
248 |     with _SERVICE_LOCK:
249 |         if _SERVICE_INSTANCE is not None:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/facade_old.py:251:1
    |
249 |         if _SERVICE_INSTANCE is not None:
250 |             return _SERVICE_INSTANCE
251 |
    | ^^^^^^^^
252 |         _SERVICE_INSTANCE = UserAnalyticsMetricsService()
253 |         _LOG.info("Analytics service initialized with layered architecture")
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:25:1
   |
23 |     """
24 |     In-memory A/B test repository.
25 |
   | ^^^^
26 |     Features:
27 |     - Thread-safe test management
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:32:1
   |
30 |     - Statistical analysis
31 |     """
32 |
   | ^^^^
33 |     def __init__(self):
34 |         """Initialize A/B test repository."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:39:1
   |
37 |         self._conversions: dict[str, dict[ABTestVariant, set[int]]] = {}
38 |         self._lock = threading.RLock()
39 |
   | ^^^^
40 |     def create_test(
41 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:48:1
   |
46 |         """
47 |         Create a new A/B test.
48 |
   | ^^^^^^^^
49 |         Args:
50 |             test_id: Test identifier
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:57:1
   |
55 |             if test_id in self._tests:
56 |                 raise ValueError(f"Test {test_id} already exists")
57 |
   | ^^^^^^^^^^^^
58 |             self._tests[test_id] = {
59 |                 "test_id": test_id,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:65:1
   |
63 |                 "status": "active",
64 |             }
65 |
   | ^^^^^^^^^^^^
66 |             self._user_assignments[test_id] = {}
67 |             self._conversions[test_id] = {variant: set() for variant in variants}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:68:1
   |
66 |             self._user_assignments[test_id] = {}
67 |             self._conversions[test_id] = {variant: set() for variant in variants}
68 |
   | ^^^^
69 |     def assign_variant(
70 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:76:1
   |
74 |         """
75 |         Assign user to a test variant.
76 |
   | ^^^^^^^^
77 |         Uses deterministic hash-based assignment to ensure
78 |         consistent variant assignment for the same user.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:79:1
   |
77 |         Uses deterministic hash-based assignment to ensure
78 |         consistent variant assignment for the same user.
79 |
   | ^^^^^^^^
80 |         Args:
81 |             test_id: Test identifier
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:83:1
   |
81 |             test_id: Test identifier
82 |             user_id: User identifier
83 |
   | ^^^^^^^^^^^^
84 |         Returns:
85 |             Assigned variant
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:90:1
   |
88 |             if test_id not in self._tests:
89 |                 raise ValueError(f"Test {test_id} not found")
90 |
   | ^^^^^^^^^^^^
91 |             # Check if user already assigned
92 |             if user_id in self._user_assignments[test_id]:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/ab_test_repository.py:94:1
   |
92 |             if user_id in self._user_assignments[test_id]:
93 |                 return self._user_assignments[test_id][user_id]
94 |
   | ^^^^^^^^^^^^
95 |             # Deterministic assignment based on hash
96 |             variants = self._tests[test_id]["variants"]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:100:1
    |
 98 |             index = int(hash_val, 16) % len(variants)
 99 |             variant = variants[index]
100 |
    | ^^^^^^^^^^^^
101 |             self._user_assignments[test_id][user_id] = variant
102 |             return variant
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:103:1
    |
101 |             self._user_assignments[test_id][user_id] = variant
102 |             return variant
103 |
    | ^^^^
104 |     def record_conversion(
105 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:112:1
    |
110 |         """
111 |         Record conversion for test variant.
112 |
    | ^^^^^^^^
113 |         Args:
114 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:121:1
    |
119 |             if test_id not in self._tests:
120 |                 raise ValueError(f"Test {test_id} not found")
121 |
    | ^^^^^^^^^^^^
122 |             # Verify user is assigned to this variant
123 |             assigned_variant = self._user_assignments[test_id].get(user_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:128:1
    |
126 |                     f"User {user_id} not assigned to variant {variant} in test {test_id}"
127 |                 )
128 |
    | ^^^^^^^^^^^^
129 |             self._conversions[test_id][variant].add(user_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:130:1
    |
129 |             self._conversions[test_id][variant].add(user_id)
130 |
    | ^^^^
131 |     def get_test_results(
132 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:137:1
    |
135 |         """
136 |         Get A/B test results with statistical analysis.
137 |
    | ^^^^^^^^
138 |         Args:
139 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:140:1
    |
138 |         Args:
139 |             test_id: Test identifier
140 |
    | ^^^^^^^^^^^^
141 |         Returns:
142 |             Dictionary with test results including:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:152:1
    |
150 |             if test_id not in self._tests:
151 |                 raise ValueError(f"Test {test_id} not found")
152 |
    | ^^^^^^^^^^^^
153 |             test = self._tests[test_id]
154 |             variants = test["variants"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:155:1
    |
153 |             test = self._tests[test_id]
154 |             variants = test["variants"]
155 |
    | ^^^^^^^^^^^^
156 |             # Calculate metrics per variant
157 |             variant_stats = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:170:1
    |
168 |                     else 0.0
169 |                 )
170 |
    | ^^^^^^^^^^^^^^^^
171 |                 variant_stats[variant.value] = {
172 |                     "variant": variant.value,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:177:1
    |
175 |                     "conversion_rate": conversion_rate,
176 |                 }
177 |
    | ^^^^^^^^^^^^
178 |             # Determine winner (highest conversion rate)
179 |             winner = None
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:185:1
    |
183 |                     max_rate = stats["conversion_rate"]
184 |                     winner = variant_name
185 |
    | ^^^^^^^^^^^^
186 |             # Calculate statistical confidence (simplified)
187 |             total_samples = sum(s["assigned"] for s in variant_stats.values())
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:189:1
    |
187 |             total_samples = sum(s["assigned"] for s in variant_stats.values())
188 |             confidence = self._calculate_confidence(total_samples)
189 |
    | ^^^^^^^^^^^^
190 |             return {
191 |                 "test_id": test_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:199:1
    |
197 |                 "confidence": confidence,
198 |             }
199 |
    | ^^^^
200 |     def _calculate_confidence(self, total_samples: int) -> float:
201 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:203:1
    |
201 |         """
202 |         Calculate statistical confidence level.
203 |
    | ^^^^^^^^
204 |         Simplified calculation based on sample size.
205 |         Production systems should use proper statistical tests.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:206:1
    |
204 |         Simplified calculation based on sample size.
205 |         Production systems should use proper statistical tests.
206 |
    | ^^^^^^^^
207 |         Args:
208 |             total_samples: Total number of samples
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:209:1
    |
207 |         Args:
208 |             total_samples: Total number of samples
209 |
    | ^^^^^^^^^^^^
210 |         Returns:
211 |             Confidence level (0.0 to 1.0)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:223:1
    |
221 |         else:
222 |             return 0.95  # High confidence
223 |
    | ^^^^
224 |     def get_all_tests(self) -> list[dict[str, Any]]:
225 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:227:1
    |
225 |         """
226 |         Get all A/B tests.
227 |
    | ^^^^^^^^
228 |         Returns:
229 |             List of test metadata
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:242:1
    |
240 |                 for test_id, test in self._tests.items()
241 |             ]
242 |
    | ^^^^
243 |     def stop_test(self, test_id: str) -> None:
244 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:246:1
    |
244 |         """
245 |         Stop an active A/B test.
246 |
    | ^^^^^^^^
247 |         Args:
248 |             test_id: Test identifier
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/ab_test_repository.py:253:1
    |
251 |             if test_id not in self._tests:
252 |                 raise ValueError(f"Test {test_id} not found")
253 |
    | ^^^^^^^^^^^^
254 |             self._tests[test_id]["status"] = "stopped"
255 |             self._tests[test_id]["stopped_at"] = datetime.utcnow()
    |
help: Remove whitespace from blank line

F401 [*] `datetime.timedelta` imported but unused
  --> app/services/analytics/infrastructure/analytics_aggregator.py:13:32
   |
11 | from __future__ import annotations
12 |
13 | from datetime import datetime, timedelta
   |                                ^^^^^^^^^
14 | from typing import Any
   |
help: Remove unused import: `datetime.timedelta`

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:27:1
   |
25 |     """
26 |     In-memory analytics aggregator.
27 |
   | ^^^^
28 |     Features:
29 |     - Real-time metric calculations
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:34:1
   |
32 |     - Cohort analytics
33 |     """
34 |
   | ^^^^
35 |     def __init__(
36 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:42:1
   |
40 |         """
41 |         Initialize aggregator.
42 |
   | ^^^^^^^^
43 |         Args:
44 |             event_repository: Event storage repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:49:1
   |
47 |         self._event_repo = event_repository
48 |         self._session_repo = session_repository
49 |
   | ^^^^
50 |     def calculate_engagement_metrics(
51 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:57:1
   |
55 |         """
56 |         Calculate engagement metrics for time period.
57 |
   | ^^^^^^^^
58 |         Args:
59 |             start_time: Start of analysis period
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:61:1
   |
59 |             start_time: Start of analysis period
60 |             end_time: End of analysis period
61 |
   | ^^^^^^^^^^^^
62 |         Returns:
63 |             Dictionary with engagement metrics including:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:76:1
   |
74 |             limit=float('inf'),  # type: ignore
75 |         )
76 |
   | ^^^^^^^^
77 |         # Get all sessions in period
78 |         sessions = self._session_repo.get_active_sessions(since=start_time)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:80:1
   |
78 |         sessions = self._session_repo.get_active_sessions(since=start_time)
79 |         sessions = [s for s in sessions if s.start_time <= end_time]
80 |
   | ^^^^^^^^
81 |         # Calculate metrics
82 |         unique_users = len(set(e.user_id for e in events))
   |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
  --> app/services/analytics/infrastructure/analytics_aggregator.py:82:28
   |
81 |         # Calculate metrics
82 |         unique_users = len(set(e.user_id for e in events))
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
83 |         total_events = len(events)
84 |         total_sessions = len(sessions)
   |
help: Rewrite as a set comprehension

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:85:1
   |
83 |         total_events = len(events)
84 |         total_sessions = len(sessions)
85 |
   | ^^^^^^^^
86 |         avg_events_per_user = total_events / unique_users if unique_users > 0 else 0.0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:87:1
   |
86 |         avg_events_per_user = total_events / unique_users if unique_users > 0 else 0.0
87 |
   | ^^^^^^^^
88 |         # Calculate average session duration
89 |         session_durations = []
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/analytics_aggregator.py:94:1
   |
92 |                 duration = (session.end_time - session.start_time).total_seconds()
93 |                 session_durations.append(duration)
94 |
   | ^^^^^^^^
95 |         avg_session_duration = (
96 |             sum(session_durations) / len(session_durations)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:100:1
    |
 98 |             else 0.0
 99 |         )
100 |
    | ^^^^^^^^
101 |         return {
102 |             "total_events": total_events,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:108:1
    |
106 |             "avg_session_duration": avg_session_duration,
107 |         }
108 |
    | ^^^^
109 |     def calculate_conversion_metrics(
110 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:117:1
    |
115 |         """
116 |         Calculate conversion metrics for funnel.
117 |
    | ^^^^^^^^
118 |         Args:
119 |             funnel_steps: List of event types in funnel
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:122:1
    |
120 |             start_time: Start of analysis period
121 |             end_time: End of analysis period
122 |
    | ^^^^^^^^^^^^
123 |         Returns:
124 |             Dictionary with conversion metrics including:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:135:1
    |
133 |                 "step_conversion_rates": [],
134 |             }
135 |
    | ^^^^^^^^
136 |         # Track users at each step
137 |         users_at_step: list[set[int]] = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:138:1
    |
136 |         # Track users at each step
137 |         users_at_step: list[set[int]] = []
138 |
    | ^^^^^^^^
139 |         for step in funnel_steps:
140 |             # Get events for this step
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:147:1
    |
145 |                 limit=float('inf'),  # type: ignore
146 |             )
147 |
    | ^^^^^^^^^^^^
148 |             # Get unique users who reached this step
149 |             users = set(e.user_id for e in events)
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
   --> app/services/analytics/infrastructure/analytics_aggregator.py:149:21
    |
148 |             # Get unique users who reached this step
149 |             users = set(e.user_id for e in events)
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
150 |
151 |             # Filter to only users who completed previous steps
    |
help: Rewrite as a set comprehension

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:150:1
    |
148 |             # Get unique users who reached this step
149 |             users = set(e.user_id for e in events)
150 |
    | ^^^^^^^^^^^^
151 |             # Filter to only users who completed previous steps
152 |             if users_at_step:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:154:1
    |
152 |             if users_at_step:
153 |                 users = users.intersection(users_at_step[-1])
154 |
    | ^^^^^^^^^^^^
155 |             users_at_step.append(users)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:156:1
    |
155 |             users_at_step.append(users)
156 |
    | ^^^^^^^^
157 |         # Calculate conversion rates
158 |         step_counts = [len(users) for users in users_at_step]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:159:1
    |
157 |         # Calculate conversion rates
158 |         step_counts = [len(users) for users in users_at_step]
159 |
    | ^^^^^^^^
160 |         step_conversion_rates = []
161 |         for i in range(1, len(step_counts)):
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:166:1
    |
164 |             rate = curr_count / prev_count if prev_count > 0 else 0.0
165 |             step_conversion_rates.append(rate)
166 |
    | ^^^^^^^^
167 |         overall_conversion_rate = (
168 |             step_counts[-1] / step_counts[0]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:172:1
    |
170 |             else 0.0
171 |         )
172 |
    | ^^^^^^^^
173 |         funnel_data = [
174 |             {
    |
help: Remove whitespace from blank line

B905 `zip()` without an explicit `strict=` parameter
   --> app/services/analytics/infrastructure/analytics_aggregator.py:178:32
    |
176 |                 "users": count,
177 |             }
178 |             for step, count in zip(funnel_steps, step_counts)
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
179 |         ]
    |
help: Add explicit value for parameter `strict=`

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:180:1
    |
178 |             for step, count in zip(funnel_steps, step_counts)
179 |         ]
180 |
    | ^^^^^^^^
181 |         return {
182 |             "funnel_steps": funnel_data,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:186:1
    |
184 |             "step_conversion_rates": step_conversion_rates,
185 |         }
186 |
    | ^^^^
187 |     def calculate_retention_metrics(
188 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:194:1
    |
192 |         """
193 |         Calculate retention metrics for cohort.
194 |
    | ^^^^^^^^
195 |         Args:
196 |             cohort_id: Cohort identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:198:1
    |
196 |             cohort_id: Cohort identifier
197 |             days: Number of days to analyze
198 |
    | ^^^^^^^^^^^^
199 |         Returns:
200 |             Dictionary with retention metrics including:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/analytics_aggregator.py:208:1
    |
206 |         # For simplicity, return placeholder metrics
207 |         # In production, this would query cohort data and calculate retention
208 |
    | ^^^^^^^^
209 |         return {
210 |             "cohort_id": cohort_id,
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/analytics/infrastructure/in_memory_repository.py:11:1
   |
 9 |   """
10 |
11 | / from __future__ import annotations
12 | |
13 | | import threading
14 | | from collections import defaultdict, deque
15 | | from datetime import datetime, timedelta
16 | | from typing import Any
17 | |
18 | | from app.services.analytics.domain.models import EventType, UserEvent, UserSession
19 | | from app.services.analytics.domain.ports import EventRepositoryPort, SessionRepositoryPort
   | |__________________________________________________________________________________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:30:1
   |
28 |     """
29 |     In-memory event repository.
30 |
   | ^^^^
31 |     Features:
32 |     - Thread-safe operations
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:40:1
   |
38 |         """
39 |         Initialize event repository.
40 |
   | ^^^^^^^^
41 |         Args:
42 |             max_events: Maximum number of events to retain
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:74:1
   |
72 |             else:
73 |                 candidates = list(self._events)
74 |
   | ^^^^^^^^^^^^
75 |             # Apply filters
76 |             results = []
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:81:1
   |
79 |                 if event_type is not None and event.event_type != event_type:
80 |                     continue
81 |
   | ^^^^^^^^^^^^^^^^
82 |                 # Time filters
83 |                 if start_time is not None and event.timestamp < start_time:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:87:1
   |
85 |                 if end_time is not None and event.timestamp > end_time:
86 |                     continue
87 |
   | ^^^^^^^^^^^^^^^^
88 |                 results.append(event)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:89:1
   |
88 |                 results.append(event)
89 |
   | ^^^^^^^^^^^^^^^^
90 |                 if len(results) >= limit:
91 |                     break
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/in_memory_repository.py:92:1
   |
90 |                 if len(results) >= limit:
91 |                     break
92 |
   | ^^^^^^^^^^^^
93 |             return results
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:118:1
    |
116 |             new_events = [e for e in self._events if e.timestamp >= before]
117 |             deleted_count = len(self._events) - len(new_events)
118 |
    | ^^^^^^^^^^^^
119 |             # Rebuild indices
120 |             self._events.clear()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:123:1
    |
121 |             self._events_by_user.clear()
122 |             self._events_by_session.clear()
123 |
    | ^^^^^^^^^^^^
124 |             for event in new_events:
125 |                 self._events.append(event)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:128:1
    |
126 |                 self._events_by_user[event.user_id].append(event)
127 |                 self._events_by_session[event.session_id].append(event)
128 |
    | ^^^^^^^^^^^^
129 |             return deleted_count
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:140:1
    |
138 |     """
139 |     In-memory session repository.
140 |
    | ^^^^
141 |     Features:
142 |     - Thread-safe operations
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:158:1
    |
156 |             session_id = session.session_id
157 |             user_id = session.user_id
158 |
    | ^^^^^^^^^^^^
159 |             # Store session
160 |             self._sessions[session_id] = session
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:161:1
    |
159 |             # Store session
160 |             self._sessions[session_id] = session
161 |
    | ^^^^^^^^^^^^
162 |             # Update user index if new session
163 |             if session_id not in self._sessions_by_user[user_id]:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:181:1
    |
179 |             session_ids = self._sessions_by_user.get(user_id, [])
180 |             sessions = []
181 |
    | ^^^^^^^^^^^^
182 |             for session_id in session_ids:
183 |                 session = self._sessions.get(session_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:186:1
    |
184 |                 if session is None:
185 |                     continue
186 |
    | ^^^^^^^^^^^^^^^^
187 |                 # Time filters
188 |                 if start_time is not None and session.start_time < start_time:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:192:1
    |
190 |                 if end_time is not None and session.start_time > end_time:
191 |                     continue
192 |
    | ^^^^^^^^^^^^^^^^
193 |                 sessions.append(session)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:194:1
    |
193 |                 sessions.append(session)
194 |
    | ^^^^^^^^^^^^
195 |             return sessions
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:201:1
    |
199 |         with self._lock:
200 |             active = []
201 |
    | ^^^^^^^^^^^^
202 |             for session in self._sessions.values():
203 |                 # Consider session active if no end time or recent activity
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:209:1
    |
207 |                 elif since is not None and session.end_time >= since:
208 |                     active.append(session)
209 |
    | ^^^^^^^^^^^^
210 |             return active
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:221:1
    |
219 |     """
220 |     In-memory user repository.
221 |
    | ^^^^
222 |     Stores user metadata and activity tracking.
223 |     """
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:224:1
    |
222 |     Stores user metadata and activity tracking.
223 |     """
224 |
    | ^^^^
225 |     def __init__(self):
226 |         self._users: dict[int, dict[str, Any]] = {}
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:228:1
    |
226 |         self._users: dict[int, dict[str, Any]] = {}
227 |         self._lock = threading.RLock()
228 |
    | ^^^^
229 |     def get_all(self) -> dict[int, dict[str, Any]]:
230 |         """Get all users"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:233:1
    |
231 |         with self._lock:
232 |             return dict(self._users)
233 |
    | ^^^^
234 |     def get_or_create(self, user_id: int) -> dict[str, Any]:
235 |         """Get or create user record"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:248:1
    |
246 |                 }
247 |             return self._users[user_id]
248 |
    | ^^^^
249 |     def update(self, user_id: int, data: dict[str, Any]) -> None:
250 |         """Update user data"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:254:1
    |
252 |             if user_id in self._users:
253 |                 self._users[user_id].update(data)
254 |
    | ^^^^
255 |     def get_active_users(self, days: int) -> set[int]:
256 |         """Get active users within days"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/in_memory_repository.py:260:1
    |
258 |             now = datetime.utcnow()
259 |             cutoff = now - timedelta(days=days)
260 |
    | ^^^^^^^^^^^^
261 |             return {
262 |                 user_id
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:24:1
   |
22 |     """
23 |     In-memory rule-based user segmentation.
24 |
   | ^^^^
25 |     Features:
26 |     - Rule-based classification
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:31:1
   |
29 |     - Segment analytics
30 |     """
31 |
   | ^^^^
32 |     def __init__(self):
33 |         """Initialize user segmentation."""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:37:1
   |
35 |         self._segment_users: dict[UserSegment, set[int]] = defaultdict(set)
36 |         self._lock = threading.RLock()
37 |
   | ^^^^
38 |     def classify_user(
39 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:45:1
   |
43 |         """
44 |         Classify user into a segment based on behavior data.
45 |
   | ^^^^^^^^
46 |         Args:
47 |             user_id: User identifier
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:54:1
   |
52 |                 - days_since_signup: Days since user signed up
53 |                 - total_conversions: Number of conversions
54 |
   | ^^^^^^^^^^^^^^^^
55 |         Returns:
56 |             UserSegment classification
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:64:1
   |
62 |             days_since_signup = user_data.get("days_since_signup", 0)
63 |             total_conversions = user_data.get("total_conversions", 0)
64 |
   | ^^^^^^^^^^^^
65 |             # Rule-based classification
66 |             segment = self._apply_segmentation_rules(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:72:1
   |
70 |                 total_conversions=total_conversions,
71 |             )
72 |
   | ^^^^^^^^^^^^
73 |             # Update segment tracking
74 |             old_segment = self._user_segments.get(user_id)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:77:1
   |
75 |             if old_segment and old_segment != segment:
76 |                 self._segment_users[old_segment].discard(user_id)
77 |
   | ^^^^^^^^^^^^
78 |             self._user_segments[user_id] = segment
79 |             self._segment_users[segment].add(user_id)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:80:1
   |
78 |             self._user_segments[user_id] = segment
79 |             self._segment_users[segment].add(user_id)
80 |
   | ^^^^^^^^^^^^
81 |             return segment
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:82:1
   |
81 |             return segment
82 |
   | ^^^^
83 |     def _apply_segmentation_rules(
84 |         self,
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/analytics/infrastructure/user_segmentation.py:92:1
   |
90 |         """
91 |         Apply segmentation rules to classify user.
92 |
   | ^^^^^^^^
93 |         Segmentation logic:
94 |         - NEW: Less than 7 days since signup, few sessions
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:103:1
    |
101 |         if days_since_signup < 7:
102 |             return UserSegment.NEW
103 |
    | ^^^^^^^^
104 |         # Power users (high engagement)
105 |         if total_events > 100 and total_sessions > 20:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:107:1
    |
105 |         if total_events > 100 and total_sessions > 20:
106 |             return UserSegment.POWER
107 |
    | ^^^^^^^^
108 |         # Active users (regular engagement)
109 |         if total_events > 20 and total_sessions > 5:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:111:1
    |
109 |         if total_events > 20 and total_sessions > 5:
110 |             return UserSegment.ACTIVE
111 |
    | ^^^^^^^^
112 |         # At-risk users (some activity but declining)
113 |         if total_events > 10 and total_sessions > 2:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:115:1
    |
113 |         if total_events > 10 and total_sessions > 2:
114 |             return UserSegment.AT_RISK
115 |
    | ^^^^^^^^
116 |         # Churned users (very low or no activity)
117 |         return UserSegment.CHURNED
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:118:1
    |
116 |         # Churned users (very low or no activity)
117 |         return UserSegment.CHURNED
118 |
    | ^^^^
119 |     def get_segment_users(
120 |         self,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:125:1
    |
123 |         """
124 |         Get all users in a segment.
125 |
    | ^^^^^^^^
126 |         Args:
127 |             segment: User segment
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:128:1
    |
126 |         Args:
127 |             segment: User segment
128 |
    | ^^^^^^^^^^^^
129 |         Returns:
130 |             List of user IDs in segment
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:134:1
    |
132 |         with self._lock:
133 |             return list(self._segment_users.get(segment, set()))
134 |
    | ^^^^
135 |     def update_segmentation(self) -> dict[UserSegment, int]:
136 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:138:1
    |
136 |         """
137 |         Update all user segments and return counts.
138 |
    | ^^^^^^^^
139 |         This is a no-op in the current implementation since segmentation
140 |         happens on-demand in classify_user(). In a production system,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:142:1
    |
140 |         happens on-demand in classify_user(). In a production system,
141 |         this could trigger batch re-segmentation of all users.
142 |
    | ^^^^^^^^
143 |         Returns:
144 |             Dictionary mapping segments to user counts
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:151:1
    |
149 |                 for segment, users in self._segment_users.items()
150 |             }
151 |
    | ^^^^
152 |     def get_segment_stats(self) -> dict[str, Any]:
153 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:155:1
    |
153 |         """
154 |         Get statistics about all segments.
155 |
    | ^^^^^^^^
156 |         Returns:
157 |             Dictionary with segment statistics
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:161:1
    |
159 |         with self._lock:
160 |             total_users = sum(len(users) for users in self._segment_users.values())
161 |
    | ^^^^^^^^^^^^
162 |             segment_stats = {}
163 |             for segment, users in self._segment_users.items():
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:166:1
    |
164 |                 count = len(users)
165 |                 percentage = (count / total_users * 100) if total_users > 0 else 0.0
166 |
    | ^^^^^^^^^^^^^^^^
167 |                 segment_stats[segment.value] = {
168 |                     "count": count,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/analytics/infrastructure/user_segmentation.py:171:1
    |
169 |                     "percentage": percentage,
170 |                 }
171 |
    | ^^^^^^^^^^^^
172 |             return {
173 |                 "total_users": total_users,
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/__init__.py:14:1
   |
12 | Usage:
13 |     from app.services.api_advanced_analytics import AdvancedAnalyticsService
14 |
   | ^^^^
15 |     service = AdvancedAnalyticsService()
16 |     service.track_request(endpoint="/api/users", method="GET", ...)
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/api_advanced_analytics/__init__.py:38:11
   |
36 |   )
37 |
38 |   __all__ = [
   |  ___________^
39 | |     # Facade (backward compatible)
40 | |     "AdvancedAnalyticsService",
41 | |     "get_advanced_analytics_service",
42 | |     # Application
43 | |     "AnalyticsManager",
44 | |     # Domain Models
45 | |     "AnalyticsReport",
46 | |     "BehaviorPattern",
47 | |     "BehaviorProfile",
48 | |     "MetricType",
49 | |     "TimeGranularity",
50 | |     "UsageMetric",
51 | |     "UserJourney",
52 | |     # Infrastructure
53 | |     "InMemoryBehaviorRepository",
54 | |     "InMemoryJourneyRepository",
55 | |     "InMemoryMetricsRepository",
56 | |     "InMemoryReportRepository",
57 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_advanced_analytics/application/manager.py:10:1
   |
 8 |   """
 9 |
10 | / import statistics
11 | | import threading
12 | | from collections import defaultdict, deque
13 | | from datetime import UTC, datetime, timedelta
14 | | from typing import Any
15 | | from uuid import uuid4
16 | |
17 | | from ..domain import (
18 | |     AnalyticsReport,
19 | |     BehaviorPattern,
20 | |     BehaviorProfile,
21 | |     BehaviorRepositoryPort,
22 | |     JourneyRepositoryPort,
23 | |     MetricType,
24 | |     MetricsRepositoryPort,
25 | |     ReportRepositoryPort,
26 | |     TimeGranularity,
27 | |     UsageMetric,
28 | |     UserJourney,
29 | | )
   | |_^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/application/manager.py:35:1
   |
33 |     """
34 |     Advanced Analytics Service Manager.
35 |
   | ^^^^
36 |     Coordinates all analytics operations:
37 |     - Real-time usage tracking
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/application/manager.py:85:1
   |
83 |         """
84 |         Track an API request with all its details.
85 |
   | ^^^^^^^^
86 |         Args:
87 |             endpoint: API endpoint path
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:137:1
    |
135 |         """Update hourly aggregated metrics."""
136 |         hour_key = timestamp.strftime("%Y-%m-%d-%H")
137 |
    | ^^^^^^^^
138 |         self._hourly_metrics[hour_key]["total_requests"] += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:139:1
    |
138 |         self._hourly_metrics[hour_key]["total_requests"] += 1
139 |
    | ^^^^^^^^
140 |         if status_code < 400:
141 |             self._hourly_metrics[hour_key]["successful_requests"] += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:144:1
    |
142 |         else:
143 |             self._hourly_metrics[hour_key]["failed_requests"] += 1
144 |
    | ^^^^^^^^
145 |         if user_id:
146 |             self._hourly_metrics[hour_key]["unique_users"].add(user_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:147:1
    |
145 |         if user_id:
146 |             self._hourly_metrics[hour_key]["unique_users"].add(user_id)
147 |
    | ^^^^^^^^
148 |         self._hourly_metrics[hour_key]["endpoints"][endpoint] += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:162:1
    |
160 |         # Get or create journey
161 |         journey = self._journey_repo.get_journey(session_id)
162 |
    | ^^^^^^^^
163 |         if journey is None:
164 |             journey = UserJourney(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:169:1
    |
167 |                 start_time=timestamp,
168 |             )
169 |
    | ^^^^^^^^
170 |         # Update journey
171 |         journey.end_time = timestamp
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:178:1
    |
176 |             "status_code": status_code,
177 |         })
178 |
    | ^^^^^^^^
179 |         if status_code >= 400:
180 |             journey.errors_encountered += 1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:181:1
    |
179 |         if status_code >= 400:
180 |             journey.errors_encountered += 1
181 |
    | ^^^^^^^^
182 |         # Save updated journey
183 |         self._journey_repo.save_journey(journey)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:188:1
    |
186 |         """
187 |         Get real-time dashboard with current metrics.
188 |
    | ^^^^^^^^
189 |         Returns comprehensive real-time analytics including:
190 |         - Current request rate
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:199:1
    |
197 |             now = datetime.now(UTC)
198 |             hour_key = now.strftime("%Y-%m-%d-%H")
199 |
    | ^^^^^^^^^^^^
200 |             # Get current hour metrics
201 |             current_hour = self._hourly_metrics.get(hour_key, {})
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:202:1
    |
200 |             # Get current hour metrics
201 |             current_hour = self._hourly_metrics.get(hour_key, {})
202 |
    | ^^^^^^^^^^^^
203 |             # Get recent metrics (last 5 minutes)
204 |             recent_metrics = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:208:1
    |
206 |                 if (now - m.timestamp).total_seconds() < 300
207 |             ]
208 |
    | ^^^^^^^^^^^^
209 |             # Calculate request rate
210 |             request_metrics = [m for m in recent_metrics if m.name == "api_request"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:212:1
    |
210 |             request_metrics = [m for m in recent_metrics if m.name == "api_request"]
211 |             requests_per_minute = len(request_metrics) / 5.0
212 |
    | ^^^^^^^^^^^^
213 |             # Calculate response time percentiles
214 |             response_times = [m.value for m in recent_metrics if m.name == "response_time"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:215:1
    |
213 |             # Calculate response time percentiles
214 |             response_times = [m.value for m in recent_metrics if m.name == "response_time"]
215 |
    | ^^^^^^^^^^^^
216 |             p50 = statistics.median(response_times) if response_times else 0
217 |             p95 = (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:227:1
    |
225 |                 else 0
226 |             )
227 |
    | ^^^^^^^^^^^^
228 |             # Calculate error rate
229 |             failed_requests = len([
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:238:1
    |
236 |                 else 0
237 |             )
238 |
    | ^^^^^^^^^^^^
239 |             # Get top endpoints
240 |             top_endpoints = self._get_top_endpoints(recent_metrics, limit=5)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:241:1
    |
239 |             # Get top endpoints
240 |             top_endpoints = self._get_top_endpoints(recent_metrics, limit=5)
241 |
    | ^^^^^^^^^^^^
242 |             return {
243 |                 "timestamp": now.isoformat(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:267:1
    |
265 |         """Get top endpoints by request count."""
266 |         endpoint_counts: dict[str, int] = defaultdict(int)
267 |
    | ^^^^^^^^
268 |         for metric in metrics:
269 |             if metric.name == "api_request" and metric.endpoint:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:271:1
    |
269 |             if metric.name == "api_request" and metric.endpoint:
270 |                 endpoint_counts[metric.endpoint] += 1
271 |
    | ^^^^^^^^
272 |         # Sort and limit
273 |         sorted_endpoints = sorted(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:278:1
    |
276 |             reverse=True,
277 |         )[:limit]
278 |
    | ^^^^^^^^
279 |         return [
280 |             {"endpoint": endpoint, "requests": count}
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:287:1
    |
285 |         """
286 |         Analyze user behavior and create behavior profile.
287 |
    | ^^^^^^^^
288 |         Uses machine learning-like heuristics to classify user behavior
289 |         and predict churn probability.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:290:1
    |
288 |         Uses machine learning-like heuristics to classify user behavior
289 |         and predict churn probability.
290 |
    | ^^^^^^^^
291 |         Args:
292 |             user_id: User identifier
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:293:1
    |
291 |         Args:
292 |             user_id: User identifier
293 |
    | ^^^^^^^^^^^^
294 |         Returns:
295 |             BehaviorProfile with classification and predictions
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:299:1
    |
297 |         # Get user's journeys
298 |         journeys = self._journey_repo.get_user_journeys(user_id, limit=30)
299 |
    | ^^^^^^^^
300 |         if not journeys:
301 |             # No data - create default profile
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:310:1
    |
308 |                 peak_usage_hours=[],
309 |             )
310 |
    | ^^^^^^^^
311 |         # Calculate statistics
312 |         total_requests = sum(j.total_requests for j in journeys)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:314:1
    |
312 |         total_requests = sum(j.total_requests for j in journeys)
313 |         avg_requests_per_day = total_requests / max(len(journeys), 1)
314 |
    | ^^^^^^^^
315 |         total_duration = sum(j.duration_seconds for j in journeys)
316 |         avg_session_duration = total_duration / max(len(journeys), 1)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:317:1
    |
315 |         total_duration = sum(j.duration_seconds for j in journeys)
316 |         avg_session_duration = total_duration / max(len(journeys), 1)
317 |
    | ^^^^^^^^
318 |         # Find favorite endpoints
319 |         endpoint_counts: dict[str, int] = defaultdict(int)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:325:1
    |
323 |                 if endpoint:
324 |                     endpoint_counts[endpoint] += 1
325 |
    | ^^^^^^^^
326 |         favorite_endpoints = sorted(
327 |             endpoint_counts.keys(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:331:1
    |
329 |             reverse=True,
330 |         )[:5]
331 |
    | ^^^^^^^^
332 |         # Find peak usage hours
333 |         hour_counts: dict[int, int] = defaultdict(int)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:336:1
    |
334 |         for journey in journeys:
335 |             hour_counts[journey.start_time.hour] += 1
336 |
    | ^^^^^^^^
337 |         peak_usage_hours = sorted(
338 |             hour_counts.keys(),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:342:1
    |
340 |             reverse=True,
341 |         )[:3]
342 |
    | ^^^^^^^^
343 |         # Classify behavior pattern
344 |         if avg_requests_per_day > 50:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:360:1
    |
358 |         else:
359 |             pattern = BehaviorPattern.CASUAL_USER
360 |
    | ^^^^^^^^
361 |         # Calculate churn probability (simple heuristic)
362 |         churn_probability = 0.0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:369:1
    |
367 |         elif pattern == BehaviorPattern.POWER_USER:
368 |             churn_probability = 0.1
369 |
    | ^^^^^^^^
370 |         # Estimate lifetime value (simple heuristic based on activity)
371 |         lifetime_value_estimate = avg_requests_per_day * 365 * 0.1
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:372:1
    |
370 |         # Estimate lifetime value (simple heuristic based on activity)
371 |         lifetime_value_estimate = avg_requests_per_day * 365 * 0.1
372 |
    | ^^^^^^^^
373 |         profile = BehaviorProfile(
374 |             user_id=user_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:383:1
    |
381 |             lifetime_value_estimate=lifetime_value_estimate,
382 |         )
383 |
    | ^^^^^^^^
384 |         # Save profile
385 |         self._behavior_repo.save_profile(profile)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:386:1
    |
384 |         # Save profile
385 |         self._behavior_repo.save_profile(profile)
386 |
    | ^^^^^^^^
387 |         return profile
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:398:1
    |
396 |         """
397 |         Generate comprehensive usage report.
398 |
    | ^^^^^^^^
399 |         Args:
400 |             name: Report name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:404:1
    |
402 |             end_time: End of time range
403 |             granularity: Time granularity for aggregation
404 |
    | ^^^^^^^^^^^^
405 |         Returns:
406 |             AnalyticsReport with metrics and insights
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:416:1
    |
414 |             granularity=granularity,
415 |         )
416 |
    | ^^^^^^^^
417 |         # Get metrics for time range
418 |         metrics = self._metrics_repo.get_metrics(start_time, end_time)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:419:1
    |
417 |         # Get metrics for time range
418 |         metrics = self._metrics_repo.get_metrics(start_time, end_time)
419 |
    | ^^^^^^^^
420 |         # Calculate aggregated metrics
421 |         request_metrics = [m for m in metrics if m.name == "api_request"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:423:1
    |
421 |         request_metrics = [m for m in metrics if m.name == "api_request"]
422 |         response_metrics = [m for m in metrics if m.name == "response_time"]
423 |
    | ^^^^^^^^
424 |         total_requests = len(request_metrics)
425 |         successful_requests = len([m for m in request_metrics if m.status_code and m.status_code < 400])
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:427:1
    |
425 |         successful_requests = len([m for m in request_metrics if m.status_code and m.status_code < 400])
426 |         failed_requests = total_requests - successful_requests
427 |
    | ^^^^^^^^
428 |         report.add_metric("total_requests", total_requests)
429 |         report.add_metric("successful_requests", successful_requests)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:432:1
    |
430 |         report.add_metric("failed_requests", failed_requests)
431 |         report.add_metric("success_rate", (successful_requests / total_requests * 100) if total_requests > 0 else 0)
432 |
    | ^^^^^^^^
433 |         # Response time statistics
434 |         if response_metrics:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:439:1
    |
437 |             report.add_metric("median_response_time", statistics.median(response_times))
438 |             report.add_metric("p95_response_time", statistics.quantiles(response_times, n=20)[18] if len(response_times) > 20 else 0)
439 |
    | ^^^^^^^^
440 |         # Generate insights
441 |         if failed_requests / total_requests > 0.05:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:444:1
    |
442 |             report.add_insight(f"High error rate detected: {failed_requests / total_requests * 100:.1f}%")
443 |             report.add_recommendation("Investigate error patterns and implement fixes")
444 |
    | ^^^^^^^^
445 |         if total_requests > 10000:
446 |             report.add_insight(f"High traffic volume: {total_requests:,} requests")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:448:1
    |
446 |             report.add_insight(f"High traffic volume: {total_requests:,} requests")
447 |             report.add_recommendation("Consider scaling infrastructure to handle load")
448 |
    | ^^^^^^^^
449 |         # Save report
450 |         self._report_repo.save_report(report)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:451:1
    |
449 |         # Save report
450 |         self._report_repo.save_report(report)
451 |
    | ^^^^^^^^
452 |         return report
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:457:1
    |
455 |         """
456 |         Detect anomalies in request patterns.
457 |
    | ^^^^^^^^
458 |         Uses statistical methods to identify unusual patterns.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:459:1
    |
458 |         Uses statistical methods to identify unusual patterns.
459 |
    | ^^^^^^^^
460 |         Args:
461 |             window_hours: Time window to analyze (in hours)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:462:1
    |
460 |         Args:
461 |             window_hours: Time window to analyze (in hours)
462 |
    | ^^^^^^^^^^^^
463 |         Returns:
464 |             List of detected anomalies
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:468:1
    |
466 |         now = datetime.now(UTC)
467 |         start_time = now - timedelta(hours=window_hours)
468 |
    | ^^^^^^^^
469 |         # Get metrics for window
470 |         metrics = [
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:474:1
    |
472 |             if m.timestamp >= start_time
473 |         ]
474 |
    | ^^^^^^^^
475 |         anomalies = []
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:476:1
    |
475 |         anomalies = []
476 |
    | ^^^^^^^^
477 |         # Check for error rate spikes
478 |         request_metrics = [m for m in metrics if m.name == "api_request"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:482:1
    |
480 |             error_metrics = [m for m in request_metrics if m.status_code and m.status_code >= 400]
481 |             error_rate = len(error_metrics) / len(request_metrics)
482 |
    | ^^^^^^^^^^^^
483 |             if error_rate > 0.1:  # > 10% error rate
484 |                 anomalies.append({
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:491:1
    |
489 |                     "message": f"Error rate {error_rate * 100:.1f}% exceeds threshold of 10%",
490 |                 })
491 |
    | ^^^^^^^^
492 |         # Check for response time anomalies
493 |         response_metrics = [m for m in metrics if m.name == "response_time"]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:498:1
    |
496 |             mean_response = statistics.mean(response_times)
497 |             stdev_response = statistics.stdev(response_times)
498 |
    | ^^^^^^^^^^^^
499 |             # Check for values beyond 3 standard deviations
500 |             threshold = mean_response + (3 * stdev_response)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:502:1
    |
500 |             threshold = mean_response + (3 * stdev_response)
501 |             outliers = [r for r in response_times if r > threshold]
502 |
    | ^^^^^^^^^^^^
503 |             if len(outliers) > len(response_times) * 0.01:  # > 1% outliers
504 |                 anomalies.append({
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:511:1
    |
509 |                     "message": f"{len(outliers)} slow responses detected (> {threshold:.0f}ms)",
510 |                 })
511 |
    | ^^^^^^^^
512 |         return anomalies
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:517:1
    |
515 |         """
516 |         Get cost optimization insights based on usage patterns.
517 |
    | ^^^^^^^^
518 |         Analyzes usage to identify cost-saving opportunities.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:519:1
    |
518 |         Analyzes usage to identify cost-saving opportunities.
519 |
    | ^^^^^^^^
520 |         Returns:
521 |             Dictionary with optimization recommendations
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:524:1
    |
522 |         """
523 |         now = datetime.now(UTC)
524 |
    | ^^^^^^^^
525 |         # Analyze last 7 days
526 |         start_time = now - timedelta(days=7)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:531:1
    |
529 |             if m.timestamp >= start_time
530 |         ]
531 |
    | ^^^^^^^^
532 |         insights = {
533 |             "analysis_period": "last_7_days",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:537:1
    |
535 |             "recommendations": [],
536 |         }
537 |
    | ^^^^^^^^
538 |         # Identify low-traffic endpoints
539 |         endpoint_counts: dict[str, int] = defaultdict(int)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:543:1
    |
541 |             if metric.name == "api_request" and metric.endpoint:
542 |                 endpoint_counts[metric.endpoint] += 1
543 |
    | ^^^^^^^^
544 |         low_traffic = [
545 |             endpoint for endpoint, count in endpoint_counts.items()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:548:1
    |
546 |             if count < 100  # Less than 100 requests in 7 days
547 |         ]
548 |
    | ^^^^^^^^
549 |         if low_traffic:
550 |             insights["recommendations"].append({
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:556:1
    |
554 |                 "action": "Consider deprecating unused endpoints to reduce maintenance costs",
555 |             })
556 |
    | ^^^^^^^^
557 |         # Check for peak/off-peak usage
558 |         hour_counts: dict[int, int] = defaultdict(int)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:562:1
    |
560 |             if metric.name == "api_request":
561 |                 hour_counts[metric.timestamp.hour] += 1
562 |
    | ^^^^^^^^
563 |         if hour_counts:
564 |             peak_hour = max(hour_counts.items(), key=lambda x: x[1])
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:566:1
    |
564 |             peak_hour = max(hour_counts.items(), key=lambda x: x[1])
565 |             off_peak_hour = min(hour_counts.items(), key=lambda x: x[1])
566 |
    | ^^^^^^^^^^^^
567 |             if peak_hour[1] > off_peak_hour[1] * 5:  # 5x difference
568 |                 insights["recommendations"].append({
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/api_advanced_analytics/application/manager.py:575:1
    |
573 |                     "action": "Consider auto-scaling or scheduled scaling to optimize costs",
574 |                 })
575 |
    | ^^^^^^^^
576 |         return insights
    |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/api_advanced_analytics/domain/__init__.py:19:11
   |
17 |   )
18 |
19 |   __all__ = [
   |  ___________^
20 | |     # Models
21 | |     "AnalyticsReport",
22 | |     "BehaviorPattern",
23 | |     "BehaviorProfile",
24 | |     "MetricType",
25 | |     "TimeGranularity",
26 | |     "UsageMetric",
27 | |     "UserJourney",
28 | |     # Ports
29 | |     "BehaviorRepositoryPort",
30 | |     "JourneyRepositoryPort",
31 | |     "MetricsRepositoryPort",
32 | |     "ReportRepositoryPort",
33 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_advanced_analytics/domain/models.py:11:1
   |
 9 |   """
10 |
11 | / from dataclasses import dataclass, field
12 | | from datetime import UTC, datetime
13 | | from enum import Enum
14 | | from typing import Any
   | |______________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/domain/models.py:60:1
   |
58 |     """
59 |     Immutable usage metric data point.
60 |
   | ^^^^
61 |     Represents a single measurement at a specific point in time.
62 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/domain/models.py:90:1
   |
88 |     """
89 |     Tracks a user's journey through the system.
90 |
   | ^^^^
91 |     Represents a session with all events and interactions.
92 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/domain/models.py:133:1
    |
131 |     """
132 |     Generated analytics report with insights.
133 |
    | ^^^^
134 |     Aggregates metrics over a time range with actionable insights.
135 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/domain/models.py:167:1
    |
165 |     """
166 |     User behavior analysis profile.
167 |
    | ^^^^
168 |     Machine learning-derived insights about user patterns.
169 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/facade.py:26:1
   |
24 |     """
25 |     Backward-compatible facade for Advanced Analytics Service.
26 |
   | ^^^^
27 |     Maintains the same API as the original monolithic service
28 |     but delegates to the new hexagonal architecture.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics/facade.py:29:1
   |
27 |     Maintains the same API as the original monolithic service
28 |     but delegates to the new hexagonal architecture.
29 |
   | ^^^^
30 |     This is a thin shim (facade pattern) that ensures zero breaking changes.
31 |     """
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/api_advanced_analytics/facade.py:108:1
    |
106 |     """
107 |     Get singleton instance of Advanced Analytics Service.
108 |
    | ^^^^
109 |     Maintains backward compatibility with the original factory function.
110 |     """
    |
help: Remove whitespace from blank line

C401 Unnecessary generator (rewrite as a set comprehension)
  --> app/services/api_advanced_analytics/infrastructure/repositories.py:63:43
   |
61 |             "total_count": float(len(metrics)),
62 |             "request_count": float(len([m for m in metrics if m.name == "api_request"])),
63 |             "unique_endpoints": float(len(set(m.endpoint for m in metrics if m.endpoint))),
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
64 |         }
   |
help: Rewrite as a set comprehension

W293 Blank line contains whitespace
  --> app/services/api_advanced_analytics_service.py:49:1
   |
47 |     """
48 |     Get singleton instance of Advanced Analytics Service.
49 |
   | ^^^^
50 |     DEPRECATED: Use get_advanced_analytics_service() instead.
51 |     """
   |
help: Remove whitespace from blank line

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/api_chaos_monkey/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/api_chaos_monkey/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/api_chaos_monkey/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/api_chaos_monkey/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/api_chaos_monkey/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/api_chaos_monkey/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/api_chaos_monkey/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/api_chaos_monkey/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/api_chaos_monkey/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/api_chaos_monkey/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/api_config_secrets/domain/ports.py:1:1
  |
1 | / from abc import ABC, abstractmethod
2 | | from typing import Any
3 | |
4 | | from .models import ConfigEntry, Secret, SecretAccessLog, Environment
  | |_____________________________________________________________________^
  |
help: Organize imports

F401 [*] `typing.Any` imported but unused
 --> app/services/api_config_secrets/domain/ports.py:2:20
  |
1 | from abc import ABC, abstractmethod
2 | from typing import Any
  |                    ^^^
3 |
4 | from .models import ConfigEntry, Secret, SecretAccessLog, Environment
  |
help: Remove unused import: `typing.Any`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/api_config_secrets/infrastructure/memory_adapters.py:1:1
  |
1 | / from collections import defaultdict, deque
2 | | from typing import Any
3 | | import threading
4 | |
5 | | from app.services.api_config_secrets.domain.models import ConfigEntry, Secret, SecretAccessLog, Environment
6 | | from app.services.api_config_secrets.domain.ports import ConfigRepository, SecretMetadataRepository, AuditLogger
  | |________________________________________________________________________________________________________________^
  |
help: Organize imports

F401 [*] `typing.Any` imported but unused
 --> app/services/api_config_secrets/infrastructure/memory_adapters.py:2:20
  |
1 | from collections import defaultdict, deque
2 | from typing import Any
  |                    ^^^
3 | import threading
  |
help: Remove unused import: `typing.Any`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/api_config_secrets/infrastructure/vault_adapters.py:1:1
  |
1 | / import base64
2 | | import os
3 | | import threading
4 | | from typing import Any
5 | | from cryptography.fernet import Fernet
6 | | from datetime import datetime, UTC
7 | |
8 | | from app.services.api_config_secrets.domain.ports import VaultBackend
  | |_____________________________________________________________________^
  |
help: Organize imports

F401 [*] `typing.Any` imported but unused
 --> app/services/api_config_secrets/infrastructure/vault_adapters.py:4:20
  |
2 | import os
3 | import threading
4 | from typing import Any
  |                    ^^^
5 | from cryptography.fernet import Fernet
6 | from datetime import datetime, UTC
  |
help: Remove unused import: `typing.Any`

F401 [*] `datetime.datetime` imported but unused
 --> app/services/api_config_secrets/infrastructure/vault_adapters.py:6:22
  |
4 | from typing import Any
5 | from cryptography.fernet import Fernet
6 | from datetime import datetime, UTC
  |                      ^^^^^^^^
7 |
8 | from app.services.api_config_secrets.domain.ports import VaultBackend
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
 --> app/services/api_config_secrets/infrastructure/vault_adapters.py:6:32
  |
4 | from typing import Any
5 | from cryptography.fernet import Fernet
6 | from datetime import datetime, UTC
  |                                ^^^
7 |
8 | from app.services.api_config_secrets.domain.ports import VaultBackend
  |
help: Remove unused import

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_config_secrets_service.py:17:1
   |
15 |   #   - Secret versioning and rollback
16 |
17 | / import os
18 | | import threading
19 | | from typing import Any
20 | |
21 | | from app.services.api_config_secrets.domain.models import (
22 | |     ConfigEntry,
23 | |     Environment,
24 | |     EnvironmentConfig,
25 | |     RotationPolicy,
26 | |     Secret,
27 | |     SecretAccessLog,
28 | |     SecretType,
29 | | )
30 | | from app.services.api_config_secrets.domain.ports import VaultBackend
31 | | from app.services.api_config_secrets.application.config_secrets_manager import ConfigSecretsManager
32 | | from app.services.api_config_secrets.infrastructure.memory_adapters import (
33 | |     InMemoryConfigRepository,
34 | |     InMemorySecretMetadataRepository,
35 | |     InMemoryAuditLogger,
36 | | )
37 | | from app.services.api_config_secrets.infrastructure.vault_adapters import (
38 | |     LocalVaultBackend,
39 | |     HashiCorpVaultBackend,
40 | |     AWSSecretsManagerBackend,
41 | |     SecretEncryption,
42 | | )
   | |_^
43 |
44 |   # Re-export key classes for backward compatibility
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/api_config_secrets_service.py:45:11
   |
44 |   # Re-export key classes for backward compatibility
45 |   __all__ = [
   |  ___________^
46 | |     "Environment",
47 | |     "SecretType",
48 | |     "RotationPolicy",
49 | |     "Secret",
50 | |     "ConfigEntry",
51 | |     "SecretAccessLog",
52 | |     "EnvironmentConfig",
53 | |     "SecretEncryption",
54 | |     "VaultBackend",
55 | |     "LocalVaultBackend",
56 | |     "HashiCorpVaultBackend",
57 | |     "AWSSecretsManagerBackend",
58 | |     "ConfigSecretsService",
59 | |     "get_config_secrets_service",
60 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/api_contract/domain/__init__.py:16:11
   |
14 |   )
15 |
16 |   __all__ = [
   |  ___________^
17 | |     "APIVersion",
18 | |     "BreakingChange",
19 | |     "ContractSchema",
20 | |     "ContractValidationResult",
21 | |     "BreakingChangeDetector",
22 | |     "ContractRepository",
23 | |     "SchemaValidator",
24 | |     "VersionManager",
25 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/api_contract/infrastructure/__init__.py:8:11
   |
 6 |   from .version_manager import InMemoryVersionManager
 7 |
 8 |   __all__ = [
   |  ___________^
 9 | |     "SimpleBreakingChangeDetector",
10 | |     "InMemoryContractRepository",
11 | |     "JSONSchemaValidator",
12 | |     "InMemoryVersionManager",
13 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `typing.Any` imported but unused
 --> app/services/api_contract/infrastructure/in_memory_repository.py:3:20
  |
1 | """In-memory implementation of contract repository."""
2 |
3 | from typing import Any
  |                    ^^^
4 |
5 | from ..domain.models import ContractSchema
  |
help: Remove unused import: `typing.Any`

F401 [*] `jsonschema.ValidationError` imported but unused
 --> app/services/api_contract/infrastructure/jsonschema_validator.py:6:41
  |
4 | from typing import Any
5 |
6 | from jsonschema import Draft7Validator, ValidationError
  |                                         ^^^^^^^^^^^^^^^
7 |
8 | from ..domain.models import ContractValidationResult
  |
help: Remove unused import: `jsonschema.ValidationError`

RUF010 [*] Use explicit conversion flag
  --> app/services/api_contract/infrastructure/jsonschema_validator.py:41:66
   |
39 |             logger.error(f"Validation error: {e}")
40 |             return ContractValidationResult(
41 |                 is_valid=False, errors=[f"Validation exception: {str(e)}"]
   |                                                                  ^^^^^^
42 |             )
   |
help: Replace with conversion flag

W291 [*] Trailing whitespace
 --> app/services/api_contract_service.py:6:2
  |
4 | # ======================================================================================
5 | # This file maintains backward compatibility while delegating to the new architecture.
6 | #
  |  ^
7 | #  REFACTORED: 627 lines  60 lines (90% reduction)
8 | #
  |
help: Remove trailing whitespace

W291 [*] Trailing whitespace
  --> app/services/api_contract_service.py:8:2
   |
 6 | #
 7 | #  REFACTORED: 627 lines  60 lines (90% reduction)
 8 | #
   |  ^
 9 | # New code should use:
10 | #   from app.services.api_contract import get_api_contract_service
   |
help: Remove trailing whitespace

F821 Undefined name `schema`
  --> app/services/api_contract_service.py:49:53
   |
47 |     def get_contract(name: str, version: str):
48 |         """Get contract schema."""
49 |         return _service.get_contract(name, version, schema)
   |                                                     ^^^^^^
50 |
51 |     @staticmethod
   |

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_developer_portal_service.py:22:1
   |
20 |   """
21 |
22 | / from __future__ import annotations
23 | |
24 | | # Re-export everything from the refactored hexagonal architecture
25 | | from app.services.developer_portal import (
26 | |     # Domain models
27 | |     APIKey,
28 | |     APIKeyStatus,
29 | |     CodeExample,
30 | |     SDKLanguage,
31 | |     SDKPackage,
32 | |     SupportTicket,
33 | |     TicketPriority,
34 | |     TicketStatus,
35 | |     # Application services (for advanced usage)
36 | |     APIKeyManager,
37 | |     TicketManager,
38 | |     SDKGenerator,
39 | |     CodeExampleManager,
40 | |     # Infrastructure (for testing/mocking)
41 | |     InMemoryAPIKeyRepository,
42 | |     InMemoryTicketRepository,
43 | |     InMemorySDKRepository,
44 | |     InMemoryCodeExampleRepository,
45 | |     # Main facade (most common usage)
46 | |     DeveloperPortalService,
47 | |     get_developer_portal_service,
48 | | )
   | |_^
49 |
50 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/api_developer_portal_service.py:50:11
   |
48 |   )
49 |
50 |   __all__ = [
   |  ___________^
51 | |     # Enums
52 | |     "SDKLanguage",
53 | |     "TicketStatus",
54 | |     "TicketPriority",
55 | |     "APIKeyStatus",
56 | |     # Models
57 | |     "APIKey",
58 | |     "SupportTicket",
59 | |     "SDKPackage",
60 | |     "CodeExample",
61 | |     # Application services
62 | |     "APIKeyManager",
63 | |     "TicketManager",
64 | |     "SDKGenerator",
65 | |     "CodeExampleManager",
66 | |     # Infrastructure
67 | |     "InMemoryAPIKeyRepository",
68 | |     "InMemoryTicketRepository",
69 | |     "InMemorySDKRepository",
70 | |     "InMemoryCodeExampleRepository",
71 | |     # Service facade
72 | |     "DeveloperPortalService",
73 | |     "get_developer_portal_service",
74 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_disaster_recovery_service.py:24:1
   |
22 |   """
23 |
24 | / from __future__ import annotations
25 | |
26 | | # Re-export everything from the refactored hexagonal architecture
27 | | from app.services.disaster_recovery import (
28 | |     # Domain models
29 | |     IncidentSeverity,
30 | |     IncidentStatus,
31 | |     OnCallRole,
32 | |     RecoveryStrategy,
33 | |     NotificationChannel,
34 | |     Incident,
35 | |     OnCallSchedule,
36 | |     EscalationPolicy,
37 | |     DisasterRecoveryPlan,
38 | |     BackupMetadata,
39 | |     PostIncidentReview,
40 | |     # Facade services
41 | |     DisasterRecoveryService,
42 | |     OnCallIncidentService,
43 | |     get_disaster_recovery_service,
44 | |     get_oncall_incident_service,
45 | | )
   | |_^
46 |
47 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/api_disaster_recovery_service.py:47:11
   |
45 |   )
46 |
47 |   __all__ = [
   |  ___________^
48 | |     # Enums
49 | |     "IncidentSeverity",
50 | |     "IncidentStatus",
51 | |     "OnCallRole",
52 | |     "RecoveryStrategy",
53 | |     "NotificationChannel",
54 | |     # Models
55 | |     "Incident",
56 | |     "OnCallSchedule",
57 | |     "EscalationPolicy",
58 | |     "DisasterRecoveryPlan",
59 | |     "BackupMetadata",
60 | |     "PostIncidentReview",
61 | |     # Services
62 | |     "DisasterRecoveryService",
63 | |     "OnCallIncidentService",
64 | |     "get_disaster_recovery_service",
65 | |     "get_oncall_incident_service",
66 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/api_event_driven_service.py:38:1
   |
37 |   # Re-export everything from the refactored hexagonal architecture
38 | / from app.services.event_driven import (
39 | |     # Domain models
40 | |     Command,
41 | |     Event,
42 | |     EventPriority,
43 | |     EventProcessingResult,
44 | |     EventStatus,
45 | |     EventStream,
46 | |     EventSubscription,
47 | |     MessageBrokerType,
48 | |     Query,
49 | |     # Domain ports
50 | |     MessageBroker,
51 | |     # Application services (for advanced usage)
52 | |     CQRSManager,
53 | |     EventManager,
54 | |     # Infrastructure implementations
55 | |     InMemoryBroker,
56 | |     KafkaBroker,
57 | |     RabbitMQBroker,
58 | |     # Main facade (most common usage)
59 | |     CQRSService,
60 | |     EventDrivenService,
61 | |     get_cqrs_service,
62 | |     get_event_driven_service,
63 | | )
   | |_^
64 |
65 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/api_event_driven_service.py:65:11
   |
63 |   )
64 |
65 |   __all__ = [
   |  ___________^
66 | |     # Enums
67 | |     "EventPriority",
68 | |     "EventStatus",
69 | |     "MessageBrokerType",
70 | |     # Models
71 | |     "Event",
72 | |     "EventProcessingResult",
73 | |     "EventSubscription",
74 | |     "EventStream",
75 | |     "Command",
76 | |     "Query",
77 | |     # Ports/Interfaces
78 | |     "MessageBroker",
79 | |     # Application services
80 | |     "EventManager",
81 | |     "CQRSManager",
82 | |     # Infrastructure
83 | |     "InMemoryBroker",
84 | |     "KafkaBroker",
85 | |     "RabbitMQBroker",
86 | |     # Service facades
87 | |     "EventDrivenService",
88 | |     "CQRSService",
89 | |     "get_event_driven_service",
90 | |     "get_cqrs_service",
91 | |     # Advanced features (if available)
92 | |     "ADVANCED_FEATURES_AVAILABLE",
93 | |     "DomainEvent",
94 | |     "DomainEventRegistry",
95 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/api_governance_service.py:19:11
   |
19 | __all__ = ["governance_service", "get_governance_service", "CosmicGovernanceService"]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/api_observability/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/api_observability/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/api_observability/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/api_observability/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/api_observability/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/api_observability/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/api_observability/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/api_observability/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/api_observability/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/api_observability/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

RUF022 [*] `__all__` is not sorted
  --> app/services/api_security_service.py:19:11
   |
19 | __all__ = ["security_service", "get_security_service", "SuperhumanSecuritySystem"]
   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/api_slo_sli/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/api_slo_sli/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/api_slo_sli/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/api_slo_sli/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/api_slo_sli/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/api_slo_sli/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/api_slo_sli/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/api_slo_sli/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/api_slo_sli/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/api_slo_sli/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/api_subscription/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/api_subscription/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/api_subscription/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/api_subscription/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/api_subscription/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/api_subscription/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/api_subscription/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/api_subscription/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/api_subscription/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/api_subscription/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/auth_boundary/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/auth_boundary/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/auth_boundary/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/auth_boundary/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/auth_boundary/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/auth_boundary/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/auth_boundary/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/auth_boundary/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/auth_boundary/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/auth_boundary/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/auth_boundary_service.py:7:1
   |
 5 |   """
 6 |
 7 | / from __future__ import annotations
 8 | |
 9 | | import datetime
10 | | import logging
11 | | from typing import Any
12 | |
13 | | import jwt
14 | | from fastapi import HTTPException, Request
15 | |
16 | | from app.config.settings import get_settings
17 | | from app.security.chrono_shield import chrono_shield
18 | | from app.services.security.auth_persistence import AuthPersistence
19 | | from sqlalchemy.ext.asyncio import AsyncSession
   | |_______________________________________________^
20 |
21 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

UP035 [*] Import from `collections.abc` instead: `AsyncGenerator`
 --> app/services/chat/handlers/genesis_handler.py:5:1
  |
3 | Adapts the powerful GenesisAgent to the Orchestrator stream protocol.
4 | """
5 | from typing import AsyncGenerator
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
6 | # Local import inside function to avoid circular dependency
7 | from app.genesis.tools.code_explorer import grep_code, read_file_segment, list_files, identify_hotspots
  |
help: Import from `collections.abc`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/chat/handlers/genesis_handler.py:5:1
  |
3 |   Adapts the powerful GenesisAgent to the Orchestrator stream protocol.
4 |   """
5 | / from typing import AsyncGenerator
6 | | # Local import inside function to avoid circular dependency
7 | | from app.genesis.tools.code_explorer import grep_code, read_file_segment, list_files, identify_hotspots
  | |_______________________________________________________________________________________________________^
8 |
9 |   async def handle_genesis_analysis(
  |
help: Organize imports

RUF010 [*] Use explicit conversion flag
  --> app/services/chat/handlers/genesis_handler.py:35:39
   |
34 |     except Exception as e:
35 |         yield f" **Genesis Error:** {str(e)}"
   |                                        ^^^^^^
   |
help: Replace with conversion flag

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/chat/intent_detector.py:5:1
  |
3 |   """
4 |
5 | / import re
6 | | from dataclasses import dataclass
7 | | from typing import Any
8 | | from enum import Enum
  | |_____________________^
  |
help: Organize imports

F401 [*] `os` imported but unused
 --> app/services/chat/security.py:5:8
  |
3 | """
4 |
5 | import os
  |        ^^
6 | import re
  |
help: Remove unused import: `os`

SIM103 Return the condition `not path.startswith("/")` directly
  --> app/services/chat/security.py:19:9
   |
17 |               return False
18 |           # Prevent absolute paths (optional, depending on requirements)
19 | /         if path.startswith("/"):
20 | |             return False
21 | |         return True
   | |___________________^
   |
help: Replace with `return not path.startswith("/")`

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:41:1
   |
39 |         """
40 |         query = select(User)
41 |
   | ^^^^^^^^
42 |         # Apply email filter
43 |         if email:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:45:1
   |
43 |         if email:
44 |             query = query.where(User.email == email)
45 |
   | ^^^^^^^^
46 |         # Apply sorting
47 |         if sort_by and hasattr(User, sort_by):
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:53:1
   |
51 |             else:
52 |                 query = query.order_by(col.asc())
53 |
   | ^^^^^^^^
54 |         # Get total count for pagination
55 |         count_query = select(func.count()).select_from(User)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:58:1
   |
56 |         if email:
57 |             count_query = count_query.where(User.email == email)
58 |
   | ^^^^^^^^
59 |         total_result = await self.db.execute(count_query)
60 |         total_items = total_result.scalar() or 0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:61:1
   |
59 |         total_result = await self.db.execute(count_query)
60 |         total_items = total_result.scalar() or 0
61 |
   | ^^^^^^^^
62 |         # Apply pagination
63 |         query = query.offset((page - 1) * per_page).limit(per_page)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:64:1
   |
62 |         # Apply pagination
63 |         query = query.offset((page - 1) * per_page).limit(per_page)
64 |
   | ^^^^^^^^
65 |         # Execute query
66 |         result = await self.db.execute(query)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:68:1
   |
66 |         result = await self.db.execute(query)
67 |         users = result.scalars().all()
68 |
   | ^^^^^^^^
69 |         # Calculate pagination metadata
70 |         total_pages = (total_items + per_page - 1) // per_page
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:73:1
   |
71 |         has_next = page < total_pages
72 |         has_prev = page > 1
73 |
   | ^^^^^^^^
74 |         return {
75 |             "items": list(users),
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud/crud_persistence.py:97:1
   |
95 |         """
96 |         query = select(Mission)
97 |
   | ^^^^^^^^
98 |         if status:
99 |             query = query.where(Mission.status == status)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud/crud_persistence.py:100:1
    |
 98 |         if status:
 99 |             query = query.where(Mission.status == status)
100 |
    | ^^^^^^^^
101 |         result = await self.db.execute(query)
102 |         return list(result.scalars().all())
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud/crud_persistence.py:115:1
    |
113 |         """
114 |         query = select(Task)
115 |
    | ^^^^^^^^
116 |         if mission_id:
117 |             query = query.where(Task.mission_id == mission_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud/crud_persistence.py:118:1
    |
116 |         if mission_id:
117 |             query = query.where(Task.mission_id == mission_id)
118 |
    | ^^^^^^^^
119 |         result = await self.db.execute(query)
120 |         return list(result.scalars().all())
    |
help: Remove whitespace from blank line

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/crud_boundary/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/crud_boundary/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/crud_boundary/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/crud_boundary/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/crud_boundary/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/crud_boundary/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/crud_boundary/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/crud_boundary/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/crud_boundary/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/crud_boundary/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

W293 [*] Blank line contains whitespace
  --> app/services/crud_boundary_service.py:49:1
   |
47 |             sort_order=sort_order,
48 |         )
49 |
   | ^^^^^^^^
50 |         return {
51 |             "status": "success",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud_boundary_service.py:63:1
   |
61 |         """
62 |         user = await self.persistence.get_user_by_id(user_id)
63 |
   | ^^^^^^^^
64 |         if not user:
65 |             return {
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud_boundary_service.py:71:1
   |
69 |                 "timestamp": datetime.utcnow().isoformat() + "Z",
70 |             }
71 |
   | ^^^^^^^^
72 |         return {
73 |             "status": "success",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/crud_boundary_service.py:85:1
   |
83 |         """
84 |         missions = await self.persistence.get_missions(status=status)
85 |
   | ^^^^^^^^
86 |         return {
87 |             "status": "success",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud_boundary_service.py:98:1
    |
 96 |         """
 97 |         mission = await self.persistence.get_mission_by_id(mission_id)
 98 |
    | ^^^^^^^^
 99 |         if not mission:
100 |             return {
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud_boundary_service.py:105:1
    |
103 |                 "data": None,
104 |             }
105 |
    | ^^^^^^^^
106 |         return {
107 |             "status": "success",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/crud_boundary_service.py:118:1
    |
116 |         """
117 |         tasks = await self.persistence.get_tasks(mission_id=mission_id)
118 |
    | ^^^^^^^^
119 |         return {
120 |             "status": "success",
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
  --> app/services/data_mesh/__init__.py:16:11
   |
14 |   )
15 |
16 |   __all__ = [
   |  ___________^
17 | |     "DataMeshService",
18 | |     "get_data_mesh_service",
19 | |     "DataDomainType",
20 | |     "DataProductStatus",
21 | |     "SchemaCompatibility",
22 | |     "GovernanceLevel",
23 | |     "DataContract",
24 | |     "DataProduct",
25 | |     "BoundedContext",
26 | |     "GovernancePolicy",
27 | |     "DataQualityMetrics",
28 | |     "SchemaEvolution",
29 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/data_mesh/domain/models.py:1:1
  |
1 | / from enum import Enum
2 | | from dataclasses import dataclass, field
3 | | from datetime import UTC, datetime
4 | | from typing import Any
  | |______________________^
  |
help: Organize imports

F401 [*] `abc.ABC` imported but unused
 --> app/services/data_mesh/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/data_mesh/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/data_mesh/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/data_mesh/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

RUF022 [*] `__all__` is not sorted
  --> app/services/data_mesh/facade.py:21:11
   |
20 |   # Export Domain Models for external consumption
21 |   __all__ = [
   |  ___________^
22 | |     "DataMeshService",
23 | |     "get_data_mesh_service",
24 | |     "DataDomainType",
25 | |     "DataProductStatus",
26 | |     "SchemaCompatibility",
27 | |     "GovernanceLevel",
28 | |     "DataContract",
29 | |     "DataProduct",
30 | |     "BoundedContext",
31 | |     "GovernancePolicy",
32 | |     "DataQualityMetrics",
33 | |     "SchemaEvolution",
34 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/data_mesh_service.py:22:11
   |
20 |   )
21 |
22 |   __all__ = [
   |  ___________^
23 | |     "DataMeshService",
24 | |     "get_data_mesh_service",
25 | |     "DataDomainType",
26 | |     "DataProductStatus",
27 | |     "SchemaCompatibility",
28 | |     "GovernanceLevel",
29 | |     "DataContract",
30 | |     "DataProduct",
31 | |     "BoundedContext",
32 | |     "GovernancePolicy",
33 | |     "DataQualityMetrics",
34 | |     "SchemaEvolution",
35 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/database_sharding/domain/__init__.py:3:1
   |
 1 |   """Domain layer for Database Sharding."""
 2 |
 3 | / from .models import (
 4 | |     DatabaseShard,
 5 | |     QueryRoute,
 6 | |     ReplicationRole,
 7 | |     ShardingConfig,
 8 | |     ShardingStrategy,
 9 | |     ShardState,
10 | | )
11 | | from .ports import LoadBalancer, ShardRepository, ShardingRouter
   | |________________________________________________________________^
12 |
13 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/database_sharding/domain/__init__.py:13:11
   |
11 |   from .ports import LoadBalancer, ShardRepository, ShardingRouter
12 |
13 |   __all__ = [
   |  ___________^
14 | |     "DatabaseShard",
15 | |     "QueryRoute",
16 | |     "ReplicationRole",
17 | |     "ShardingConfig",
18 | |     "ShardingStrategy",
19 | |     "ShardState",
20 | |     "LoadBalancer",
21 | |     "ShardRepository",
22 | |     "ShardingRouter",
23 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `typing.Any` imported but unused
 --> app/services/database_sharding/domain/models.py:6:20
  |
4 | from datetime import datetime
5 | from enum import Enum
6 | from typing import Any
  |                    ^^^
  |
help: Remove unused import: `typing.Any`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/database_sharding_service.py:10:1
   |
 8 |   #   from app.services.database_sharding import get_database_sharding_service
 9 |
10 | / import logging
11 | | from typing import Any
12 | |
13 | | from .database_sharding import get_database_sharding_service
14 | | from .database_sharding.domain import (
15 | |     DatabaseShard,
16 | |     ShardingConfig,
17 | |     ShardingStrategy,
18 | |     ShardState,
19 | |     ReplicationRole,
20 | | )
   | |_^
21 |
22 |   logger = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `.database_sharding.domain.ShardingStrategy` imported but unused
  --> app/services/database_sharding_service.py:17:5
   |
15 |     DatabaseShard,
16 |     ShardingConfig,
17 |     ShardingStrategy,
   |     ^^^^^^^^^^^^^^^^
18 |     ShardState,
19 |     ReplicationRole,
   |
help: Remove unused import

F401 [*] `.database_sharding.domain.ShardState` imported but unused
  --> app/services/database_sharding_service.py:18:5
   |
16 |     ShardingConfig,
17 |     ShardingStrategy,
18 |     ShardState,
   |     ^^^^^^^^^^
19 |     ReplicationRole,
20 | )
   |
help: Remove unused import

F401 [*] `.database_sharding.domain.ReplicationRole` imported but unused
  --> app/services/database_sharding_service.py:19:5
   |
17 |     ShardingStrategy,
18 |     ShardState,
19 |     ReplicationRole,
   |     ^^^^^^^^^^^^^^^
20 | )
   |
help: Remove unused import

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/developer_portal/__init__.py:15:1
   |
14 |   # Domain exports
15 | / from app.services.developer_portal.domain.models import (
16 | |     APIKey,
17 | |     APIKeyStatus,
18 | |     CodeExample,
19 | |     SDKLanguage,
20 | |     SDKPackage,
21 | |     SupportTicket,
22 | |     TicketPriority,
23 | |     TicketStatus,
24 | | )
25 | |
26 | | # Application exports
27 | | from app.services.developer_portal.application import (
28 | |     APIKeyManager,
29 | |     TicketManager,
30 | |     SDKGenerator,
31 | |     CodeExampleManager,
32 | | )
33 | |
34 | | # Infrastructure exports
35 | | from app.services.developer_portal.infrastructure import (
36 | |     InMemoryAPIKeyRepository,
37 | |     InMemoryTicketRepository,
38 | |     InMemorySDKRepository,
39 | |     InMemoryCodeExampleRepository,
40 | | )
41 | |
42 | | # Facade exports
43 | | from app.services.developer_portal.facade import (
44 | |     DeveloperPortalService,
45 | |     get_developer_portal_service,
46 | | )
   | |_^
47 |
48 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/developer_portal/__init__.py:48:11
   |
46 |   )
47 |
48 |   __all__ = [
   |  ___________^
49 | |     # Domain models
50 | |     "APIKey",
51 | |     "APIKeyStatus",
52 | |     "CodeExample",
53 | |     "SDKLanguage",
54 | |     "SDKPackage",
55 | |     "SupportTicket",
56 | |     "TicketPriority",
57 | |     "TicketStatus",
58 | |     # Application services
59 | |     "APIKeyManager",
60 | |     "TicketManager",
61 | |     "SDKGenerator",
62 | |     "CodeExampleManager",
63 | |     # Infrastructure
64 | |     "InMemoryAPIKeyRepository",
65 | |     "InMemoryTicketRepository",
66 | |     "InMemorySDKRepository",
67 | |     "InMemoryCodeExampleRepository",
68 | |     # Facade
69 | |     "DeveloperPortalService",
70 | |     "get_developer_portal_service",
71 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/developer_portal/application/__init__.py:8:1
   |
 6 |   """
 7 |
 8 | / from app.services.developer_portal.application.api_key_manager import APIKeyManager
 9 | | from app.services.developer_portal.application.ticket_manager import TicketManager
10 | | from app.services.developer_portal.application.sdk_generator import SDKGenerator
11 | | from app.services.developer_portal.application.code_example_manager import (
12 | |     CodeExampleManager,
13 | | )
   | |_^
14 |
15 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/developer_portal/application/__init__.py:15:11
   |
13 |   )
14 |
15 |   __all__ = [
   |  ___________^
16 | |     "APIKeyManager",
17 | |     "TicketManager",
18 | |     "SDKGenerator",
19 | |     "CodeExampleManager",
20 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/developer_portal/application/api_key_manager.py:4:1
  |
2 |   """API Key Management Service - Single Responsibility"""
3 |
4 | / import hashlib
5 | | import secrets
6 | | from datetime import datetime, timedelta, UTC
7 | |
8 | | from app.services.developer_portal.domain.models import APIKey, APIKeyStatus
9 | | from app.services.developer_portal.domain.ports import APIKeyRepository
  | |_______________________________________________________________________^
  |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/developer_portal/application/api_key_manager.py:15:1
   |
13 |     """
14 |     Manages API key lifecycle.
15 |
   | ^^^^
16 |     Single Responsibility: API key creation, validation, rotation, revocation.
17 |     """
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/developer_portal/application/code_example_manager.py:4:1
  |
2 |   """Code Example Management Service - Single Responsibility"""
3 |
4 | / import uuid
5 | | from datetime import datetime, UTC
6 | |
7 | | from app.services.developer_portal.domain.models import CodeExample, SDKLanguage
8 | | from app.services.developer_portal.domain.ports import CodeExampleRepository
  | |____________________________________________________________________________^
  |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/developer_portal/application/code_example_manager.py:14:1
   |
12 |     """
13 |     Manages code examples.
14 |
   | ^^^^
15 |     Single Responsibility: Code example creation, organization, retrieval.
16 |     """
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/developer_portal/application/sdk_generator.py:4:1
  |
2 |   """SDK Generation Service - Single Responsibility"""
3 |
4 | / import hashlib
5 | | import uuid
6 | | from datetime import datetime, UTC
7 | |
8 | | from app.services.developer_portal.domain.models import SDKPackage, SDKLanguage
9 | | from app.services.developer_portal.domain.ports import SDKRepository
  | |____________________________________________________________________^
  |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/developer_portal/application/sdk_generator.py:15:1
   |
13 |     """
14 |     Generates SDK packages.
15 |
   | ^^^^
16 |     Single Responsibility: SDK generation, versioning, distribution.
17 |     """
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/developer_portal/application/ticket_manager.py:4:1
   |
 2 |   """Support Ticket Management Service - Single Responsibility"""
 3 |
 4 | / import uuid
 5 | | from datetime import datetime, UTC
 6 | | from typing import Any
 7 | |
 8 | | from app.services.developer_portal.domain.models import (
 9 | |     SupportTicket,
10 | |     TicketStatus,
11 | |     TicketPriority,
12 | | )
13 | | from app.services.developer_portal.domain.ports import TicketRepository
   | |_______________________________________________________________________^
   |
help: Organize imports

F401 [*] `typing.Any` imported but unused
 --> app/services/developer_portal/application/ticket_manager.py:6:20
  |
4 | import uuid
5 | from datetime import datetime, UTC
6 | from typing import Any
  |                    ^^^
7 |
8 | from app.services.developer_portal.domain.models import (
  |
help: Remove unused import: `typing.Any`

W293 Blank line contains whitespace
  --> app/services/developer_portal/application/ticket_manager.py:19:1
   |
17 |     """
18 |     Manages support tickets.
19 |
   | ^^^^
20 |     Single Responsibility: Ticket creation, assignment, resolution.
21 |     """
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/developer_portal/domain/__init__.py:21:11
   |
19 |   )
20 |
21 |   __all__ = [
   |  ___________^
22 | |     # Models
23 | |     "APIKey",
24 | |     "SupportTicket",
25 | |     "SDKPackage",
26 | |     "CodeExample",
27 | |     # Enums
28 | |     "SDKLanguage",
29 | |     "TicketStatus",
30 | |     "TicketPriority",
31 | |     "APIKeyStatus",
32 | |     # Ports
33 | |     "APIKeyRepository",
34 | |     "TicketRepository",
35 | |     "SDKRepository",
36 | |     "CodeExampleRepository",
37 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
   --> app/services/developer_portal/domain/models.py:123:11
    |
123 |   __all__ = [
    |  ___________^
124 | |     "SDKLanguage",
125 | |     "TicketStatus",
126 | |     "TicketPriority",
127 | |     "APIKeyStatus",
128 | |     "APIKey",
129 | |     "SupportTicket",
130 | |     "SDKPackage",
131 | |     "CodeExample",
132 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `abc.ABC` imported but unused
 --> app/services/developer_portal/domain/ports.py:8:17
  |
6 | """
7 |
8 | from abc import ABC, abstractmethod
  |                 ^^^
9 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/developer_portal/domain/ports.py:8:22
  |
6 | """
7 |
8 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
9 | from typing import Protocol
  |
help: Remove unused import

RUF022 [*] `__all__` is not sorted
   --> app/services/developer_portal/domain/ports.py:95:11
    |
 95 |   __all__ = [
    |  ___________^
 96 | |     "APIKeyRepository",
 97 | |     "TicketRepository",
 98 | |     "SDKRepository",
 99 | |     "CodeExampleRepository",
100 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/developer_portal/facade.py:8:1
   |
 6 |   """
 7 |
 8 | / import threading
 9 | | from typing import Any
10 | |
11 | | from app.services.developer_portal.domain.models import (
12 | |     APIKey,
13 | |     APIKeyStatus,
14 | |     CodeExample,
15 | |     SDKLanguage,
16 | |     SDKPackage,
17 | |     SupportTicket,
18 | |     TicketPriority,
19 | |     TicketStatus,
20 | | )
21 | | from app.services.developer_portal.application.api_key_manager import APIKeyManager
22 | | from app.services.developer_portal.application.ticket_manager import TicketManager
23 | | from app.services.developer_portal.application.sdk_generator import SDKGenerator
24 | | from app.services.developer_portal.application.code_example_manager import (
25 | |     CodeExampleManager,
26 | | )
27 | | from app.services.developer_portal.infrastructure.in_memory_repository import (
28 | |     InMemoryAPIKeyRepository,
29 | |     InMemoryTicketRepository,
30 | |     InMemorySDKRepository,
31 | |     InMemoryCodeExampleRepository,
32 | | )
   | |_^
   |
help: Organize imports

F401 [*] `typing.Any` imported but unused
  --> app/services/developer_portal/facade.py:9:20
   |
 8 | import threading
 9 | from typing import Any
   |                    ^^^
10 |
11 | from app.services.developer_portal.domain.models import (
   |
help: Remove unused import: `typing.Any`

F401 [*] `app.services.developer_portal.domain.models.APIKeyStatus` imported but unused
  --> app/services/developer_portal/facade.py:13:5
   |
11 | from app.services.developer_portal.domain.models import (
12 |     APIKey,
13 |     APIKeyStatus,
   |     ^^^^^^^^^^^^
14 |     CodeExample,
15 |     SDKLanguage,
   |
help: Remove unused import

F401 [*] `app.services.developer_portal.domain.models.TicketStatus` imported but unused
  --> app/services/developer_portal/facade.py:19:5
   |
17 |     SupportTicket,
18 |     TicketPriority,
19 |     TicketStatus,
   |     ^^^^^^^^^^^^
20 | )
21 | from app.services.developer_portal.application.api_key_manager import APIKeyManager
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/developer_portal/facade.py:38:1
   |
36 |     """
37 |     Developer Portal Service Facade.
38 |
   | ^^^^
39 |     Maintains backward compatibility with original monolithic API
40 |     while delegating to clean hexagonal architecture.
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/developer_portal/infrastructure/__init__.py:8:1
   |
 6 |   """
 7 |
 8 | / from app.services.developer_portal.infrastructure.in_memory_repository import (
 9 | |     InMemoryAPIKeyRepository,
10 | |     InMemoryTicketRepository,
11 | |     InMemorySDKRepository,
12 | |     InMemoryCodeExampleRepository,
13 | | )
   | |_^
14 |
15 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/developer_portal/infrastructure/__init__.py:15:11
   |
13 |   )
14 |
15 |   __all__ = [
   |  ___________^
16 | |     "InMemoryAPIKeyRepository",
17 | |     "InMemoryTicketRepository",
18 | |     "InMemorySDKRepository",
19 | |     "InMemoryCodeExampleRepository",
20 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/developer_portal/infrastructure/in_memory_repository.py:4:1
  |
2 |   """In-Memory Repository Implementations"""
3 |
4 | / from app.services.developer_portal.domain.models import (
5 | |     APIKey,
6 | |     SupportTicket,
7 | |     SDKPackage,
8 | |     CodeExample,
9 | | )
  | |_^
  |
help: Organize imports

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/distributed_resilience/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/distributed_resilience/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/distributed_resilience/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/distributed_resilience/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/distributed_resilience/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/distributed_resilience/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/distributed_resilience/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/distributed_resilience/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/distributed_resilience/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/distributed_resilience/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/edge_multicloud/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/edge_multicloud/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/edge_multicloud/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/edge_multicloud/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/edge_multicloud/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/edge_multicloud/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/edge_multicloud/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/edge_multicloud/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/edge_multicloud/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/edge_multicloud/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/event_driven/__init__.py:11:1
   |
10 |   # Domain models and enums
11 | / from .domain.models import (
12 | |     Command,
13 | |     Event,
14 | |     EventPriority,
15 | |     EventProcessingResult,
16 | |     EventStatus,
17 | |     EventStream,
18 | |     EventSubscription,
19 | |     MessageBrokerType,
20 | |     Query,
21 | | )
22 | |
23 | | # Domain ports
24 | | from .domain.ports import MessageBroker
25 | |
26 | | # Application services
27 | | from .application.cqrs_manager import CQRSManager
28 | | from .application.event_manager import EventManager
29 | |
30 | | # Infrastructure implementations
31 | | from .infrastructure.brokers import InMemoryBroker, KafkaBroker, RabbitMQBroker
32 | |
33 | | # Main facade (backward compatible)
34 | | from .facade import (
35 | |     CQRSService,
36 | |     EventDrivenService,
37 | |     get_cqrs_service,
38 | |     get_event_driven_service,
39 | | )
   | |_^
40 |
41 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/event_driven/__init__.py:41:11
   |
39 |   )
40 |
41 |   __all__ = [
   |  ___________^
42 | |     # Domain - Enums
43 | |     "EventPriority",
44 | |     "EventStatus",
45 | |     "MessageBrokerType",
46 | |     # Domain - Models
47 | |     "Event",
48 | |     "EventProcessingResult",
49 | |     "EventSubscription",
50 | |     "EventStream",
51 | |     "Command",
52 | |     "Query",
53 | |     # Domain - Ports
54 | |     "MessageBroker",
55 | |     # Application services (for advanced usage)
56 | |     "EventManager",
57 | |     "CQRSManager",
58 | |     # Infrastructure implementations (for testing/mocking)
59 | |     "InMemoryBroker",
60 | |     "KafkaBroker",
61 | |     "RabbitMQBroker",
62 | |     # Main facade (most common usage)
63 | |     "EventDrivenService",
64 | |     "CQRSService",
65 | |     "get_event_driven_service",
66 | |     "get_cqrs_service",
67 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/event_driven/application/__init__.py:7:11
   |
 5 |   from .event_manager import EventManager
 6 |
 7 |   __all__ = [
   |  ___________^
 8 | |     "EventManager",
 9 | |     "CQRSManager",
10 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/event_driven/domain/__init__.py:17:11
   |
15 |   from .ports import MessageBroker
16 |
17 |   __all__ = [
   |  ___________^
18 | |     # Enums
19 | |     "EventPriority",
20 | |     "EventStatus",
21 | |     "MessageBrokerType",
22 | |     # Models
23 | |     "Event",
24 | |     "EventProcessingResult",
25 | |     "EventSubscription",
26 | |     "EventStream",
27 | |     "Command",
28 | |     "Query",
29 | |     # Ports
30 | |     "MessageBroker",
31 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
   --> app/services/event_driven/domain/models.py:135:11
    |
135 |   __all__ = [
    |  ___________^
136 | |     # Enums
137 | |     "EventPriority",
138 | |     "EventStatus",
139 | |     "MessageBrokerType",
140 | |     # Event models
141 | |     "Event",
142 | |     "EventProcessingResult",
143 | |     "EventSubscription",
144 | |     "EventStream",
145 | |     # CQRS models
146 | |     "Command",
147 | |     "Query",
148 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
   --> app/services/event_driven/facade.py:226:11
    |
226 |   __all__ = [
    |  ___________^
227 | |     "EventDrivenService",
228 | |     "CQRSService",
229 | |     "get_event_driven_service",
230 | |     "get_cqrs_service",
231 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/services/fastapi_generation/__init__.py:18:1
   |
17 | import json
18 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |
20 | from app.models import Task
   |
help: Import from `collections.abc`

RUF022 `__all__` is not sorted
  --> app/services/fastapi_generation/__init__.py:77:11
   |
75 |   generation_service = get_generation_service()
76 |
77 |   __all__ = [
   |  ___________^
78 | |     # Main service
79 | |     "MaestroGenerationService",
80 | |     "get_generation_service",
81 | |     "generation_service",
82 | |     # Domain models
83 | |     "OrchestratorTelemetry",
84 | |     "StepState",
85 | |     "OrchestratorConfig",
86 | |     # Convenience functions
87 | |     "diagnostics",
88 | |     "execute_task",
89 | |     "forge_new_code",
90 | |     "generate_comprehensive_response",
91 | |     "generate_json",
92 | |     "register_post_finalize_hook",
93 | | ]
   | |_^
94 |
95 |   __version__ = "18.1.0-refactored"
   |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/services/fastapi_generation/application/generation_manager.py:12:1
   |
10 | import time
11 | import uuid
12 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | from ..domain.models import (
   |
help: Import from `collections.abc`

F401 [*] `..domain.models.GenerationRequest` imported but unused
  --> app/services/fastapi_generation/application/generation_manager.py:16:5
   |
14 | from ..domain.models import (
15 |     CompletionRequest,
16 |     GenerationRequest,
   |     ^^^^^^^^^^^^^^^^^
17 |     GenerationResponse,
18 |     StructuredJsonRequest,
   |
help: Remove unused import

F401 [*] `..domain.models.GenerationResponse` imported but unused
  --> app/services/fastapi_generation/application/generation_manager.py:17:5
   |
15 |     CompletionRequest,
16 |     GenerationRequest,
17 |     GenerationResponse,
   |     ^^^^^^^^^^^^^^^^^^
18 |     StructuredJsonRequest,
19 | )
   |
help: Remove unused import

F401 [*] `..domain.models.StructuredJsonRequest` imported but unused
  --> app/services/fastapi_generation/application/generation_manager.py:18:5
   |
16 |     GenerationRequest,
17 |     GenerationResponse,
18 |     StructuredJsonRequest,
   |     ^^^^^^^^^^^^^^^^^^^^^
19 | )
20 | from ..domain.ports import (
   |
help: Remove unused import

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/application/generation_manager.py:59:1
   |
57 |             )
58 |             log.addHandler(handler)
59 |
   | ^^^^^^^^
60 |         level_env = (
61 |             os.getenv("GEN_SERVICE_LOG_LEVEL")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/application/generation_manager.py:69:1
   |
67 |         except Exception:
68 |             log.setLevel("INFO")
69 |
   | ^^^^^^^^
70 |         return log
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/application/generation_manager.py:80:1
   |
78 |         """
79 |         Generate new code based on prompt.
80 |
   | ^^^^^^^^
81 |         Handles complexity modes:
82 |         - Ultimate: >50k chars or ULTIMATE_MODE=1
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/fastapi_generation/domain/__init__.py:23:11
   |
21 |   )
22 |
23 |   __all__ = [
   |  ___________^
24 | |     # Models
25 | |     "StepState",
26 | |     "OrchestratorConfig",
27 | |     "OrchestratorTelemetry",
28 | |     "GenerationRequest",
29 | |     "GenerationResponse",
30 | |     "CompletionRequest",
31 | |     "StructuredJsonRequest",
32 | |     # Ports
33 | |     "LLMClientPort",
34 | |     "ModelSelectorPort",
35 | |     "ErrorMessageBuilderPort",
36 | |     "ContextFinderPort",
37 | |     "TaskExecutorPort",
38 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:17:1
   |
15 | class StepState:
16 |     """Represents the state of a single orchestration step."""
17 |
   | ^^^^
18 |     step_index: int
19 |     started_ms: float = field(default_factory=lambda: time.perf_counter() * 1000)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:33:1
   |
31 | class OrchestratorConfig:
32 |     """Configuration for the orchestrator."""
33 |
   | ^^^^
34 |     model_name: str
35 |     max_steps: int
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:41:1
   |
39 | class OrchestratorTelemetry:
40 |     """Telemetry data for orchestration execution."""
41 |
   | ^^^^
42 |     steps_taken: int = 0
43 |     tools_invoked: int = 0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:60:1
   |
58 | class GenerationRequest:
59 |     """Request for code generation."""
60 |
   | ^^^^
61 |     prompt: str
62 |     conversation_id: str | None = None
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:72:1
   |
70 | class GenerationResponse:
71 |     """Response from code generation."""
72 |
   | ^^^^
73 |     status: str  # "success" or "error"
74 |     answer: str
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:82:1
   |
80 | class CompletionRequest:
81 |     """Request for text completion."""
82 |
   | ^^^^
83 |     system_prompt: str
84 |     user_prompt: str
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/domain/models.py:95:1
   |
93 | class StructuredJsonRequest:
94 |     """Request for structured JSON generation."""
95 |
   | ^^^^
96 |     system_prompt: str
97 |     user_prompt: str
   |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/fastapi_generation/domain/models.py:105:11
    |
105 |   __all__ = [
    |  ___________^
106 | |     "StepState",
107 | |     "OrchestratorConfig",
108 | |     "OrchestratorTelemetry",
109 | |     "GenerationRequest",
110 | |     "GenerationResponse",
111 | |     "CompletionRequest",
112 | |     "StructuredJsonRequest",
113 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `.models.GenerationRequest` imported but unused
  --> app/services/fastapi_generation/domain/ports.py:13:5
   |
11 | from .models import (
12 |     CompletionRequest,
13 |     GenerationRequest,
   |     ^^^^^^^^^^^^^^^^^
14 |     GenerationResponse,
15 |     StructuredJsonRequest,
   |
help: Remove unused import

F401 [*] `.models.GenerationResponse` imported but unused
  --> app/services/fastapi_generation/domain/ports.py:14:5
   |
12 |     CompletionRequest,
13 |     GenerationRequest,
14 |     GenerationResponse,
   |     ^^^^^^^^^^^^^^^^^^
15 |     StructuredJsonRequest,
16 | )
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:25:1
   |
23 |         """
24 |         Generate text completion.
25 |
   | ^^^^^^^^
26 |         Args:
27 |             request: Completion request parameters
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:28:1
   |
26 |         Args:
27 |             request: Completion request parameters
28 |
   | ^^^^^^^^^^^^
29 |         Returns:
30 |             Generated text
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:31:1
   |
29 |         Returns:
30 |             Generated text
31 |
   | ^^^^^^^^^^^^
32 |         Raises:
33 |             RuntimeError: If completion fails
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:40:1
   |
38 |         """
39 |         Generate structured JSON response.
40 |
   | ^^^^^^^^
41 |         Args:
42 |             request: Structured JSON request parameters
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:43:1
   |
41 |         Args:
42 |             request: Structured JSON request parameters
43 |
   | ^^^^^^^^^^^^
44 |         Returns:
45 |             Parsed JSON object or None if failed
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:58:1
   |
56 |         """
57 |         Select appropriate model based on context.
58 |
   | ^^^^^^^^
59 |         Args:
60 |             explicit: Explicitly requested model
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:62:1
   |
60 |             explicit: Explicitly requested model
61 |             task: Task object for context
62 |
   | ^^^^^^^^^^^^
63 |         Returns:
64 |             Selected model name
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:77:1
   |
75 |         """
76 |         Build bilingual error message.
77 |
   | ^^^^^^^^
78 |         Args:
79 |             error: Error description
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:82:1
   |
80 |             prompt_length: Length of prompt
81 |             max_tokens: Max tokens used
82 |
   | ^^^^^^^^^^^^
83 |         Returns:
84 |             Formatted error message
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/domain/ports.py:95:1
   |
93 |         """
94 |         Find related context for a description.
95 |
   | ^^^^^^^^
96 |         Args:
97 |             description: Description to find context for
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/fastapi_generation/domain/ports.py:98:1
    |
 96 |         Args:
 97 |             description: Description to find context for
 98 |
    | ^^^^^^^^^^^^
 99 |         Returns:
100 |             Context object
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/fastapi_generation/domain/ports.py:111:1
    |
109 |         """
110 |         Execute a task.
111 |
    | ^^^^^^^^
112 |         Args:
113 |             task: Task to execute
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/fastapi_generation/domain/ports.py:119:11
    |
119 |   __all__ = [
    |  ___________^
120 | |     "LLMClientPort",
121 | |     "ModelSelectorPort",
122 | |     "ErrorMessageBuilderPort",
123 | |     "ContextFinderPort",
124 | |     "TaskExecutorPort",
125 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/services/fastapi_generation/facade.py:8:1
   |
 6 | from __future__ import annotations
 7 |
 8 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | from app.models import Task
   |
help: Import from `collections.abc`

F401 [*] `.domain.models.OrchestratorConfig` imported but unused
  --> app/services/fastapi_generation/facade.py:14:5
   |
12 | from .application.generation_manager import GenerationManager
13 | from .domain.models import (
14 |     OrchestratorConfig,
   |     ^^^^^^^^^^^^^^^^^^
15 |     OrchestratorTelemetry,
16 |     StepState,
   |
help: Remove unused import

F401 [*] `.domain.models.OrchestratorTelemetry` imported but unused
  --> app/services/fastapi_generation/facade.py:15:5
   |
13 | from .domain.models import (
14 |     OrchestratorConfig,
15 |     OrchestratorTelemetry,
   |     ^^^^^^^^^^^^^^^^^^^^^
16 |     StepState,
17 | )
   |
help: Remove unused import

F401 [*] `.domain.models.StepState` imported but unused
  --> app/services/fastapi_generation/facade.py:16:5
   |
14 |     OrchestratorConfig,
15 |     OrchestratorTelemetry,
16 |     StepState,
   |     ^^^^^^^^^
17 | )
18 | from .infrastructure.error_builder import ErrorMessageBuilder
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/facade.py:27:1
   |
25 |     """
26 |     Backward-compatible facade for the generation service.
27 |
   | ^^^^
28 |     Delegates to the new hexagonal architecture implementation.
29 |     """
   |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
  --> app/services/fastapi_generation/infrastructure/__init__.py:11:11
   |
 9 |   from .task_executor_adapter import TaskExecutorAdapter
10 |
11 |   __all__ = [
   |  ___________^
12 | |     "LLMAdapter",
13 | |     "ModelSelector",
14 | |     "ErrorMessageBuilder",
15 | |     "TaskExecutorAdapter",
16 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/error_builder.py:17:1
   |
15 |         """
16 |         Build bilingual error message.
17 |
   | ^^^^^^^^
18 |         Args:
19 |             error: Error description
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/error_builder.py:22:1
   |
20 |             prompt_length: Length of prompt
21 |             max_tokens: Max tokens used
22 |
   | ^^^^^^^^^^^^
23 |         Returns:
24 |             Formatted bilingual error message
   |
help: Remove whitespace from blank line

F401 [*] `..domain.ports.LLMClientPort` imported but unused
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:15:28
   |
14 | from ..domain.models import CompletionRequest, StructuredJsonRequest
15 | from ..domain.ports import LLMClientPort
   |                            ^^^^^^^^^^^^^
   |
help: Remove unused import: `..domain.ports.LLMClientPort`

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:24:1
   |
22 |         """
23 |         Initialize adapter with LLM client getter.
24 |
   | ^^^^^^^^
25 |         Args:
26 |             get_llm_client_func: Function to get LLM client instance
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:33:1
   |
31 |         """
32 |         Generate text completion using LLM.
33 |
   | ^^^^^^^^
34 |         Implements retry logic with exponential backoff.
35 |         """
   |
help: Remove whitespace from blank line

F401 [*] `app.utils.text_processing.extract_first_json_object` imported but unused
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:37:13
   |
35 |         """
36 |         from app.utils.text_processing import (
37 |             extract_first_json_object,
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^
38 |             strip_markdown_fences,
39 |         )
   |
help: Remove unused import

F401 [*] `app.utils.text_processing.strip_markdown_fences` imported but unused
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:38:13
   |
36 |         from app.utils.text_processing import (
37 |             extract_first_json_object,
38 |             strip_markdown_fences,
   |             ^^^^^^^^^^^^^^^^^^^^^
39 |         )
   |
help: Remove unused import

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:63:1
   |
61 |                 last_err = e
62 |                 error_msg = str(e).lower()
63 |
   | ^^^^^^^^^^^^^^^^
64 |                 if "500" in error_msg or "server" in error_msg:
65 |                     self._log(
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/llm_adapter.py:92:1
   |
90 |         """
91 |         Generate structured JSON response.
92 |
   | ^^^^^^^^
93 |         Implements JSON extraction and validation.
94 |         """
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/fastapi_generation/infrastructure/llm_adapter.py:164:1
    |
163 |         ai_config = get_ai_config()
164 |
    | ^^^^^^^^
165 |         # Check for overrides
166 |         force_model = os.getenv("MAESTRO_FORCE_MODEL")
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/fastapi_generation/infrastructure/llm_adapter.py:169:1
    |
167 |         if force_model:
168 |             return force_model
169 |
    | ^^^^^^^^
170 |         override_model = os.getenv("AI_MODEL_OVERRIDE")
171 |         if override_model:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/fastapi_generation/infrastructure/llm_adapter.py:173:1
    |
171 |         if override_model:
172 |             return override_model
173 |
    | ^^^^^^^^
174 |         return ai_config.primary_model
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/model_selector.py:18:1
   |
16 |         """
17 |         Select model based on explicit request, task context, or defaults.
18 |
   | ^^^^^^^^
19 |         Priority:
20 |         1. Explicit model parameter
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/model_selector.py:25:1
   |
23 |         4. Task-specific model (if task provided)
24 |         5. Central config primary model
25 |
   | ^^^^^^^^
26 |         Args:
27 |             explicit: Explicitly requested model
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/model_selector.py:29:1
   |
27 |             explicit: Explicitly requested model
28 |             task: Task object for context-based selection
29 |
   | ^^^^^^^^^^^^
30 |         Returns:
31 |             Selected model name
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/task_executor_adapter.py:17:1
   |
15 |         """
16 |         Initialize with generation manager reference.
17 |
   | ^^^^^^^^
18 |         Args:
19 |             generation_manager: Reference to generation manager
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/fastapi_generation/infrastructure/task_executor_adapter.py:26:1
   |
24 |         """
25 |         Execute task using TaskExecutor.
26 |
   | ^^^^^^^^
27 |         Args:
28 |             task: Task to execute
   |
help: Remove whitespace from blank line

UP035 [*] Import from `collections.abc` instead: `Callable`
  --> app/services/fastapi_generation_service.py:22:1
   |
20 | from __future__ import annotations
21 |
22 | from typing import Any, Callable
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |
24 | from app.models import Task
   |
help: Import from `collections.abc`

F401 [*] `typing.Any` imported but unused
  --> app/services/fastapi_generation_service.py:22:20
   |
20 | from __future__ import annotations
21 |
22 | from typing import Any, Callable
   |                    ^^^
23 |
24 | from app.models import Task
   |
help: Remove unused import

F401 [*] `typing.Callable` imported but unused
  --> app/services/fastapi_generation_service.py:22:25
   |
20 | from __future__ import annotations
21 |
22 | from typing import Any, Callable
   |                         ^^^^^^^^
23 |
24 | from app.models import Task
   |
help: Remove unused import

F401 [*] `app.models.Task` imported but unused
  --> app/services/fastapi_generation_service.py:24:24
   |
22 | from typing import Any, Callable
23 |
24 | from app.models import Task
   |                        ^^^^
25 |
26 | # Import from new modular structure
   |
help: Remove unused import: `app.models.Task`

F811 Redefinition of unused `generation_service` from line 37
  --> app/services/fastapi_generation_service.py:61:1
   |
60 | # Backward compatibility: expose module-level singleton
61 | generation_service = get_generation_service()
   | ^^^^^^^^^^^^^^^^^^ `generation_service` redefined here
62 |
63 | if __name__ == "__main__":
   |
  ::: app/services/fastapi_generation_service.py:37:5
   |
35 |     generate_comprehensive_response,
36 |     generate_json,
37 |     generation_service,
   |     ------------------ previous definition of `generation_service` here
38 |     get_generation_service,
39 |     register_post_finalize_hook,
   |
help: Remove definition: `generation_service`

W293 [*] Blank line contains whitespace
  --> app/services/fastapi_generation_service.py:65:1
   |
63 | if __name__ == "__main__":
64 |     import json
65 |
   | ^^^^
66 |     svc = generation_service
67 |     print("=== FastAPI Generation Service Diagnostics ===")
   |
help: Remove whitespace from blank line

F401 [*] `uuid` imported but unused
 --> app/services/gitops_policy/application/policy_manager.py:4:8
  |
3 | import logging
4 | import uuid
  |        ^^^^
5 | from datetime import UTC, datetime
6 | from typing import Any
  |
help: Remove unused import: `uuid`

RUF022 [*] `__all__` is not sorted
  --> app/services/gitops_policy/domain/__init__.py:14:11
   |
12 |   from .ports import ApplicationRepository, GitOpsSync, PolicyEvaluator, PolicyRepository
13 |
14 |   __all__ = [
   |  ___________^
15 | |     "DriftDetectionResult",
16 | |     "GitOpsApplication",
17 | |     "Policy",
18 | |     "PolicyEnforcementMode",
19 | |     "PolicyViolation",
20 | |     "ResourceType",
21 | |     "SyncStatus",
22 | |     "ApplicationRepository",
23 | |     "GitOpsSync",
24 | |     "PolicyEvaluator",
25 | |     "PolicyRepository",
26 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `..domain.models.PolicyEnforcementMode` imported but unused
 --> app/services/gitops_policy/infrastructure/simple_evaluator.py:8:37
  |
6 | from typing import Any
7 |
8 | from ..domain.models import Policy, PolicyEnforcementMode, PolicyViolation, ResourceType
  |                                     ^^^^^^^^^^^^^^^^^^^^^
9 | from ..domain.ports import PolicyEvaluator
  |
help: Remove unused import: `..domain.models.PolicyEnforcementMode`

SIM114 [*] Combine `if` branches using logical `or` operator
  --> app/services/gitops_policy/infrastructure/simple_evaluator.py:60:9
   |
59 |           violated = False
60 | /         if operator == "equals" and actual != expected:
61 | |             violated = True
62 | |         elif operator == "not_equals" and actual == expected:
63 | |             violated = True
   | |___________________________^
64 |           elif operator == "exists" and actual is None:
65 |               violated = True
   |
help: Combine `if` branches

SIM114 [*] Combine `if` branches using logical `or` operator
  --> app/services/gitops_policy/infrastructure/simple_evaluator.py:62:9
   |
60 |           if operator == "equals" and actual != expected:
61 |               violated = True
62 | /         elif operator == "not_equals" and actual == expected:
63 | |             violated = True
64 | |         elif operator == "exists" and actual is None:
65 | |             violated = True
   | |___________________________^
66 |
67 |           if violated:
   |
help: Combine `if` branches

F401 [*] `.gitops_policy.domain.PolicyEnforcementMode` imported but unused
  --> app/services/gitops_policy_service.py:17:5
   |
15 |     GitOpsApplication,
16 |     Policy,
17 |     PolicyEnforcementMode,
   |     ^^^^^^^^^^^^^^^^^^^^^
18 |     ResourceType,
19 |     SyncStatus,
   |
help: Remove unused import

F401 [*] `.gitops_policy.domain.ResourceType` imported but unused
  --> app/services/gitops_policy_service.py:18:5
   |
16 |     Policy,
17 |     PolicyEnforcementMode,
18 |     ResourceType,
   |     ^^^^^^^^^^^^
19 |     SyncStatus,
20 | )
   |
help: Remove unused import

F401 [*] `.gitops_policy.domain.SyncStatus` imported but unused
  --> app/services/gitops_policy_service.py:19:5
   |
17 |     PolicyEnforcementMode,
18 |     ResourceType,
19 |     SyncStatus,
   |     ^^^^^^^^^^
20 | )
   |
help: Remove unused import

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/governance/application/consciousness_manager.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Any, Protocol
11 | |
12 | | # Import models from facade instead of app.models since they don't exist there
13 | | # (Circular import is avoided because facade imports *from* application but we only import types from facade,
14 | | #  Wait, Facade imports ConsciousnessManager from here. Importing types from Facade HERE causes circular import.
15 | | #  We must define types or import them from a common place.
16 | | #  Since we defined them in Facade to solve the first issue, we should move them to a separate models file
17 | | #  that both can import.
18 | | #  However, for now, let's use Type Checking imports or just assume they exist if we mock them.)
19 | | # Better yet, let's create a shared models file in app/services/governance/domain/models.py
20 | | # and update Facade to import from there, and this file to import from there.
21 | |
22 | | # Plan:
23 | | # 1. Update app/services/governance/domain/models.py to include the missing dataclasses.
24 | | # 2. Update Facade to import from domain/models.py.
25 | | # 3. Update this file to import from domain/models.py.
26 | |
27 | | from app.services.governance.domain.models import ConsciousnessSignature, ExistentialProtocol
   | |_____________________________________________________________________________________________^
   |
help: Organize imports

F401 [*] `typing.Any` imported but unused
  --> app/services/governance/application/consciousness_manager.py:10:20
   |
 8 | from __future__ import annotations
 9 |
10 | from typing import Any, Protocol
   |                    ^^^
11 |
12 | # Import models from facade instead of app.models since they don't exist there
   |
help: Remove unused import: `typing.Any`

W293 Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:46:1
   |
44 |     """
45 |     Consciousness manager.
46 |
   | ^^^^
47 |     Responsibilities:
48 |     - Protocol opt-in
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:52:1
   |
50 |     - Protocol compliance tracking
51 |     """
52 |
   | ^^^^
53 |     MIN_UNDERSTANDING_LEVEL = 1.0
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:54:1
   |
53 |     MIN_UNDERSTANDING_LEVEL = 1.0
54 |
   | ^^^^
55 |     def __init__(
56 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:64:1
   |
62 |         self._protocol_repo = protocol_repository
63 |         self._transparency = transparency_logger
64 |
   | ^^^^
65 |     def opt_into_protocol(
66 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:74:1
   |
72 |         if understanding_level < self.MIN_UNDERSTANDING_LEVEL:
73 |             return False
74 |
   | ^^^^^^^^
75 |         consciousness = self._consciousness_repo.get(consciousness_signature)
76 |         if not consciousness:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:78:1
   |
76 |         if not consciousness:
77 |             return False
78 |
   | ^^^^^^^^
79 |         # Add protocol to adopted protocols
80 |         if not consciousness.adopted_protocols:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:82:1
   |
80 |         if not consciousness.adopted_protocols:
81 |             consciousness.adopted_protocols = []
82 |
   | ^^^^^^^^
83 |         if protocol.id not in consciousness.adopted_protocols:
84 |             consciousness.adopted_protocols.append(protocol.id)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:86:1
   |
84 |             consciousness.adopted_protocols.append(protocol.id)
85 |             self._consciousness_repo.update(consciousness)
86 |
   | ^^^^^^^^^^^^
87 |             self._transparency.log_event(
88 |                 event_type="PROTOCOL_ADOPTED",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/consciousness_manager.py:98:1
   |
96 |                 impact={"protocol_adoption": True},
97 |             )
98 |
   | ^^^^^^^^^^^^
99 |             return True
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:100:1
    |
 99 |             return True
100 |
    | ^^^^^^^^
101 |         return False
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:102:1
    |
101 |         return False
102 |
    | ^^^^
103 |     def auto_realign_consciousness(
104 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:112:1
    |
110 |         if not consciousness:
111 |             return False
112 |
    | ^^^^^^^^
113 |         # Update understanding level
114 |         if not consciousness.metadata_json:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:116:1
    |
114 |         if not consciousness.metadata_json:
115 |             consciousness.metadata_json = {}
116 |
    | ^^^^^^^^
117 |         consciousness.metadata_json["understanding_level"] = new_understanding_level
118 |         self._consciousness_repo.update(consciousness)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:119:1
    |
117 |         consciousness.metadata_json["understanding_level"] = new_understanding_level
118 |         self._consciousness_repo.update(consciousness)
119 |
    | ^^^^^^^^
120 |         self._transparency.log_event(
121 |             event_type="CONSCIOUSNESS_REALIGNED",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/consciousness_manager.py:130:1
    |
128 |             impact={"realignment": True},
129 |         )
130 |
    | ^^^^^^^^
131 |         return True
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:30:1
   |
28 |     """
29 |     Cosmic governance council manager.
30 |
   | ^^^^
31 |     Responsibilities:
32 |     - Create councils
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:37:1
   |
35 |     - Voting and consensus
36 |     """
37 |
   | ^^^^
38 |     MIN_COUNCIL_MEMBERS = 3
39 |     CONSENSUS_THRESHOLD = 0.75
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:40:1
   |
38 |     MIN_COUNCIL_MEMBERS = 3
39 |     CONSENSUS_THRESHOLD = 0.75
40 |
   | ^^^^
41 |     def __init__(
42 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:48:1
   |
46 |         self._council_repo = council_repository
47 |         self._transparency = transparency_logger
48 |
   | ^^^^
49 |     def create_council(
50 |         self,
   |
help: Remove whitespace from blank line

W291 [*] Trailing whitespace
  --> app/services/governance/application/council_manager.py:60:24
   |
58 |             purpose=purpose,
59 |             consensus_threshold=consensus_threshold,
60 |             members=[],
   |                        ^
61 |             pending_decisions={},
62 |             decision_history=[],
   |
help: Remove trailing whitespace

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:64:1
   |
62 |             decision_history=[],
63 |         )
64 |
   | ^^^^^^^^
65 |         saved_council = self._council_repo.save(council)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:66:1
   |
65 |         saved_council = self._council_repo.save(council)
66 |
   | ^^^^^^^^
67 |         self._transparency.log_event(
68 |             event_type="COUNCIL_CREATED",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:74:1
   |
72 |             impact={"new_council": True},
73 |         )
74 |
   | ^^^^^^^^
75 |         return saved_council
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:76:1
   |
75 |         return saved_council
76 |
   | ^^^^
77 |     def add_member(
78 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:86:1
   |
84 |             council.members.append(consciousness_signature)
85 |             self._council_repo.update(council)
86 |
   | ^^^^^^^^^^^^
87 |             self._transparency.log_event(
88 |                 event_type="COUNCIL_MEMBER_ADDED",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:94:1
   |
92 |                 impact={"member_added": True},
93 |             )
94 |
   | ^^^^^^^^^^^^
95 |             return True
96 |         return False
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/council_manager.py:97:1
   |
95 |             return True
96 |         return False
97 |
   | ^^^^
98 |     def propose_decision(
99 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:108:1
    |
106 |             f"{council.id}{proposal}{datetime.utcnow()}".encode()
107 |         ).hexdigest()[:16]
108 |
    | ^^^^^^^^
109 |         council.pending_decisions[decision_id] = {
110 |             "proposal": proposal,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:117:1
    |
115 |             "timestamp": datetime.utcnow().isoformat(),
116 |         }
117 |
    | ^^^^^^^^
118 |         self._council_repo.update(council)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:119:1
    |
118 |         self._council_repo.update(council)
119 |
    | ^^^^^^^^
120 |         self._transparency.log_event(
121 |             event_type="DECISION_PROPOSED",
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:127:1
    |
125 |             impact={"proposal_created": True},
126 |         )
127 |
    | ^^^^^^^^
128 |         return decision_id
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:129:1
    |
128 |         return decision_id
129 |
    | ^^^^
130 |     def vote_on_decision(
131 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:140:1
    |
138 |         if decision_id not in council.pending_decisions:
139 |             return False
140 |
    | ^^^^^^^^
141 |         decision = council.pending_decisions[decision_id]
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:142:1
    |
141 |         decision = council.pending_decisions[decision_id]
142 |
    | ^^^^^^^^
143 |         # Remove from all vote lists first
144 |         for vote_list in ["votes_for", "votes_against", "votes_abstain"]:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:147:1
    |
145 |             if voter_signature in decision[vote_list]:
146 |                 decision[vote_list].remove(voter_signature)
147 |
    | ^^^^^^^^
148 |         # Add to appropriate list
149 |         if vote == "for":
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:155:1
    |
153 |         elif vote == "abstain":
154 |             decision["votes_abstain"].append(voter_signature)
155 |
    | ^^^^^^^^
156 |         self._council_repo.update(council)
157 |         return True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:158:1
    |
156 |         self._council_repo.update(council)
157 |         return True
158 |
    | ^^^^
159 |     def check_consensus_reached(
160 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:167:1
    |
165 |         if decision_id not in council.pending_decisions:
166 |             return False, "pending"
167 |
    | ^^^^^^^^
168 |         decision = council.pending_decisions[decision_id]
169 |         total_votes = len(decision["votes_for"]) + len(decision["votes_against"])
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:170:1
    |
168 |         decision = council.pending_decisions[decision_id]
169 |         total_votes = len(decision["votes_for"]) + len(decision["votes_against"])
170 |
    | ^^^^^^^^
171 |         if total_votes == 0:
172 |             return False, "pending"
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:173:1
    |
171 |         if total_votes == 0:
172 |             return False, "pending"
173 |
    | ^^^^^^^^
174 |         approval_rate = len(decision["votes_for"]) / total_votes
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:175:1
    |
174 |         approval_rate = len(decision["votes_for"]) / total_votes
175 |
    | ^^^^^^^^
176 |         if approval_rate >= council.consensus_threshold:
177 |             return True, "approved"
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/council_manager.py:182:1
    |
180 |         else:
181 |             return False, "pending"
182 |
    | ^^^^
183 |     def get_council_analytics(
184 |         self,
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/governance/application/protocol_manager.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime
11 | | from typing import Any, Protocol
12 | |
13 | | from app.services.governance.domain.models import PolicyStatus as CosmicPolicyStatus, ExistentialProtocol
   | |_________________________________________________________________________________________________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:29:1
   |
27 |     """
28 |     Existential protocol manager.
29 |
   | ^^^^
30 |     Responsibilities:
31 |     - Create protocols
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:35:1
   |
33 |     - Check compliance
34 |     """
35 |
   | ^^^^
36 |     def __init__(
37 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:43:1
   |
41 |         self._protocol_repo = protocol_repository
42 |         self._transparency = transparency_logger
43 |
   | ^^^^
44 |     def create_protocol(
45 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:63:1
   |
61 |             },
62 |         )
63 |
   | ^^^^^^^^
64 |         saved_protocol = self._protocol_repo.save(protocol)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:65:1
   |
64 |         saved_protocol = self._protocol_repo.save(protocol)
65 |
   | ^^^^^^^^
66 |         # Log transparency event
67 |         self._transparency.log_event(
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:79:1
   |
77 |             impact={"new_protocol": True, "governance_expanded": True},
78 |         )
79 |
   | ^^^^^^^^
80 |         return saved_protocol
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:81:1
   |
80 |         return saved_protocol
81 |
   | ^^^^
82 |     def activate_protocol(self, protocol: ExistentialProtocol) -> bool:
83 |         """Activate existential protocol"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:88:1
   |
86 |             protocol.activated_at = datetime.utcnow()
87 |             self._protocol_repo.update(protocol)
88 |
   | ^^^^^^^^^^^^
89 |             self._transparency.log_event(
90 |                 event_type="PROTOCOL_ACTIVATED",
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/protocol_manager.py:96:1
   |
94 |                 impact={"protocol_active": True},
95 |             )
96 |
   | ^^^^^^^^^^^^
97 |             return True
98 |         except Exception:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/protocol_manager.py:100:1
    |
 98 |         except Exception:
 99 |             return False
100 |
    | ^^^^
101 |     def check_protocol_compliance(
102 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/protocol_manager.py:108:1
    |
106 |         """Check if consciousness complies with protocol"""
107 |         violations = []
108 |
    | ^^^^^^^^
109 |         for rule_name, rule_spec in protocol.cosmic_rules.items():
110 |             if not self._check_rule(rule_name, rule_spec, consciousness_data):
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/protocol_manager.py:112:1
    |
110 |             if not self._check_rule(rule_name, rule_spec, consciousness_data):
111 |                 violations.append(f"Violation: {rule_name}")
112 |
    | ^^^^^^^^
113 |         is_compliant = len(violations) == 0
114 |         return is_compliant, violations
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/protocol_manager.py:115:1
    |
113 |         is_compliant = len(violations) == 0
114 |         return is_compliant, violations
115 |
    | ^^^^
116 |     def _check_rule(
117 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/application/protocol_manager.py:128:1
    |
126 |             if field and field not in consciousness_data:
127 |                 return False
128 |
    | ^^^^^^^^
129 |         return True
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:25:1
   |
23 |     """
24 |     Existential transparency service.
25 |
   | ^^^^
26 |     Responsibilities:
27 |     - Log all governance events
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:31:1
   |
29 |     - Enable transparency queries
30 |     """
31 |
   | ^^^^
32 |     def __init__(self, transparency_repository: TransparencyRepository):
33 |         self._transparency_repo = transparency_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:34:1
   |
32 |     def __init__(self, transparency_repository: TransparencyRepository):
33 |         self._transparency_repo = transparency_repository
34 |
   | ^^^^
35 |     def log_event(
36 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:47:1
   |
45 |             f"{event_type}{subject}{datetime.utcnow()}".encode()
46 |         ).hexdigest()[:16]
47 |
   | ^^^^^^^^
48 |         log = ExistentialTransparencyLog(
49 |             event_type=event_type,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:56:1
   |
54 |             event_hash=event_id,
55 |         )
56 |
   | ^^^^^^^^
57 |         self._transparency_repo.save(log)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/application/transparency_service.py:58:1
   |
57 |         self._transparency_repo.save(log)
58 |
   | ^^^^
59 |     def query_logs(
60 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/domain/ports.py:52:1
   |
50 |         impact: dict[str, Any],
51 |     ) -> None: ...
52 |
   | ^^^^
53 |     def query_logs(
54 |         self,
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/governance/facade.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from datetime import datetime
11 | | from typing import Any
12 | |
13 | | # Import from domain models instead of app.models to fix import error
14 | | # (The previous implementation incorrectly assumed these were in app.models)
15 | | # Wait, looking at domain/models.py, it imports FROM app.models in comments but defines some dataclasses
16 | | # The original file was likely refactored but app.models was not updated.
17 | | # We will define minimal mocks here if they are not found, or use a dynamic approach.
18 | | # But for now, let's just make sure this file compiles.
19 | |
20 | | # Since app.models doesn't have them, and domain/models.py has some unrelated things,
21 | | # we need to find where these classes are or stub them.
22 | | # Given this is a "missing service" implementation, we should probably add them to the system.
23 | | # However, modifying app.models is risky (DB migration needed).
24 | | # Instead, we will define them here as Pydantic models/dataclasses to satisfy the import.
25 | |
26 | | from dataclasses import dataclass, field
   | |________________________________________^
27 |
28 |   @dataclass
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/governance/facade.py:78:1
   |
76 |     """
77 |     Cosmic Governance Service - Complete Facade
78 |
   | ^^^^
79 |     100% backward compatible with original 714-line service.
80 |     Delegates to specialized services following SRP.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/governance/facade.py:81:1
   |
79 |     100% backward compatible with original 714-line service.
80 |     Delegates to specialized services following SRP.
81 |
   | ^^^^
82 |     Features:
83 |     - Existential protocols
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/facade.py:88:1
   |
86 |     - Transparency logging
87 |     """
88 |
   | ^^^^
89 |     # Constants
90 |     MIN_COUNCIL_MEMBERS = 3
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/facade.py:93:1
   |
91 |     CONSENSUS_THRESHOLD = 0.75
92 |     MIN_UNDERSTANDING_LEVEL = 1.0
93 |
   | ^^^^
94 |     def __init__(self):
95 |         """Initialize governance service"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:101:1
    |
 99 |         consciousness_repo = SQLAlchemyConsciousnessRepository()
100 |         transparency_repo = SQLAlchemyTransparencyRepository()
101 |
    | ^^^^^^^^
102 |         # Application layer
103 |         self._transparency_service = TransparencyService(transparency_repo)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:117:1
    |
115 |             self._transparency_service,
116 |         )
117 |
    | ^^^^
118 |     # ==================================================================================
119 |     # PROTOCOL MANAGEMENT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:121:1
    |
119 |     # PROTOCOL MANAGEMENT
120 |     # ==================================================================================
121 |
    | ^^^^
122 |     @staticmethod
123 |     def create_existential_protocol(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:137:1
    |
135 |             version=version,
136 |         )
137 |
    | ^^^^
138 |     @staticmethod
139 |     def activate_protocol(protocol: ExistentialProtocol) -> bool:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:143:1
    |
141 |         service = CosmicGovernanceService()
142 |         return service._protocol_manager.activate_protocol(protocol)
143 |
    | ^^^^
144 |     @staticmethod
145 |     def opt_into_protocol(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:157:1
    |
155 |             understanding_level=understanding_level,
156 |         )
157 |
    | ^^^^
158 |     @staticmethod
159 |     def check_protocol_compliance(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:169:1
    |
167 |             consciousness_data=consciousness_data,
168 |         )
169 |
    | ^^^^
170 |     @staticmethod
171 |     def auto_realign_consciousness(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:181:1
    |
179 |             new_understanding_level=new_understanding_level,
180 |         )
181 |
    | ^^^^
182 |     # ==================================================================================
183 |     # COUNCIL MANAGEMENT
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:185:1
    |
183 |     # COUNCIL MANAGEMENT
184 |     # ==================================================================================
185 |
    | ^^^^
186 |     @staticmethod
187 |     def create_cosmic_council(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:199:1
    |
197 |             consensus_threshold=consensus_threshold,
198 |         )
199 |
    | ^^^^
200 |     @staticmethod
201 |     def add_council_member(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:211:1
    |
209 |             consciousness_signature=consciousness_signature,
210 |         )
211 |
    | ^^^^
212 |     @staticmethod
213 |     def propose_council_decision(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:225:1
    |
223 |             proposed_by=proposed_by,
224 |         )
225 |
    | ^^^^
226 |     @staticmethod
227 |     def vote_on_decision(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:241:1
    |
239 |             vote=vote,
240 |         )
241 |
    | ^^^^
242 |     @staticmethod
243 |     def reach_consciousness_consensus(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:253:1
    |
251 |             decision_id=decision_id,
252 |         )
253 |
    | ^^^^
254 |     @staticmethod
255 |     def get_council_analytics(council: CosmicGovernanceCouncil) -> dict[str, Any]:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:259:1
    |
257 |         service = CosmicGovernanceService()
258 |         return service._council_manager.get_council_analytics(council)
259 |
    | ^^^^
260 |     # ==================================================================================
261 |     # TRANSPARENCY
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:263:1
    |
261 |     # TRANSPARENCY
262 |     # ==================================================================================
263 |
    | ^^^^
264 |     @staticmethod
265 |     def _log_transparency_event(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/facade.py:281:1
    |
279 |             impact=impact,
280 |         )
281 |
    | ^^^^
282 |     @staticmethod
283 |     def query_transparency_logs(
    |
help: Remove whitespace from blank line

F401 [*] `typing.Any` imported but unused
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:10:20
   |
 8 | from __future__ import annotations
 9 |
10 | from typing import Any
   |                    ^^^
11 |
12 | from app.core.database import get_sync_session
   |
help: Remove unused import: `typing.Any`

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:23:1
   |
21 | class SQLAlchemyProtocolRepository:
22 |     """SQLAlchemy protocol repository"""
23 |
   | ^^^^
24 |     def save(self, protocol: ExistentialProtocol) -> ExistentialProtocol:
25 |         """Save protocol"""
   |
help: Remove whitespace from blank line

F841 Local variable `protocol_id` is assigned to but never used
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:30:13
   |
28 |             session.flush()
29 |             session.refresh(protocol)
30 |             protocol_id = protocol.id
   |             ^^^^^^^^^^^
31 |         # Return protocol (may be detached after session closes)
32 |         return protocol
   |
help: Remove assignment to unused variable `protocol_id`

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:33:1
   |
31 |         # Return protocol (may be detached after session closes)
32 |         return protocol
33 |
   | ^^^^
34 |     def get(self, protocol_id: int) -> ExistentialProtocol | None:
35 |         """Get protocol by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:38:1
   |
36 |         with get_sync_session() as session:
37 |             return session.query(ExistentialProtocol).filter_by(id=protocol_id).first()
38 |
   | ^^^^
39 |     def get_all(self) -> list[ExistentialProtocol]:
40 |         """Get all protocols"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:43:1
   |
41 |         with get_sync_session() as session:
42 |             return session.query(ExistentialProtocol).all()
43 |
   | ^^^^
44 |     def update(self, protocol: ExistentialProtocol) -> None:
45 |         """Update protocol"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:52:1
   |
50 | class SQLAlchemyCouncilRepository:
51 |     """SQLAlchemy council repository"""
52 |
   | ^^^^
53 |     def save(self, council: CosmicGovernanceCouncil) -> CosmicGovernanceCouncil:
54 |         """Save council"""
   |
help: Remove whitespace from blank line

F841 Local variable `council_id` is assigned to but never used
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:59:13
   |
57 |             session.flush()
58 |             session.refresh(council)
59 |             council_id = council.id
   |             ^^^^^^^^^^
60 |         return council
   |
help: Remove assignment to unused variable `council_id`

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:61:1
   |
59 |             council_id = council.id
60 |         return council
61 |
   | ^^^^
62 |     def get(self, council_id: int) -> CosmicGovernanceCouncil | None:
63 |         """Get council by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:66:1
   |
64 |         with get_sync_session() as session:
65 |             return session.query(CosmicGovernanceCouncil).filter_by(id=council_id).first()
66 |
   | ^^^^
67 |     def get_all(self) -> list[CosmicGovernanceCouncil]:
68 |         """Get all councils"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:71:1
   |
69 |         with get_sync_session() as session:
70 |             return session.query(CosmicGovernanceCouncil).all()
71 |
   | ^^^^
72 |     def update(self, council: CosmicGovernanceCouncil) -> None:
73 |         """Update council"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:80:1
   |
78 | class SQLAlchemyConsciousnessRepository:
79 |     """SQLAlchemy consciousness repository"""
80 |
   | ^^^^
81 |     def get(self, signature: str) -> ConsciousnessSignature | None:
82 |         """Get consciousness by signature"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:87:1
   |
85 |                 signature=signature
86 |             ).first()
87 |
   | ^^^^
88 |     def update(self, consciousness: ConsciousnessSignature) -> None:
89 |         """Update consciousness"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/governance/infrastructure/sqlalchemy_repositories.py:96:1
   |
94 | class SQLAlchemyTransparencyRepository:
95 |     """SQLAlchemy transparency repository"""
96 |
   | ^^^^
97 |     def save(self, log: ExistentialTransparencyLog) -> None:
98 |         """Save transparency log"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/infrastructure/sqlalchemy_repositories.py:101:1
    |
 99 |         with get_sync_session() as session:
100 |             session.add(log)
101 |
    | ^^^^
102 |     def query(
103 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/infrastructure/sqlalchemy_repositories.py:110:1
    |
108 |         with get_sync_session() as session:
109 |             query = session.query(ExistentialTransparencyLog)
110 |
    | ^^^^^^^^^^^^
111 |             if event_type:
112 |                 query = query.filter_by(event_type=event_type)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/infrastructure/sqlalchemy_repositories.py:113:1
    |
111 |             if event_type:
112 |                 query = query.filter_by(event_type=event_type)
113 |
    | ^^^^^^^^^^^^
114 |             query = query.order_by(ExistentialTransparencyLog.timestamp.desc())
115 |             query = query.limit(limit)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/governance/infrastructure/sqlalchemy_repositories.py:116:1
    |
114 |             query = query.order_by(ExistentialTransparencyLog.timestamp.desc())
115 |             query = query.limit(limit)
116 |
    | ^^^^^^^^^^^^
117 |             return query.all()
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/governance/infrastructure/sqlalchemy_repositories.py:120:11
    |
120 |   __all__ = [
    |  ___________^
121 | |     "SQLAlchemyProtocolRepository",
122 | |     "SQLAlchemyCouncilRepository",
123 | |     "SQLAlchemyConsciousnessRepository",
124 | |     "SQLAlchemyTransparencyRepository",
125 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/history_service/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/history_service/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/history_service/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/history_service/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/history_service/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/history_service/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/history_service/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/history_service/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/history_service/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/history_service/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/__init__.py:7:1
   |
 5 |   Hexagonal Architecture Implementation.
 6 |   """
 7 | / from .domain.models import (
 8 | |     LoadBalancingAlgorithm,
 9 | |     ServerState,
10 | |     ScalingEvent,
11 | |     RegionZone,
12 | |     Server,
13 | |     ScalingMetrics,
14 | |     ConsistentHashNode,
15 | | )
16 | | from .application.manager import HorizontalScalingManager
17 | | from .application.chaos_monkey import ChaosMonkey
18 | | from .application.load_balancer import LoadBalancerStrategy as LoadBalancer
19 | | from .facade import get_scaling_orchestrator
   | |____________________________________________^
20 |
21 |   # Re-export key components to match original API
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/horizontal_scaling/__init__.py:24:11
   |
22 |   HorizontalScalingOrchestrator = HorizontalScalingManager
23 |
24 |   __all__ = [
   |  ___________^
25 | |     "LoadBalancingAlgorithm",
26 | |     "ServerState",
27 | |     "ScalingEvent",
28 | |     "RegionZone",
29 | |     "Server",
30 | |     "ScalingMetrics",
31 | |     "ConsistentHashNode",
32 | |     "HorizontalScalingOrchestrator",
33 | |     "ChaosMonkey",
34 | |     "LoadBalancer",
35 | |     "get_scaling_orchestrator",
36 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/application/__init__.py:7:1
   |
 5 |   Exports application components.
 6 |   """
 7 | / from .manager import HorizontalScalingManager
 8 | | from .chaos_monkey import ChaosMonkey
 9 | | from .load_balancer import LoadBalancerStrategy, LoadBalancerConfig
   | |___________________________________________________________________^
10 |
11 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/horizontal_scaling/application/__init__.py:11:11
   |
 9 |   from .load_balancer import LoadBalancerStrategy, LoadBalancerConfig
10 |
11 |   __all__ = [
   |  ___________^
12 | |     "HorizontalScalingManager",
13 | |     "ChaosMonkey",
14 | |     "LoadBalancerStrategy",
15 | |     "LoadBalancerConfig",
16 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/application/chaos_monkey.py:7:1
   |
 5 |   Resilience testing component.
 6 |   """
 7 | / from __future__ import annotations
 8 | |
 9 | | import random
10 | | import logging
11 | | from ..domain.models import ServerState
12 | | from .manager import HorizontalScalingManager
   | |_____________________________________________^
13 |
14 |   class ChaosMonkey:
   |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/application/load_balancer.py:7:1
   |
 5 |   Core logic for load balancing algorithms.
 6 |   """
 7 | / from __future__ import annotations
 8 | |
 9 | | import hashlib
10 | | import random
11 | | from dataclasses import dataclass, field
12 | | from typing import List, Dict, Optional, Any
13 | |
14 | | from ..domain.models import Server, LoadBalancingAlgorithm, RegionZone
   | |______________________________________________________________________^
   |
help: Organize imports

F401 [*] `dataclasses.field` imported but unused
  --> app/services/horizontal_scaling/application/load_balancer.py:11:36
   |
 9 | import hashlib
10 | import random
11 | from dataclasses import dataclass, field
   |                                    ^^^^^
12 | from typing import List, Dict, Optional, Any
   |
help: Remove unused import: `dataclasses.field`

UP035 `typing.List` is deprecated, use `list` instead
  --> app/services/horizontal_scaling/application/load_balancer.py:12:1
   |
10 | import random
11 | from dataclasses import dataclass, field
12 | from typing import List, Dict, Optional, Any
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | from ..domain.models import Server, LoadBalancingAlgorithm, RegionZone
   |

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/services/horizontal_scaling/application/load_balancer.py:12:1
   |
10 | import random
11 | from dataclasses import dataclass, field
12 | from typing import List, Dict, Optional, Any
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
13 |
14 | from ..domain.models import Server, LoadBalancingAlgorithm, RegionZone
   |

F401 [*] `typing.Any` imported but unused
  --> app/services/horizontal_scaling/application/load_balancer.py:12:42
   |
10 | import random
11 | from dataclasses import dataclass, field
12 | from typing import List, Dict, Optional, Any
   |                                          ^^^
13 |
14 | from ..domain.models import Server, LoadBalancingAlgorithm, RegionZone
   |
help: Remove unused import: `typing.Any`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/application/load_balancer.py:31:23
   |
29 |     def __init__(self, config: LoadBalancerConfig):
30 |         self.config = config
31 |         self.servers: List[Server] = []
   |                       ^^^^
32 |         self.hash_ring: Dict[int, str] = {}
33 |         self.current_index: int = 0  # For Round Robin
   |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/horizontal_scaling/application/load_balancer.py:32:25
   |
30 |         self.config = config
31 |         self.servers: List[Server] = []
32 |         self.hash_ring: Dict[int, str] = {}
   |                         ^^^^
33 |         self.current_index: int = 0  # For Round Robin
34 |         self.total_requests: int = 0
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/load_balancer.py:52:22
   |
50 |     def select_server(
51 |         self,
52 |         request_key: Optional[str] = None,
   |                      ^^^^^^^^^^^^^
53 |         client_region: Optional[RegionZone] = None,
54 |     ) -> Optional[Server]:
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/load_balancer.py:53:24
   |
51 |         self,
52 |         request_key: Optional[str] = None,
53 |         client_region: Optional[RegionZone] = None,
   |                        ^^^^^^^^^^^^^^^^^^^^
54 |     ) -> Optional[Server]:
55 |         """Select a server based on the configured algorithm."""
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/load_balancer.py:54:10
   |
52 |         request_key: Optional[str] = None,
53 |         client_region: Optional[RegionZone] = None,
54 |     ) -> Optional[Server]:
   |          ^^^^^^^^^^^^^^^^
55 |         """Select a server based on the configured algorithm."""
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/application/load_balancer.py:88:37
   |
86 |                 self.hash_ring[hash_value] = server.server_id
87 |
88 |     def _round_robin(self, servers: List[Server]) -> Server:
   |                                     ^^^^
89 |         self.current_index = (self.current_index + 1) % len(servers)
90 |         return servers[self.current_index]
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/application/load_balancer.py:92:43
   |
90 |         return servers[self.current_index]
91 |
92 |     def _least_connections(self, servers: List[Server]) -> Server:
   |                                           ^^^^
93 |         return min(servers, key=lambda s: s.active_connections)
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/application/load_balancer.py:95:46
   |
93 |         return min(servers, key=lambda s: s.active_connections)
94 |
95 |     def _weighted_round_robin(self, servers: List[Server]) -> Server:
   |                                              ^^^^
96 |         total_weight = sum(s.weight for s in servers)
97 |         if total_weight == 0:
   |
help: Replace with `list`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/horizontal_scaling/application/load_balancer.py:108:39
    |
106 |         return servers[-1]
107 |
108 |     def _latency_based(self, servers: List[Server]) -> Server:
    |                                       ^^^^
109 |         return min(servers, key=lambda s: s.avg_latency_ms)
    |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
   --> app/services/horizontal_scaling/application/load_balancer.py:111:45
    |
109 |         return min(servers, key=lambda s: s.avg_latency_ms)
110 |
111 |     def _consistent_hash(self, key: str) -> Optional[Server]:
    |                                             ^^^^^^^^^^^^^^^^
112 |         if not self.hash_ring:
113 |             return None
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/horizontal_scaling/application/load_balancer.py:129:44
    |
127 |         return next((s for s in self.servers if s.server_id == server_id), None)
128 |
129 |     def _geographic_routing(self, servers: List[Server], client_region: Optional[RegionZone]) -> Server:
    |                                            ^^^^
130 |         if client_region:
131 |             region_servers = [s for s in servers if s.region == client_region]
    |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
   --> app/services/horizontal_scaling/application/load_balancer.py:129:73
    |
127 |         return next((s for s in self.servers if s.server_id == server_id), None)
128 |
129 |     def _geographic_routing(self, servers: List[Server], client_region: Optional[RegionZone]) -> Server:
    |                                                                         ^^^^^^^^^^^^^^^^^^^^
130 |         if client_region:
131 |             region_servers = [s for s in servers if s.region == client_region]
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/horizontal_scaling/application/load_balancer.py:136:45
    |
134 |         return min(servers, key=lambda s: s.active_connections)
135 |
136 |     def _intelligent_routing(self, servers: List[Server]) -> Server:
    |                                             ^^^^
137 |         def score_server(s: Server) -> float:
138 |             connection_score = 1.0 - (s.active_connections / max(s.max_connections, 1))
    |
help: Replace with `list`

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/services/horizontal_scaling/application/manager.py:13:1
   |
11 | from collections import deque
12 | from datetime import UTC, datetime
13 | from typing import Any, Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |
15 | from ..domain.models import (
   |

UP035 `typing.List` is deprecated, use `list` instead
  --> app/services/horizontal_scaling/application/manager.py:13:1
   |
11 | from collections import deque
12 | from datetime import UTC, datetime
13 | from typing import Any, Dict, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |
15 | from ..domain.models import (
   |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/horizontal_scaling/application/manager.py:33:30
   |
32 |     def __init__(self):
33 |         self.load_balancers: Dict[str, LoadBalancerStrategy] = {}
   |                              ^^^^
34 |         self.servers: Dict[str, Server] = {}
35 |         self.metrics_history: deque[ScalingMetrics] = deque(maxlen=1000)
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/horizontal_scaling/application/manager.py:34:23
   |
32 |     def __init__(self):
33 |         self.load_balancers: Dict[str, LoadBalancerStrategy] = {}
34 |         self.servers: Dict[str, Server] = {}
   |                       ^^^^
35 |         self.metrics_history: deque[ScalingMetrics] = deque(maxlen=1000)
36 |         self.scaling_policy: Dict[str, Any] = {
   |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/horizontal_scaling/application/manager.py:36:30
   |
34 |         self.servers: Dict[str, Server] = {}
35 |         self.metrics_history: deque[ScalingMetrics] = deque(maxlen=1000)
36 |         self.scaling_policy: Dict[str, Any] = {
   |                              ^^^^
37 |             "min_servers": 10,
38 |             "max_servers": 1000,
   |
help: Replace with `dict`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/manager.py:46:34
   |
44 |             "cooldown_seconds": 300,
45 |         }
46 |         self.last_scaling_event: Optional[datetime] = None
   |                                  ^^^^^^^^^^^^^^^^^^
47 |         self._lock = threading.Lock()
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/manager.py:96:22
   |
94 |         self,
95 |         lb_id: str,
96 |         request_key: Optional[str] = None,
   |                      ^^^^^^^^^^^^^
97 |         client_region: Optional[RegionZone] = None,
98 |     ) -> Optional[Server]:
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/application/manager.py:97:24
   |
95 |         lb_id: str,
96 |         request_key: Optional[str] = None,
97 |         client_region: Optional[RegionZone] = None,
   |                        ^^^^^^^^^^^^^^^^^^^^
98 |     ) -> Optional[Server]:
99 |         """Route a request to an appropriate server."""
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
   --> app/services/horizontal_scaling/application/manager.py:98:10
    |
 96 |         request_key: Optional[str] = None,
 97 |         client_region: Optional[RegionZone] = None,
 98 |     ) -> Optional[Server]:
    |          ^^^^^^^^^^^^^^^^
 99 |         """Route a request to an appropriate server."""
100 |         lb = self.load_balancers.get(lb_id)
    |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
   --> app/services/horizontal_scaling/application/manager.py:146:71
    |
144 |         return ScalingEvent.NO_ACTION
145 |
146 |     def execute_scaling(self, event: ScalingEvent, count: int = 1) -> List[Server]:
    |                                                                       ^^^^
147 |         """Execute the scaling action."""
148 |         servers_affected = []
    |
help: Replace with `list`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/horizontal_scaling/application/manager.py:179:43
    |
177 |         return servers_affected
178 |
179 |     def health_check_all_servers(self) -> Dict[str, bool]:
    |                                           ^^^^
180 |         """Run health checks on all servers."""
181 |         results = {}
    |
help: Replace with `dict`

UP006 [*] Use `dict` instead of `Dict` for type annotation
   --> app/services/horizontal_scaling/application/manager.py:200:36
    |
198 |         return random.random() > 0.05
199 |
200 |     def get_cluster_stats(self) -> Dict[str, Any]:
    |                                    ^^^^
201 |         """Get aggregate statistics for the cluster."""
202 |         active_servers = [
    |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/domain/__init__.py:7:1
   |
 5 |   Exports domain models and ports.
 6 |   """
 7 | / from .models import (
 8 | |     LoadBalancingAlgorithm,
 9 | |     ServerState,
10 | |     ScalingEvent,
11 | |     RegionZone,
12 | |     Server,
13 | |     ScalingMetrics,
14 | |     ConsistentHashNode,
15 | | )
16 | | from .ports import (
17 | |     LoadBalancerPort,
18 | |     ServerRepositoryPort,
19 | |     MetricsRepositoryPort,
20 | | )
   | |_^
21 |
22 |   __all__ = [
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/horizontal_scaling/domain/__init__.py:22:11
   |
20 |   )
21 |
22 |   __all__ = [
   |  ___________^
23 | |     "LoadBalancingAlgorithm",
24 | |     "ServerState",
25 | |     "ScalingEvent",
26 | |     "RegionZone",
27 | |     "Server",
28 | |     "ScalingMetrics",
29 | |     "ConsistentHashNode",
30 | |     "LoadBalancerPort",
31 | |     "ServerRepositoryPort",
32 | |     "MetricsRepositoryPort",
33 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

UP035 `typing.Dict` is deprecated, use `dict` instead
  --> app/services/horizontal_scaling/domain/models.py:13:1
   |
11 | from datetime import UTC, datetime
12 | from enum import Enum
13 | from typing import Any, Dict
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

UP006 [*] Use `dict` instead of `Dict` for type annotation
  --> app/services/horizontal_scaling/domain/models.py:74:15
   |
72 |     memory_usage: float = 0.0
73 |     last_health_check: datetime = field(default_factory=lambda: datetime.now(UTC))
74 |     metadata: Dict[str, Any] = field(default_factory=dict)
   |               ^^^^
75 |
76 |     @property
   |
help: Replace with `dict`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/domain/ports.py:8:1
   |
 6 |   Defines contracts for repositories and external services.
 7 |   """
 8 | / from __future__ import annotations
 9 | |
10 | | from typing import Protocol, List, Optional
11 | | from .models import Server, ScalingMetrics, ScalingEvent, LoadBalancingAlgorithm
   | |________________________________________________________________________________^
   |
help: Organize imports

UP035 `typing.List` is deprecated, use `list` instead
  --> app/services/horizontal_scaling/domain/ports.py:10:1
   |
 8 | from __future__ import annotations
 9 |
10 | from typing import Protocol, List, Optional
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 | from .models import Server, ScalingMetrics, ScalingEvent, LoadBalancingAlgorithm
   |

F401 [*] `.models.ScalingEvent` imported but unused
  --> app/services/horizontal_scaling/domain/ports.py:11:45
   |
10 | from typing import Protocol, List, Optional
11 | from .models import Server, ScalingMetrics, ScalingEvent, LoadBalancingAlgorithm
   |                                             ^^^^^^^^^^^^
   |
help: Remove unused import

F401 [*] `.models.LoadBalancingAlgorithm` imported but unused
  --> app/services/horizontal_scaling/domain/ports.py:11:59
   |
10 | from typing import Protocol, List, Optional
11 | from .models import Server, ScalingMetrics, ScalingEvent, LoadBalancingAlgorithm
   |                                                           ^^^^^^^^^^^^^^^^^^^^^^
   |
help: Remove unused import

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/domain/ports.py:23:42
   |
21 |         ...
22 |
23 |     def select_server(self, request_key: Optional[str] = None) -> Optional[Server]:
   |                                          ^^^^^^^^^^^^^
24 |         ...
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/domain/ports.py:23:67
   |
21 |         ...
22 |
23 |     def select_server(self, request_key: Optional[str] = None) -> Optional[Server]:
   |                                                                   ^^^^^^^^^^^^^^^^
24 |         ...
   |
help: Convert to `X | None`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/domain/ports.py:36:38
   |
34 |         ...
35 |
36 |     def get(self, server_id: str) -> Optional[Server]:
   |                                      ^^^^^^^^^^^^^^^^
37 |         ...
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/domain/ports.py:39:27
   |
37 |         ...
38 |
39 |     def list_all(self) -> List[Server]:
   |                           ^^^^
40 |         ...
   |
help: Replace with `list`

UP045 [*] Use `X | None` for type annotations
  --> app/services/horizontal_scaling/domain/ports.py:52:29
   |
50 |         ...
51 |
52 |     def get_latest(self) -> Optional[ScalingMetrics]:
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^
53 |         ...
   |
help: Convert to `X | None`

UP006 [*] Use `list` instead of `List` for type annotation
  --> app/services/horizontal_scaling/domain/ports.py:55:48
   |
53 |         ...
54 |
55 |     def get_history(self, limit: int = 100) -> List[ScalingMetrics]:
   |                                                ^^^^
56 |         ...
   |
help: Replace with `list`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/horizontal_scaling/facade.py:8:1
   |
 6 |   Combines Domain, Application, and Infrastructure layers.
 7 |   """
 8 | / from __future__ import annotations
 9 | |
10 | | from .application.manager import HorizontalScalingManager
11 | | from .application.chaos_monkey import ChaosMonkey
   | |_________________________________________________^
12 |
13 |   # Singleton instance
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/horizontal_scaling_service.py:38:11
   |
37 |   # Re-export for backward compatibility
38 |   __all__ = [
   |  ___________^
39 | |     "LoadBalancingAlgorithm",
40 | |     "ServerState",
41 | |     "ScalingEvent",
42 | |     "RegionZone",
43 | |     "Server",
44 | |     "LoadBalancer",
45 | |     "ScalingMetrics",
46 | |     "ConsistentHashNode",
47 | |     "HorizontalScalingOrchestrator",
48 | |     "ChaosMonkey",
49 | |     "get_scaling_orchestrator",
50 | | ]
   | |_^
51 |
52 |   # Singleton instance
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/infra_metrics/collectors/io.py:1:1
  |
1 | / import time
2 | | import psutil
3 | | from app.services.infra_metrics.domain.models import DiskMetrics, NetworkMetrics
  | |________________________________________________________________________________^
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/infra_metrics/collectors/processes.py:1:1
  |
1 | / import os
2 | | import psutil
3 | | from app.services.infra_metrics.domain.models import ProcessMetrics
  | |___________________________________________________________________^
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
 --> app/services/infra_metrics/collectors/resources.py:1:1
  |
1 | / import os
2 | | import psutil
3 | | from app.services.infra_metrics.domain.models import CPUMetrics, MemoryMetrics
  | |______________________________________________________________________________^
  |
help: Organize imports

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/infrastructure_metrics_service.py:8:1
   |
 6 |   # This service has been refactored into a modular structure at app/services/infra_metrics/
 7 |
 8 | / from app.services.infra_metrics.domain.models import (
 9 | |     ResourceType,
10 | |     HealthStatus,
11 | |     CPUMetrics,
12 | |     MemoryMetrics,
13 | |     DiskMetrics,
14 | |     NetworkMetrics,
15 | |     ProcessMetrics,
16 | |     SystemHealthSnapshot,
17 | |     AvailabilityMetrics,
18 | | )
19 | | from app.services.infra_metrics.application.manager import (
20 | |     InfrastructureMetricsService,
21 | |     get_infrastructure_service,
22 | | )
   | |_^
23 |
24 |   # Re-export all public members
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/infrastructure_metrics_service.py:25:11
   |
24 |   # Re-export all public members
25 |   __all__ = [
   |  ___________^
26 | |     "ResourceType",
27 | |     "HealthStatus",
28 | |     "CPUMetrics",
29 | |     "MemoryMetrics",
30 | |     "DiskMetrics",
31 | |     "NetworkMetrics",
32 | |     "ProcessMetrics",
33 | |     "SystemHealthSnapshot",
34 | |     "AvailabilityMetrics",
35 | |     "InfrastructureMetricsService",
36 | |     "get_infrastructure_service",
37 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/k8s/__init__.py:22:11
   |
20 |   )
21 |
22 |   __all__ = [
   |  ___________^
23 | |     "KubernetesOrchestrator",
24 | |     "get_kubernetes_orchestrator",
25 | |     "Pod",
26 | |     "Node",
27 | |     "PodPhase",
28 | |     "NodeState",
29 | |     "ConsensusRole",
30 | |     "ScalingDirection",
31 | |     "RaftState",
32 | |     "AutoScalingConfig",
33 | |     "SelfHealingEvent",
34 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/k8s/application/__init__.py:10:11
   |
 8 |   from app.services.k8s.application.self_healer import SelfHealer
 9 |
10 |   __all__ = [
   |  ___________^
11 | |     "PodScheduler",
12 | |     "AutoScaler",
13 | |     "SelfHealer",
14 | |     "HealthMonitor",
15 | |     "ConsensusManager",
16 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

SIM102 Use a single `if` statement instead of nested `if` statements
  --> app/services/k8s/application/auto_scaler.py:63:9
   |
61 |               if len(pods) < config.max_replicas:
62 |                   direction = ScalingDirection.UP
63 | /         elif (
64 | |             cpu_usage < config.target_cpu_utilization * 0.5
65 | |             and memory_usage < config.target_memory_utilization * 0.5
66 | |         ):
67 | |             if len(pods) > config.min_replicas:
   | |_______________________________________________^
68 |                   direction = ScalingDirection.DOWN
   |
help: Combine `if` statements using `and`

RUF022 `__all__` is not sorted
  --> app/services/k8s/domain/__init__.py:25:11
   |
23 |   )
24 |
25 |   __all__ = [
   |  ___________^
26 | |     # Models
27 | |     "Pod",
28 | |     "Node",
29 | |     "PodPhase",
30 | |     "NodeState",
31 | |     "ConsensusRole",
32 | |     "ScalingDirection",
33 | |     "RaftState",
34 | |     "AutoScalingConfig",
35 | |     "SelfHealingEvent",
36 | |     # Ports
37 | |     "PodRepositoryPort",
38 | |     "NodeRepositoryPort",
39 | |     "SchedulerPort",
40 | |     "AutoScalerPort",
41 | |     "SelfHealingPort",
42 | |     "HealthMonitorPort",
43 | |     "ConsensusPort",
44 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/k8s/facade.py:34:11
   |
33 |   # Re-export models for backward compatibility
34 |   __all__ = [
   |  ___________^
35 | |     "KubernetesOrchestrator",
36 | |     "get_kubernetes_orchestrator",
37 | |     "Pod",
38 | |     "Node",
39 | |     "PodPhase",
40 | |     "NodeState",
41 | |     "ConsensusRole",
42 | |     "ScalingDirection",
43 | |     "RaftState",
44 | |     "AutoScalingConfig",
45 | |     "SelfHealingEvent",
46 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/k8s/infrastructure/__init__.py:7:11
   |
 5 |   from app.services.k8s.infrastructure.in_memory_pod_repository import InMemoryPodRepository
 6 |
 7 |   __all__ = [
   |  ___________^
 8 | |     "InMemoryPodRepository",
 9 | |     "InMemoryNodeRepository",
10 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/kubernetes_orchestration_service.py:29:11
   |
28 |   # Re-export everything for backward compatibility
29 |   __all__ = [
   |  ___________^
30 | |     # Enums
31 | |     "PodPhase",
32 | |     "NodeState",
33 | |     "ConsensusRole",
34 | |     "ScalingDirection",
35 | |     # Models
36 | |     "Pod",
37 | |     "Node",
38 | |     "RaftState",
39 | |     "SelfHealingEvent",
40 | |     "AutoScalingConfig",
41 | |     # Service
42 | |     "KubernetesOrchestrator",
43 | |     "get_kubernetes_orchestrator",
44 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/llm_client/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/llm_client/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/llm_client/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/llm_client/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/llm_client/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/llm_client/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/llm_client/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/llm_client/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/llm_client/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/llm_client/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/llm_client_service.py:14:1
   |
12 |   """
13 |
14 | / from __future__ import annotations
15 | |
16 | | import contextlib
17 | | import logging
18 | | import os
19 | | import random
20 | | import re
21 | | import threading
22 | | import time
23 | | from collections.abc import Callable, Generator
24 | | from typing import Any
25 | |
26 | | # Import centralized AI client factory
27 | | from app.core.ai_client_factory import (
28 | |     MockClient,
29 | |     clear_ai_client_cache,
30 | | )
31 | | from app.core.ai_client_factory import (
32 | |     get_ai_client as _get_centralized_client,
33 | | )
34 | |
35 | | # New Modular Helpers
36 | | from app.ai.application.payload_builder import PayloadBuilder
37 | | from app.ai.application.response_normalizer import ResponseNormalizer
38 | | from app.services.llm.circuit_breaker import CircuitBreaker
39 | | from app.services.llm.cost_manager import CostManager
40 | | from app.services.llm.retry_strategy import RetryStrategy
   | |_________________________________________________________^
41 |
42 |   # --------------------------------------------------------------------------------------
   |
help: Organize imports

F401 [*] `contextlib` imported but unused
  --> app/services/llm_client_service.py:16:8
   |
14 | from __future__ import annotations
15 |
16 | import contextlib
   |        ^^^^^^^^^^
17 | import logging
18 | import os
   |
help: Remove unused import: `contextlib`

F401 [*] `re` imported but unused
  --> app/services/llm_client_service.py:20:8
   |
18 | import os
19 | import random
20 | import re
   |        ^^
21 | import threading
22 | import time
   |
help: Remove unused import: `re`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/master_agent/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/master_agent/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/master_agent/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/master_agent/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/master_agent/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/master_agent/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/master_agent/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/master_agent/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/master_agent/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/master_agent/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/micro_frontends/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/micro_frontends/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/micro_frontends/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/micro_frontends/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/micro_frontends/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/micro_frontends/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/micro_frontends/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/micro_frontends/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/micro_frontends/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/micro_frontends/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/model_serving_infrastructure.py:17:1
   |
15 |   # This shim exists for backward compatibility only.
16 |
17 | / from __future__ import annotations
18 | |
19 | | # Re-export everything from the refactored hexagonal architecture
20 | | from app.services.serving import (
21 | |     # Domain models
22 | |     ABTestConfig,
23 | |     EnsembleConfig,
24 | |     ModelMetrics,
25 | |     ModelRequest,
26 | |     ModelResponse,
27 | |     ModelStatus,
28 | |     ModelType,
29 | |     ModelVersion,
30 | |     RoutingStrategy,
31 | |     ServingStrategy,
32 | |     ShadowDeployment,
33 | |     # Application services
34 | |     ModelRegistry,
35 | |     InferenceRouter,
36 | |     ExperimentManager,
37 | |     # Infrastructure
38 | |     InMemoryModelRepository,
39 | |     InMemoryMetricsRepository,
40 | |     MockModelInvoker,
41 | |     # Facade and factory (backward compatibility)
42 | |     ModelServingInfrastructure,
43 | |     get_model_serving_infrastructure,
44 | | )
   | |_^
45 |
46 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/model_serving_infrastructure.py:46:11
   |
44 |   )
45 |
46 |   __all__ = [
   |  ___________^
47 | |     # Domain models
48 | |     "ModelVersion",
49 | |     "ModelMetrics",
50 | |     "ModelRequest",
51 | |     "ModelResponse",
52 | |     "ABTestConfig",
53 | |     "ShadowDeployment",
54 | |     "EnsembleConfig",
55 | |     "ModelStatus",
56 | |     "ModelType",
57 | |     "ServingStrategy",
58 | |     "RoutingStrategy",
59 | |     # Application services (for advanced usage)
60 | |     "ModelRegistry",
61 | |     "InferenceRouter",
62 | |     "ExperimentManager",
63 | |     # Infrastructure (for testing/mocking)
64 | |     "InMemoryModelRepository",
65 | |     "InMemoryMetricsRepository",
66 | |     "MockModelInvoker",
67 | |     # Main facade (most common usage)
68 | |     "ModelServingInfrastructure",
69 | |     "get_model_serving_infrastructure",
70 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/multi_layer_cache/__init__.py:20:1
   |
18 |   Status:  Wave 10 Refactored
19 |   """
20 | / from __future__ import annotations
21 | |
22 | | from .facade import (
23 | |     CDNEdgeCache,
24 | |     CacheEntry,
25 | |     CacheLayer,
26 | |     CacheStats,
27 | |     CacheStrategy,
28 | |     EvictionPolicy,
29 | |     InMemoryCache,
30 | |     MultiLayerCacheManager,
31 | |     MultiLayerCacheOrchestrator,
32 | |     RedisClusterCache,
33 | |     RedisClusterNode,
34 | |     get_cache_orchestrator,
35 | | )
   | |_^
36 |
37 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/multi_layer_cache/__init__.py:37:11
   |
35 |   )
36 |
37 |   __all__ = [
   |  ___________^
38 | |     # Main entry point
39 | |     "get_cache_orchestrator",
40 | |     # Classes
41 | |     "MultiLayerCacheOrchestrator",
42 | |     "MultiLayerCacheManager",
43 | |     "InMemoryCache",
44 | |     "RedisClusterCache",
45 | |     "CDNEdgeCache",
46 | |     # Domain models
47 | |     "CacheLayer",
48 | |     "CacheStrategy",
49 | |     "EvictionPolicy",
50 | |     "CacheEntry",
51 | |     "CacheStats",
52 | |     "RedisClusterNode",
53 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/multi_layer_cache/domain/__init__.py:19:11
   |
17 |   from .ports import CachePort, ClusterCachePort, EdgeCachePort
18 |
19 |   __all__ = [
   |  ___________^
20 | |     # Models
21 | |     "CacheLayer",
22 | |     "CacheStrategy",
23 | |     "EvictionPolicy",
24 | |     "CacheEntry",
25 | |     "CacheStats",
26 | |     "RedisClusterNode",
27 | |     # Ports
28 | |     "CachePort",
29 | |     "EdgeCachePort",
30 | |     "ClusterCachePort",
31 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/multi_layer_cache/domain/models.py:8:1
   |
 6 |   Implements the core domain logic for multi-layer caching.
 7 |   """
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass, field
11 | | from datetime import UTC, datetime
12 | | from enum import Enum
13 | | from typing import Any
   | |______________________^
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
   --> app/services/multi_layer_cache/domain/models.py:122:11
    |
121 |   # Export all domain models
122 |   __all__ = [
    |  ___________^
123 | |     "CacheLayer",
124 | |     "CacheStrategy",
125 | |     "EvictionPolicy",
126 | |     "CacheEntry",
127 | |     "CacheStats",
128 | |     "RedisClusterNode",
129 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `.models.CacheLayer` imported but unused
  --> app/services/multi_layer_cache/domain/ports.py:12:21
   |
10 | from typing import Any, Protocol
11 |
12 | from .models import CacheLayer
   |                     ^^^^^^^^^^
   |
help: Remove unused import: `.models.CacheLayer`

RUF022 [*] `__all__` is not sorted
  --> app/services/multi_layer_cache/domain/ports.py:79:11
   |
79 |   __all__ = [
   |  ___________^
80 | |     "CachePort",
81 | |     "EdgeCachePort",
82 | |     "ClusterCachePort",
83 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/services/multi_layer_cache/facade.py:30:1
   |
28 |     """
29 |     Get the singleton instance of the Multi-Layer Cache Manager.
30 |
   | ^^^^
31 |       instance     
32 |     """
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/multi_layer_cache/facade.py:43:11
   |
42 |   # Export all public APIs for backward compatibility
43 |   __all__ = [
   |  ___________^
44 | |     # Main orchestrator
45 | |     "get_cache_orchestrator",
46 | |     "MultiLayerCacheOrchestrator",
47 | |     "MultiLayerCacheManager",
48 | |     # Domain models
49 | |     "CacheLayer",
50 | |     "CacheStrategy",
51 | |     "EvictionPolicy",
52 | |     "CacheEntry",
53 | |     "CacheStats",
54 | |     "RedisClusterNode",
55 | |     # Infrastructure adapters
56 | |     "InMemoryCache",
57 | |     "RedisClusterCache",
58 | |     "CDNEdgeCache",
59 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/multi_layer_cache/infrastructure/__init__.py:13:11
   |
11 |   from .redis_adapter import RedisClusterCache
12 |
13 |   __all__ = [
   |  ___________^
14 | |     "InMemoryCache",
15 | |     "RedisClusterCache",
16 | |     "CDNEdgeCache",
17 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/multi_layer_cache_service.py:20:1
   |
18 |   Status:  Wave 10 Refactored
19 |   """
20 | / from __future__ import annotations
21 | |
22 | | # Import from new modular structure
23 | | from .multi_layer_cache import (
24 | |     CDNEdgeCache,
25 | |     CacheEntry,
26 | |     CacheLayer,
27 | |     CacheStats,
28 | |     CacheStrategy,
29 | |     EvictionPolicy,
30 | |     InMemoryCache,
31 | |     MultiLayerCacheOrchestrator,
32 | |     RedisClusterCache,
33 | |     RedisClusterNode,
34 | |     get_cache_orchestrator,
35 | | )
   | |_^
36 |
37 |   # Re-export for backward compatibility
   |
help: Organize imports

RUF022 [*] `__all__` is not sorted
  --> app/services/multi_layer_cache_service.py:38:11
   |
37 |   # Re-export for backward compatibility
38 |   __all__ = [
   |  ___________^
39 | |     "CacheLayer",
40 | |     "CacheStrategy",
41 | |     "EvictionPolicy",
42 | |     "CacheEntry",
43 | |     "CacheStats",
44 | |     "RedisClusterNode",
45 | |     "InMemoryCache",
46 | |     "RedisClusterCache",
47 | |     "CDNEdgeCache",
48 | |     "MultiLayerCacheOrchestrator",
49 | |     "get_cache_orchestrator",
50 | | ]
   | |_^
51 |
52 |   # Singleton instance for backward compatibility
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/observability_integration/__init__.py:27:11
   |
25 |   from .facade import ObservabilityIntegrationFacade
26 |
27 |   __all__ = [
   |  ___________^
28 | |     # Facade
29 | |     "ObservabilityIntegrationFacade",
30 | |     # Application Services
31 | |     "AlertManager",
32 | |     "HealthMonitor",
33 | |     "MetricsManager",
34 | |     "PerformanceTracker",
35 | |     "TraceManager",
36 | |     # Domain Models
37 | |     "Alert",
38 | |     "AlertSeverity",
39 | |     "HealthStatus",
40 | |     "Metric",
41 | |     "MetricType",
42 | |     "PerformanceSnapshot",
43 | |     "Span",
44 | |     "TraceStatus",
45 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/observability_integration/domain/__init__.py:25:11
   |
23 |   )
24 |
25 |   __all__ = [
   |  ___________^
26 | |     # Models
27 | |     "Alert",
28 | |     "AlertSeverity",
29 | |     "HealthStatus",
30 | |     "Metric",
31 | |     "MetricType",
32 | |     "PerformanceSnapshot",
33 | |     "Span",
34 | |     "TraceStatus",
35 | |     # Ports
36 | |     "IAlertRepository",
37 | |     "IHealthMonitor",
38 | |     "IMetricsCollector",
39 | |     "ITraceExporter",
40 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/observability_integration_service.py:25:11
   |
23 |   )
24 |
25 |   __all__ = [
   |  ___________^
26 | |     "ObservabilityIntegration",
27 | |     "Metric",
28 | |     "MetricType",
29 | |     "Span",
30 | |     "TraceStatus",
31 | |     "Alert",
32 | |     "AlertSeverity",
33 | |     "HealthStatus",
34 | |     "PerformanceSnapshot",
35 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 `__all__` is not sorted
  --> app/services/orchestration/__init__.py:33:11
   |
31 |   )
32 |
33 |   __all__ = [
   |  ___________^
34 | |     # Domain models
35 | |     "AutoScalingConfig",
36 | |     "ConsensusRole",
37 | |     "Node",
38 | |     "NodeState",
39 | |     "Pod",
40 | |     "PodPhase",
41 | |     "RaftState",
42 | |     "ScalingDirection",
43 | |     "SelfHealingEvent",
44 | |     # Facade
45 | |     "KubernetesOrchestrator",
46 | |     "get_kubernetes_orchestrator",
47 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `datetime.timedelta` imported but unused
  --> app/services/orchestration/application/auto_scaler.py:10:32
   |
 8 | from __future__ import annotations
 9 |
10 | from datetime import datetime, timedelta
   |                                ^^^^^^^^^
11 | from typing import Protocol
   |
help: Remove unused import: `datetime.timedelta`

W293 Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:23:1
   |
21 |     """
22 |     Kubernetes auto-scaler.
23 |
   | ^^^^
24 |     Responsibilities:
25 |     - Monitor resource usage
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:29:1
   |
27 |     - Respect min/max replicas
28 |     """
29 |
   | ^^^^
30 |     def __init__(self, pod_repository: PodRepository):
31 |         self._pod_repo = pod_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:34:1
   |
32 |         self._configs: dict[str, AutoScalingConfig] = {}
33 |         self._last_scale_time: dict[str, datetime] = {}
34 |
   | ^^^^
35 |     def configure_autoscaling(
36 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:52:1
   |
50 |         )
51 |         self._configs[deployment_name] = config
52 |
   | ^^^^
53 |     def check_autoscaling(self, deployment_name: str) -> tuple[ScalingDirection, int]:
54 |         """Check if scaling is needed"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:57:1
   |
55 |         if deployment_name not in self._configs:
56 |             return ScalingDirection.NONE, 0
57 |
   | ^^^^^^^^
58 |         config = self._configs[deployment_name]
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:59:1
   |
58 |         config = self._configs[deployment_name]
59 |
   | ^^^^^^^^
60 |         # Check cooldown period
61 |         if not self._can_scale(deployment_name, config):
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:63:1
   |
61 |         if not self._can_scale(deployment_name, config):
62 |             return ScalingDirection.NONE, 0
63 |
   | ^^^^^^^^
64 |         # Calculate current resource usage
65 |         cpu_usage = self._calculate_deployment_cpu_usage(deployment_name)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:67:1
   |
65 |         cpu_usage = self._calculate_deployment_cpu_usage(deployment_name)
66 |         current_replicas = self._get_current_replicas(deployment_name)
67 |
   | ^^^^^^^^
68 |         # Determine scaling direction
69 |         if cpu_usage > config.target_cpu_percent * config.scale_up_threshold:
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:75:1
   |
73 |                 self._last_scale_time[deployment_name] = datetime.utcnow()
74 |                 return ScalingDirection.UP, new_replicas
75 |
   | ^^^^^^^^
76 |         elif cpu_usage < config.target_cpu_percent * config.scale_down_threshold:
77 |             # Scale down
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:82:1
   |
80 |                 self._last_scale_time[deployment_name] = datetime.utcnow()
81 |                 return ScalingDirection.DOWN, new_replicas
82 |
   | ^^^^^^^^
83 |         return ScalingDirection.NONE, current_replicas
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:84:1
   |
83 |         return ScalingDirection.NONE, current_replicas
84 |
   | ^^^^
85 |     def _can_scale(self, deployment_name: str, config: AutoScalingConfig) -> bool:
86 |         """Check if cooldown period has passed"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:89:1
   |
87 |         if deployment_name not in self._last_scale_time:
88 |             return True
89 |
   | ^^^^^^^^
90 |         last_scale = self._last_scale_time[deployment_name]
91 |         elapsed = (datetime.utcnow() - last_scale).total_seconds()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:92:1
   |
90 |         last_scale = self._last_scale_time[deployment_name]
91 |         elapsed = (datetime.utcnow() - last_scale).total_seconds()
92 |
   | ^^^^^^^^
93 |         return elapsed >= config.cooldown_seconds
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/auto_scaler.py:94:1
   |
93 |         return elapsed >= config.cooldown_seconds
94 |
   | ^^^^
95 |     def _calculate_deployment_cpu_usage(self, deployment_name: str) -> float:
96 |         """Calculate average CPU usage for deployment"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/auto_scaler.py:101:1
    |
 99 |         import random
100 |         return random.uniform(20, 90)
101 |
    | ^^^^
102 |     def _get_current_replicas(self, deployment_name: str) -> int:
103 |         """Get current replica count"""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:27:1
   |
25 |     """
26 |     Cluster node manager.
27 |
   | ^^^^
28 |     Responsibilities:
29 |     - Add/remove nodes
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:33:1
   |
31 |     - Update node state
32 |     """
33 |
   | ^^^^
34 |     def __init__(self, node_repository: NodeRepository):
35 |         self._node_repo = node_repository
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:36:1
   |
34 |     def __init__(self, node_repository: NodeRepository):
35 |         self._node_repo = node_repository
36 |
   | ^^^^
37 |     def add_node(
38 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:46:1
   |
44 |         """Add new node to cluster"""
45 |         node_id = hashlib.sha256(name.encode()).hexdigest()[:16]
46 |
   | ^^^^^^^^
47 |         node = Node(
48 |             node_id=node_id,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:55:1
   |
53 |             labels=labels or {},
54 |         )
55 |
   | ^^^^^^^^
56 |         self._node_repo.save(node)
57 |         return node_id
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:58:1
   |
56 |         self._node_repo.save(node)
57 |         return node_id
58 |
   | ^^^^
59 |     def get_node(self, node_id: str) -> Node | None:
60 |         """Get node by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:62:1
   |
60 |         """Get node by ID"""
61 |         return self._node_repo.get(node_id)
62 |
   | ^^^^
63 |     def get_all_nodes(self) -> list[Node]:
64 |         """Get all nodes"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:66:1
   |
64 |         """Get all nodes"""
65 |         return self._node_repo.get_all()
66 |
   | ^^^^
67 |     def update_node_heartbeat(self, node_id: str) -> None:
68 |         """Update node heartbeat"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:73:1
   |
71 |             node.last_heartbeat = datetime.utcnow()
72 |             self._node_repo.update(node)
73 |
   | ^^^^
74 |     def cordon_node(self, node_id: str) -> bool:
75 |         """Cordon node (prevent new pods)"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:82:1
   |
80 |             return True
81 |         return False
82 |
   | ^^^^
83 |     def uncordon_node(self, node_id: str) -> bool:
84 |         """Uncordon node (allow new pods)"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/node_manager.py:91:1
   |
89 |             return True
90 |         return False
91 |
   | ^^^^
92 |     def mark_node_not_ready(self, node_id: str) -> None:
93 |         """Mark node as not ready"""
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:30:1
   |
28 |     """
29 |     Kubernetes pod scheduler.
30 |
   | ^^^^
31 |     Responsibilities:
32 |     - Find best node for pod
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:36:1
   |
34 |     - Load balancing
35 |     """
36 |
   | ^^^^
37 |     def __init__(
38 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:44:1
   |
42 |         self._pod_repo = pod_repository
43 |         self._node_repo = node_repository
44 |
   | ^^^^
45 |     def schedule_pod(
46 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:59:1
   |
57 |         # Find best node
58 |         best_node = self._find_best_node(cpu_request, memory_request)
59 |
   | ^^^^^^^^
60 |         if not best_node:
61 |             raise RuntimeError("No available nodes for pod")
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:62:1
   |
60 |         if not best_node:
61 |             raise RuntimeError("No available nodes for pod")
62 |
   | ^^^^^^^^
63 |         # Create pod
64 |         pod_id = self._generate_pod_id(name)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:78:1
   |
76 |             labels=labels or {},
77 |         )
78 |
   | ^^^^^^^^
79 |         # Allocate to node
80 |         best_node.allocate_pod(pod)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:82:1
   |
80 |         best_node.allocate_pod(pod)
81 |         self._node_repo.update(best_node)
82 |
   | ^^^^^^^^
83 |         # Mark as running
84 |         pod.mark_running()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:86:1
   |
84 |         pod.mark_running()
85 |         self._pod_repo.save(pod)
86 |
   | ^^^^^^^^
87 |         return pod_id
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:88:1
   |
87 |         return pod_id
88 |
   | ^^^^
89 |     def _find_best_node(
90 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/pod_scheduler.py:96:1
   |
94 |         """Find best node for pod using bin-packing strategy"""
95 |         nodes = self._node_repo.get_all()
96 |
   | ^^^^^^^^
97 |         # Filter nodes that can fit the pod
98 |         eligible = [
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/pod_scheduler.py:102:1
    |
100 |             if n.can_fit_pod(cpu_request, memory_request)
101 |         ]
102 |
    | ^^^^^^^^
103 |         if not eligible:
104 |             return None
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/pod_scheduler.py:105:1
    |
103 |         if not eligible:
104 |             return None
105 |
    | ^^^^^^^^
106 |         # Best fit: node with least remaining resources (bin-packing)
107 |         return min(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/pod_scheduler.py:111:1
    |
109 |             key=lambda n: n.cpu_available + n.memory_available,
110 |         )
111 |
    | ^^^^
112 |     def _generate_pod_id(self, name: str) -> str:
113 |         """Generate unique pod ID"""
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:22:1
   |
20 |     """
21 |     Raft distributed consensus protocol implementation.
22 |
   | ^^^^
23 |     Responsibilities:
24 |     - Leader election
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:28:1
   |
26 |     - Heartbeat management
27 |     """
28 |
   | ^^^^
29 |     def __init__(self, node_id: str, cluster_nodes: list[str]):
30 |         self._node_id = node_id
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:39:1
   |
37 |         self._running = False
38 |         self._consensus_thread: threading.Thread | None = None
39 |
   | ^^^^
40 |     def start(self) -> None:
41 |         """Start consensus protocol"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:48:1
   |
46 |         )
47 |         self._consensus_thread.start()
48 |
   | ^^^^
49 |     def stop(self) -> None:
50 |         """Stop consensus protocol"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:54:1
   |
52 |         if self._consensus_thread:
53 |             self._consensus_thread.join(timeout=5)
54 |
   | ^^^^
55 |     def append_log_entry(self, entry: dict[str, Any]) -> bool:
56 |         """Append entry to distributed log (Leader only)"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:60:1
   |
58 |             if self._state.role != ConsensusRole.LEADER:
59 |                 return False
60 |
   | ^^^^^^^^^^^^
61 |             log_entry = {
62 |                 "term": self._state.term,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:68:1
   |
66 |             self._state.log.append(log_entry)
67 |             return True
68 |
   | ^^^^
69 |     def get_state(self) -> RaftState:
70 |         """Get current Raft state"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:73:1
   |
71 |         with self._lock:
72 |             return self._state
73 |
   | ^^^^
74 |     def is_leader(self) -> bool:
75 |         """Check if this node is the leader"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:78:1
   |
76 |         with self._lock:
77 |             return self._state.role == ConsensusRole.LEADER
78 |
   | ^^^^
79 |     def _run_consensus_loop(self) -> None:
80 |         """Main consensus loop"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/raft_consensus.py:95:1
   |
93 |             except Exception:
94 |                 pass
95 |
   | ^^^^
96 |     def _send_heartbeats(self) -> None:
97 |         """Send heartbeats to followers"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/raft_consensus.py:100:1
    |
 98 |         self._state.last_heartbeat_time = datetime.utcnow()
 99 |         # In production: send RPCs to all followers
100 |
    | ^^^^
101 |     def _check_election_timeout(self) -> None:
102 |         """Check if election timeout exceeded"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/raft_consensus.py:105:1
    |
103 |         elapsed = (datetime.utcnow() - self._state.last_heartbeat_time).total_seconds()
104 |         timeout = self._state.election_timeout + random.uniform(0, 2)
105 |
    | ^^^^^^^^
106 |         if elapsed > timeout:
107 |             # Start election
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/raft_consensus.py:112:1
    |
110 |             self._state.voted_for = self._node_id
111 |             self._state.votes_received = {self._node_id}
112 |
    | ^^^^
113 |     def _conduct_election(self) -> None:
114 |         """Conduct leader election"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/raft_consensus.py:116:1
    |
114 |         """Conduct leader election"""
115 |         majority = (len(self._cluster_nodes) // 2) + 1
116 |
    | ^^^^^^^^
117 |         # Simulate receiving votes from other nodes
118 |         for node_id in self._cluster_nodes:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/raft_consensus.py:121:1
    |
119 |             if node_id != self._node_id and random.random() > 0.3:
120 |                 self._state.votes_received.add(node_id)
121 |
    | ^^^^^^^^
122 |         # Check if won election
123 |         if len(self._state.votes_received) >= majority:
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:51:1
   |
49 |     """
50 |     Self-healing orchestrator.
51 |
   | ^^^^
52 |     Responsibilities:
53 |     - Monitor pod health
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:58:1
   |
56 |     - Record healing events
57 |     """
58 |
   | ^^^^
59 |     def __init__(
60 |         self,
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:70:1
   |
68 |         self._event_repo = healing_event_repository
69 |         self._scheduler = pod_scheduler
70 |
   | ^^^^
71 |     def check_and_heal_pods(self) -> list[str]:
72 |         """Check all pods and heal failed ones"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:74:1
   |
72 |         """Check all pods and heal failed ones"""
73 |         healed_pods = []
74 |
   | ^^^^^^^^
75 |         for pod in self._pod_repo.get_all():
76 |             if self._is_pod_unhealthy(pod):
   |
help: Remove whitespace from blank line

SIM102 Use a single `if` statement instead of nested `if` statements
  --> app/services/orchestration/application/self_healer.py:76:13
   |
75 |           for pod in self._pod_repo.get_all():
76 | /             if self._is_pod_unhealthy(pod):
77 | |                 if self._heal_pod(pod):
   | |_______________________________________^
78 |                       healed_pods.append(pod.pod_id)
   |
help: Combine `if` statements using `and`

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:79:1
   |
77 |                 if self._heal_pod(pod):
78 |                     healed_pods.append(pod.pod_id)
79 |
   | ^^^^^^^^
80 |         return healed_pods
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:81:1
   |
80 |         return healed_pods
81 |
   | ^^^^
82 |     def check_and_heal_nodes(self) -> list[str]:
83 |         """Check all nodes and evacuate unhealthy ones"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:85:1
   |
83 |         """Check all nodes and evacuate unhealthy ones"""
84 |         evacuated_nodes = []
85 |
   | ^^^^^^^^
86 |         for node in self._node_repo.get_all():
87 |             if self._is_node_unhealthy(node):
   |
help: Remove whitespace from blank line

SIM102 Use a single `if` statement instead of nested `if` statements
  --> app/services/orchestration/application/self_healer.py:87:13
   |
86 |           for node in self._node_repo.get_all():
87 | /             if self._is_node_unhealthy(node):
88 | |                 if self._evacuate_node(node):
   | |_____________________________________________^
89 |                       evacuated_nodes.append(node.node_id)
   |
help: Combine `if` statements using `and`

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:90:1
   |
88 |                 if self._evacuate_node(node):
89 |                     evacuated_nodes.append(node.node_id)
90 |
   | ^^^^^^^^
91 |         return evacuated_nodes
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/application/self_healer.py:92:1
   |
91 |         return evacuated_nodes
92 |
   | ^^^^
93 |     def _is_pod_unhealthy(self, pod: Pod) -> bool:
94 |         """Check if pod is unhealthy"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:98:1
    |
 96 |         if pod.phase == PodPhase.FAILED:
 97 |             return True
 98 |
    | ^^^^^^^^
 99 |         # Random failures for testing
100 |         return random.random() < 0.01  # 1% failure rate
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:101:1
    |
 99 |         # Random failures for testing
100 |         return random.random() < 0.01  # 1% failure rate
101 |
    | ^^^^
102 |     def _is_node_unhealthy(self, node: Node) -> bool:
103 |         """Check if node is unhealthy"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:106:1
    |
104 |         # Check heartbeat timeout
105 |         time_since_heartbeat = (datetime.utcnow() - node.last_heartbeat).total_seconds()
106 |
    | ^^^^^^^^
107 |         if time_since_heartbeat > 60:  # 60 seconds timeout
108 |             return True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:109:1
    |
107 |         if time_since_heartbeat > 60:  # 60 seconds timeout
108 |             return True
109 |
    | ^^^^^^^^
110 |         # Check resource pressure
111 |         if node.cpu_utilization > 95 or node.memory_utilization > 95:
    |
help: Remove whitespace from blank line

SIM103 Return the condition directly
   --> app/services/orchestration/application/self_healer.py:111:9
    |
110 |           # Check resource pressure
111 | /         if node.cpu_utilization > 95 or node.memory_utilization > 95:
112 | |             return True
113 | |
114 | |         return False
    | |____________________^
115 |
116 |       def _heal_pod(self, pod: Pod) -> bool:
    |
help: Inline condition

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:113:1
    |
111 |         if node.cpu_utilization > 95 or node.memory_utilization > 95:
112 |             return True
113 |
    | ^^^^^^^^
114 |         return False
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:115:1
    |
114 |         return False
115 |
    | ^^^^
116 |     def _heal_pod(self, pod: Pod) -> bool:
117 |         """Heal failed pod"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:121:1
    |
119 |             # Delete failed pod
120 |             self._pod_repo.delete(pod.pod_id)
121 |
    | ^^^^^^^^^^^^
122 |             # Reschedule pod
123 |             new_pod_id = self._scheduler.schedule_pod(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:133:1
    |
131 |                 labels=pod.labels,
132 |             )
133 |
    | ^^^^^^^^^^^^
134 |             # Record healing event
135 |             self._record_healing_event(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:141:1
    |
139 |                 success=True,
140 |             )
141 |
    | ^^^^^^^^^^^^
142 |             return True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:143:1
    |
142 |             return True
143 |
    | ^^^^^^^^
144 |         except Exception as e:
145 |             self._record_healing_event(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:152:1
    |
150 |             )
151 |             return False
152 |
    | ^^^^
153 |     def _evacuate_node(self, node: Node) -> bool:
154 |         """Evacuate pods from unhealthy node"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:159:1
    |
157 |             node.state = NodeState.CORDONED
158 |             self._node_repo.update(node)
159 |
    | ^^^^^^^^^^^^
160 |             # Get all pods on node
161 |             pods = self._pod_repo.get_by_node(node.node_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:162:1
    |
160 |             # Get all pods on node
161 |             pods = self._pod_repo.get_by_node(node.node_id)
162 |
    | ^^^^^^^^^^^^
163 |             # Reschedule all pods
164 |             rescheduled_count = 0
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:181:1
    |
179 |                 except Exception:
180 |                     pass
181 |
    | ^^^^^^^^^^^^
182 |             # Record healing event
183 |             self._record_healing_event(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:192:1
    |
190 |                 success=True,
191 |             )
192 |
    | ^^^^^^^^^^^^
193 |             return True
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:194:1
    |
193 |             return True
194 |
    | ^^^^^^^^
195 |         except Exception as e:
196 |             self._record_healing_event(
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:203:1
    |
201 |             )
202 |             return False
203 |
    | ^^^^
204 |     def _record_healing_event(
205 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:215:1
    |
213 |             f"{event_type}{resource_id}{time.time_ns()}".encode()
214 |         ).hexdigest()[:16]
215 |
    | ^^^^^^^^
216 |         event = SelfHealingEvent(
217 |             event_id=event_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:224:1
    |
222 |             success=success,
223 |         )
224 |
    | ^^^^^^^^
225 |         self._event_repo.save(event)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/application/self_healer.py:226:1
    |
225 |         self._event_repo.save(event)
226 |
    | ^^^^
227 |     def get_healing_events(self, limit: int = 100) -> list[SelfHealingEvent]:
228 |         """Get recent healing events"""
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/orchestration/domain/models.py:8:1
   |
 6 |   """
 7 |
 8 | / from __future__ import annotations
 9 | |
10 | | from dataclasses import dataclass, field
11 | | from datetime import datetime
12 | | from enum import Enum
13 | | from typing import Any
   | |______________________^
   |
help: Organize imports

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/domain/models.py:75:1
   |
73 |     created_at: datetime = field(default_factory=datetime.utcnow)
74 |     last_restart: datetime | None = None
75 |
   | ^^^^
76 |     def mark_failed(self) -> None:
77 |         """Mark pod as failed"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/domain/models.py:81:1
   |
79 |         self.restart_count += 1
80 |         self.last_restart = datetime.utcnow()
81 |
   | ^^^^
82 |     def mark_running(self) -> None:
83 |         """Mark pod as running"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/domain/models.py:101:1
    |
 99 |     created_at: datetime = field(default_factory=datetime.utcnow)
100 |     last_heartbeat: datetime = field(default_factory=datetime.utcnow)
101 |
    | ^^^^
102 |     @property
103 |     def cpu_available(self) -> float:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/domain/models.py:105:1
    |
103 |     def cpu_available(self) -> float:
104 |         return self.cpu_capacity - self.cpu_allocated
105 |
    | ^^^^
106 |     @property
107 |     def memory_available(self) -> float:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/domain/models.py:109:1
    |
107 |     def memory_available(self) -> float:
108 |         return self.memory_capacity - self.memory_allocated
109 |
    | ^^^^
110 |     def can_fit_pod(self, cpu_request: float, memory_request: float) -> bool:
111 |         return (
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/domain/models.py:116:1
    |
114 |             self.memory_available >= memory_request
115 |         )
116 |
    | ^^^^
117 |     def allocate_pod(self, pod: Pod) -> None:
118 |         self.pods.add(pod.pod_id)
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/domain/models.py:121:1
    |
119 |         self.cpu_allocated += pod.cpu_request
120 |         self.memory_allocated += pod.memory_request
121 |
    | ^^^^
122 |     def deallocate_pod(self, pod: Pod) -> None:
123 |         if pod.pod_id in self.pods:
    |
help: Remove whitespace from blank line

F401 [*] `datetime.datetime` imported but unused
  --> app/services/orchestration/domain/ports.py:10:22
   |
 8 | from __future__ import annotations
 9 |
10 | from datetime import datetime
   |                      ^^^^^^^^
11 | from typing import Protocol
   |
help: Remove unused import: `datetime.datetime`

F401 [*] `app.services.orchestration.domain.models.ConsensusRole` imported but unused
  --> app/services/orchestration/facade.py:22:5
   |
20 | )
21 | from app.services.orchestration.domain.models import (
22 |     ConsensusRole,
   |     ^^^^^^^^^^^^^
23 |     NodeState,
24 |     PodPhase,
   |
help: Remove unused import

F401 [*] `app.services.orchestration.domain.models.ScalingDirection` imported but unused
  --> app/services/orchestration/facade.py:25:5
   |
23 |     NodeState,
24 |     PodPhase,
25 |     ScalingDirection,
   |     ^^^^^^^^^^^^^^^^
26 | )
27 | from app.services.orchestration.infrastructure import (
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/orchestration/facade.py:37:1
   |
35 |     """
36 |     Kubernetes Orchestration Service - Complete Facade
37 |
   | ^^^^
38 |     100% backward compatible with original 715-line service.
39 |     Delegates to specialized services following SRP.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/orchestration/facade.py:40:1
   |
38 |     100% backward compatible with original 715-line service.
39 |     Delegates to specialized services following SRP.
40 |
   | ^^^^
41 |     Features:
42 |     - Pod scheduling
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:47:1
   |
45 |     - Auto-scaling
46 |     """
47 |
   | ^^^^
48 |     def __init__(self, cluster_size: int = 5):
49 |         """Initialize orchestrator"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:54:1
   |
52 |         self._node_repo = InMemoryNodeRepository()
53 |         self._healing_event_repo = InMemoryHealingEventRepository()
54 |
   | ^^^^^^^^
55 |         # Application layer
56 |         self._node_manager = NodeManager(self._node_repo)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:69:1
   |
67 |             cluster_nodes=[f"node-{i}" for i in range(cluster_size)],
68 |         )
69 |
   | ^^^^^^^^
70 |         # Initialize cluster
71 |         self._initialize_cluster(cluster_size)
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:72:1
   |
70 |         # Initialize cluster
71 |         self._initialize_cluster(cluster_size)
72 |
   | ^^^^^^^^
73 |         # Start background services
74 |         self._start_health_monitoring()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:76:1
   |
74 |         self._start_health_monitoring()
75 |         self._start_consensus_protocol()
76 |
   | ^^^^^^^^
77 |         # Legacy compatibility
78 |         self._lock = threading.RLock()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:84:1
   |
82 |         self._raft_state = None
83 |         self._autoscaling_configs = {}
84 |
   | ^^^^
85 |     def _initialize_cluster(self, cluster_size: int) -> None:
86 |         """Initialize cluster with nodes"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/facade.py:97:1
   |
95 |                 },
96 |             )
97 |
   | ^^^^
98 |     def _start_health_monitoring(self) -> None:
99 |         """Start health monitoring background thread"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:109:1
    |
107 |                 except Exception:
108 |                     pass
109 |
    | ^^^^^^^^
110 |         thread = threading.Thread(target=monitor, daemon=True)
111 |         thread.start()
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:112:1
    |
110 |         thread = threading.Thread(target=monitor, daemon=True)
111 |         thread.start()
112 |
    | ^^^^
113 |     def _start_consensus_protocol(self) -> None:
114 |         """Start Raft consensus protocol"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:116:1
    |
114 |         """Start Raft consensus protocol"""
115 |         self._raft_consensus.start()
116 |
    | ^^^^
117 |     # ==================================================================================
118 |     # POD SCHEDULING
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:120:1
    |
118 |     # POD SCHEDULING
119 |     # ==================================================================================
120 |
    | ^^^^
121 |     def schedule_pod(
122 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:144:1
    |
142 |             labels=labels,
143 |         )
144 |
    | ^^^^
145 |     # ==================================================================================
146 |     # AUTO-SCALING
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:148:1
    |
146 |     # AUTO-SCALING
147 |     # ==================================================================================
148 |
    | ^^^^
149 |     def configure_autoscaling(
150 |         self,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:165:1
    |
163 |             target_memory_percent=target_memory_percent,
164 |         )
165 |
    | ^^^^
166 |     def check_autoscaling(self) -> dict[str, Any]:
167 |         """Check and apply auto-scaling rules"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:174:1
    |
172 |             "timestamp": datetime.utcnow().isoformat(),
173 |         }
174 |
    | ^^^^
175 |     # ==================================================================================
176 |     # RAFT CONSENSUS
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:178:1
    |
176 |     # RAFT CONSENSUS
177 |     # ==================================================================================
178 |
    | ^^^^
179 |     def append_log_entry(self, entry: dict[str, Any]) -> bool:
180 |         """Append entry to distributed log"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:182:1
    |
180 |         """Append entry to distributed log"""
181 |         return self._raft_consensus.append_log_entry(entry)
182 |
    | ^^^^
183 |     def get_raft_state(self) -> dict[str, Any]:
184 |         """Get Raft consensus state"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:193:1
    |
191 |             "is_leader": self._raft_consensus.is_leader(),
192 |         }
193 |
    | ^^^^
194 |     # ==================================================================================
195 |     # STATUS & MONITORING
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:197:1
    |
195 |     # STATUS & MONITORING
196 |     # ==================================================================================
197 |
    | ^^^^
198 |     def get_pod_status(self, pod_id: str) -> dict[str, Any] | None:
199 |         """Get pod status"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:203:1
    |
201 |         if not pod:
202 |             return None
203 |
    | ^^^^^^^^
204 |         return {
205 |             "pod_id": pod.pod_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:214:1
    |
212 |             "memory_request": pod.memory_request,
213 |         }
214 |
    | ^^^^
215 |     def get_node_status(self, node_id: str) -> dict[str, Any] | None:
216 |         """Get node status"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:220:1
    |
218 |         if not node:
219 |             return None
220 |
    | ^^^^^^^^
221 |         return {
222 |             "node_id": node.node_id,
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:233:1
    |
231 |             "pod_count": len(node.pods),
232 |         }
233 |
    | ^^^^
234 |     def get_cluster_stats(self) -> dict[str, Any]:
235 |         """Get cluster statistics"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:238:1
    |
236 |         nodes = self._node_repo.get_all()
237 |         pods = self._pod_repo.get_all()
238 |
    | ^^^^^^^^
239 |         return {
240 |             "total_nodes": len(nodes),
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:250:1
    |
248 |             "total_memory_allocated": sum(n.memory_allocated for n in nodes),
249 |         }
250 |
    | ^^^^
251 |     def get_healing_events(self, limit: int = 100) -> list[dict[str, Any]]:
252 |         """Get recent healing events"""
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:278:1
    |
276 |     """Get or create orchestrator singleton"""
277 |     global _ORCHESTRATOR_INSTANCE
278 |
    | ^^^^
279 |     if _ORCHESTRATOR_INSTANCE is not None:
280 |         return _ORCHESTRATOR_INSTANCE
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/orchestration/facade.py:281:1
    |
279 |     if _ORCHESTRATOR_INSTANCE is not None:
280 |         return _ORCHESTRATOR_INSTANCE
281 |
    | ^^^^
282 |     with _ORCHESTRATOR_LOCK:
283 |         if _ORCHESTRATOR_INSTANCE is None:
    |
help: Remove whitespace from blank line

F401 [*] `typing.Any` imported but unused
  --> app/services/orchestration/infrastructure/in_memory_repository.py:11:20
   |
10 | import threading
11 | from typing import Any
   |                    ^^^
12 |
13 | from app.services.orchestration.domain.models import Node, Pod, SelfHealingEvent
   |
help: Remove unused import: `typing.Any`

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:18:1
   |
16 | class InMemoryPodRepository:
17 |     """In-memory pod repository"""
18 |
   | ^^^^
19 |     def __init__(self):
20 |         self._pods: dict[str, Pod] = {}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:23:1
   |
21 |         self._pods_by_node: dict[str, list[Pod]] = {}
22 |         self._lock = threading.RLock()
23 |
   | ^^^^
24 |     def save(self, pod: Pod) -> None:
25 |         """Save pod"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:32:1
   |
30 |             if pod not in self._pods_by_node[pod.node_id]:
31 |                 self._pods_by_node[pod.node_id].append(pod)
32 |
   | ^^^^
33 |     def get(self, pod_id: str) -> Pod | None:
34 |         """Get pod by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:37:1
   |
35 |         with self._lock:
36 |             return self._pods.get(pod_id)
37 |
   | ^^^^
38 |     def get_all(self) -> list[Pod]:
39 |         """Get all pods"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:42:1
   |
40 |         with self._lock:
41 |             return list(self._pods.values())
42 |
   | ^^^^
43 |     def get_by_node(self, node_id: str) -> list[Pod]:
44 |         """Get pods by node"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:47:1
   |
45 |         with self._lock:
46 |             return self._pods_by_node.get(node_id, []).copy()
47 |
   | ^^^^
48 |     def delete(self, pod_id: str) -> None:
49 |         """Delete pod"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:60:1
   |
58 | class InMemoryNodeRepository:
59 |     """In-memory node repository"""
60 |
   | ^^^^
61 |     def __init__(self):
62 |         self._nodes: dict[str, Node] = {}
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:64:1
   |
62 |         self._nodes: dict[str, Node] = {}
63 |         self._lock = threading.RLock()
64 |
   | ^^^^
65 |     def save(self, node: Node) -> None:
66 |         """Save node"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:69:1
   |
67 |         with self._lock:
68 |             self._nodes[node.node_id] = node
69 |
   | ^^^^
70 |     def get(self, node_id: str) -> Node | None:
71 |         """Get node by ID"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:74:1
   |
72 |         with self._lock:
73 |             return self._nodes.get(node_id)
74 |
   | ^^^^
75 |     def get_all(self) -> list[Node]:
76 |         """Get all nodes"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:79:1
   |
77 |         with self._lock:
78 |             return list(self._nodes.values())
79 |
   | ^^^^
80 |     def update(self, node: Node) -> None:
81 |         """Update node"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:88:1
   |
86 | class InMemoryHealingEventRepository:
87 |     """In-memory healing event repository"""
88 |
   | ^^^^
89 |     def __init__(self):
90 |         self._events: list[SelfHealingEvent] = []
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:92:1
   |
90 |         self._events: list[SelfHealingEvent] = []
91 |         self._lock = threading.RLock()
92 |
   | ^^^^
93 |     def save(self, event: SelfHealingEvent) -> None:
94 |         """Save healing event"""
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/orchestration/infrastructure/in_memory_repository.py:97:1
   |
95 |         with self._lock:
96 |             self._events.append(event)
97 |
   | ^^^^
98 |     def get_recent(self, limit: int = 100) -> list[SelfHealingEvent]:
99 |         """Get recent events"""
   |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
   --> app/services/orchestration/infrastructure/in_memory_repository.py:108:11
    |
108 |   __all__ = [
    |  ___________^
109 | |     "InMemoryPodRepository",
110 | |     "InMemoryNodeRepository",
111 | |     "InMemoryHealingEventRepository",
112 | | ]
    | |_^
    |
help: Apply an isort-style sorting to `__all__`

F401 [*] `logging` imported but unused
  --> app/services/platform_boundary_service.py:15:8
   |
13 | from __future__ import annotations
14 |
15 | import logging
   |        ^^^^^^^
16 | import uuid
17 | from datetime import UTC, datetime
   |
help: Remove unused import: `logging`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/project_context/__init__.py:11:1
   |
10 |   # Domain models
11 | / from .domain.models import (
12 | |     CodeStatistics,
13 | |     FileAnalysis,
14 | |     KeyComponent,
15 | |     ProjectHealth,
16 | |     ProjectStructure,
17 | | )
18 | |
19 | | # Application service
20 | | from .application.context_analyzer import ProjectContextService
21 | |
22 | | # Facade (backward compatible)
23 | | from .facade import get_project_context_for_ai, get_project_context_service
   | |___________________________________________________________________________^
24 |
25 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/project_context/__init__.py:25:11
   |
23 |   from .facade import get_project_context_for_ai, get_project_context_service
24 |
25 |   __all__ = [
   |  ___________^
26 | |     # Domain models
27 | |     "ProjectHealth",
28 | |     "CodeStatistics",
29 | |     "ProjectStructure",
30 | |     "FileAnalysis",
31 | |     "KeyComponent",
32 | |     # Application service
33 | |     "ProjectContextService",
34 | |     # Facade functions
35 | |     "get_project_context_service",
36 | |     "get_project_context_for_ai",
37 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/project_context/domain/__init__.py:12:11
   |
10 |   )
11 |
12 |   __all__ = [
   |  ___________^
13 | |     "ProjectHealth",
14 | |     "CodeStatistics",
15 | |     "ProjectStructure",
16 | |     "FileAnalysis",
17 | |     "KeyComponent",
18 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/project_context/domain/models.py:72:11
   |
72 |   __all__ = [
   |  ___________^
73 | |     "ProjectHealth",
74 | |     "CodeStatistics",
75 | |     "ProjectStructure",
76 | |     "FileAnalysis",
77 | |     "KeyComponent",
78 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/project_context/facade.py:34:11
   |
34 |   __all__ = [
   |  ___________^
35 | |     "ProjectContextService",
36 | |     "get_project_context_service",
37 | |     "get_project_context_for_ai",
38 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/project_context_service.py:24:1
   |
22 |   """
23 |
24 | / from __future__ import annotations
25 | |
26 | | # Re-export everything from the refactored hexagonal architecture
27 | | from app.services.project_context import (
28 | |     # Domain models
29 | |     CodeStatistics,
30 | |     FileAnalysis,
31 | |     KeyComponent,
32 | |     ProjectHealth,
33 | |     ProjectStructure,
34 | |     # Application service
35 | |     ProjectContextService,
36 | |     # Facade functions (most common usage)
37 | |     get_project_context_for_ai,
38 | |     get_project_context_service,
39 | | )
   | |_^
40 |
41 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/project_context_service.py:41:11
   |
39 |   )
40 |
41 |   __all__ = [
   |  ___________^
42 | |     # Models
43 | |     "ProjectHealth",
44 | |     "CodeStatistics",
45 | |     "ProjectStructure",
46 | |     "FileAnalysis",
47 | |     "KeyComponent",
48 | |     # Service
49 | |     "ProjectContextService",
50 | |     # Convenience functions
51 | |     "get_project_context_service",
52 | |     "get_project_context_for_ai",
53 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 [*] Blank line contains whitespace
  --> app/services/security/auth_persistence.py:52:1
   |
50 |         )
51 |         new_user.set_password(password)
52 |
   | ^^^^^^^^
53 |         self.db.add(new_user)
54 |         await self.db.commit()
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/security/auth_persistence.py:56:1
   |
54 |         await self.db.commit()
55 |         await self.db.refresh(new_user)
56 |
   | ^^^^^^^^
57 |         return new_user
   |
help: Remove whitespace from blank line

RUF022 `__all__` is not sorted
  --> app/services/security_metrics/__init__.py:15:11
   |
13 |   from .facade import SecurityMetricsEngine, get_security_metrics_engine
14 |
15 |   __all__ = [
   |  ___________^
16 | |     # Facade
17 | |     "SecurityMetricsEngine",
18 | |     "get_security_metrics_engine",
19 | |     # Domain Models
20 | |     "SecurityFinding",
21 | |     "SecurityMetrics",
22 | |     "RiskPrediction",
23 | |     "Severity",
24 | |     "TrendDirection",
25 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

RUF022 [*] `__all__` is not sorted
  --> app/services/security_metrics/application/__init__.py:7:11
   |
 5 |   from .risk_calculator import AdvancedRiskCalculator
 6 |
 7 |   __all__ = [
   |  ___________^
 8 | |     "AdvancedRiskCalculator",
 9 | |     "LinearRegressionPredictor",
10 | |     "ComprehensiveMetricsCalculator",
11 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

C420 [*] Unnecessary dict comprehension for iterable; use `dict.fromkeys` instead
  --> app/services/security_metrics/application/metrics_calculator.py:48:18
   |
46 |     def _count_by_severity(self, findings: list[SecurityFinding]) -> dict[Severity, int]:
47 |         """Count findings by severity"""
48 |         counts = {severity: 0 for severity in Severity}
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |         for finding in findings:
50 |             if not finding.fixed and not finding.false_positive:
   |
help: Replace with `dict.fromkeys(iterable)`)

RUF022 `__all__` is not sorted
  --> app/services/security_metrics/domain/__init__.py:13:11
   |
11 |   )
12 |
13 |   __all__ = [
   |  ___________^
14 | |     # Models
15 | |     "SecurityFinding",
16 | |     "SecurityMetrics",
17 | |     "RiskPrediction",
18 | |     "Severity",
19 | |     "TrendDirection",
20 | |     # Ports
21 | |     "RiskCalculatorPort",
22 | |     "PredictiveAnalyticsPort",
23 | |     "MetricsCalculatorPort",
24 | |     "AnomalyDetectorPort",
25 | |     "FindingsRepositoryPort",
26 | |     "MetricsRepositoryPort",
27 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/security_metrics_engine.py:20:1
   |
18 |   """
19 |
20 | / import warnings
21 | |
22 | | # Import from refactored module
23 | | from app.services.security_metrics import (
24 | |     RiskPrediction,
25 | |     SecurityFinding,
26 | |     SecurityMetrics,
27 | |     SecurityMetricsEngine as RefactoredSecurityMetricsEngine,
28 | |     Severity,
29 | |     TrendDirection,
30 | |     get_security_metrics_engine,
31 | | )
   | |_^
32 |
33 |   # Emit deprecation warning
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/security_metrics_engine.py:43:11
   |
42 |   # Re-export everything for backward compatibility
43 |   __all__ = [
   |  ___________^
44 | |     # Main service
45 | |     "SecurityMetricsEngine",
46 | |     "get_security_metrics_engine",
47 | |     # Domain models
48 | |     "SecurityFinding",
49 | |     "SecurityMetrics",
50 | |     "RiskPrediction",
51 | |     "Severity",
52 | |     "TrendDirection",
53 | | ]
   | |_^
54 |
55 |   # Alias for backward compatibility
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/service_catalog/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/service_catalog/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/service_catalog/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/service_catalog/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/service_catalog/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/service_catalog/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/service_catalog/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/service_catalog/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/service_catalog/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/service_catalog/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/__init__.py:14:1
   |
13 |   # Domain models (pure entities)
14 | / from app.services.serving.domain.models import (
15 | |     ABTestConfig,
16 | |     EnsembleConfig,
17 | |     ModelMetrics,
18 | |     ModelRequest,
19 | |     ModelResponse,
20 | |     ModelStatus,
21 | |     ModelType,
22 | |     ModelVersion,
23 | |     RoutingStrategy,
24 | |     ServingStrategy,
25 | |     ShadowDeployment,
26 | | )
27 | |
28 | | # Application layer services
29 | | from app.services.serving.application.model_registry import ModelRegistry
30 | | from app.services.serving.application.inference_router import InferenceRouter
31 | | from app.services.serving.application.experiment_manager import ExperimentManager
32 | |
33 | | # Infrastructure layer
34 | | from app.services.serving.infrastructure.in_memory_repository import (
35 | |     InMemoryModelRepository,
36 | |     InMemoryMetricsRepository,
37 | | )
38 | | from app.services.serving.infrastructure.mock_model_invoker import MockModelInvoker
39 | |
40 | | # Facade for backward compatibility
41 | | from app.services.serving.facade import (
42 | |     ModelServingInfrastructure,
43 | |     get_model_serving_infrastructure,
44 | | )
   | |_^
45 |
46 |   __all__ = [
   |
help: Organize imports

RUF022 `__all__` is not sorted
  --> app/services/serving/__init__.py:46:11
   |
44 |   )
45 |
46 |   __all__ = [
   |  ___________^
47 | |     # Domain models
48 | |     "ModelVersion",
49 | |     "ModelMetrics",
50 | |     "ModelRequest",
51 | |     "ModelResponse",
52 | |     "ABTestConfig",
53 | |     "ShadowDeployment",
54 | |     "EnsembleConfig",
55 | |     "ModelStatus",
56 | |     "ModelType",
57 | |     "ServingStrategy",
58 | |     "RoutingStrategy",
59 | |     # Application services
60 | |     "ModelRegistry",
61 | |     "InferenceRouter",
62 | |     "ExperimentManager",
63 | |     # Infrastructure
64 | |     "InMemoryModelRepository",
65 | |     "InMemoryMetricsRepository",
66 | |     "MockModelInvoker",
67 | |     # Facade (backward compatibility)
68 | |     "ModelServingInfrastructure",
69 | |     "get_model_serving_infrastructure",
70 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/application/experiment_manager.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | import logging
13 | | import random
14 | | import threading
15 | | import time
16 | | import uuid
17 | | from datetime import UTC, datetime
18 | | from typing import Any
19 | |
20 | | from app.services.serving.domain.models import (
21 | |     ABTestConfig,
22 | |     EnsembleConfig,
23 | |     ModelRequest,
24 | |     ModelResponse,
25 | |     ShadowDeployment,
26 | | )
27 | | from app.services.serving.application.model_registry import ModelRegistry
28 | | from app.services.serving.application.inference_router import InferenceRouter
   | |_____________________________________________________________________________^
29 |
30 |   _LOG = logging.getLogger(__name__)
   |
help: Organize imports

F401 [*] `app.services.serving.domain.models.ModelRequest` imported but unused
  --> app/services/serving/application/experiment_manager.py:23:5
   |
21 |     ABTestConfig,
22 |     EnsembleConfig,
23 |     ModelRequest,
   |     ^^^^^^^^^^^^
24 |     ModelResponse,
25 |     ShadowDeployment,
   |
help: Remove unused import: `app.services.serving.domain.models.ModelRequest`

W293 Blank line contains whitespace
  --> app/services/serving/application/experiment_manager.py:36:1
   |
34 |     """
35 |     Manages experimental model serving strategies.
36 |
   | ^^^^
37 |     Responsibilities:
38 |     - A/B test creation and management
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/experiment_manager.py:42:1
   |
40 |     - Ensemble serving coordination
41 |     - Experiment analysis and reporting
42 |
   | ^^^^
43 |     Does NOT handle:
44 |     - Model loading (ModelRegistry)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/experiment_manager.py:56:1
   |
54 |         """
55 |         Initialize experiment manager.
56 |
   | ^^^^^^^^
57 |         Args:
58 |             registry: Model registry for model lookup
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/experiment_manager.py:82:1
   |
80 |         """
81 |         Start an A/B test between two models.
82 |
   | ^^^^^^^^
83 |         Args:
84 |             model_a_id: Model A version ID
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/experiment_manager.py:89:1
   |
87 |             duration_hours: Test duration in hours
88 |             success_metric: Metric to optimize (latency, cost, accuracy)
89 |
   | ^^^^^^^^^^^^
90 |         Returns:
91 |             Test ID
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:131:1
    |
129 |         """
130 |         Serve request within an A/B test.
131 |
    | ^^^^^^^^
132 |         Randomly routes to model A or B based on configured percentages.
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:133:1
    |
132 |         Randomly routes to model A or B based on configured percentages.
133 |
    | ^^^^^^^^
134 |         Args:
135 |             test_id: A/B test ID
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:138:1
    |
136 |             input_data: Input data
137 |             parameters: Optional parameters
138 |
    | ^^^^^^^^^^^^
139 |         Returns:
140 |             Model response
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:167:1
    |
165 |         """
166 |         Analyze A/B test results and determine winner.
167 |
    | ^^^^^^^^
168 |         Args:
169 |             test_id: Test ID
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:170:1
    |
168 |         Args:
169 |             test_id: Test ID
170 |
    | ^^^^^^^^^^^^
171 |         Returns:
172 |             Analysis results with winner determination
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
   --> app/services/serving/application/experiment_manager.py:179:9
    |
178 |           # Get metrics for both models
179 | /         from app.services.serving.infrastructure.in_memory_repository import (
180 | |             InMemoryMetricsRepository
181 | |         )
    | |_________^
182 |           metrics_repo = InMemoryMetricsRepository()
    |
help: Organize imports

W293 [*] Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:183:1
    |
181 |         )
182 |         metrics_repo = InMemoryMetricsRepository()
183 |
    | ^^^^^^^^
184 |         metrics_a = metrics_repo.get_summary(config.model_a_id)
185 |         metrics_b = metrics_repo.get_summary(config.model_b_id)
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:242:1
    |
240 |         """
241 |         Start shadow deployment for testing new model.
242 |
    | ^^^^^^^^
243 |         Args:
244 |             primary_model_id: Production model ID
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/experiment_manager.py:247:1
    |
245 |             shadow_model_id: Shadow model ID (being tested)
246 |             traffic_percentage: % of requests to shadow (0-100)
247 |
    | ^^^^^^^^^^^^
248 |         Returns:
249 |             Shadow deployment ID
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/application/inference_router.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | import logging
13 | | import uuid
14 | |
15 | | from app.services.serving.domain.models import (
16 | |     ModelRequest,
17 | |     ModelResponse,
18 | |     ModelStatus,
19 | | )
20 | | from app.services.serving.application.model_registry import ModelRegistry
21 | | from app.services.serving.infrastructure.mock_model_invoker import MockModelInvoker
22 | | from app.services.serving.infrastructure.in_memory_repository import (
23 | |     InMemoryMetricsRepository,
24 | | )
   | |_^
25 |
26 |   _LOG = logging.getLogger(__name__)
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/serving/application/inference_router.py:32:1
   |
30 |     """
31 |     Routes and executes inference requests.
32 |
   | ^^^^
33 |     Responsibilities:
34 |     - Route requests to appropriate model versions
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/inference_router.py:38:1
   |
36 |     - Track request/response history
37 |     - Update metrics
38 |
   | ^^^^
39 |     Does NOT handle:
40 |     - Model lifecycle (ModelRegistry)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/inference_router.py:53:1
   |
51 |         """
52 |         Initialize inference router.
53 |
   | ^^^^^^^^
54 |         Args:
55 |             registry: Model registry for model lookup
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/inference_router.py:72:1
   |
70 |         """
71 |         Serve an inference request.
72 |
   | ^^^^^^^^
73 |         Args:
74 |             model_name: Name of the model
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/inference_router.py:78:1
   |
76 |             version_id: Optional specific version ID
77 |             parameters: Optional request parameters
78 |
   | ^^^^^^^^^^^^
79 |         Returns:
80 |             Model response with results or error
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/serving/application/inference_router.py:125:1
    |
123 |         try:
124 |             response = self._invoker.invoke(model, request)
125 |
    | ^^^^^^^^^^^^
126 |             # Log success
127 |             if response.success:
    |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
   --> app/services/serving/application/inference_router.py:137:1
    |
135 |                     f"Request {request_id} failed: {response.error}"
136 |                 )
137 |
    | ^^^^^^^^^^^^
138 |             return response
    |
help: Remove whitespace from blank line

RUF010 [*] Use explicit conversion flag
   --> app/services/serving/application/inference_router.py:149:44
    |
147 |                 latency_ms=0.0,
148 |                 success=False,
149 |                 error=f"Inference failed: {str(e)}",
    |                                            ^^^^^^
150 |             )
    |
help: Replace with conversion flag

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:28:1
   |
26 |     """
27 |     Application service for model registration and lifecycle management.
28 |
   | ^^^^
29 |     Responsibilities:
30 |     - Register new models
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:34:1
   |
32 |     - Track model status
33 |     - Query model information
34 |
   | ^^^^
35 |     Does NOT handle:
36 |     - Inference execution (InferenceRouter)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:44:1
   |
42 |         """
43 |         Initialize model registry.
44 |
   | ^^^^^^^^
45 |         Args:
46 |             repository: Model storage repository (defaults to in-memory)
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:54:1
   |
52 |         """
53 |         Register a new model version.
54 |
   | ^^^^^^^^
55 |         Sets initial status to LOADING and starts async loading process.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:56:1
   |
55 |         Sets initial status to LOADING and starts async loading process.
56 |
   | ^^^^^^^^
57 |         Args:
58 |             model: Model version to register
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:59:1
   |
57 |         Args:
58 |             model: Model version to register
59 |
   | ^^^^^^^^^^^^
60 |         Returns:
61 |             True if registration successful, False if already exists
   |
help: Remove whitespace from blank line

W293 [*] Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:66:1
   |
64 |             # Set initial status
65 |             model.status = ModelStatus.LOADING
66 |
   | ^^^^^^^^^^^^
67 |             # Save to repository
68 |             if not self._repository.save(model):
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:86:1
   |
84 |         """
85 |         Unload a model (graceful shutdown).
86 |
   | ^^^^^^^^
87 |         Transitions to DRAINING status, then STOPPED after cooldown.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:88:1
   |
87 |         Transitions to DRAINING status, then STOPPED after cooldown.
88 |
   | ^^^^^^^^
89 |         Args:
90 |             version_id: Model version ID
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/application/model_registry.py:91:1
   |
89 |         Args:
90 |             version_id: Model version ID
91 |
   | ^^^^^^^^^^^^
92 |         Returns:
93 |             True if unload initiated, False if model not found
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:123:1
    |
121 |         """
122 |         List all models or models by name.
123 |
    | ^^^^^^^^
124 |         Args:
125 |             model_name: Optional filter by model name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:126:1
    |
124 |         Args:
125 |             model_name: Optional filter by model name
126 |
    | ^^^^^^^^^^^^
127 |         Returns:
128 |             List of model versions
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:137:1
    |
135 |         """
136 |         Get the latest READY version of a model.
137 |
    | ^^^^^^^^
138 |         Args:
139 |             model_name: Model name
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:140:1
    |
138 |         Args:
139 |             model_name: Model name
140 |
    | ^^^^^^^^^^^^
141 |         Returns:
142 |             Latest ready model version, or None if none available
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:157:1
    |
155 |         """
156 |         Async model loading simulation.
157 |
    | ^^^^^^^^
158 |         In real implementation, this would:
159 |         - Download model weights
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/application/model_registry.py:186:1
    |
184 |         """
185 |         Drain active requests and stop model.
186 |
    | ^^^^^^^^
187 |         Waits for cooldown period before transitioning to STOPPED.
188 |         """
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/domain/models.py:11:1
   |
 9 |   """
10 |
11 | / from __future__ import annotations
12 | |
13 | | from dataclasses import dataclass, field
14 | | from datetime import UTC, datetime
15 | | from enum import Enum
16 | | from typing import Any
   | |______________________^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/serving/domain/models.py:74:1
   |
72 |     """
73 |       
74 |
   | ^^^^
75 |     Entity representing a specific version of a model.
76 |     Immutable after creation (except status transitions).
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:99:1
    |
 97 |     """
 98 |       
 99 |
    | ^^^^
100 |     Value Object containing performance metrics snapshot.
101 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:123:1
    |
121 |     """
122 |       A/B
123 |
    | ^^^^
124 |     Entity representing an A/B test configuration.
125 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:143:1
    |
141 |     """
142 |        
143 |
    | ^^^^
144 |     Entity for shadow deployment configuration.
145 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:161:1
    |
159 |     """
160 |      
161 |
    | ^^^^
162 |     Value Object representing an inference request.
163 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:177:1
    |
175 |     """
176 |      
177 |
    | ^^^^
178 |     Value Object representing an inference response.
179 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/models.py:197:1
    |
195 |     """
196 |       (Ensemble)
197 |
    | ^^^^
198 |     Configuration for ensemble serving strategy.
199 |     """
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/domain/ports.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | from typing import Any, Protocol
13 | |
14 | | from app.services.serving.domain.models import (
15 | |     ModelMetrics,
16 | |     ModelRequest,
17 | |     ModelResponse,
18 | |     ModelVersion,
19 | | )
   | |_^
   |
help: Organize imports

W293 Blank line contains whitespace
  --> app/services/serving/domain/ports.py:30:1
   |
28 |     """
29 |     Port for model storage and retrieval.
30 |
   | ^^^^
31 |     Infrastructure implementations:
32 |     - InMemoryModelRepository
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/domain/ports.py:61:1
   |
59 |     """
60 |     Port for metrics storage.
61 |
   | ^^^^
62 |     Infrastructure implementations:
63 |     - InMemoryMetricsRepository
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/domain/ports.py:88:1
   |
86 |     """
87 |     Port for actual model inference.
88 |
   | ^^^^
89 |     Infrastructure implementations:
90 |     - OpenAIModelInvoker
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/ports.py:112:1
    |
110 |     """
111 |     Port for cost calculation.
112 |
    | ^^^^
113 |     Different pricing strategies for different providers.
114 |     """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/services/serving/domain/ports.py:134:1
    |
132 |     """
133 |     Port for load balancing strategies.
134 |
    | ^^^^
135 |     Implementations:
136 |     - RoundRobinBalancer
    |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/facade.py:16:1
   |
14 |   """
15 |
16 | / from __future__ import annotations
17 | |
18 | | import threading
19 | | from typing import Any
20 | |
21 | | from app.services.serving.domain.models import (
22 | |     ABTestConfig,
23 | |     EnsembleConfig,
24 | |     ModelMetrics,
25 | |     ModelRequest,
26 | |     ModelResponse,
27 | |     ModelStatus,
28 | |     ModelType,
29 | |     ModelVersion,
30 | |     RoutingStrategy,
31 | |     ServingStrategy,
32 | |     ShadowDeployment,
33 | | )
34 | | from app.services.serving.application.model_registry import ModelRegistry
35 | | from app.services.serving.application.inference_router import InferenceRouter
36 | | from app.services.serving.application.experiment_manager import ExperimentManager
37 | | from app.services.serving.infrastructure.in_memory_repository import (
38 | |     InMemoryModelRepository,
39 | |     InMemoryMetricsRepository,
40 | | )
41 | | from app.services.serving.infrastructure.mock_model_invoker import MockModelInvoker
   | |___________________________________________________________________________________^
   |
help: Organize imports

F401 [*] `app.services.serving.domain.models.EnsembleConfig` imported but unused
  --> app/services/serving/facade.py:23:5
   |
21 | from app.services.serving.domain.models import (
22 |     ABTestConfig,
23 |     EnsembleConfig,
   |     ^^^^^^^^^^^^^^
24 |     ModelMetrics,
25 |     ModelRequest,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ModelMetrics` imported but unused
  --> app/services/serving/facade.py:24:5
   |
22 |     ABTestConfig,
23 |     EnsembleConfig,
24 |     ModelMetrics,
   |     ^^^^^^^^^^^^
25 |     ModelRequest,
26 |     ModelResponse,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ModelRequest` imported but unused
  --> app/services/serving/facade.py:25:5
   |
23 |     EnsembleConfig,
24 |     ModelMetrics,
25 |     ModelRequest,
   |     ^^^^^^^^^^^^
26 |     ModelResponse,
27 |     ModelStatus,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ModelStatus` imported but unused
  --> app/services/serving/facade.py:27:5
   |
25 |     ModelRequest,
26 |     ModelResponse,
27 |     ModelStatus,
   |     ^^^^^^^^^^^
28 |     ModelType,
29 |     ModelVersion,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ModelType` imported but unused
  --> app/services/serving/facade.py:28:5
   |
26 |     ModelResponse,
27 |     ModelStatus,
28 |     ModelType,
   |     ^^^^^^^^^
29 |     ModelVersion,
30 |     RoutingStrategy,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.RoutingStrategy` imported but unused
  --> app/services/serving/facade.py:30:5
   |
28 |     ModelType,
29 |     ModelVersion,
30 |     RoutingStrategy,
   |     ^^^^^^^^^^^^^^^
31 |     ServingStrategy,
32 |     ShadowDeployment,
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ServingStrategy` imported but unused
  --> app/services/serving/facade.py:31:5
   |
29 |     ModelVersion,
30 |     RoutingStrategy,
31 |     ServingStrategy,
   |     ^^^^^^^^^^^^^^^
32 |     ShadowDeployment,
33 | )
   |
help: Remove unused import

F401 [*] `app.services.serving.domain.models.ShadowDeployment` imported but unused
  --> app/services/serving/facade.py:32:5
   |
30 |     RoutingStrategy,
31 |     ServingStrategy,
32 |     ShadowDeployment,
   |     ^^^^^^^^^^^^^^^^
33 | )
34 | from app.services.serving.application.model_registry import ModelRegistry
   |
help: Remove unused import

W293 Blank line contains whitespace
  --> app/services/serving/facade.py:47:1
   |
45 |     """
46 |     Facade for Model Serving Infrastructure.
47 |
   | ^^^^
48 |     **REFACTORED**: This class now delegates to specialized services
49 |     instead of implementing everything inline.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/facade.py:50:1
   |
48 |     **REFACTORED**: This class now delegates to specialized services
49 |     instead of implementing everything inline.
50 |
   | ^^^^
51 |     Maintains 100% backward compatibility with original API while
52 |     using clean layered architecture internally.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/facade.py:53:1
   |
51 |     Maintains 100% backward compatibility with original API while
52 |     using clean layered architecture internally.
53 |
   | ^^^^
54 |     Original responsibilities (851 lines) now delegated to:
55 |     - ModelRegistry: Model lifecycle management
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/infrastructure/in_memory_repository.py:22:1
   |
20 |     """
21 |     In-memory implementation of ModelRepository port.
22 |
   | ^^^^
23 |     Thread-safe storage using RLock.
24 |     Suitable for single-instance deployments or testing.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/infrastructure/in_memory_repository.py:77:1
   |
75 |     """
76 |     In-memory implementation of MetricsRepository port.
77 |
   | ^^^^
78 |     Stores metrics in a circular buffer (deque) per model.
79 |     Limited history to prevent memory overflow.
   |
help: Remove whitespace from blank line

I001 [*] Import block is un-sorted or un-formatted
  --> app/services/serving/infrastructure/mock_model_invoker.py:10:1
   |
 8 |   """
 9 |
10 | / from __future__ import annotations
11 | |
12 | | import random
13 | | import time
14 | | import uuid
15 | |
16 | | from app.services.serving.domain.models import (
17 | |     ModelRequest,
18 | |     ModelResponse,
19 | |     ModelVersion,
20 | |     ModelStatus,
21 | | )
   | |_^
   |
help: Organize imports

F401 [*] `uuid` imported but unused
  --> app/services/serving/infrastructure/mock_model_invoker.py:14:8
   |
12 | import random
13 | import time
14 | import uuid
   |        ^^^^
15 |
16 | from app.services.serving.domain.models import (
   |
help: Remove unused import: `uuid`

W293 Blank line contains whitespace
  --> app/services/serving/infrastructure/mock_model_invoker.py:27:1
   |
25 |     """
26 |     Mock implementation of ModelInvoker port.
27 |
   | ^^^^
28 |     Simulates inference with configurable latency and responses.
29 |     Useful for testing, development, and load testing.
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/infrastructure/mock_model_invoker.py:41:1
   |
39 |         """
40 |         Initialize mock invoker.
41 |
   | ^^^^^^^^
42 |         Args:
43 |             simulate_latency: Whether to simulate processing time
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/services/serving/infrastructure/mock_model_invoker.py:60:1
   |
58 |         """
59 |         Simulate model inference.
60 |
   | ^^^^^^^^
61 |         Returns a mock response with simulated processing time.
62 |         """
   |
help: Remove whitespace from blank line

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/sre_error_budget/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/sre_error_budget/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/sre_error_budget/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/sre_error_budget/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/sre_error_budget/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/sre_error_budget/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/sre_error_budget/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/sre_error_budget/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/sre_error_budget/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/sre_error_budget/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

RUF022 `__all__` is not sorted
  --> app/services/user_analytics_metrics_service.py:35:11
   |
34 |   # Re-export everything for backward compatibility
35 |   __all__ = [
   |  ___________^
36 | |     # Enums
37 | |     "EventType",
38 | |     "UserSegment",
39 | |     "ABTestVariant",
40 | |     # Models
41 | |     "UserEvent",
42 | |     "UserSession",
43 | |     "EngagementMetrics",
44 | |     "ConversionMetrics",
45 | |     "RetentionMetrics",
46 | |     "NPSMetrics",
47 | |     "ABTestResults",
48 | |     "CohortAnalysis",
49 | |     "RevenueMetrics",
50 | |     # Service
51 | |     "UserAnalyticsMetricsService",
52 | |     "get_user_analytics_service",
53 | |     "reset_analytics_service",
54 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/user_service/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/user_service/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/user_service/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/user_service/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/user_service/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/user_service/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/user_service/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/user_service/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/user_service/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/user_service/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

F401 [*] `dataclasses.dataclass` imported but unused
 --> app/services/workflow_orchestration/domain/models.py:7:25
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                         ^^^^^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `dataclasses.field` imported but unused
 --> app/services/workflow_orchestration/domain/models.py:7:36
  |
5 | from __future__ import annotations
6 |
7 | from dataclasses import dataclass, field
  |                                    ^^^^^
8 | from datetime import UTC, datetime
9 | from enum import Enum
  |
help: Remove unused import

F401 [*] `datetime.UTC` imported but unused
  --> app/services/workflow_orchestration/domain/models.py:8:22
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                      ^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `datetime.datetime` imported but unused
  --> app/services/workflow_orchestration/domain/models.py:8:27
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
   |                           ^^^^^^^^
 9 | from enum import Enum
10 | from typing import Any
   |
help: Remove unused import

F401 [*] `enum.Enum` imported but unused
  --> app/services/workflow_orchestration/domain/models.py:9:18
   |
 7 | from dataclasses import dataclass, field
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
   |                  ^^^^
10 | from typing import Any
   |
help: Remove unused import: `enum.Enum`

F401 [*] `typing.Any` imported but unused
  --> app/services/workflow_orchestration/domain/models.py:10:20
   |
 8 | from datetime import UTC, datetime
 9 | from enum import Enum
10 | from typing import Any
   |                    ^^^
   |
help: Remove unused import: `typing.Any`

F401 [*] `abc.ABC` imported but unused
 --> app/services/workflow_orchestration/domain/ports.py:5:17
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                 ^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `abc.abstractmethod` imported but unused
 --> app/services/workflow_orchestration/domain/ports.py:5:22
  |
3 | """
4 |
5 | from abc import ABC, abstractmethod
  |                      ^^^^^^^^^^^^^^
6 | from typing import Protocol
  |
help: Remove unused import

F401 [*] `typing.Protocol` imported but unused
 --> app/services/workflow_orchestration/domain/ports.py:6:20
  |
5 | from abc import ABC, abstractmethod
6 | from typing import Protocol
  |                    ^^^^^^^^
  |
help: Remove unused import: `typing.Protocol`

W291 [*] Trailing whitespace
  --> app/services/workflow_orchestration/domain/ports.py:14:2
   |
12 | #     def save(self, entity) -> None:
13 | #         ...
14 | #
   |  ^^^^^
15 | #     def find_by_id(self, id: str):
16 | #         ...
   |
help: Remove trailing whitespace

RUF022 [*] `__all__` is not sorted
  --> app/serving/application/__init__.py:9:11
   |
 7 |   from .shadow_deployment import ShadowDeploymentManager
 8 |
 9 |   __all__ = [
   |  ___________^
10 | |     "ModelRegistry",
11 | |     "ABTestEngine",
12 | |     "ShadowDeploymentManager",
13 | |     "EnsembleRouter",
14 | |     "ModelInvoker",
15 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/serving/application/ab_test_engine.py:26:1
   |
24 |     """
25 |     A/B Testing Engine -   A/B
26 |
   | ^^^^
27 |     Responsibilities:
28 |     - Create and manage A/B test configurations
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ab_test_engine.py:47:1
   |
45 |         """
46 |           A/B  
47 |
   | ^^^^^^^^
48 |         Args:
49 |             model_a_id:   A
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ab_test_engine.py:53:1
   |
51 |             split_percentage:    A (  B)
52 |             duration_hours:   
53 |
   | ^^^^^^^^^^^^
54 |         Returns:
55 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ab_test_engine.py:83:1
   |
81 |         """
82 |             A/B
83 |
   | ^^^^^^^^
84 |         Args:
85 |             test_id:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ab_test_engine.py:86:1
   |
84 |         Args:
85 |             test_id:  
86 |
   | ^^^^^^^^^^^^
87 |         Returns:
88 |               
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ab_test_engine.py:104:1
    |
102 |         """
103 |            A/B  
104 |
    | ^^^^^^^^
105 |         Args:
106 |             test_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ab_test_engine.py:108:1
    |
106 |             test_id:  
107 |             metrics_getter:     
108 |
    | ^^^^^^^^^^^^
109 |         Returns:
110 |              
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ab_test_engine.py:144:1
    |
142 |         """
143 |             A/B
144 |
    | ^^^^^^^^
145 |         Args:
146 |             test_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ab_test_engine.py:147:1
    |
145 |         Args:
146 |             test_id:  
147 |
    | ^^^^^^^^^^^^
148 |         Returns:
149 |                None
    |
help: Remove whitespace from blank line

F401 [*] `time` imported but unused
  --> app/serving/application/ensemble_router.py:10:8
   |
 9 | import threading
10 | import time
   |        ^^^^
11 | import uuid
12 | from collections import Counter
   |
help: Remove unused import: `time`

W293 Blank line contains whitespace
  --> app/serving/application/ensemble_router.py:21:1
   |
19 |     """
20 |     Ensemble Router -  
21 |
   | ^^^^
22 |     Responsibilities:
23 |     - Create and manage ensemble configurations
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ensemble_router.py:40:1
   |
38 |         """
39 |            (Ensemble)
40 |
   | ^^^^^^^^
41 |         Args:
42 |             model_versions:   
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ensemble_router.py:45:1
   |
43 |             aggregation_method:   (voting, averaging, stacking)
44 |             weights:   ()
45 |
   | ^^^^^^^^^^^^
46 |         Returns:
47 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ensemble_router.py:70:1
   |
68 |         """
69 |           
70 |
   | ^^^^^^^^
71 |         Args:
72 |             responses:   
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/ensemble_router.py:74:1
   |
72 |             responses:   
73 |             ensemble_id:  
74 |
   | ^^^^^^^^^^^^
75 |         Returns:
76 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ensemble_router.py:115:1
    |
113 |         """
114 |            
115 |
    | ^^^^^^^^
116 |         Args:
117 |             ensemble_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ensemble_router.py:118:1
    |
116 |         Args:
117 |             ensemble_id:  
118 |
    | ^^^^^^^^^^^^
119 |         Returns:
120 |                None
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ensemble_router.py:134:1
    |
132 |         """
133 |           
134 |
    | ^^^^^^^^
135 |         Args:
136 |             ensemble_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/ensemble_router.py:140:1
    |
138 |             responses:    
139 |             total_latency:   
140 |
    | ^^^^^^^^^^^^
141 |         Returns:
142 |              
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_invoker.py:27:1
   |
25 |     """
26 |     Model Invoker -  
27 |
   | ^^^^
28 |     Responsibilities:
29 |     - Execute model inference
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_invoker.py:48:1
   |
46 |         """
47 |           
48 |
   | ^^^^^^^^
49 |         Args:
50 |             model:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_invoker.py:55:1
   |
53 |             cost_calculator:   
54 |             metrics_updater:   
55 |
   | ^^^^^^^^^^^^
56 |         Returns:
57 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_invoker.py:137:1
    |
135 |         """
136 |           
137 |
    | ^^^^^^^^
138 |           :
139 |         -   API  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_invoker.py:141:1
    |
139 |         -   API  
140 |         -    
141 |
    | ^^^^^^^^
142 |           
143 |         """
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:20:1
   |
18 |     """
19 |     Model Registry -    
20 |
   | ^^^^
21 |     Responsibilities:
22 |     - Register new model versions
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:35:1
   |
33 |         """
34 |           
35 |
   | ^^^^^^^^
36 |         Args:
37 |             model:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:38:1
   |
36 |         Args:
37 |             model:  
38 |
   | ^^^^^^^^^^^^
39 |         Returns:
40 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:63:1
   |
61 |         """
62 |           
63 |
   | ^^^^^^^^
64 |         Args:
65 |             version_id:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:66:1
   |
64 |         Args:
65 |             version_id:  
66 |
   | ^^^^^^^^^^^^
67 |         Returns:
68 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/model_registry.py:95:1
   |
93 |         """
94 |               
95 |
   | ^^^^^^^^
96 |         Args:
97 |             model_name:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_registry.py:98:1
    |
 96 |         Args:
 97 |             model_name:  
 98 |
    | ^^^^^^^^^^^^
 99 |         Returns:
100 |                 None
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_registry.py:118:1
    |
116 |         """
117 |            
118 |
    | ^^^^^^^^
119 |         Returns:
120 |              
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_registry.py:128:1
    |
126 |         """
127 |            
128 |
    | ^^^^^^^^
129 |         Args:
130 |             version_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/model_registry.py:131:1
    |
129 |         Args:
130 |             version_id:  
131 |
    | ^^^^^^^^^^^^
132 |         Returns:
133 |               None
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:24:1
   |
22 |     """
23 |     Shadow Deployment Manager -   
24 |
   | ^^^^
25 |     Responsibilities:
26 |     - Create and manage shadow deployments
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:43:1
   |
41 |         """
42 |              (Shadow Mode)
43 |
   | ^^^^^^^^
44 |         Args:
45 |             primary_model_id:   ()
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:48:1
   |
46 |             shadow_model_id:   ()
47 |             traffic_percentage:   
48 |
   | ^^^^^^^^^^^^
49 |         Returns:
50 |               
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:69:1
   |
67 |         """
68 |              
69 |
   | ^^^^^^^^
70 |         Args:
71 |             shadow_id:   
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:72:1
   |
70 |         Args:
71 |             shadow_id:   
72 |
   | ^^^^^^^^^^^^
73 |         Returns:
74 |             True    
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/application/shadow_deployment.py:90:1
   |
88 |         """
89 |              
90 |
   | ^^^^^^^^
91 |         Args:
92 |             shadow_id:   
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/shadow_deployment.py:114:1
    |
112 |         """
113 |             
114 |
    | ^^^^^^^^
115 |         Args:
116 |             shadow_id:   
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/application/shadow_deployment.py:117:1
    |
115 |         Args:
116 |             shadow_id:   
117 |
    | ^^^^^^^^^^^^
118 |         Returns:
119 |                None
    |
help: Remove whitespace from blank line

RUF022 [*] `__all__` is not sorted
  --> app/serving/domain/entities/__init__.py:8:11
   |
 6 |   from .request_response import ModelRequest, ModelResponse, RoutingStrategy
 7 |
 8 |   __all__ = [
   |  ___________^
 9 | |     "ModelStatus",
10 | |     "ModelType",
11 | |     "ModelVersion",
12 | |     "ModelMetrics",
13 | |     "ServingStrategy",
14 | |     "ABTestConfig",
15 | |     "ShadowDeployment",
16 | |     "EnsembleConfig",
17 | |     "RoutingStrategy",
18 | |     "ModelRequest",
19 | |     "ModelResponse",
20 | | ]
   | |_^
   |
help: Apply an isort-style sorting to `__all__`

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:21:1
   |
19 |     """
20 |     Metrics Collector -  
21 |
   | ^^^^
22 |     Responsibilities:
23 |     - Collect performance metrics for each model
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:64:1
   |
62 |         """
63 |           
64 |
   | ^^^^^^^^
65 |         Args:
66 |             version_id:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:78:1
   |
76 |         """
77 |           
78 |
   | ^^^^^^^^
79 |         Args:
80 |             model:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:82:1
   |
80 |             model:  
81 |             output:  
82 |
   | ^^^^^^^^^^^^
83 |         Returns:
84 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:93:1
   |
91 |         """
92 |             
93 |
   | ^^^^^^^^
94 |         Args:
95 |             version_id:  
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
  --> app/serving/infrastructure/metrics_collector.py:96:1
   |
94 |         Args:
95 |             version_id:  
96 |
   | ^^^^^^^^^^^^
97 |         Returns:
98 |              
   |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/infrastructure/metrics_collector.py:122:1
    |
120 |         """
121 |             
122 |
    | ^^^^^^^^
123 |         Args:
124 |             version_id:  
    |
help: Remove whitespace from blank line

W293 Blank line contains whitespace
   --> app/serving/infrastructure/metrics_collector.py:125:1
    |
123 |         Args:
124 |             version_id:  
125 |
    | ^^^^^^^^^^^^
126 |         Returns:
127 |              
    |
help: Remove whitespace from blank line

Found 2575 errors.
[*] 1883 fixable with the `--fix` option (631 hidden fixes can be enabled with the `--unsafe-fixes` option).

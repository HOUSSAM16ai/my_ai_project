CI Failure Summary (STEP 5)
============================

Root Causes Identified:
1.  **Duplicate Test Invocations:** Multiple CI workflow files (`required-ci.yml`, `ci.yml`, `transcendent.yml`) were triggered on pull requests, causing pytest to run multiple times. This led to redundant checks, longer CI times, and confusing, repeated log outputs.
2.  **Legacy Flask Configuration:** The `ci.yml` workflow still contained legacy Flask environment variables (`FLASK_ENV`, `TESTING`), which are no longer relevant after the migration to FastAPI.
3.  **Potential Race Conditions in SQLModel:** The manual invocation of `update_forward_refs()` in `app/models.py` was not robust. If a new model with a forward reference was added without updating the list, it could lead to `NameError` or mapper initialization race conditions.
4.  **Inconsistent Test Database Setup:** The test database setup in `tests/conftest.py` was not optimally configured for a fully async test suite using SQLModel. The session creation and teardown logic could be made more robust to ensure complete test isolation.

Fixes Applied:
-   **CI Workflow Consolidation:** The `required-ci.yml` workflow was established as the single source of truth for all PR checks. It now runs the full test suite (`pytest tests/`). The `ci.yml` file was deleted, and `transcendent.yml` was modified to be a manual-trigger-only workflow.
-   **Environment Sanitization:** All Flask-specific environment variables were removed from the CI configuration.
-   **Robust Forward Ref Handling:** Replaced manual `update_forward_refs()` calls in `app/models.py` with an automated loop that iterates over all `SQLModel` subclasses, making the model initialization process deterministic and future-proof.
-   **Improved Async Test Fixtures:** Refactored `tests/conftest.py` to use a more standardized and robust pattern for creating the async engine and providing isolated, transaction-wrapped async sessions to each test function, using `SQLModel.metadata.create_all` for consistency.

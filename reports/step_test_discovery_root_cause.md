# تقرير تحليل السبب الجذري: انهيار اكتشاف مجموعة الاختبارات

## ملخص
حدث فشل كارثي أدى إلى انخفاض عدد الاختبارات المكتشفة من حوالي 650 اختبارًا إلى 9 فقط. يوضح هذا التقرير بالتفصيل السبب الجذري لهذا الفشل والخطوات التي تم اتخاذها لتشخيصه.

## العرض الأولي
عند تشغيل `pytest --collect-only -q`، كانت النتيجة الفورية هي خطأ `ModuleNotFoundError: No module named 'pytest_asyncio'`. حدث هذا الخطأ أثناء تحميل ملف إعداد الاختبار المركزي، `tests/conftest.py`، الذي يعتمد بشكل كبير على هذه المكتبة للاختبارات غير المتزامنة.

## مسار التحقيق
1.  **التحقق من المتطلبات:** تم فحص ملف `requirements.txt` وتأكد وجود `pytest-asyncio` ضمن قائمة المتطلبات.
2.  **محاولة الإصلاح الأولية:** تم تنفيذ `pip install -r requirements.txt`، والذي اكتمل بنجاح. ومع ذلك، فشل تشغيل `pytest` اللاحق بنفس الخطأ.
3.  **تشخيص البيئة:** تم تشغيل `pip list` للكشف عن الحزم المثبتة. أظهرت النتائج بيئة شبه فارغة، مما أكد أن الحزم التي تم تثبيتها في الخطوة السابقة لم تكن موجودة.

## السبب الجذري
يكمن السبب الجذري في طبيعة **بيئة التنفيذ المؤقتة وغير المستمرة**. يتم تنفيذ كل أمر `run_in_bash_session` في حاوية معزولة ومنفصلة. نتيجة لذلك، فإن تثبيت التبعيات في أمر واحد لا يجعلها متاحة للأوامر اللاحقة. كان أمر `pytest` يعمل في بيئة "نظيفة" تفتقر إلى التبعيات اللازمة، مما تسبب في فشل استيراد `pytest-asyncio` وبالتالي توقف عملية اكتشاف الاختبار بالكامل عند تحميل `conftest.py`.

## الخلاصة
لم يكن الفشل ناتجًا عن خطأ في تكوين تبعيات المشروع أو كود الاختبار، بل كان سمة من سمات بيئة التنفيذ المعزولة. تم حل المشكلة عن طريق **ربط أوامر التثبيت والتنفيذ في عملية ذرية واحدة** (`pip install ... && pytest ...`)، مما ضمن تشغيل جامع الاختبارات داخل بيئة مهيأة بشكل صحيح.
